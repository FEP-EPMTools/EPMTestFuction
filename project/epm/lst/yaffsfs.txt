; generated by ARM C/C++ Compiler, 5.03 [Build 76]
; commandline ArmCC [--c99 --list --debug -c --asm --interleave -o.\obj\yaffsfs.o --asm_dir=.\lst\ --list_dir=.\lst\ --depend=.\obj\yaffsfs.d --cpu=ARM926EJ-S --apcs=interwork -O0 -I.\src -I..\..\common\src\BSP\Driver\Include -I..\..\common\src\FreeRTOS -I..\..\common\src\FreeRTOS\Source\include -I..\..\common\src\FreeRTOS\Source\portable\RVDS\ARM926EJ-S -I..\..\common\src\BSP\ThirdParty\FATFS\src -I.\src\userdrv -I.\src\syshal -I.\src\user -I.\src\userdrv\vl53l0x\core\inc -I.\src\userdrv\vl53l0x\platform\inc -I.\src\syshal\json -I.\src\syshal\modemlib -I..\..\common\src\BSP\ThirdParty\yaffs2 -I..\..\common\src\BSP\ThirdParty\yaffs2\include -I..\..\common\src\BSP\ThirdParty\yaffs2\include\asm -I..\..\common\src\BSP\ThirdParty\yaffs2\include\linux -I.\src\syshal\yaffs2 -I..\..\common\src\BSP\Library\SmartcardLib\Include -I.\src\syshal\cardlib -I.\src\syshal\cardlog -I.\src\syshal\blk -I..\..\common\src\BSP\Library\USB_HOST\Inc -I..\..\common\src\BSP\Library\USB_HOST\Inc\usb_uvc -IC:\Keil\ARM\RV31\INC -IC:\Keil\ARM\CMSIS\Include -IC:\Keil\ARM\Inc\Toshiba -DEPM_PROJECT -DCONFIG_YAFFS_DIRECT -DCONFIG_YAFFS_SHORT_NAMES_IN_RAM -DCONFIG_YAFFS_YAFFS2 -DNO_Y_INLINE -DCONFIG_YAFFS_PROVIDE_DEFS -DCONFIG_YAFFSFS_PROVIDE_VALUES --omf_browse=.\obj\yaffsfs.crf ..\..\common\src\BSP\ThirdParty\yaffs2\yaffsfs.c]
                          ARM

                          AREA ||.text||, CODE, READONLY, ALIGN=2

                  list_add PROC
;;;52     /* Add an element to a list */
;;;53     static __inline void list_add(struct list_head *new_entry,
000000  e5912000          LDR      r2,[r1,#0]
;;;54     				struct list_head *list)
;;;55     {
;;;56     	struct list_head *list_next = list->next;
;;;57     
;;;58     	list->next = new_entry;
000004  e5810000          STR      r0,[r1,#0]
;;;59     	new_entry->prev = list;
000008  e5801004          STR      r1,[r0,#4]
;;;60     	new_entry->next = list_next;
00000c  e5802000          STR      r2,[r0,#0]
;;;61     	list_next->prev = new_entry;
000010  e5820004          STR      r0,[r2,#4]
;;;62     
;;;63     }
000014  e12fff1e          BX       lr
;;;64     
                          ENDP

                  yaffs_set_trace PROC
;;;103    
;;;104    unsigned yaffs_set_trace(unsigned tm)
000018  e1a01000          MOV      r1,r0
;;;105    {
;;;106    	yaffs_trace_mask = tm;
00001c  e59f0998          LDR      r0,|L1.2492|
000020  e5801000          STR      r1,[r0,#0]  ; yaffs_trace_mask
;;;107    	return yaffs_trace_mask;
000024  e5900000          LDR      r0,[r0,#0]  ; yaffs_trace_mask
;;;108    }
000028  e12fff1e          BX       lr
;;;109    
                          ENDP

                  yaffs_get_trace PROC
;;;110    unsigned yaffs_get_trace(void)
00002c  e59f0988          LDR      r0,|L1.2492|
;;;111    {
;;;112    	return yaffs_trace_mask;
000030  e5900000          LDR      r0,[r0,#0]  ; yaffs_trace_mask
;;;113    }
000034  e12fff1e          BX       lr
;;;114    
                          ENDP

                  yaffsfs_InitHandles PROC
;;;119    
;;;120    static void yaffsfs_InitHandles(void)
000038  e92d4010          PUSH     {r4,lr}
;;;121    {
;;;122    	int i;
;;;123    	if (yaffsfs_handlesInitialised)
00003c  e59f097c          LDR      r0,|L1.2496|
000040  e5900000          LDR      r0,[r0,#0]  ; yaffsfs_handlesInitialised
000044  e3500000          CMP      r0,#0
000048  0a000000          BEQ      |L1.80|
                  |L1.76|
;;;124    		return;
;;;125    
;;;126    	memset(yaffsfs_inode, 0, sizeof(yaffsfs_inode));
;;;127    	memset(yaffsfs_fd, 0, sizeof(yaffsfs_fd));
;;;128    	memset(yaffsfs_handle, 0, sizeof(yaffsfs_handle));
;;;129    	memset(yaffsfs_dsc, 0, sizeof(yaffsfs_dsc));
;;;130    
;;;131    	for (i = 0; i < YAFFSFS_N_HANDLES; i++)
;;;132    		yaffsfs_fd[i].inodeId = -1;
;;;133    	for (i = 0; i < YAFFSFS_N_HANDLES; i++)
;;;134    		yaffsfs_handle[i].fdId = -1;
;;;135    }
00004c  e8bd8010          POP      {r4,pc}
                  |L1.80|
000050  e3a01e32          MOV      r1,#0x320             ;126
000054  e59f0968          LDR      r0,|L1.2500|
000058  ebfffffe          BL       __aeabi_memclr4
00005c  e3a01d19          MOV      r1,#0x640             ;127
000060  e59f0960          LDR      r0,|L1.2504|
000064  ebfffffe          BL       __aeabi_memclr4
000068  e3a01e19          MOV      r1,#0x190             ;128
00006c  e59f0958          LDR      r0,|L1.2508|
000070  ebfffffe          BL       __aeabi_memclr
000074  e59f1954          LDR      r1,|L1.2512|
000078  e59f0954          LDR      r0,|L1.2516|
00007c  ebfffffe          BL       __aeabi_memclr4
000080  e3a04000          MOV      r4,#0                 ;131
000084  ea000006          B        |L1.164|
                  |L1.136|
000088  e59f0938          LDR      r0,|L1.2504|
00008c  e7900204          LDR      r0,[r0,r4,LSL #4]     ;132
000090  e3800a1f          ORR      r0,r0,#0x1f000        ;132
000094  e3800efe          ORR      r0,r0,#0xfe0          ;132
000098  e59f1928          LDR      r1,|L1.2504|
00009c  e7810204          STR      r0,[r1,r4,LSL #4]     ;132
0000a0  e2844001          ADD      r4,r4,#1              ;131
                  |L1.164|
0000a4  e3540064          CMP      r4,#0x64              ;131
0000a8  bafffff6          BLT      |L1.136|
0000ac  e3a04000          MOV      r4,#0                 ;133
0000b0  ea000004          B        |L1.200|
                  |L1.180|
0000b4  e3e00000          MVN      r0,#0                 ;134
0000b8  e59f190c          LDR      r1,|L1.2508|
0000bc  e0811104          ADD      r1,r1,r4,LSL #2       ;134
0000c0  e1c100b0          STRH     r0,[r1,#0]            ;134
0000c4  e2844001          ADD      r4,r4,#1              ;133
                  |L1.200|
0000c8  e3540064          CMP      r4,#0x64              ;133
0000cc  bafffff8          BLT      |L1.180|
0000d0  e1a00000          MOV      r0,r0
0000d4  eaffffdc          B        |L1.76|
;;;136    
                          ENDP

                  yaffsfs_HandleToPointer PROC
;;;137    static struct yaffsfs_Handle *yaffsfs_HandleToPointer(int h)
0000d8  e1a01000          MOV      r1,r0
;;;138    {
;;;139    	if (h >= 0 && h < YAFFSFS_N_HANDLES)
0000dc  e3510000          CMP      r1,#0
0000e0  ba000004          BLT      |L1.248|
0000e4  e3510064          CMP      r1,#0x64
0000e8  aa000002          BGE      |L1.248|
;;;140    		return &yaffsfs_handle[h];
0000ec  e59f08d8          LDR      r0,|L1.2508|
0000f0  e0800101          ADD      r0,r0,r1,LSL #2
                  |L1.244|
;;;141    	return NULL;
;;;142    }
0000f4  e12fff1e          BX       lr
                  |L1.248|
0000f8  e3a00000          MOV      r0,#0                 ;141
0000fc  eafffffc          B        |L1.244|
;;;143    
                          ENDP

                  yaffsfs_HandleToFileDes PROC
;;;144    static struct yaffsfs_FileDes *yaffsfs_HandleToFileDes(int handle)
000100  e92d4070          PUSH     {r4-r6,lr}
;;;145    {
000104  e1a05000          MOV      r5,r0
;;;146    	struct yaffsfs_Handle *h = yaffsfs_HandleToPointer(handle);
000108  e1a00005          MOV      r0,r5
00010c  ebfffffe          BL       yaffsfs_HandleToPointer
000110  e1a04000          MOV      r4,r0
;;;147    
;;;148    	if (h && h->useCount > 0 && h->fdId >= 0 && h->fdId < YAFFSFS_N_HANDLES)
000114  e3540000          CMP      r4,#0
000118  0a00000c          BEQ      |L1.336|
00011c  e1d400f2          LDRSH    r0,[r4,#2]
000120  e3500000          CMP      r0,#0
000124  da000009          BLE      |L1.336|
000128  e1d400f0          LDRSH    r0,[r4,#0]
00012c  e3500000          CMP      r0,#0
000130  ba000006          BLT      |L1.336|
000134  e1d400f0          LDRSH    r0,[r4,#0]
000138  e3500064          CMP      r0,#0x64
00013c  aa000003          BGE      |L1.336|
;;;149    		return &yaffsfs_fd[h->fdId];
000140  e1d400f0          LDRSH    r0,[r4,#0]
000144  e59f187c          LDR      r1,|L1.2504|
000148  e0810200          ADD      r0,r1,r0,LSL #4
                  |L1.332|
;;;150    
;;;151    	return NULL;
;;;152    }
00014c  e8bd8070          POP      {r4-r6,pc}
                  |L1.336|
000150  e3a00000          MOV      r0,#0                 ;151
000154  eafffffc          B        |L1.332|
;;;153    
                          ENDP

                  yaffsfs_HandleToInode PROC
;;;154    static struct yaffsfs_Inode *yaffsfs_HandleToInode(int handle)
000158  e92d4070          PUSH     {r4-r6,lr}
;;;155    {
00015c  e1a05000          MOV      r5,r0
;;;156    	struct yaffsfs_FileDes *fd = yaffsfs_HandleToFileDes(handle);
000160  e1a00005          MOV      r0,r5
000164  ebfffffe          BL       yaffsfs_HandleToFileDes
000168  e1a04000          MOV      r4,r0
;;;157    
;;;158    	if (fd && fd->handleCount > 0 &&
00016c  e3540000          CMP      r4,#0
000170  0a000013          BEQ      |L1.452|
000174  e5940000          LDR      r0,[r4,#0]
000178  e1a00280          LSL      r0,r0,#5
00017c  e1a00b20          LSR      r0,r0,#22
000180  e3500000          CMP      r0,#0
000184  da00000e          BLE      |L1.452|
;;;159    	    fd->inodeId >= 0 && fd->inodeId < YAFFSFS_N_HANDLES)
000188  e5940000          LDR      r0,[r4,#0]
00018c  e1a00780          LSL      r0,r0,#15
000190  e1b00a20          LSRS     r0,r0,#20
000194  4a00000a          BMI      |L1.452|
000198  e5940000          LDR      r0,[r4,#0]
00019c  e1a00780          LSL      r0,r0,#15
0001a0  e3a01064          MOV      r1,#0x64
0001a4  e1510a20          CMP      r1,r0,LSR #20
0001a8  da000005          BLE      |L1.452|
;;;160    		return &yaffsfs_inode[fd->inodeId];
0001ac  e5940000          LDR      r0,[r4,#0]
0001b0  e1a00780          LSL      r0,r0,#15
0001b4  e1a00a20          LSR      r0,r0,#20
0001b8  e59f1804          LDR      r1,|L1.2500|
0001bc  e0810180          ADD      r0,r1,r0,LSL #3
                  |L1.448|
;;;161    
;;;162    	return NULL;
;;;163    }
0001c0  e8bd8070          POP      {r4-r6,pc}
                  |L1.452|
0001c4  e3a00000          MOV      r0,#0                 ;162
0001c8  eafffffc          B        |L1.448|
;;;164    
                          ENDP

                  yaffsfs_HandleToObject PROC
;;;165    static struct yaffs_obj *yaffsfs_HandleToObject(int handle)
0001cc  e92d4070          PUSH     {r4-r6,lr}
;;;166    {
0001d0  e1a05000          MOV      r5,r0
;;;167    	struct yaffsfs_Inode *in = yaffsfs_HandleToInode(handle);
0001d4  e1a00005          MOV      r0,r5
0001d8  ebfffffe          BL       yaffsfs_HandleToInode
0001dc  e1a04000          MOV      r4,r0
;;;168    
;;;169    	if (in)
0001e0  e3540000          CMP      r4,#0
0001e4  0a000001          BEQ      |L1.496|
;;;170    		return in->iObj;
0001e8  e5940004          LDR      r0,[r4,#4]
                  |L1.492|
;;;171    
;;;172    	return NULL;
;;;173    }
0001ec  e8bd8070          POP      {r4-r6,pc}
                  |L1.496|
0001f0  e3a00000          MOV      r0,#0                 ;172
0001f4  eafffffc          B        |L1.492|
;;;174    
                          ENDP

                  yaffsfs_FindInodeIdForObject PROC
;;;179    
;;;180    static int yaffsfs_FindInodeIdForObject(struct yaffs_obj *obj)
0001f8  e92d4070          PUSH     {r4-r6,lr}
;;;181    {
0001fc  e1a05000          MOV      r5,r0
;;;182    	int i;
;;;183    	int ret = -1;
000200  e3e06000          MVN      r6,#0
;;;184    
;;;185    	if (obj)
000204  e3550000          CMP      r5,#0
000208  0a000002          BEQ      |L1.536|
;;;186    		obj = yaffs_get_equivalent_obj(obj);
00020c  e1a00005          MOV      r0,r5
000210  ebfffffe          BL       yaffs_get_equivalent_obj
000214  e1a05000          MOV      r5,r0
                  |L1.536|
;;;187    
;;;188    	/* Look for it in open inode table */
;;;189    	for (i = 0; i < YAFFSFS_N_HANDLES && ret < 0; i++) {
000218  e3a04000          MOV      r4,#0
00021c  ea000006          B        |L1.572|
                  |L1.544|
;;;190    		if (yaffsfs_inode[i].iObj == obj)
000220  e59f079c          LDR      r0,|L1.2500|
000224  e0800184          ADD      r0,r0,r4,LSL #3
000228  e5900004          LDR      r0,[r0,#4]
00022c  e1500005          CMP      r0,r5
000230  1a000000          BNE      |L1.568|
;;;191    			ret = i;
000234  e1a06004          MOV      r6,r4
                  |L1.568|
000238  e2844001          ADD      r4,r4,#1              ;189
                  |L1.572|
00023c  e3540064          CMP      r4,#0x64              ;189
000240  aa000001          BGE      |L1.588|
000244  e3560000          CMP      r6,#0                 ;189
000248  bafffff4          BLT      |L1.544|
                  |L1.588|
;;;192    	}
;;;193    	return ret;
00024c  e1a00006          MOV      r0,r6
;;;194    }
000250  e8bd8070          POP      {r4-r6,pc}
;;;195    
                          ENDP

                  yaffsfs_GetInodeIdForObject PROC
;;;199     */
;;;200    static int yaffsfs_GetInodeIdForObject(struct yaffs_obj *obj)
000254  e92d41f0          PUSH     {r4-r8,lr}
;;;201    {
000258  e1a07000          MOV      r7,r0
;;;202    	int i;
;;;203    	int ret;
;;;204    	struct yaffsfs_Inode *in = NULL;
00025c  e3a06000          MOV      r6,#0
;;;205    
;;;206    	if (obj)
000260  e3570000          CMP      r7,#0
000264  0a000002          BEQ      |L1.628|
;;;207    		obj = yaffs_get_equivalent_obj(obj);
000268  e1a00007          MOV      r0,r7
00026c  ebfffffe          BL       yaffs_get_equivalent_obj
000270  e1a07000          MOV      r7,r0
                  |L1.628|
;;;208    
;;;209    	ret = yaffsfs_FindInodeIdForObject(obj);
000274  e1a00007          MOV      r0,r7
000278  ebfffffe          BL       yaffsfs_FindInodeIdForObject
00027c  e1a05000          MOV      r5,r0
;;;210    
;;;211    	for (i = 0; i < YAFFSFS_N_HANDLES && ret < 0; i++) {
000280  e3a04000          MOV      r4,#0
000284  ea000006          B        |L1.676|
                  |L1.648|
;;;212    		if (!yaffsfs_inode[i].iObj)
000288  e59f0734          LDR      r0,|L1.2500|
00028c  e0800184          ADD      r0,r0,r4,LSL #3
000290  e5900004          LDR      r0,[r0,#4]
000294  e3500000          CMP      r0,#0
000298  1a000000          BNE      |L1.672|
;;;213    			ret = i;
00029c  e1a05004          MOV      r5,r4
                  |L1.672|
0002a0  e2844001          ADD      r4,r4,#1              ;211
                  |L1.676|
0002a4  e3540064          CMP      r4,#0x64              ;211
0002a8  aa000001          BGE      |L1.692|
0002ac  e3550000          CMP      r5,#0                 ;211
0002b0  bafffff4          BLT      |L1.648|
                  |L1.692|
;;;214    	}
;;;215    
;;;216    	if (ret >= 0) {
0002b4  e3550000          CMP      r5,#0
0002b8  ba00000a          BLT      |L1.744|
;;;217    		in = &yaffsfs_inode[ret];
0002bc  e59f0700          LDR      r0,|L1.2500|
0002c0  e0806185          ADD      r6,r0,r5,LSL #3
;;;218    		if (!in->iObj)
0002c4  e5960004          LDR      r0,[r6,#4]
0002c8  e3500000          CMP      r0,#0
0002cc  1a000001          BNE      |L1.728|
;;;219    			in->count = 0;
0002d0  e3a00000          MOV      r0,#0
0002d4  e5860000          STR      r0,[r6,#0]
                  |L1.728|
;;;220    		in->iObj = obj;
0002d8  e5867004          STR      r7,[r6,#4]
;;;221    		in->count++;
0002dc  e5960000          LDR      r0,[r6,#0]
0002e0  e2800001          ADD      r0,r0,#1
0002e4  e5860000          STR      r0,[r6,#0]
                  |L1.744|
;;;222    	}
;;;223    
;;;224    	return ret;
0002e8  e1a00005          MOV      r0,r5
;;;225    }
0002ec  e8bd81f0          POP      {r4-r8,pc}
;;;226    
                          ENDP

                  yaffsfs_CountHandles PROC
;;;227    static int yaffsfs_CountHandles(struct yaffs_obj *obj)
0002f0  e92d4070          PUSH     {r4-r6,lr}
;;;228    {
0002f4  e1a05000          MOV      r5,r0
;;;229    	int i = yaffsfs_FindInodeIdForObject(obj);
0002f8  e1a00005          MOV      r0,r5
0002fc  ebfffffe          BL       yaffsfs_FindInodeIdForObject
000300  e1a04000          MOV      r4,r0
;;;230    
;;;231    	if (i >= 0)
000304  e3540000          CMP      r4,#0
000308  ba000002          BLT      |L1.792|
;;;232    		return yaffsfs_inode[i].count;
00030c  e59f06b0          LDR      r0,|L1.2500|
000310  e7900184          LDR      r0,[r0,r4,LSL #3]
                  |L1.788|
;;;233    	else
;;;234    		return 0;
;;;235    }
000314  e8bd8070          POP      {r4-r6,pc}
                  |L1.792|
000318  e3a00000          MOV      r0,#0                 ;234
00031c  eafffffc          B        |L1.788|
;;;236    
                          ENDP

                  yaffsfs_ReleaseInode PROC
;;;237    static void yaffsfs_ReleaseInode(struct yaffsfs_Inode *in)
000320  e92d4070          PUSH     {r4-r6,lr}
;;;238    {
000324  e1a04000          MOV      r4,r0
;;;239    	struct yaffs_obj *obj;
;;;240    
;;;241    	obj = in->iObj;
000328  e5945004          LDR      r5,[r4,#4]
;;;242    
;;;243    	if (obj->unlinked)
00032c  e5d50000          LDRB     r0,[r5,#0]
000330  e1a00e80          LSL      r0,r0,#29
000334  e1b00fa0          LSRS     r0,r0,#31
000338  0a000001          BEQ      |L1.836|
;;;244    		yaffs_del_obj(obj);
00033c  e1a00005          MOV      r0,r5
000340  ebfffffe          BL       yaffs_del_obj
                  |L1.836|
;;;245    
;;;246    	obj->my_inode = NULL;
000344  e3a00000          MOV      r0,#0
000348  e5850060          STR      r0,[r5,#0x60]
;;;247    	in->iObj = NULL;
00034c  e5840004          STR      r0,[r4,#4]
;;;248    
;;;249    }
000350  e8bd8070          POP      {r4-r6,pc}
;;;250    
                          ENDP

                  yaffsfs_PutInode PROC
;;;251    static void yaffsfs_PutInode(int inodeId)
000354  e92d4070          PUSH     {r4-r6,lr}
;;;252    {
000358  e1a05000          MOV      r5,r0
;;;253    	if (inodeId >= 0 && inodeId < YAFFSFS_N_HANDLES) {
00035c  e3550000          CMP      r5,#0
000360  ba00000e          BLT      |L1.928|
000364  e3550064          CMP      r5,#0x64
000368  aa00000c          BGE      |L1.928|
;;;254    		struct yaffsfs_Inode *in = &yaffsfs_inode[inodeId];
00036c  e59f0650          LDR      r0,|L1.2500|
000370  e0804185          ADD      r4,r0,r5,LSL #3
;;;255    		in->count--;
000374  e5940000          LDR      r0,[r4,#0]
000378  e2400001          SUB      r0,r0,#1
00037c  e5840000          STR      r0,[r4,#0]
;;;256    		if (in->count <= 0) {
000380  e5940000          LDR      r0,[r4,#0]
000384  e3500000          CMP      r0,#0
000388  ca000003          BGT      |L1.924|
;;;257    			yaffsfs_ReleaseInode(in);
00038c  e1a00004          MOV      r0,r4
000390  ebfffffe          BL       yaffsfs_ReleaseInode
;;;258    			in->count = 0;
000394  e3a00000          MOV      r0,#0
000398  e5840000          STR      r0,[r4,#0]
                  |L1.924|
;;;259    		}
;;;260    	}
00039c  e1a00000          MOV      r0,r0
                  |L1.928|
;;;261    }
0003a0  e8bd8070          POP      {r4-r6,pc}
;;;262    
                          ENDP

                  yaffsfs_NewHandle PROC
;;;263    static int yaffsfs_NewHandle(struct yaffsfs_Handle **hptr)
0003a4  e1a03000          MOV      r3,r0
;;;264    {
;;;265    	int i;
;;;266    	struct yaffsfs_Handle *h;
;;;267    
;;;268    	for (i = 0; i < YAFFSFS_N_HANDLES; i++) {
0003a8  e3a02000          MOV      r2,#0
0003ac  ea000011          B        |L1.1016|
                  |L1.944|
;;;269    		h = &yaffsfs_handle[i];
0003b0  e59f0614          LDR      r0,|L1.2508|
0003b4  e0801102          ADD      r1,r0,r2,LSL #2
;;;270    		if (h->useCount < 1) {
0003b8  e1d100f2          LDRSH    r0,[r1,#2]
0003bc  e3500001          CMP      r0,#1
0003c0  aa00000b          BGE      |L1.1012|
;;;271    			memset(h, 0, sizeof(struct yaffsfs_Handle));
0003c4  e3a00000          MOV      r0,#0
0003c8  e1c100b0          STRH     r0,[r1,#0]
0003cc  e1c100b2          STRH     r0,[r1,#2]
;;;272    			h->fdId = -1;
0003d0  e3e00000          MVN      r0,#0
0003d4  e1c100b0          STRH     r0,[r1,#0]
;;;273    			h->useCount = 1;
0003d8  e3a00001          MOV      r0,#1
0003dc  e1c100b2          STRH     r0,[r1,#2]
;;;274    			if (hptr)
0003e0  e3530000          CMP      r3,#0
0003e4  0a000000          BEQ      |L1.1004|
;;;275    				*hptr = h;
0003e8  e5831000          STR      r1,[r3,#0]
                  |L1.1004|
;;;276    			return i;
0003ec  e1a00002          MOV      r0,r2
                  |L1.1008|
;;;277    		}
;;;278    	}
;;;279    	return -1;
;;;280    }
0003f0  e12fff1e          BX       lr
                  |L1.1012|
0003f4  e2822001          ADD      r2,r2,#1              ;268
                  |L1.1016|
0003f8  e3520064          CMP      r2,#0x64              ;268
0003fc  baffffeb          BLT      |L1.944|
000400  e3e00000          MVN      r0,#0                 ;279
000404  eafffff9          B        |L1.1008|
;;;281    
                          ENDP

                  yaffsfs_NewHandleAndFileDes PROC
;;;282    static int yaffsfs_NewHandleAndFileDes(void)
000408  e92d40f8          PUSH     {r3-r7,lr}
;;;283    {
;;;284    	int i;
;;;285    	struct yaffsfs_FileDes *fd;
;;;286    	struct yaffsfs_Handle *h = NULL;
00040c  e3a00000          MOV      r0,#0
000410  e58d0000          STR      r0,[sp,#0]
;;;287    	int handle = yaffsfs_NewHandle(&h);
000414  e1a0000d          MOV      r0,sp
000418  ebfffffe          BL       yaffsfs_NewHandle
00041c  e1a06000          MOV      r6,r0
;;;288    
;;;289    	if (handle < 0)
000420  e3560000          CMP      r6,#0
000424  aa000001          BGE      |L1.1072|
;;;290    		return -1;
000428  e3e00000          MVN      r0,#0
                  |L1.1068|
;;;291    
;;;292    	for (i = 0; i < YAFFSFS_N_HANDLES; i++) {
;;;293    		fd = &yaffsfs_fd[i];
;;;294    		if (fd->handleCount < 1) {
;;;295    			memset(fd, 0, sizeof(struct yaffsfs_FileDes));
;;;296    			fd->inodeId = -1;
;;;297    			fd->handleCount = 1;
;;;298    			h->fdId = i;
;;;299    			return handle;
;;;300    		}
;;;301    	}
;;;302    
;;;303    	/* Dump the handle because we could not get a fd */
;;;304    	h->useCount = 0;
;;;305    	return -1;
;;;306    }
00042c  e8bd80f8          POP      {r3-r7,pc}
                  |L1.1072|
000430  e3a05000          MOV      r5,#0                 ;292
000434  ea00001b          B        |L1.1192|
                  |L1.1080|
000438  e59f0588          LDR      r0,|L1.2504|
00043c  e0804205          ADD      r4,r0,r5,LSL #4       ;293
000440  e5940000          LDR      r0,[r4,#0]            ;294
000444  e1a00280          LSL      r0,r0,#5              ;294
000448  e3a01001          MOV      r1,#1                 ;294
00044c  e1510b20          CMP      r1,r0,LSR #22         ;294
000450  da000013          BLE      |L1.1188|
000454  e3a00000          MOV      r0,#0                 ;295
000458  e5840000          STR      r0,[r4,#0]            ;295
00045c  e5840004          STR      r0,[r4,#4]            ;295
000460  e5840008          STR      r0,[r4,#8]            ;295
000464  e584000c          STR      r0,[r4,#0xc]          ;295
000468  e5940000          LDR      r0,[r4,#0]            ;296
00046c  e3800a1f          ORR      r0,r0,#0x1f000        ;296
000470  e3800efe          ORR      r0,r0,#0xfe0          ;296
000474  e5840000          STR      r0,[r4,#0]            ;296
000478  e5940000          LDR      r0,[r4,#0]            ;297
00047c  e3c00407          BIC      r0,r0,#0x7000000      ;297
000480  e3c008fe          BIC      r0,r0,#0xfe0000       ;297
000484  e3800802          ORR      r0,r0,#0x20000        ;297
000488  e5840000          STR      r0,[r4,#0]            ;297
00048c  e1a00805          LSL      r0,r5,#16             ;298
000490  e1a00840          ASR      r0,r0,#16             ;298
000494  e59d1000          LDR      r1,[sp,#0]            ;298
000498  e1c100b0          STRH     r0,[r1,#0]            ;298
00049c  e1a00006          MOV      r0,r6                 ;299
0004a0  eaffffe1          B        |L1.1068|
                  |L1.1188|
0004a4  e2855001          ADD      r5,r5,#1              ;292
                  |L1.1192|
0004a8  e3550064          CMP      r5,#0x64              ;292
0004ac  baffffe1          BLT      |L1.1080|
0004b0  e3a00000          MOV      r0,#0                 ;304
0004b4  e59d1000          LDR      r1,[sp,#0]            ;304
0004b8  e1c100b2          STRH     r0,[r1,#2]            ;304
0004bc  e3e00000          MVN      r0,#0                 ;305
0004c0  eaffffd9          B        |L1.1068|
;;;307    
                          ENDP

                  yaffsfs_GetHandle PROC
;;;313    
;;;314    static int yaffsfs_GetHandle(int handle)
0004c4  e92d4070          PUSH     {r4-r6,lr}
;;;315    {
0004c8  e1a05000          MOV      r5,r0
;;;316    	struct yaffsfs_Handle *h = yaffsfs_HandleToPointer(handle);
0004cc  e1a00005          MOV      r0,r5
0004d0  ebfffffe          BL       yaffsfs_HandleToPointer
0004d4  e1a04000          MOV      r4,r0
;;;317    
;;;318    	if (h && h->useCount > 0) {
0004d8  e3540000          CMP      r4,#0
0004dc  0a000009          BEQ      |L1.1288|
0004e0  e1d400f2          LDRSH    r0,[r4,#2]
0004e4  e3500000          CMP      r0,#0
0004e8  da000006          BLE      |L1.1288|
;;;319    		h->useCount++;
0004ec  e1d400b2          LDRH     r0,[r4,#2]
0004f0  e2800001          ADD      r0,r0,#1
0004f4  e1a00800          LSL      r0,r0,#16
0004f8  e1a00840          ASR      r0,r0,#16
0004fc  e1c400b2          STRH     r0,[r4,#2]
;;;320    		return 0;
000500  e3a00000          MOV      r0,#0
                  |L1.1284|
;;;321    	}
;;;322    	return -1;
;;;323    }
000504  e8bd8070          POP      {r4-r6,pc}
                  |L1.1288|
000508  e3e00000          MVN      r0,#0                 ;322
00050c  eafffffc          B        |L1.1284|
;;;324    
                          ENDP

                  yaffsfs_PutFileDes PROC
;;;330    
;;;331    static int yaffsfs_PutFileDes(int fdId)
000510  e92d4070          PUSH     {r4-r6,lr}
;;;332    {
000514  e1a05000          MOV      r5,r0
;;;333    	struct yaffsfs_FileDes *fd;
;;;334    
;;;335    	if (fdId >= 0 && fdId < YAFFSFS_N_HANDLES) {
000518  e3550000          CMP      r5,#0
00051c  ba00001f          BLT      |L1.1440|
000520  e3550064          CMP      r5,#0x64
000524  aa00001d          BGE      |L1.1440|
;;;336    		fd = &yaffsfs_fd[fdId];
000528  e59f0498          LDR      r0,|L1.2504|
00052c  e0804205          ADD      r4,r0,r5,LSL #4
;;;337    		fd->handleCount--;
000530  e5940000          LDR      r0,[r4,#0]
000534  e3c00407          BIC      r0,r0,#0x7000000
000538  e3c008fe          BIC      r0,r0,#0xfe0000
00053c  e5941000          LDR      r1,[r4,#0]
000540  e1a01281          LSL      r1,r1,#5
000544  e3a02001          MOV      r2,#1
000548  e0621b21          RSB      r1,r2,r1,LSR #22
00054c  e59f2484          LDR      r2,|L1.2520|
000550  e0021881          AND      r1,r2,r1,LSL #17
000554  e1800001          ORR      r0,r0,r1
000558  e5840000          STR      r0,[r4,#0]
;;;338    		if (fd->handleCount < 1) {
00055c  e5940000          LDR      r0,[r4,#0]
000560  e1a00280          LSL      r0,r0,#5
000564  e3a01001          MOV      r1,#1
000568  e1510b20          CMP      r1,r0,LSR #22
00056c  da00000b          BLE      |L1.1440|
;;;339    			if (fd->inodeId >= 0) {
000570  e5940000          LDR      r0,[r4,#0]
000574  e1a00780          LSL      r0,r0,#15
000578  e1b00a20          LSRS     r0,r0,#20
00057c  4a000007          BMI      |L1.1440|
;;;340    				yaffsfs_PutInode(fd->inodeId);
000580  e5941000          LDR      r1,[r4,#0]
000584  e1a01781          LSL      r1,r1,#15
000588  e1a00a21          LSR      r0,r1,#20
00058c  ebfffffe          BL       yaffsfs_PutInode
;;;341    				fd->inodeId = -1;
000590  e5940000          LDR      r0,[r4,#0]
000594  e3800a1f          ORR      r0,r0,#0x1f000
000598  e3800efe          ORR      r0,r0,#0xfe0
00059c  e5840000          STR      r0,[r4,#0]
                  |L1.1440|
;;;342    			}
;;;343    		}
;;;344    	}
;;;345    	return 0;
0005a0  e3a00000          MOV      r0,#0
;;;346    }
0005a4  e8bd8070          POP      {r4-r6,pc}
;;;347    
                          ENDP

                  yaffsfs_PutHandle PROC
;;;348    static int yaffsfs_PutHandle(int handle)
0005a8  e92d4070          PUSH     {r4-r6,lr}
;;;349    {
0005ac  e1a05000          MOV      r5,r0
;;;350    	struct yaffsfs_Handle *h = yaffsfs_HandleToPointer(handle);
0005b0  e1a00005          MOV      r0,r5
0005b4  ebfffffe          BL       yaffsfs_HandleToPointer
0005b8  e1a04000          MOV      r4,r0
;;;351    
;;;352    	if (h && h->useCount > 0) {
0005bc  e3540000          CMP      r4,#0
0005c0  0a00000e          BEQ      |L1.1536|
0005c4  e1d400f2          LDRSH    r0,[r4,#2]
0005c8  e3500000          CMP      r0,#0
0005cc  da00000b          BLE      |L1.1536|
;;;353    		h->useCount--;
0005d0  e1d400b2          LDRH     r0,[r4,#2]
0005d4  e2400001          SUB      r0,r0,#1
0005d8  e1a00800          LSL      r0,r0,#16
0005dc  e1a00840          ASR      r0,r0,#16
0005e0  e1c400b2          STRH     r0,[r4,#2]
;;;354    		if (h->useCount < 1) {
0005e4  e1d400f2          LDRSH    r0,[r4,#2]
0005e8  e3500001          CMP      r0,#1
0005ec  aa000003          BGE      |L1.1536|
;;;355    			yaffsfs_PutFileDes(h->fdId);
0005f0  e1d400f0          LDRSH    r0,[r4,#0]
0005f4  ebfffffe          BL       yaffsfs_PutFileDes
;;;356    			h->fdId = -1;
0005f8  e3e00000          MVN      r0,#0
0005fc  e1c400b0          STRH     r0,[r4,#0]
                  |L1.1536|
;;;357    		}
;;;358    	}
;;;359    
;;;360    	return 0;
000600  e3a00000          MOV      r0,#0
;;;361    }
000604  e8bd8070          POP      {r4-r6,pc}
;;;362    
                          ENDP

                  yaffsfs_BreakDeviceHandles PROC
;;;363    static void yaffsfs_BreakDeviceHandles(struct yaffs_dev *dev)
000608  e92d41f0          PUSH     {r4-r8,lr}
;;;364    {
00060c  e1a08000          MOV      r8,r0
;;;365    	struct yaffsfs_FileDes *fd;
;;;366    	struct yaffsfs_Handle *h;
;;;367    	struct yaffs_obj *obj;
;;;368    	int i;
;;;369    	for (i = 0; i < YAFFSFS_N_HANDLES; i++) {
000610  e3a07000          MOV      r7,#0
000614  ea000029          B        |L1.1728|
                  |L1.1560|
;;;370    		h = yaffsfs_HandleToPointer(i);
000618  e1a00007          MOV      r0,r7
00061c  ebfffffe          BL       yaffsfs_HandleToPointer
000620  e1a05000          MOV      r5,r0
;;;371    		fd = yaffsfs_HandleToFileDes(i);
000624  e1a00007          MOV      r0,r7
000628  ebfffffe          BL       yaffsfs_HandleToFileDes
00062c  e1a04000          MOV      r4,r0
;;;372    		obj = yaffsfs_HandleToObject(i);
000630  e1a00007          MOV      r0,r7
000634  ebfffffe          BL       yaffsfs_HandleToObject
000638  e1a06000          MOV      r6,r0
;;;373    		if (h && h->useCount > 0) {
00063c  e3550000          CMP      r5,#0
000640  0a000005          BEQ      |L1.1628|
000644  e1d500f2          LDRSH    r0,[r5,#2]
000648  e3500000          CMP      r0,#0
00064c  da000002          BLE      |L1.1628|
;;;374    			h->useCount = 0;
000650  e3a00000          MOV      r0,#0
000654  e1c500b2          STRH     r0,[r5,#2]
;;;375    			h->fdId = 0;
000658  e1c500b0          STRH     r0,[r5,#0]
                  |L1.1628|
;;;376    		}
;;;377    		if (fd && fd->handleCount > 0 && obj && obj->my_dev == dev) {
00065c  e3540000          CMP      r4,#0
000660  0a000015          BEQ      |L1.1724|
000664  e5940000          LDR      r0,[r4,#0]
000668  e1a00280          LSL      r0,r0,#5
00066c  e1a00b20          LSR      r0,r0,#22
000670  e3500000          CMP      r0,#0
000674  da000010          BLE      |L1.1724|
000678  e3560000          CMP      r6,#0
00067c  0a00000e          BEQ      |L1.1724|
000680  e5960008          LDR      r0,[r6,#8]
000684  e1500008          CMP      r0,r8
000688  1a00000b          BNE      |L1.1724|
;;;378    			fd->handleCount = 0;
00068c  e5940000          LDR      r0,[r4,#0]
000690  e3c00407          BIC      r0,r0,#0x7000000
000694  e3c008fe          BIC      r0,r0,#0xfe0000
000698  e5840000          STR      r0,[r4,#0]
;;;379    			yaffsfs_PutInode(fd->inodeId);
00069c  e5941000          LDR      r1,[r4,#0]
0006a0  e1a01781          LSL      r1,r1,#15
0006a4  e1a00a21          LSR      r0,r1,#20
0006a8  ebfffffe          BL       yaffsfs_PutInode
;;;380    			fd->inodeId = -1;
0006ac  e5940000          LDR      r0,[r4,#0]
0006b0  e3800a1f          ORR      r0,r0,#0x1f000
0006b4  e3800efe          ORR      r0,r0,#0xfe0
0006b8  e5840000          STR      r0,[r4,#0]
                  |L1.1724|
0006bc  e2877001          ADD      r7,r7,#1              ;369
                  |L1.1728|
0006c0  e3570064          CMP      r7,#0x64              ;369
0006c4  baffffd3          BLT      |L1.1560|
;;;381    		}
;;;382    	}
;;;383    }
0006c8  e8bd81f0          POP      {r4-r8,pc}
;;;384    
                          ENDP

                  yaffsfs_Match PROC
;;;402    #else
;;;403    int yaffsfs_Match(YCHAR a, YCHAR b)
0006cc  e1a02000          MOV      r2,r0
;;;404    {
;;;405    	/* case sensitive */
;;;406    	return (a == b);
0006d0  e1520001          CMP      r2,r1
0006d4  1a000001          BNE      |L1.1760|
0006d8  e3a00001          MOV      r0,#1
                  |L1.1756|
;;;407    }
0006dc  e12fff1e          BX       lr
                  |L1.1760|
0006e0  e3a00000          MOV      r0,#0                 ;406
0006e4  eafffffc          B        |L1.1756|
;;;408    #endif
                          ENDP

                  yaffsfs_IsPathDivider PROC
;;;409    
;;;410    int yaffsfs_IsPathDivider(YCHAR ch)
0006e8  e1a02000          MOV      r2,r0
;;;411    {
;;;412    	const YCHAR *str = YAFFS_PATH_DIVIDERS;
0006ec  e28f1fba          ADR      r1,|L1.2524|
;;;413    
;;;414    	while (*str) {
0006f0  ea000005          B        |L1.1804|
                  |L1.1780|
;;;415    		if (*str == ch)
0006f4  e5d10000          LDRB     r0,[r1,#0]
0006f8  e1500002          CMP      r0,r2
0006fc  1a000001          BNE      |L1.1800|
;;;416    			return 1;
000700  e3a00001          MOV      r0,#1
                  |L1.1796|
;;;417    		str++;
;;;418    	}
;;;419    
;;;420    	return 0;
;;;421    }
000704  e12fff1e          BX       lr
                  |L1.1800|
000708  e2811001          ADD      r1,r1,#1              ;417
                  |L1.1804|
00070c  e5d10000          LDRB     r0,[r1,#0]            ;414
000710  e3500000          CMP      r0,#0                 ;414
000714  1afffff6          BNE      |L1.1780|
000718  e3a00000          MOV      r0,#0                 ;420
00071c  eafffff8          B        |L1.1796|
;;;422    
                          ENDP

                  yaffsfs_CheckNameLength PROC
;;;423    int yaffsfs_CheckNameLength(const char *name)
000720  e92d4070          PUSH     {r4-r6,lr}
;;;424    {
000724  e1a05000          MOV      r5,r0
;;;425    	int retVal = 0;
000728  e3a06000          MOV      r6,#0
;;;426    
;;;427    	int nameLength = yaffs_strnlen(name, YAFFS_MAX_NAME_LENGTH + 1);
00072c  e1a00005          MOV      r0,r5
000730  ebfffffe          BL       strlen
000734  e3500c01          CMP      r0,#0x100
000738  9a000001          BLS      |L1.1860|
00073c  e3a00c01          MOV      r0,#0x100
000740  ea000001          B        |L1.1868|
                  |L1.1860|
000744  e1a00005          MOV      r0,r5
000748  ebfffffe          BL       strlen
                  |L1.1868|
00074c  e1a04000          MOV      r4,r0
;;;428    
;;;429    	if (nameLength == 0) {
000750  e3540000          CMP      r4,#0
000754  1a000003          BNE      |L1.1896|
;;;430    		yaffsfs_SetError(-ENOENT);
000758  e3e00001          MVN      r0,#1
00075c  ebfffffe          BL       yaffsfs_SetError
;;;431    		retVal = -1;
000760  e3e06000          MVN      r6,#0
000764  ea000004          B        |L1.1916|
                  |L1.1896|
;;;432    	} else if (nameLength > YAFFS_MAX_NAME_LENGTH) {
000768  e35400ff          CMP      r4,#0xff
00076c  da000002          BLE      |L1.1916|
;;;433    		yaffsfs_SetError(-ENAMETOOLONG);
000770  e3e00023          MVN      r0,#0x23
000774  ebfffffe          BL       yaffsfs_SetError
;;;434    		retVal = -1;
000778  e3e06000          MVN      r6,#0
                  |L1.1916|
;;;435    	}
;;;436    
;;;437    	return retVal;
00077c  e1a00006          MOV      r0,r6
;;;438    }
000780  e8bd8070          POP      {r4-r6,pc}
;;;439    
                          ENDP

                  yaffsfs_alt_dir_path PROC
;;;440    static int yaffsfs_alt_dir_path(const YCHAR *path, YCHAR **ret_path)
000784  e92d41f0          PUSH     {r4-r8,lr}
;;;441    {
000788  e1a07000          MOV      r7,r0
00078c  e1a08001          MOV      r8,r1
;;;442    	YCHAR *alt_path = NULL;
000790  e3a04000          MOV      r4,#0
;;;443    	int path_length;
;;;444    	int i;
;;;445    
;;;446    	/*
;;;447    	 * We don't have a definition for max path length.
;;;448    	 * We will use 3 * max name length instead.
;;;449    	 */
;;;450    	*ret_path = NULL;
000794  e3a00000          MOV      r0,#0
000798  e5880000          STR      r0,[r8,#0]
;;;451    	path_length = yaffs_strnlen(path, (YAFFS_MAX_NAME_LENGTH + 1) * 3 + 1);
00079c  e1a00007          MOV      r0,r7
0007a0  ebfffffe          BL       strlen
0007a4  e59f1234          LDR      r1,|L1.2528|
0007a8  e1500001          CMP      r0,r1
0007ac  9a000001          BLS      |L1.1976|
0007b0  e1a00001          MOV      r0,r1
0007b4  ea000001          B        |L1.1984|
                  |L1.1976|
0007b8  e1a00007          MOV      r0,r7
0007bc  ebfffffe          BL       strlen
                  |L1.1984|
0007c0  e1a05000          MOV      r5,r0
;;;452    
;;;453    	/* If the last character is a path divider, then we need to
;;;454    	 * trim it back so that the name look-up works properly.
;;;455    	 * eg. /foo/new_dir/ -> /foo/newdir
;;;456    	 * Curveball: Need to handle multiple path dividers:
;;;457    	 * eg. /foof/sdfse///// -> /foo/sdfse
;;;458    	 */
;;;459    	if (path_length > 0 && yaffsfs_IsPathDivider(path[path_length - 1])) {
0007c4  e3550000          CMP      r5,#0
0007c8  da00001c          BLE      |L1.2112|
0007cc  e2451001          SUB      r1,r5,#1
0007d0  e7d70001          LDRB     r0,[r7,r1]
0007d4  ebfffffe          BL       yaffsfs_IsPathDivider
0007d8  e3500000          CMP      r0,#0
0007dc  0a000017          BEQ      |L1.2112|
;;;460    // 		alt_path = kmalloc(path_length + 1, 0);
;;;461    		alt_path = yaffs_malloc(path_length + 1);
0007e0  e2850001          ADD      r0,r5,#1
0007e4  ebfffffe          BL       yaffs_malloc
0007e8  e1a04000          MOV      r4,r0
;;;462    		if (!alt_path)
0007ec  e3540000          CMP      r4,#0
0007f0  1a000001          BNE      |L1.2044|
;;;463    			return -1;
0007f4  e3e00000          MVN      r0,#0
                  |L1.2040|
;;;464            memset(alt_path, 0, path_length + 1);
;;;465    		yaffs_strcpy(alt_path, path);
;;;466    		for (i = path_length - 1;
;;;467    		     i >= 0 && yaffsfs_IsPathDivider(alt_path[i]); i--)
;;;468    			alt_path[i] = (YCHAR) 0;
;;;469    	}
;;;470    	*ret_path = alt_path;
;;;471    	return 0;
;;;472    }
0007f8  e8bd81f0          POP      {r4-r8,pc}
                  |L1.2044|
0007fc  e2851001          ADD      r1,r5,#1              ;464
000800  e1a00004          MOV      r0,r4                 ;464
000804  ebfffffe          BL       __aeabi_memclr
000808  e1a01007          MOV      r1,r7                 ;465
00080c  e1a00004          MOV      r0,r4                 ;465
000810  ebfffffe          BL       strcpy
000814  e2456001          SUB      r6,r5,#1              ;466
000818  ea000002          B        |L1.2088|
                  |L1.2076|
00081c  e3a00000          MOV      r0,#0                 ;468
000820  e7c40006          STRB     r0,[r4,r6]            ;468
000824  e2466001          SUB      r6,r6,#1              ;467
                  |L1.2088|
000828  e3560000          CMP      r6,#0                 ;467
00082c  ba000003          BLT      |L1.2112|
000830  e7d40006          LDRB     r0,[r4,r6]            ;467
000834  ebfffffe          BL       yaffsfs_IsPathDivider
000838  e3500000          CMP      r0,#0                 ;467
00083c  1afffff6          BNE      |L1.2076|
                  |L1.2112|
000840  e5884000          STR      r4,[r8,#0]            ;470
000844  e3a00000          MOV      r0,#0                 ;471
000848  eaffffea          B        |L1.2040|
;;;473    
                          ENDP

                  yaffsfs_FindDevice PROC
;;;482     */
;;;483    static struct yaffs_dev *yaffsfs_FindDevice(const YCHAR *path,
00084c  e92d4ff8          PUSH     {r3-r11,lr}
;;;484    					    YCHAR **restOfPath)
;;;485    {
000850  e1a08000          MOV      r8,r0
000854  e1a09001          MOV      r9,r1
;;;486    	struct list_head *cfg;
;;;487    	const YCHAR *leftOver;
;;;488    	const YCHAR *p;
;;;489    	struct yaffs_dev *retval = NULL;
000858  e3a00000          MOV      r0,#0
00085c  e58d0000          STR      r0,[sp,#0]
;;;490    	struct yaffs_dev *dev = NULL;
000860  e3a0a000          MOV      r10,#0
;;;491    	int thisMatchLength;
;;;492    	int longestMatch = -1;
000864  e3e0b000          MVN      r11,#0
;;;493    	int matching;
;;;494    
;;;495    	/*
;;;496    	 * Check all configs, choose the one that:
;;;497    	 * 1) Actually matches a prefix (ie /a amd /abc will not match
;;;498    	 * 2) Matches the longest.
;;;499    	 */
;;;500    	list_for_each(cfg, &yaffsfs_deviceList) {
000868  e59f0174          LDR      r0,|L1.2532|
00086c  e5905000          LDR      r5,[r0,#0]  ; yaffsfs_deviceList
000870  ea00004c          B        |L1.2472|
                  |L1.2164|
;;;501    		dev = list_entry(cfg, struct yaffs_dev, dev_list);
000874  e245a09c          SUB      r10,r5,#0x9c
;;;502    		leftOver = path;
000878  e1a03008          MOV      r3,r8
;;;503    		p = dev->param.name;
00087c  e59a4000          LDR      r4,[r10,#0]
;;;504    		thisMatchLength = 0;
000880  e3a06000          MOV      r6,#0
;;;505    		matching = 1;
000884  e3a07001          MOV      r7,#1
;;;506    
;;;507    		while (matching && *p && *leftOver) {
000888  ea000026          B        |L1.2344|
                  |L1.2188|
;;;508    			/* Skip over any /s */
;;;509    			while (yaffsfs_IsPathDivider(*p))
00088c  ea000000          B        |L1.2196|
                  |L1.2192|
;;;510    				p++;
000890  e2844001          ADD      r4,r4,#1
                  |L1.2196|
000894  e5d40000          LDRB     r0,[r4,#0]            ;509
000898  ebfffffe          BL       yaffsfs_IsPathDivider
00089c  e3500000          CMP      r0,#0                 ;509
0008a0  1afffffa          BNE      |L1.2192|
;;;511    
;;;512    			/* Skip over any /s */
;;;513    			while (yaffsfs_IsPathDivider(*leftOver))
0008a4  ea000000          B        |L1.2220|
                  |L1.2216|
;;;514    				leftOver++;
0008a8  e2833001          ADD      r3,r3,#1
                  |L1.2220|
0008ac  e5d30000          LDRB     r0,[r3,#0]            ;513
0008b0  ebfffffe          BL       yaffsfs_IsPathDivider
0008b4  e3500000          CMP      r0,#0                 ;513
0008b8  1afffffa          BNE      |L1.2216|
;;;515    
;;;516    			/* Now match the text part */
;;;517    			while (matching &&
0008bc  ea000009          B        |L1.2280|
                  |L1.2240|
;;;518    			       *p && !yaffsfs_IsPathDivider(*p) &&
;;;519    			       *leftOver && !yaffsfs_IsPathDivider(*leftOver)) {
;;;520    				if (yaffsfs_Match(*p, *leftOver)) {
0008c0  e5d31000          LDRB     r1,[r3,#0]
0008c4  e5d40000          LDRB     r0,[r4,#0]
0008c8  ebfffffe          BL       yaffsfs_Match
0008cc  e3500000          CMP      r0,#0
0008d0  0a000003          BEQ      |L1.2276|
;;;521    					p++;
0008d4  e2844001          ADD      r4,r4,#1
;;;522    					leftOver++;
0008d8  e2833001          ADD      r3,r3,#1
;;;523    					thisMatchLength++;
0008dc  e2866001          ADD      r6,r6,#1
0008e0  ea000000          B        |L1.2280|
                  |L1.2276|
;;;524    				} else {
;;;525    					matching = 0;
0008e4  e3a07000          MOV      r7,#0
                  |L1.2280|
0008e8  e3570000          CMP      r7,#0                 ;517
0008ec  0a00000d          BEQ      |L1.2344|
0008f0  e5d40000          LDRB     r0,[r4,#0]            ;518
0008f4  e3500000          CMP      r0,#0                 ;518
0008f8  0a00000a          BEQ      |L1.2344|
0008fc  e5d40000          LDRB     r0,[r4,#0]            ;518
000900  ebfffffe          BL       yaffsfs_IsPathDivider
000904  e3500000          CMP      r0,#0                 ;518
000908  1a000006          BNE      |L1.2344|
00090c  e5d30000          LDRB     r0,[r3,#0]            ;519
000910  e3500000          CMP      r0,#0                 ;519
000914  0a000003          BEQ      |L1.2344|
000918  e5d30000          LDRB     r0,[r3,#0]            ;519
00091c  ebfffffe          BL       yaffsfs_IsPathDivider
000920  e3500000          CMP      r0,#0                 ;519
000924  0affffe5          BEQ      |L1.2240|
                  |L1.2344|
000928  e3570000          CMP      r7,#0                 ;507
00092c  0a000005          BEQ      |L1.2376|
000930  e5d40000          LDRB     r0,[r4,#0]            ;507
000934  e3500000          CMP      r0,#0                 ;507
000938  0a000002          BEQ      |L1.2376|
00093c  e5d30000          LDRB     r0,[r3,#0]            ;507
000940  e3500000          CMP      r0,#0                 ;507
000944  1affffd0          BNE      |L1.2188|
                  |L1.2376|
;;;526    				}
;;;527    			}
;;;528    		}
;;;529    
;;;530    		/* Skip over any /s in leftOver */
;;;531    		while (yaffsfs_IsPathDivider(*leftOver))
000948  ea000000          B        |L1.2384|
                  |L1.2380|
;;;532    			leftOver++;
00094c  e2833001          ADD      r3,r3,#1
                  |L1.2384|
000950  e5d30000          LDRB     r0,[r3,#0]            ;531
000954  ebfffffe          BL       yaffsfs_IsPathDivider
000958  e3500000          CMP      r0,#0                 ;531
00095c  1afffffa          BNE      |L1.2380|
;;;533    
;;;534    		/*Skip over any /s in p */
;;;535    		while (yaffsfs_IsPathDivider(*p))
000960  ea000000          B        |L1.2408|
                  |L1.2404|
;;;536    			p++;
000964  e2844001          ADD      r4,r4,#1
                  |L1.2408|
000968  e5d40000          LDRB     r0,[r4,#0]            ;535
00096c  ebfffffe          BL       yaffsfs_IsPathDivider
000970  e3500000          CMP      r0,#0                 ;535
000974  1afffffa          BNE      |L1.2404|
;;;537    
;;;538    		/* p should now be at the end of the string if fully matched */
;;;539    		if (*p)
000978  e5d40000          LDRB     r0,[r4,#0]
00097c  e3500000          CMP      r0,#0
000980  0a000000          BEQ      |L1.2440|
;;;540    			matching = 0;
000984  e3a07000          MOV      r7,#0
                  |L1.2440|
;;;541    
;;;542    		if (matching && (thisMatchLength > longestMatch)) {
000988  e3570000          CMP      r7,#0
00098c  0a000004          BEQ      |L1.2468|
000990  e156000b          CMP      r6,r11
000994  da000002          BLE      |L1.2468|
;;;543    			/* Matched prefix */
;;;544    			*restOfPath = (YCHAR *) leftOver;
000998  e5893000          STR      r3,[r9,#0]
;;;545    			retval = dev;
00099c  e58da000          STR      r10,[sp,#0]
;;;546    			longestMatch = thisMatchLength;
0009a0  e1a0b006          MOV      r11,r6
                  |L1.2468|
0009a4  e5955000          LDR      r5,[r5,#0]            ;500
                  |L1.2472|
0009a8  e59f0034          LDR      r0,|L1.2532|
0009ac  e1550000          CMP      r5,r0                 ;500
0009b0  1affffaf          BNE      |L1.2164|
;;;547    		}
;;;548    	}
;;;549    	return retval;
0009b4  e59d0000          LDR      r0,[sp,#0]
;;;550    }
0009b8  e8bd8ff8          POP      {r3-r11,pc}
                  |L1.2492|
                          DCD      yaffs_trace_mask
                  |L1.2496|
                          DCD      yaffsfs_handlesInitialised
                  |L1.2500|
                          DCD      yaffsfs_inode
                  |L1.2504|
                          DCD      yaffsfs_fd
                  |L1.2508|
                          DCD      yaffsfs_handle
                  |L1.2512|
                          DCD      0x00002b20
                  |L1.2516|
                          DCD      yaffsfs_dsc
                  |L1.2520|
                          DCD      0x07fe0000
                  |L1.2524|
0009dc  2f00              DCB      "/",0
0009de  00                DCB      0
0009df  00                DCB      0
                  |L1.2528|
                          DCD      0x00000301
                  |L1.2532|
                          DCD      yaffsfs_deviceList
                          ENDP

                  yaffsfs_CheckPath PROC
;;;551    
;;;552    static int yaffsfs_CheckPath(const YCHAR *path)
0009e8  e92d4030          PUSH     {r4,r5,lr}
;;;553    {
0009ec  e1a03000          MOV      r3,r0
;;;554    	int n = 0;
0009f0  e3a04000          MOV      r4,#0
;;;555    	int divs = 0;
0009f4  e3a05000          MOV      r5,#0
;;;556    
;;;557    	while (*path && n < YAFFS_MAX_NAME_LENGTH && divs < 100) {
0009f8  ea000008          B        |L1.2592|
                  |L1.2556|
;;;558    		if (yaffsfs_IsPathDivider(*path)) {
0009fc  e5d30000          LDRB     r0,[r3,#0]
000a00  ebfffffe          BL       yaffsfs_IsPathDivider
000a04  e3500000          CMP      r0,#0
000a08  0a000002          BEQ      |L1.2584|
;;;559    			n = 0;
000a0c  e3a04000          MOV      r4,#0
;;;560    			divs++;
000a10  e2855001          ADD      r5,r5,#1
000a14  ea000000          B        |L1.2588|
                  |L1.2584|
;;;561    		} else
;;;562    			n++;
000a18  e2844001          ADD      r4,r4,#1
                  |L1.2588|
;;;563    		path++;
000a1c  e2833001          ADD      r3,r3,#1
                  |L1.2592|
000a20  e5d30000          LDRB     r0,[r3,#0]            ;557
000a24  e3500000          CMP      r0,#0                 ;557
000a28  0a000003          BEQ      |L1.2620|
000a2c  e35400ff          CMP      r4,#0xff              ;557
000a30  aa000001          BGE      |L1.2620|
000a34  e3550064          CMP      r5,#0x64              ;557
000a38  baffffef          BLT      |L1.2556|
                  |L1.2620|
;;;564    	}
;;;565    
;;;566    	return (*path) ? -1 : 0;
000a3c  e5d30000          LDRB     r0,[r3,#0]
000a40  e3500000          CMP      r0,#0
000a44  0a000001          BEQ      |L1.2640|
000a48  e3e00000          MVN      r0,#0
                  |L1.2636|
;;;567    }
000a4c  e8bd8030          POP      {r4,r5,pc}
                  |L1.2640|
000a50  e3a00000          MOV      r0,#0                 ;566
000a54  eafffffc          B        |L1.2636|
;;;568    
                          ENDP

                  yaffsfs_FindMountPoint PROC
;;;569    /* FindMountPoint only returns a dev entry if the path is a mount point */
;;;570    static struct yaffs_dev *yaffsfs_FindMountPoint(const YCHAR *path)
000a58  e92d4038          PUSH     {r3-r5,lr}
;;;571    {
000a5c  e1a05000          MOV      r5,r0
;;;572    	struct yaffs_dev *dev;
;;;573    	YCHAR *restOfPath = NULL;
000a60  e3a00000          MOV      r0,#0
000a64  e58d0000          STR      r0,[sp,#0]
;;;574    
;;;575    	dev = yaffsfs_FindDevice(path, &restOfPath);
000a68  e1a0100d          MOV      r1,sp
000a6c  e1a00005          MOV      r0,r5
000a70  ebfffffe          BL       yaffsfs_FindDevice
000a74  e1a04000          MOV      r4,r0
;;;576    	if (dev && restOfPath && *restOfPath)
000a78  e3540000          CMP      r4,#0
000a7c  0a000007          BEQ      |L1.2720|
000a80  e59d0000          LDR      r0,[sp,#0]
000a84  e3500000          CMP      r0,#0
000a88  0a000004          BEQ      |L1.2720|
000a8c  e59d0000          LDR      r0,[sp,#0]
000a90  e5d00000          LDRB     r0,[r0,#0]
000a94  e3500000          CMP      r0,#0
000a98  0a000000          BEQ      |L1.2720|
;;;577    		dev = NULL;
000a9c  e3a04000          MOV      r4,#0
                  |L1.2720|
;;;578    	return dev;
000aa0  e1a00004          MOV      r0,r4
;;;579    }
000aa4  e8bd8038          POP      {r3-r5,pc}
;;;580    
                          ENDP

                  yaffsfs_FindRoot PROC
;;;581    static struct yaffs_obj *yaffsfs_FindRoot(const YCHAR *path,
000aa8  e92d4070          PUSH     {r4-r6,lr}
;;;582    					  YCHAR **restOfPath)
;;;583    {
000aac  e1a05000          MOV      r5,r0
000ab0  e1a06001          MOV      r6,r1
;;;584    	struct yaffs_dev *dev;
;;;585    
;;;586    	dev = yaffsfs_FindDevice(path, restOfPath);
000ab4  e1a01006          MOV      r1,r6
000ab8  e1a00005          MOV      r0,r5
000abc  ebfffffe          BL       yaffsfs_FindDevice
000ac0  e1a04000          MOV      r4,r0
;;;587    	if (dev && dev->is_mounted)
000ac4  e3540000          CMP      r4,#0
000ac8  0a000004          BEQ      |L1.2784|
000acc  e59400c4          LDR      r0,[r4,#0xc4]
000ad0  e3500000          CMP      r0,#0
000ad4  0a000001          BEQ      |L1.2784|
;;;588    		return dev->root_dir;
000ad8  e5940d80          LDR      r0,[r4,#0xd80]
                  |L1.2780|
;;;589    
;;;590    	return NULL;
;;;591    }
000adc  e8bd8070          POP      {r4-r6,pc}
                  |L1.2784|
000ae0  e3a00000          MOV      r0,#0                 ;590
000ae4  eafffffc          B        |L1.2780|
;;;592    
                          ENDP

                  yaffsfs_DoFindDirectory PROC
;;;623     */
;;;624    static struct yaffs_obj *yaffsfs_DoFindDirectory(struct yaffs_obj *startDir,
000ae8  e92d4ff0          PUSH     {r4-r11,lr}
;;;625    						 const YCHAR *path,
;;;626    						 YCHAR **name, int symDepth,
;;;627    						 int *notDir, int *loop)
;;;628    {
000aec  e24ddf41          SUB      sp,sp,#0x104
000af0  e1a06000          MOV      r6,r0
000af4  e1a07001          MOV      r7,r1
000af8  e1a0a002          MOV      r10,r2
000afc  e1a08003          MOV      r8,r3
000b00  e59d912c          LDR      r9,[sp,#0x12c]
000b04  e59db128          LDR      r11,[sp,#0x128]
;;;629    	struct yaffs_obj *dir;
;;;630    	YCHAR *restOfPath;
;;;631    	YCHAR str[YAFFS_MAX_NAME_LENGTH + 1];
;;;632    	int i;
;;;633    
;;;634    	if (symDepth > YAFFSFS_MAX_SYMLINK_DEREFERENCES) {
000b08  e3580005          CMP      r8,#5
000b0c  da000006          BLE      |L1.2860|
;;;635    		if (loop)
000b10  e3590000          CMP      r9,#0
000b14  0a000001          BEQ      |L1.2848|
;;;636    			*loop = 1;
000b18  e3a00001          MOV      r0,#1
000b1c  e5890000          STR      r0,[r9,#0]
                  |L1.2848|
;;;637    		return NULL;
000b20  e3a00000          MOV      r0,#0
                  |L1.2852|
000b24  e28ddf41          ADD      sp,sp,#0x104
;;;638    	}
;;;639    
;;;640    	if (startDir) {
;;;641    		dir = startDir;
;;;642    		restOfPath = (YCHAR *) path;
;;;643    	} else
;;;644    		dir = yaffsfs_FindRoot(path, &restOfPath);
;;;645    
;;;646    	while (dir) {
;;;647    		/*
;;;648    		 * parse off /.
;;;649    		 * curve ball: also throw away surplus '/'
;;;650    		 * eg. "/ram/x////ff" gets treated the same as "/ram/x/ff"
;;;651    		 */
;;;652    		while (yaffsfs_IsPathDivider(*restOfPath))
;;;653    			restOfPath++;	/* get rid of '/' */
;;;654    
;;;655    		*name = restOfPath;
;;;656    		i = 0;
;;;657    
;;;658    		while (*restOfPath && !yaffsfs_IsPathDivider(*restOfPath)) {
;;;659    			if (i < YAFFS_MAX_NAME_LENGTH) {
;;;660    				str[i] = *restOfPath;
;;;661    				str[i + 1] = '\0';
;;;662    				i++;
;;;663    			}
;;;664    			restOfPath++;
;;;665    		}
;;;666    
;;;667    		if (!*restOfPath)
;;;668    			/* got to the end of the string */
;;;669    			return dir;
;;;670    		else {
;;;671    			if (yaffs_strcmp(str, _Y(".")) == 0) {
;;;672    				/* Do nothing */
;;;673    			} else if (yaffs_strcmp(str, _Y("..")) == 0) {
;;;674    				dir = dir->parent;
;;;675    			} else {
;;;676    				dir = yaffs_find_by_name(dir, str);
;;;677    
;;;678    				dir = yaffsfs_FollowLink(dir, symDepth, loop);
;;;679    
;;;680    				if (dir && dir->variant_type !=
;;;681    				    YAFFS_OBJECT_TYPE_DIRECTORY) {
;;;682    					if (notDir)
;;;683    						*notDir = 1;
;;;684    					dir = NULL;
;;;685    				}
;;;686    
;;;687    			}
;;;688    		}
;;;689    	}
;;;690    	/* directory did not exist. */
;;;691    	return NULL;
;;;692    }
000b28  e8bd8ff0          POP      {r4-r11,pc}
                  |L1.2860|
000b2c  e3560000          CMP      r6,#0                 ;640
000b30  0a000002          BEQ      |L1.2880|
000b34  e1a04006          MOV      r4,r6                 ;641
000b38  e58d7100          STR      r7,[sp,#0x100]        ;642
000b3c  ea000003          B        |L1.2896|
                  |L1.2880|
000b40  e28d1c01          ADD      r1,sp,#0x100          ;644
000b44  e1a00007          MOV      r0,r7                 ;644
000b48  ebfffffe          BL       yaffsfs_FindRoot
000b4c  e1a04000          MOV      r4,r0                 ;644
                  |L1.2896|
000b50  ea000046          B        |L1.3184|
                  |L1.2900|
000b54  ea000002          B        |L1.2916|
                  |L1.2904|
000b58  e59d0100          LDR      r0,[sp,#0x100]        ;653
000b5c  e2800001          ADD      r0,r0,#1              ;653
000b60  e58d0100          STR      r0,[sp,#0x100]        ;653
                  |L1.2916|
000b64  e59d1100          LDR      r1,[sp,#0x100]        ;652
000b68  e5d10000          LDRB     r0,[r1,#0]            ;652
000b6c  ebfffffe          BL       yaffsfs_IsPathDivider
000b70  e3500000          CMP      r0,#0                 ;652
000b74  1afffff7          BNE      |L1.2904|
000b78  e59d0100          LDR      r0,[sp,#0x100]        ;655
000b7c  e58a0000          STR      r0,[r10,#0]           ;655
000b80  e3a05000          MOV      r5,#0                 ;656
000b84  ea00000b          B        |L1.3000|
                  |L1.2952|
000b88  e35500ff          CMP      r5,#0xff              ;659
000b8c  aa000006          BGE      |L1.2988|
000b90  e59d0100          LDR      r0,[sp,#0x100]        ;660
000b94  e5d00000          LDRB     r0,[r0,#0]            ;660
000b98  e7cd0005          STRB     r0,[sp,r5]            ;660
000b9c  e3a00000          MOV      r0,#0                 ;661
000ba0  e2852001          ADD      r2,r5,#1              ;661
000ba4  e7cd0002          STRB     r0,[sp,r2]            ;661
000ba8  e2855001          ADD      r5,r5,#1              ;662
                  |L1.2988|
000bac  e59d0100          LDR      r0,[sp,#0x100]        ;664
000bb0  e2800001          ADD      r0,r0,#1              ;664
000bb4  e58d0100          STR      r0,[sp,#0x100]        ;664
                  |L1.3000|
000bb8  e59d0100          LDR      r0,[sp,#0x100]        ;658
000bbc  e5d00000          LDRB     r0,[r0,#0]            ;658
000bc0  e3500000          CMP      r0,#0                 ;658
000bc4  0a000004          BEQ      |L1.3036|
000bc8  e59d1100          LDR      r1,[sp,#0x100]        ;658
000bcc  e5d10000          LDRB     r0,[r1,#0]            ;658
000bd0  ebfffffe          BL       yaffsfs_IsPathDivider
000bd4  e3500000          CMP      r0,#0                 ;658
000bd8  0affffea          BEQ      |L1.2952|
                  |L1.3036|
000bdc  e59d0100          LDR      r0,[sp,#0x100]        ;667
000be0  e5d00000          LDRB     r0,[r0,#0]            ;667
000be4  e3500000          CMP      r0,#0                 ;667
000be8  1a000001          BNE      |L1.3060|
000bec  e1a00004          MOV      r0,r4                 ;669
000bf0  eaffffcb          B        |L1.2852|
                  |L1.3060|
000bf4  e28f1f7e          ADR      r1,|L1.3572|
000bf8  e1a0000d          MOV      r0,sp                 ;671
000bfc  ebfffffe          BL       strcmp
000c00  e3500000          CMP      r0,#0                 ;671
000c04  0a000019          BEQ      |L1.3184|
000c08  e28f1f7a          ADR      r1,|L1.3576|
000c0c  e1a0000d          MOV      r0,sp                 ;673
000c10  ebfffffe          BL       strcmp
000c14  e3500000          CMP      r0,#0                 ;673
000c18  1a000001          BNE      |L1.3108|
000c1c  e594401c          LDR      r4,[r4,#0x1c]         ;674
000c20  ea000012          B        |L1.3184|
                  |L1.3108|
000c24  e1a0100d          MOV      r1,sp                 ;676
000c28  e1a00004          MOV      r0,r4                 ;676
000c2c  ebfffffe          BL       yaffs_find_by_name
000c30  e1a04000          MOV      r4,r0                 ;676
000c34  e1a02009          MOV      r2,r9                 ;678
000c38  e1a01008          MOV      r1,r8                 ;678
000c3c  e1a00004          MOV      r0,r4                 ;678
000c40  ebfffffe          BL       yaffsfs_FollowLink
000c44  e1a04000          MOV      r4,r0                 ;678
000c48  e3540000          CMP      r4,#0                 ;680
000c4c  0a000007          BEQ      |L1.3184|
000c50  e5d40064          LDRB     r0,[r4,#0x64]         ;680
000c54  e3500003          CMP      r0,#3                 ;680
000c58  0a000004          BEQ      |L1.3184|
000c5c  e35b0000          CMP      r11,#0                ;682
000c60  0a000001          BEQ      |L1.3180|
000c64  e3a00001          MOV      r0,#1                 ;683
000c68  e58b0000          STR      r0,[r11,#0]           ;683
                  |L1.3180|
000c6c  e3a04000          MOV      r4,#0                 ;684
                  |L1.3184|
000c70  e3540000          CMP      r4,#0                 ;646
000c74  1affffb6          BNE      |L1.2900|
000c78  e3a00000          MOV      r0,#0                 ;691
000c7c  eaffffa8          B        |L1.2852|
;;;693    
                          ENDP

                  yaffsfs_FindDirectory PROC
;;;694    static struct yaffs_obj *yaffsfs_FindDirectory(struct yaffs_obj *relDir,
000c80  e92d47fc          PUSH     {r2-r10,lr}
;;;695    					       const YCHAR *path,
;;;696    					       YCHAR **name,
;;;697    					       int symDepth,
;;;698    					       int *notDir, int *loop)
;;;699    {
000c84  e1a04000          MOV      r4,r0
000c88  e1a05001          MOV      r5,r1
000c8c  e1a06002          MOV      r6,r2
000c90  e1a07003          MOV      r7,r3
000c94  e1cd82d8          LDRD     r8,r9,[sp,#0x28]
;;;700    	return yaffsfs_DoFindDirectory(relDir, path, name, symDepth, notDir,
000c98  e1a03007          MOV      r3,r7
000c9c  e1a02006          MOV      r2,r6
000ca0  e1a01005          MOV      r1,r5
000ca4  e1a00004          MOV      r0,r4
000ca8  e1cd80f0          STRD     r8,r9,[sp,#0]
000cac  ebfffffe          BL       yaffsfs_DoFindDirectory
;;;701    						loop);
;;;702    }
000cb0  e8bd87fc          POP      {r2-r10,pc}
;;;703    
                          ENDP

                  yaffsfs_FindObject PROC
;;;706     */
;;;707    static struct yaffs_obj *yaffsfs_FindObject(struct yaffs_obj *relDir,
000cb4  e92d4fff          PUSH     {r0-r11,lr}
;;;708    					    const YCHAR *path, int symDepth,
;;;709    					    int getEquiv,
;;;710    					    struct yaffs_obj **dirOut,
;;;711    					    int *notDir, int *loop)
;;;712    {
000cb8  e24dd00c          SUB      sp,sp,#0xc
000cbc  e1a09000          MOV      r9,r0
000cc0  e1a06002          MOV      r6,r2
000cc4  e1a07003          MOV      r7,r3
000cc8  e28db040          ADD      r11,sp,#0x40
000ccc  e89b0d00          LDM      r11,{r8,r10,r11}
;;;713    	struct yaffs_obj *dir;
;;;714    	struct yaffs_obj *obj;
;;;715    	YCHAR *name;
;;;716    
;;;717    	dir =
000cd0  e1a03006          MOV      r3,r6
000cd4  e1cda0f0          STRD     r10,r11,[sp,#0]
000cd8  e28d2008          ADD      r2,sp,#8
000cdc  e1a00009          MOV      r0,r9
000ce0  e59d1010          LDR      r1,[sp,#0x10]
000ce4  ebfffffe          BL       yaffsfs_FindDirectory
000ce8  e1a04000          MOV      r4,r0
;;;718    	    yaffsfs_FindDirectory(relDir, path, &name, symDepth, notDir, loop);
;;;719    
;;;720    	if (dirOut)
000cec  e3580000          CMP      r8,#0
000cf0  0a000000          BEQ      |L1.3320|
;;;721    		*dirOut = dir;
000cf4  e5884000          STR      r4,[r8,#0]
                  |L1.3320|
;;;722    
;;;723    	if (dir && *name)
000cf8  e3540000          CMP      r4,#0
000cfc  0a000008          BEQ      |L1.3364|
000d00  e59d0008          LDR      r0,[sp,#8]
000d04  e5d00000          LDRB     r0,[r0,#0]
000d08  e3500000          CMP      r0,#0
000d0c  0a000004          BEQ      |L1.3364|
;;;724    		obj = yaffs_find_by_name(dir, name);
000d10  e1a00004          MOV      r0,r4
000d14  e59d1008          LDR      r1,[sp,#8]
000d18  ebfffffe          BL       yaffs_find_by_name
000d1c  e1a05000          MOV      r5,r0
000d20  ea000000          B        |L1.3368|
                  |L1.3364|
;;;725    	else
;;;726    		obj = dir;
000d24  e1a05004          MOV      r5,r4
                  |L1.3368|
;;;727    
;;;728    	if (getEquiv)
000d28  e3570000          CMP      r7,#0
000d2c  0a000002          BEQ      |L1.3388|
;;;729    		obj = yaffs_get_equivalent_obj(obj);
000d30  e1a00005          MOV      r0,r5
000d34  ebfffffe          BL       yaffs_get_equivalent_obj
000d38  e1a05000          MOV      r5,r0
                  |L1.3388|
;;;730    
;;;731    	return obj;
000d3c  e1a00005          MOV      r0,r5
000d40  e28dd01c          ADD      sp,sp,#0x1c
;;;732    }
000d44  e8bd8ff0          POP      {r4-r11,pc}
;;;733    
                          ENDP

                  yaffsfs_FollowLink PROC
;;;592    
;;;593    static struct yaffs_obj *yaffsfs_FollowLink(struct yaffs_obj *obj,
000d48  e92d40fe          PUSH     {r1-r7,lr}
;;;594    					    int symDepth, int *loop)
;;;595    {
000d4c  e1a04000          MOV      r4,r0
000d50  e1a05001          MOV      r5,r1
000d54  e1a06002          MOV      r6,r2
;;;596    
;;;597    	if (obj)
000d58  e3540000          CMP      r4,#0
000d5c  0a000002          BEQ      |L1.3436|
;;;598    		obj = yaffs_get_equivalent_obj(obj);
000d60  e1a00004          MOV      r0,r4
000d64  ebfffffe          BL       yaffs_get_equivalent_obj
000d68  e1a04000          MOV      r4,r0
                  |L1.3436|
;;;599    
;;;600    	while (obj && obj->variant_type == YAFFS_OBJECT_TYPE_SYMLINK) {
000d6c  ea000019          B        |L1.3544|
                  |L1.3440|
;;;601    		YCHAR *alias = obj->variant.symlink_variant.alias;
000d70  e5947068          LDR      r7,[r4,#0x68]
;;;602    
;;;603    		if (yaffsfs_IsPathDivider(*alias))
000d74  e5d70000          LDRB     r0,[r7,#0]
000d78  ebfffffe          BL       yaffsfs_IsPathDivider
000d7c  e3500000          CMP      r0,#0
000d80  0a000009          BEQ      |L1.3500|
;;;604    			/* Starts with a /, need to scan from root up */
;;;605    			obj = yaffsfs_FindObject(NULL, alias, symDepth++,
000d84  e3a00000          MOV      r0,#0
000d88  e58d0000          STR      r0,[sp,#0]
000d8c  e1a02005          MOV      r2,r5
000d90  e2855001          ADD      r5,r5,#1
000d94  e3a03001          MOV      r3,#1
000d98  e1a01007          MOV      r1,r7
000d9c  e98d0041          STMIB    sp,{r0,r6}
000da0  ebfffffe          BL       yaffsfs_FindObject
000da4  e1a04000          MOV      r4,r0
000da8  ea000009          B        |L1.3540|
                  |L1.3500|
;;;606    						 1, NULL, NULL, loop);
;;;607    		else
;;;608    			/*
;;;609    			 * Relative to here so use the parent of the
;;;610    			 * symlink as a start
;;;611    			 */
;;;612    			obj = yaffsfs_FindObject(obj->parent, alias, symDepth++,
000dac  e3a00000          MOV      r0,#0
000db0  e58d0000          STR      r0,[sp,#0]
000db4  e1a02005          MOV      r2,r5
000db8  e2855001          ADD      r5,r5,#1
000dbc  e98d0041          STMIB    sp,{r0,r6}
000dc0  e3a03001          MOV      r3,#1
000dc4  e1a01007          MOV      r1,r7
000dc8  e594001c          LDR      r0,[r4,#0x1c]
000dcc  ebfffffe          BL       yaffsfs_FindObject
000dd0  e1a04000          MOV      r4,r0
                  |L1.3540|
;;;613    						 1, NULL, NULL, loop);
;;;614    	}
000dd4  e1a00000          MOV      r0,r0
                  |L1.3544|
000dd8  e3540000          CMP      r4,#0                 ;600
000ddc  0a000002          BEQ      |L1.3564|
000de0  e5d40064          LDRB     r0,[r4,#0x64]         ;600
000de4  e3500002          CMP      r0,#2                 ;600
000de8  0affffe0          BEQ      |L1.3440|
                  |L1.3564|
;;;615    	return obj;
000dec  e1a00004          MOV      r0,r4
;;;616    }
000df0  e8bd80fe          POP      {r1-r7,pc}
                  |L1.3572|
000df4  2e00              DCB      ".",0
000df6  00                DCB      0
000df7  00                DCB      0
                  |L1.3576|
000df8  2e2e00            DCB      "..",0
000dfb  00                DCB      0
                          ENDP

                  yaffs_dup PROC
;;;737    
;;;738    int yaffs_dup(int handle)
000dfc  e92d40f8          PUSH     {r3-r7,lr}
;;;739    {
000e00  e1a05000          MOV      r5,r0
;;;740    	int newHandleNumber = -1;
000e04  e3e06000          MVN      r6,#0
;;;741    	struct yaffsfs_FileDes *existingFD = NULL;
000e08  e3a04000          MOV      r4,#0
;;;742    	struct yaffsfs_Handle *existingHandle = NULL;
000e0c  e3a07000          MOV      r7,#0
;;;743    	struct yaffsfs_Handle *newHandle = NULL;
000e10  e3a00000          MOV      r0,#0
000e14  e58d0000          STR      r0,[sp,#0]
;;;744    
;;;745    	yaffsfs_Lock();
000e18  ebfffffe          BL       yaffsfs_Lock
;;;746    	existingHandle = yaffsfs_HandleToPointer(handle);
000e1c  e1a00005          MOV      r0,r5
000e20  ebfffffe          BL       yaffsfs_HandleToPointer
000e24  e1a07000          MOV      r7,r0
;;;747    	existingFD = yaffsfs_HandleToFileDes(handle);
000e28  e1a00005          MOV      r0,r5
000e2c  ebfffffe          BL       yaffsfs_HandleToFileDes
000e30  e1a04000          MOV      r4,r0
;;;748    	if (existingFD)
000e34  e3540000          CMP      r4,#0
000e38  0a000002          BEQ      |L1.3656|
;;;749    		newHandleNumber = yaffsfs_NewHandle(&newHandle);
000e3c  e1a0000d          MOV      r0,sp
000e40  ebfffffe          BL       yaffsfs_NewHandle
000e44  e1a06000          MOV      r6,r0
                  |L1.3656|
;;;750    	if (newHandle) {
000e48  e59d0000          LDR      r0,[sp,#0]
000e4c  e3500000          CMP      r0,#0
000e50  0a00000d          BEQ      |L1.3724|
;;;751    		newHandle->fdId = existingHandle->fdId;
000e54  e1d700b0          LDRH     r0,[r7,#0]
000e58  e59d1000          LDR      r1,[sp,#0]
000e5c  e1c100b0          STRH     r0,[r1,#0]
;;;752    		existingFD->handleCount++;
000e60  e5940000          LDR      r0,[r4,#0]
000e64  e3c00407          BIC      r0,r0,#0x7000000
000e68  e3c008fe          BIC      r0,r0,#0xfe0000
000e6c  e5941000          LDR      r1,[r4,#0]
000e70  e1a01281          LSL      r1,r1,#5
000e74  e3a02001          MOV      r2,#1
000e78  e0821b21          ADD      r1,r2,r1,LSR #22
000e7c  e51f24ac          LDR      r2,|L1.2520|
000e80  e0021881          AND      r1,r2,r1,LSL #17
000e84  e1800001          ORR      r0,r0,r1
000e88  e5840000          STR      r0,[r4,#0]
                  |L1.3724|
;;;753    	}
;;;754    
;;;755    	yaffsfs_Unlock();
000e8c  ebfffffe          BL       yaffsfs_Unlock
;;;756    
;;;757    	if (!existingFD)
000e90  e3540000          CMP      r4,#0
000e94  1a000002          BNE      |L1.3748|
;;;758    		yaffsfs_SetError(-EBADF);
000e98  e3e00008          MVN      r0,#8
000e9c  ebfffffe          BL       yaffsfs_SetError
000ea0  ea000004          B        |L1.3768|
                  |L1.3748|
;;;759    	else if (!newHandle)
000ea4  e59d0000          LDR      r0,[sp,#0]
000ea8  e3500000          CMP      r0,#0
000eac  1a000001          BNE      |L1.3768|
;;;760    		yaffsfs_SetError(-ENOMEM);
000eb0  e3e0000b          MVN      r0,#0xb
000eb4  ebfffffe          BL       yaffsfs_SetError
                  |L1.3768|
;;;761    
;;;762    	return newHandleNumber;
000eb8  e1a00006          MOV      r0,r6
;;;763    
;;;764    }
000ebc  e8bd80f8          POP      {r3-r7,pc}
;;;765    
                          ENDP

                  yaffsfs_TooManyObjects PROC
;;;766    static int yaffsfs_TooManyObjects(struct yaffs_dev *dev)
000ec0  e1a01000          MOV      r1,r0
;;;767    {
;;;768    	int current_objects = dev->n_obj - dev->n_deleted_files;
000ec4  e591013c          LDR      r0,[r1,#0x13c]
000ec8  e5913da4          LDR      r3,[r1,#0xda4]
000ecc  e0402003          SUB      r2,r0,r3
;;;769    
;;;770    	if (dev->param.max_objects && current_objects > dev->param.max_objects)
000ed0  e5910090          LDR      r0,[r1,#0x90]
000ed4  e3500000          CMP      r0,#0
000ed8  0a000004          BEQ      |L1.3824|
000edc  e5910090          LDR      r0,[r1,#0x90]
000ee0  e1500002          CMP      r0,r2
000ee4  aa000001          BGE      |L1.3824|
;;;771    		return 1;
000ee8  e3a00001          MOV      r0,#1
                  |L1.3820|
;;;772    	else
;;;773    		return 0;
;;;774    }
000eec  e12fff1e          BX       lr
                  |L1.3824|
000ef0  e3a00000          MOV      r0,#0                 ;773
000ef4  eafffffc          B        |L1.3820|
;;;775    
                          ENDP

                  yaffs_open_sharing PROC
;;;776    int yaffs_open_sharing(const YCHAR *path, int oflag, int mode, int sharing)
000ef8  e92d4fff          PUSH     {r0-r11,lr}
;;;777    {
000efc  e24dd044          SUB      sp,sp,#0x44
000f00  e1a06001          MOV      r6,r1
;;;778    	struct yaffs_obj *obj = NULL;
000f04  e3a04000          MOV      r4,#0
;;;779    	struct yaffs_obj *dir = NULL;
000f08  e3a09000          MOV      r9,#0
;;;780    	YCHAR *name;
;;;781    	int handle = -1;
000f0c  e3e00000          MVN      r0,#0
000f10  e58d003c          STR      r0,[sp,#0x3c]
;;;782    	struct yaffsfs_FileDes *fd = NULL;
000f14  e3a05000          MOV      r5,#0
;;;783    	int openDenied = 0;
000f18  e3a00000          MOV      r0,#0
000f1c  e58d0038          STR      r0,[sp,#0x38]
;;;784    	int symDepth = 0;
000f20  e58d0034          STR      r0,[sp,#0x34]
;;;785    	int errorReported = 0;
000f24  e3a07000          MOV      r7,#0
;;;786    	int rwflags = oflag & (O_RDWR | O_RDONLY | O_WRONLY);
000f28  e206a003          AND      r10,r6,#3
;;;787    	u8 shareRead = (sharing & YAFFS_SHARE_READ) ? 1 : 0;
000f2c  e59d0050          LDR      r0,[sp,#0x50]
000f30  e2000001          AND      r0,r0,#1
000f34  e58d0030          STR      r0,[sp,#0x30]
;;;788    	u8 shareWrite = (sharing & YAFFS_SHARE_WRITE) ? 1 : 0;
000f38  e59d0050          LDR      r0,[sp,#0x50]
000f3c  e2000002          AND      r0,r0,#2
000f40  e1a000a0          LSR      r0,r0,#1
000f44  e58d002c          STR      r0,[sp,#0x2c]
;;;789    	u8 sharedReadAllowed;
;;;790    	u8 sharedWriteAllowed;
;;;791    	u8 alreadyReading;
;;;792    	u8 alreadyWriting;
;;;793    	u8 readRequested;
;;;794    	u8 writeRequested;
;;;795    	int notDir = 0;
000f48  e3a00000          MOV      r0,#0
000f4c  e58d0014          STR      r0,[sp,#0x14]
;;;796    	int loop = 0;
000f50  e58d0010          STR      r0,[sp,#0x10]
;;;797    
;;;798    	if (!path) {
000f54  e59d0044          LDR      r0,[sp,#0x44]
000f58  e3500000          CMP      r0,#0
000f5c  1a000004          BNE      |L1.3956|
;;;799    		yaffsfs_SetError(-EFAULT);
000f60  e3e0000d          MVN      r0,#0xd
000f64  ebfffffe          BL       yaffsfs_SetError
;;;800    		return -1;
000f68  e3e00000          MVN      r0,#0
                  |L1.3948|
000f6c  e28dd054          ADD      sp,sp,#0x54
;;;801    	}
;;;802    
;;;803    	if (yaffsfs_CheckPath(path) < 0) {
;;;804    		yaffsfs_SetError(-ENAMETOOLONG);
;;;805    		return -1;
;;;806    	}
;;;807    
;;;808    	/* O_EXCL only has meaning if O_CREAT is specified */
;;;809    	if (!(oflag & O_CREAT))
;;;810    		oflag &= ~(O_EXCL);
;;;811    
;;;812    	/* O_TRUNC has no meaning if (O_CREAT | O_EXCL) is specified */
;;;813    	if ((oflag & O_CREAT) & (oflag & O_EXCL))
;;;814    		oflag &= ~(O_TRUNC);
;;;815    
;;;816    	/* Todo: Are there any more flag combos to sanitise ? */
;;;817    
;;;818    	/* Figure out if reading or writing is requested */
;;;819    
;;;820    	readRequested = (rwflags == O_RDWR || rwflags == O_RDONLY) ? 1 : 0;
;;;821    	writeRequested = (rwflags == O_RDWR || rwflags == O_WRONLY) ? 1 : 0;
;;;822    
;;;823    	yaffsfs_Lock();
;;;824    
;;;825    	handle = yaffsfs_NewHandleAndFileDes();
;;;826    
;;;827    	if (handle < 0) {
;;;828    		yaffsfs_SetError(-ENFILE);
;;;829    		errorReported = 1;
;;;830    	} else {
;;;831    
;;;832    		fd = yaffsfs_HandleToFileDes(handle);
;;;833    
;;;834    		/* try to find the exisiting object */
;;;835    		obj = yaffsfs_FindObject(NULL, path, 0, 1, NULL, NULL, NULL);
;;;836    
;;;837    		obj = yaffsfs_FollowLink(obj, symDepth++, &loop);
;;;838    
;;;839    		if (obj &&
;;;840    		    obj->variant_type != YAFFS_OBJECT_TYPE_FILE &&
;;;841    		    obj->variant_type != YAFFS_OBJECT_TYPE_DIRECTORY)
;;;842    			obj = NULL;
;;;843    
;;;844    		if (obj) {
;;;845    
;;;846    			/* The file already exists or it might be a directory */
;;;847    
;;;848    			/* A directory can't be opened as a file */
;;;849    			if (obj->variant_type == YAFFS_OBJECT_TYPE_DIRECTORY) {
;;;850    				openDenied = 1;
;;;851    				yaffsfs_SetError(-EISDIR);
;;;852    				errorReported = 1;
;;;853    			}
;;;854    
;;;855    			/* Open should fail if O_CREAT and O_EXCL are specified
;;;856    			 * for a file that exists.
;;;857    			 */
;;;858    			if (!errorReported &&
;;;859    			    (oflag & O_EXCL) && (oflag & O_CREAT)) {
;;;860    				openDenied = 1;
;;;861    				yaffsfs_SetError(-EEXIST);
;;;862    				errorReported = 1;
;;;863    			}
;;;864    
;;;865    			/* Check file permissions */
;;;866    			if (readRequested && !(obj->yst_mode & S_IREAD))
;;;867    				openDenied = 1;
;;;868    
;;;869    			if (writeRequested && !(obj->yst_mode & S_IWRITE))
;;;870    				openDenied = 1;
;;;871    
;;;872    			if (!errorReported && writeRequested &&
;;;873    			    obj->my_dev->read_only) {
;;;874    				openDenied = 1;
;;;875    				yaffsfs_SetError(-EROFS);
;;;876    				errorReported = 1;
;;;877    			}
;;;878    
;;;879    			if (openDenied && !errorReported) {
;;;880    				yaffsfs_SetError(-EACCES);
;;;881    				errorReported = 1;
;;;882    			}
;;;883    
;;;884    			/* Check sharing of an existing object. */
;;;885    			if (!openDenied) {
;;;886    				struct yaffsfs_FileDes *fdx;
;;;887    				int i;
;;;888    
;;;889    				sharedReadAllowed = 1;
;;;890    				sharedWriteAllowed = 1;
;;;891    				alreadyReading = 0;
;;;892    				alreadyWriting = 0;
;;;893    				for (i = 0; i < YAFFSFS_N_HANDLES; i++) {
;;;894    					fdx = &yaffsfs_fd[i];
;;;895    					if (fdx->handleCount > 0 &&
;;;896    					    fdx->inodeId >= 0 &&
;;;897    					    yaffsfs_inode[fdx->inodeId].iObj
;;;898    					    == obj) {
;;;899    						if (!fdx->shareRead)
;;;900    							sharedReadAllowed = 0;
;;;901    						if (!fdx->shareWrite)
;;;902    							sharedWriteAllowed = 0;
;;;903    						if (fdx->reading)
;;;904    							alreadyReading = 1;
;;;905    						if (fdx->writing)
;;;906    							alreadyWriting = 1;
;;;907    					}
;;;908    				}
;;;909    
;;;910    				if ((!sharedReadAllowed && readRequested) ||
;;;911    				    (!shareRead && alreadyReading) ||
;;;912    				    (!sharedWriteAllowed && writeRequested) ||
;;;913    				    (!shareWrite && alreadyWriting)) {
;;;914    					openDenied = 1;
;;;915    					yaffsfs_SetError(-EBUSY);
;;;916    					errorReported = 1;
;;;917    				}
;;;918    			}
;;;919    
;;;920    		}
;;;921    
;;;922    		/* If we could not open an existing object, then let's see if
;;;923    		 * the directory exists. If not, error.
;;;924    		 */
;;;925    		if (!obj && !errorReported) {
;;;926    			dir = yaffsfs_FindDirectory(NULL, path, &name, 0,
;;;927    						    &notDir, &loop);
;;;928    			if (!dir && notDir) {
;;;929    				yaffsfs_SetError(-ENOTDIR);
;;;930    				errorReported = 1;
;;;931    			} else if (loop) {
;;;932    				yaffsfs_SetError(-ELOOP);
;;;933    				errorReported = 1;
;;;934    			} else if (!dir) {
;;;935    				yaffsfs_SetError(-ENOENT);
;;;936    				errorReported = 1;
;;;937    			}
;;;938    		}
;;;939    
;;;940    		if (!obj && dir && !errorReported && (oflag & O_CREAT)) {
;;;941    			/* Let's see if we can create this file */
;;;942    			if (dir->my_dev->read_only) {
;;;943    				yaffsfs_SetError(-EROFS);
;;;944    				errorReported = 1;
;;;945    			} else if (yaffsfs_TooManyObjects(dir->my_dev)) {
;;;946    				yaffsfs_SetError(-ENFILE);
;;;947    				errorReported = 1;
;;;948    			} else
;;;949    				obj = yaffs_create_file(dir, name, mode, 0, 0);
;;;950    
;;;951    			if (!obj && !errorReported) {
;;;952    				yaffsfs_SetError(-ENOSPC);
;;;953    				errorReported = 1;
;;;954    			}
;;;955    		}
;;;956    
;;;957    		if (!obj && dir && !errorReported && !(oflag & O_CREAT)) {
;;;958    			yaffsfs_SetError(-ENOENT);
;;;959    			errorReported = 1;
;;;960    		}
;;;961    
;;;962    		if (obj && !openDenied) {
;;;963    			int inodeId = yaffsfs_GetInodeIdForObject(obj);
;;;964    
;;;965    			if (inodeId < 0) {
;;;966    				/*
;;;967    				 * Todo: Fix any problem if inodes run out,
;;;968    				 * That can't happen if the number of inode
;;;969    				 * items >= number of handles.
;;;970    				 */
;;;971    			}
;;;972    
;;;973    			fd->inodeId = inodeId;
;;;974    			fd->reading = readRequested;
;;;975    			fd->writing = writeRequested;
;;;976    			fd->append = (oflag & O_APPEND) ? 1 : 0;
;;;977    			fd->position = 0;
;;;978    			fd->shareRead = shareRead;
;;;979    			fd->shareWrite = shareWrite;
;;;980    
;;;981    			/* Hook inode to object */
;;;982    			obj->my_inode = (void *)&yaffsfs_inode[inodeId];
;;;983    
;;;984    			if ((oflag & O_TRUNC) && fd->writing)
;;;985    				yaffs_resize_file(obj, 0);
;;;986    		} else {
;;;987    			yaffsfs_PutHandle(handle);
;;;988    			if (!errorReported)
;;;989    				yaffsfs_SetError(0);	/* Problem */
;;;990    			handle = -1;
;;;991    		}
;;;992    	}
;;;993    
;;;994    	yaffsfs_Unlock();
;;;995    
;;;996    	return handle;
;;;997    }
000f70  e8bd8ff0          POP      {r4-r11,pc}
                  |L1.3956|
000f74  e59d0044          LDR      r0,[sp,#0x44]         ;803
000f78  ebfffffe          BL       yaffsfs_CheckPath
000f7c  e3500000          CMP      r0,#0                 ;803
000f80  aa000003          BGE      |L1.3988|
000f84  e3e00023          MVN      r0,#0x23              ;804
000f88  ebfffffe          BL       yaffsfs_SetError
000f8c  e3e00000          MVN      r0,#0                 ;805
000f90  eafffff5          B        |L1.3948|
                  |L1.3988|
000f94  e3160040          TST      r6,#0x40              ;809
000f98  1a000000          BNE      |L1.4000|
000f9c  e3c66080          BIC      r6,r6,#0x80           ;810
                  |L1.4000|
000fa0  e2060040          AND      r0,r6,#0x40           ;813
000fa4  e2061080          AND      r1,r6,#0x80           ;813
000fa8  e1100001          TST      r0,r1                 ;813
000fac  0a000000          BEQ      |L1.4020|
000fb0  e3c66c02          BIC      r6,r6,#0x200          ;814
                  |L1.4020|
000fb4  e35a0002          CMP      r10,#2                ;820
000fb8  0a000001          BEQ      |L1.4036|
000fbc  e35a0000          CMP      r10,#0                ;820
000fc0  1a000001          BNE      |L1.4044|
                  |L1.4036|
000fc4  e3a00001          MOV      r0,#1                 ;820
000fc8  ea000000          B        |L1.4048|
                  |L1.4044|
000fcc  e3a00000          MOV      r0,#0                 ;820
                  |L1.4048|
000fd0  e58d0018          STR      r0,[sp,#0x18]         ;820
000fd4  e35a0002          CMP      r10,#2                ;821
000fd8  0a000001          BEQ      |L1.4068|
000fdc  e35a0001          CMP      r10,#1                ;821
000fe0  1a000001          BNE      |L1.4076|
                  |L1.4068|
000fe4  e3a00001          MOV      r0,#1                 ;821
000fe8  ea000000          B        |L1.4080|
                  |L1.4076|
000fec  e3a00000          MOV      r0,#0                 ;821
                  |L1.4080|
000ff0  e1a0b000          MOV      r11,r0                ;821
000ff4  ebfffffe          BL       yaffsfs_Lock
000ff8  ebfffffe          BL       yaffsfs_NewHandleAndFileDes
000ffc  e58d003c          STR      r0,[sp,#0x3c]         ;825
001000  e59d003c          LDR      r0,[sp,#0x3c]         ;827
001004  e3500000          CMP      r0,#0                 ;827
001008  aa000003          BGE      |L1.4124|
00100c  e3e00016          MVN      r0,#0x16              ;828
001010  ebfffffe          BL       yaffsfs_SetError
001014  e3a07001          MOV      r7,#1                 ;829
001018  ea00014d          B        |L1.5460|
                  |L1.4124|
00101c  e59d003c          LDR      r0,[sp,#0x3c]         ;832
001020  ebfffffe          BL       yaffsfs_HandleToFileDes
001024  e1a05000          MOV      r5,r0                 ;832
001028  e3a00000          MOV      r0,#0                 ;835
00102c  e58d0000          STR      r0,[sp,#0]            ;835
001030  e58d0004          STR      r0,[sp,#4]            ;835
001034  e3a03001          MOV      r3,#1                 ;835
001038  e58d0008          STR      r0,[sp,#8]            ;835
00103c  e1a02000          MOV      r2,r0                 ;835
001040  e59d1044          LDR      r1,[sp,#0x44]         ;835
001044  ebfffffe          BL       yaffsfs_FindObject
001048  e1a04000          MOV      r4,r0                 ;835
00104c  e59d0034          LDR      r0,[sp,#0x34]         ;837
001050  e2802001          ADD      r2,r0,#1              ;837
001054  e1a01000          MOV      r1,r0                 ;837
001058  e58d2034          STR      r2,[sp,#0x34]         ;837
00105c  e28d2010          ADD      r2,sp,#0x10           ;837
001060  e1a00004          MOV      r0,r4                 ;837
001064  ebfffffe          BL       yaffsfs_FollowLink
001068  e1a04000          MOV      r4,r0                 ;837
00106c  e3540000          CMP      r4,#0                 ;839
001070  0a000006          BEQ      |L1.4240|
001074  e5d40064          LDRB     r0,[r4,#0x64]         ;840
001078  e3500001          CMP      r0,#1                 ;840
00107c  0a000003          BEQ      |L1.4240|
001080  e5d40064          LDRB     r0,[r4,#0x64]         ;841
001084  e3500003          CMP      r0,#3                 ;841
001088  0a000000          BEQ      |L1.4240|
00108c  e3a04000          MOV      r4,#0                 ;842
                  |L1.4240|
001090  e3540000          CMP      r4,#0                 ;844
001094  0a00008f          BEQ      |L1.4824|
001098  e5d40064          LDRB     r0,[r4,#0x64]         ;849
00109c  e3500003          CMP      r0,#3                 ;849
0010a0  1a000004          BNE      |L1.4280|
0010a4  e3a00001          MOV      r0,#1                 ;850
0010a8  e58d0038          STR      r0,[sp,#0x38]         ;850
0010ac  e3e00014          MVN      r0,#0x14              ;851
0010b0  ebfffffe          BL       yaffsfs_SetError
0010b4  e3a07001          MOV      r7,#1                 ;852
                  |L1.4280|
0010b8  e3570000          CMP      r7,#0                 ;858
0010bc  1a000008          BNE      |L1.4324|
0010c0  e3160080          TST      r6,#0x80              ;859
0010c4  0a000006          BEQ      |L1.4324|
0010c8  e3160040          TST      r6,#0x40              ;859
0010cc  0a000004          BEQ      |L1.4324|
0010d0  e3a00001          MOV      r0,#1                 ;860
0010d4  e58d0038          STR      r0,[sp,#0x38]         ;860
0010d8  e3e00010          MVN      r0,#0x10              ;861
0010dc  ebfffffe          BL       yaffsfs_SetError
0010e0  e3a07001          MOV      r7,#1                 ;862
                  |L1.4324|
0010e4  e59d0018          LDR      r0,[sp,#0x18]         ;866
0010e8  e3500000          CMP      r0,#0                 ;866
0010ec  0a000004          BEQ      |L1.4356|
0010f0  e1d403b4          LDRH     r0,[r4,#0x34]         ;866
0010f4  e3100c01          TST      r0,#0x100             ;866
0010f8  1a000001          BNE      |L1.4356|
0010fc  e3a00001          MOV      r0,#1                 ;867
001100  e58d0038          STR      r0,[sp,#0x38]         ;867
                  |L1.4356|
001104  e35b0000          CMP      r11,#0                ;869
001108  0a000004          BEQ      |L1.4384|
00110c  e5d40034          LDRB     r0,[r4,#0x34]         ;869
001110  e3100080          TST      r0,#0x80              ;869
001114  1a000001          BNE      |L1.4384|
001118  e3a00001          MOV      r0,#1                 ;870
00111c  e58d0038          STR      r0,[sp,#0x38]         ;870
                  |L1.4384|
001120  e3570000          CMP      r7,#0                 ;872
001124  1a00000a          BNE      |L1.4436|
001128  e35b0000          CMP      r11,#0                ;872
00112c  0a000008          BEQ      |L1.4436|
001130  e5940008          LDR      r0,[r4,#8]            ;873
001134  e59000c8          LDR      r0,[r0,#0xc8]         ;873
001138  e3500000          CMP      r0,#0                 ;873
00113c  0a000004          BEQ      |L1.4436|
001140  e3a00001          MOV      r0,#1                 ;874
001144  e58d0038          STR      r0,[sp,#0x38]         ;874
001148  e3e0001d          MVN      r0,#0x1d              ;875
00114c  ebfffffe          BL       yaffsfs_SetError
001150  e3a07001          MOV      r7,#1                 ;876
                  |L1.4436|
001154  e59d0038          LDR      r0,[sp,#0x38]         ;879
001158  e3500000          CMP      r0,#0                 ;879
00115c  0a000004          BEQ      |L1.4468|
001160  e3570000          CMP      r7,#0                 ;879
001164  1a000002          BNE      |L1.4468|
001168  e3e0000c          MVN      r0,#0xc               ;880
00116c  ebfffffe          BL       yaffsfs_SetError
001170  e3a07001          MOV      r7,#1                 ;881
                  |L1.4468|
001174  e59d0038          LDR      r0,[sp,#0x38]         ;885
001178  e3500000          CMP      r0,#0                 ;885
00117c  1a000055          BNE      |L1.4824|
001180  e3a00001          MOV      r0,#1                 ;889
001184  e58d0028          STR      r0,[sp,#0x28]         ;889
001188  e58d0024          STR      r0,[sp,#0x24]         ;890
00118c  e3a00000          MOV      r0,#0                 ;891
001190  e58d0020          STR      r0,[sp,#0x20]         ;891
001194  e58d001c          STR      r0,[sp,#0x1c]         ;892
001198  e58d000c          STR      r0,[sp,#0xc]          ;893
00119c  ea00002d          B        |L1.4696|
                  |L1.4512|
0011a0  e51f17e0          LDR      r1,|L1.2504|
0011a4  e59d000c          LDR      r0,[sp,#0xc]          ;894
0011a8  e0818200          ADD      r8,r1,r0,LSL #4       ;894
0011ac  e5980000          LDR      r0,[r8,#0]            ;895
0011b0  e1a00280          LSL      r0,r0,#5              ;895
0011b4  e1a00b20          LSR      r0,r0,#22             ;895
0011b8  e3500000          CMP      r0,#0                 ;895
0011bc  da000022          BLE      |L1.4684|
0011c0  e5980000          LDR      r0,[r8,#0]            ;896
0011c4  e1a00780          LSL      r0,r0,#15             ;896
0011c8  e1b00a20          LSRS     r0,r0,#20             ;896
0011cc  4a00001e          BMI      |L1.4684|
0011d0  e5980000          LDR      r0,[r8,#0]            ;897
0011d4  e1a00780          LSL      r0,r0,#15             ;897
0011d8  e1a00a20          LSR      r0,r0,#20             ;897
0011dc  e51f1820          LDR      r1,|L1.2500|
0011e0  e0810180          ADD      r0,r1,r0,LSL #3       ;897
0011e4  e5900004          LDR      r0,[r0,#4]            ;897
0011e8  e1500004          CMP      r0,r4                 ;897
0011ec  1a000016          BNE      |L1.4684|
0011f0  e5d80000          LDRB     r0,[r8,#0]            ;899
0011f4  e1a00e00          LSL      r0,r0,#28             ;899
0011f8  e1b00fa0          LSRS     r0,r0,#31             ;899
0011fc  1a000001          BNE      |L1.4616|
001200  e3a00000          MOV      r0,#0                 ;900
001204  e58d0028          STR      r0,[sp,#0x28]         ;900
                  |L1.4616|
001208  e5d80000          LDRB     r0,[r8,#0]            ;901
00120c  e1a00d80          LSL      r0,r0,#27             ;901
001210  e1b00fa0          LSRS     r0,r0,#31             ;901
001214  1a000001          BNE      |L1.4640|
001218  e3a00000          MOV      r0,#0                 ;902
00121c  e58d0024          STR      r0,[sp,#0x24]         ;902
                  |L1.4640|
001220  e5d80000          LDRB     r0,[r8,#0]            ;903
001224  e3100001          TST      r0,#1                 ;903
001228  0a000001          BEQ      |L1.4660|
00122c  e3a00001          MOV      r0,#1                 ;904
001230  e58d0020          STR      r0,[sp,#0x20]         ;904
                  |L1.4660|
001234  e5d80000          LDRB     r0,[r8,#0]            ;905
001238  e1a00f00          LSL      r0,r0,#30             ;905
00123c  e1b00fa0          LSRS     r0,r0,#31             ;905
001240  0a000001          BEQ      |L1.4684|
001244  e3a00001          MOV      r0,#1                 ;906
001248  e58d001c          STR      r0,[sp,#0x1c]         ;906
                  |L1.4684|
00124c  e59d000c          LDR      r0,[sp,#0xc]          ;893
001250  e2800001          ADD      r0,r0,#1              ;893
001254  e58d000c          STR      r0,[sp,#0xc]          ;893
                  |L1.4696|
001258  e59d000c          LDR      r0,[sp,#0xc]          ;893
00125c  e3500064          CMP      r0,#0x64              ;893
001260  baffffce          BLT      |L1.4512|
001264  e59d0028          LDR      r0,[sp,#0x28]         ;910
001268  e3500000          CMP      r0,#0                 ;910
00126c  1a000002          BNE      |L1.4732|
001270  e59d0018          LDR      r0,[sp,#0x18]         ;910
001274  e3500000          CMP      r0,#0                 ;910
001278  1a000010          BNE      |L1.4800|
                  |L1.4732|
00127c  e59d0030          LDR      r0,[sp,#0x30]         ;911
001280  e3500000          CMP      r0,#0                 ;911
001284  1a000002          BNE      |L1.4756|
001288  e59d0020          LDR      r0,[sp,#0x20]         ;911
00128c  e3500000          CMP      r0,#0                 ;911
001290  1a00000a          BNE      |L1.4800|
                  |L1.4756|
001294  e59d0024          LDR      r0,[sp,#0x24]         ;912
001298  e3500000          CMP      r0,#0                 ;912
00129c  1a000001          BNE      |L1.4776|
0012a0  e35b0000          CMP      r11,#0                ;912
0012a4  1a000005          BNE      |L1.4800|
                  |L1.4776|
0012a8  e59d002c          LDR      r0,[sp,#0x2c]         ;913
0012ac  e3500000          CMP      r0,#0                 ;913
0012b0  1a000007          BNE      |L1.4820|
0012b4  e59d001c          LDR      r0,[sp,#0x1c]         ;913
0012b8  e3500000          CMP      r0,#0                 ;913
0012bc  0a000004          BEQ      |L1.4820|
                  |L1.4800|
0012c0  e3a00001          MOV      r0,#1                 ;914
0012c4  e58d0038          STR      r0,[sp,#0x38]         ;914
0012c8  e3e0000f          MVN      r0,#0xf               ;915
0012cc  ebfffffe          BL       yaffsfs_SetError
0012d0  e3a07001          MOV      r7,#1                 ;916
                  |L1.4820|
0012d4  e1a00000          MOV      r0,r0                 ;918
                  |L1.4824|
0012d8  e3540000          CMP      r4,#0                 ;925
0012dc  1a000020          BNE      |L1.4964|
0012e0  e3570000          CMP      r7,#0                 ;925
0012e4  1a00001e          BNE      |L1.4964|
0012e8  e28d0010          ADD      r0,sp,#0x10           ;926
0012ec  e28d1014          ADD      r1,sp,#0x14           ;926
0012f0  e3a03000          MOV      r3,#0                 ;926
0012f4  e58d0004          STR      r0,[sp,#4]            ;926
0012f8  e58d1000          STR      r1,[sp,#0]            ;926
0012fc  e28d2040          ADD      r2,sp,#0x40           ;926
001300  e1a00003          MOV      r0,r3                 ;926
001304  e59d1044          LDR      r1,[sp,#0x44]         ;926
001308  ebfffffe          BL       yaffsfs_FindDirectory
00130c  e1a09000          MOV      r9,r0                 ;926
001310  e3590000          CMP      r9,#0                 ;928
001314  1a000006          BNE      |L1.4916|
001318  e59d0014          LDR      r0,[sp,#0x14]         ;928
00131c  e3500000          CMP      r0,#0                 ;928
001320  0a000003          BEQ      |L1.4916|
001324  e3e00013          MVN      r0,#0x13              ;929
001328  ebfffffe          BL       yaffsfs_SetError
00132c  e3a07001          MOV      r7,#1                 ;930
001330  ea00000b          B        |L1.4964|
                  |L1.4916|
001334  e59d0010          LDR      r0,[sp,#0x10]         ;931
001338  e3500000          CMP      r0,#0                 ;931
00133c  0a000003          BEQ      |L1.4944|
001340  e3e00027          MVN      r0,#0x27              ;932
001344  ebfffffe          BL       yaffsfs_SetError
001348  e3a07001          MOV      r7,#1                 ;933
00134c  ea000004          B        |L1.4964|
                  |L1.4944|
001350  e3590000          CMP      r9,#0                 ;934
001354  1a000002          BNE      |L1.4964|
001358  e3e00001          MVN      r0,#1                 ;935
00135c  ebfffffe          BL       yaffsfs_SetError
001360  e3a07001          MOV      r7,#1                 ;936
                  |L1.4964|
001364  e3540000          CMP      r4,#0                 ;940
001368  1a000024          BNE      |L1.5120|
00136c  e3590000          CMP      r9,#0                 ;940
001370  0a000022          BEQ      |L1.5120|
001374  e3570000          CMP      r7,#0                 ;940
001378  1a000020          BNE      |L1.5120|
00137c  e3160040          TST      r6,#0x40              ;940
001380  0a00001e          BEQ      |L1.5120|
001384  e5990008          LDR      r0,[r9,#8]            ;942
001388  e59000c8          LDR      r0,[r0,#0xc8]         ;942
00138c  e3500000          CMP      r0,#0                 ;942
001390  0a000003          BEQ      |L1.5028|
001394  e3e0001d          MVN      r0,#0x1d              ;943
001398  ebfffffe          BL       yaffsfs_SetError
00139c  e3a07001          MOV      r7,#1                 ;944
0013a0  ea00000f          B        |L1.5092|
                  |L1.5028|
0013a4  e5990008          LDR      r0,[r9,#8]            ;945
0013a8  ebfffffe          BL       yaffsfs_TooManyObjects
0013ac  e3500000          CMP      r0,#0                 ;945
0013b0  0a000003          BEQ      |L1.5060|
0013b4  e3e00016          MVN      r0,#0x16              ;946
0013b8  ebfffffe          BL       yaffsfs_SetError
0013bc  e3a07001          MOV      r7,#1                 ;947
0013c0  ea000007          B        |L1.5092|
                  |L1.5060|
0013c4  e3a00000          MOV      r0,#0                 ;949
0013c8  e58d0000          STR      r0,[sp,#0]            ;949
0013cc  e1a03000          MOV      r3,r0                 ;949
0013d0  e1a00009          MOV      r0,r9                 ;949
0013d4  e59d1040          LDR      r1,[sp,#0x40]         ;949
0013d8  e59d204c          LDR      r2,[sp,#0x4c]         ;949
0013dc  ebfffffe          BL       yaffs_create_file
0013e0  e1a04000          MOV      r4,r0                 ;949
                  |L1.5092|
0013e4  e3540000          CMP      r4,#0                 ;951
0013e8  1a000004          BNE      |L1.5120|
0013ec  e3570000          CMP      r7,#0                 ;951
0013f0  1a000002          BNE      |L1.5120|
0013f4  e3e0001b          MVN      r0,#0x1b              ;952
0013f8  ebfffffe          BL       yaffsfs_SetError
0013fc  e3a07001          MOV      r7,#1                 ;953
                  |L1.5120|
001400  e3540000          CMP      r4,#0                 ;957
001404  1a000008          BNE      |L1.5164|
001408  e3590000          CMP      r9,#0                 ;957
00140c  0a000006          BEQ      |L1.5164|
001410  e3570000          CMP      r7,#0                 ;957
001414  1a000004          BNE      |L1.5164|
001418  e3160040          TST      r6,#0x40              ;957
00141c  1a000002          BNE      |L1.5164|
001420  e3e00001          MVN      r0,#1                 ;958
001424  ebfffffe          BL       yaffsfs_SetError
001428  e3a07001          MOV      r7,#1                 ;959
                  |L1.5164|
00142c  e3540000          CMP      r4,#0                 ;962
001430  0a00003f          BEQ      |L1.5428|
001434  e59d0038          LDR      r0,[sp,#0x38]         ;962
001438  e3500000          CMP      r0,#0                 ;962
00143c  1a00003c          BNE      |L1.5428|
001440  e1a00004          MOV      r0,r4                 ;963
001444  ebfffffe          BL       yaffsfs_GetInodeIdForObject
001448  e1a08000          MOV      r8,r0                 ;963
00144c  e5950000          LDR      r0,[r5,#0]            ;973
001450  e3c00a1f          BIC      r0,r0,#0x1f000        ;973
001454  e3c00efe          BIC      r0,r0,#0xfe0          ;973
001458  e59f1ed8          LDR      r1,|L1.9016|
00145c  e0011288          AND      r1,r1,r8,LSL #5       ;973
001460  e1800001          ORR      r0,r0,r1              ;973
001464  e5850000          STR      r0,[r5,#0]            ;973
001468  e5d50000          LDRB     r0,[r5,#0]            ;974
00146c  e3c01001          BIC      r1,r0,#1              ;974
001470  e59d0018          LDR      r0,[sp,#0x18]         ;974
001474  e2000001          AND      r0,r0,#1              ;974
001478  e1800001          ORR      r0,r0,r1              ;974
00147c  e5c50000          STRB     r0,[r5,#0]            ;974
001480  e5d50000          LDRB     r0,[r5,#0]            ;975
001484  e3c00002          BIC      r0,r0,#2              ;975
001488  e3a01002          MOV      r1,#2                 ;975
00148c  e001108b          AND      r1,r1,r11,LSL #1      ;975
001490  e1800001          ORR      r0,r0,r1              ;975
001494  e5c50000          STRB     r0,[r5,#0]            ;975
001498  e5d50000          LDRB     r0,[r5,#0]            ;976
00149c  e3c00004          BIC      r0,r0,#4              ;976
0014a0  e2061b01          AND      r1,r6,#0x400          ;976
0014a4  e1a01521          LSR      r1,r1,#10             ;976
0014a8  e3a02004          MOV      r2,#4                 ;976
0014ac  e0021101          AND      r1,r2,r1,LSL #2       ;976
0014b0  e1800001          ORR      r0,r0,r1              ;976
0014b4  e5c50000          STRB     r0,[r5,#0]            ;976
0014b8  e3a01000          MOV      r1,#0                 ;976
0014bc  e5851008          STR      r1,[r5,#8]            ;977
0014c0  e585100c          STR      r1,[r5,#0xc]          ;977
0014c4  e5d50000          LDRB     r0,[r5,#0]            ;978
0014c8  e3c01008          BIC      r1,r0,#8              ;978
0014cc  e3a02008          MOV      r2,#8                 ;978
0014d0  e59d0030          LDR      r0,[sp,#0x30]         ;978
0014d4  e0020180          AND      r0,r2,r0,LSL #3       ;978
0014d8  e1800001          ORR      r0,r0,r1              ;978
0014dc  e5c50000          STRB     r0,[r5,#0]            ;978
0014e0  e5d50000          LDRB     r0,[r5,#0]            ;979
0014e4  e3c01010          BIC      r1,r0,#0x10           ;979
0014e8  e3a02010          MOV      r2,#0x10              ;979
0014ec  e59d002c          LDR      r0,[sp,#0x2c]         ;979
0014f0  e0020200          AND      r0,r2,r0,LSL #4       ;979
0014f4  e1800001          ORR      r0,r0,r1              ;979
0014f8  e5c50000          STRB     r0,[r5,#0]            ;979
0014fc  e51f0b40          LDR      r0,|L1.2500|
001500  e0800188          ADD      r0,r0,r8,LSL #3       ;982
001504  e5840060          STR      r0,[r4,#0x60]         ;982
001508  e3160c02          TST      r6,#0x200             ;984
00150c  0a000007          BEQ      |L1.5424|
001510  e5d50000          LDRB     r0,[r5,#0]            ;984
001514  e1a00f00          LSL      r0,r0,#30             ;984
001518  e1b00fa0          LSRS     r0,r0,#31             ;984
00151c  0a000003          BEQ      |L1.5424|
001520  e3a02000          MOV      r2,#0                 ;984
001524  e1a03002          MOV      r3,r2                 ;984
001528  e1a00004          MOV      r0,r4                 ;985
00152c  ebfffffe          BL       yaffs_resize_file
                  |L1.5424|
001530  ea000007          B        |L1.5460|
                  |L1.5428|
001534  e59d003c          LDR      r0,[sp,#0x3c]         ;987
001538  ebfffffe          BL       yaffsfs_PutHandle
00153c  e3570000          CMP      r7,#0                 ;988
001540  1a000001          BNE      |L1.5452|
001544  e3a00000          MOV      r0,#0                 ;989
001548  ebfffffe          BL       yaffsfs_SetError
                  |L1.5452|
00154c  e3e00000          MVN      r0,#0                 ;990
001550  e58d003c          STR      r0,[sp,#0x3c]         ;990
                  |L1.5460|
001554  ebfffffe          BL       yaffsfs_Unlock
001558  e59d003c          LDR      r0,[sp,#0x3c]         ;996
00155c  eafffe82          B        |L1.3948|
;;;998    
                          ENDP

                  yaffs_open PROC
;;;999    int yaffs_open(const YCHAR *path, int oflag, int mode)
001560  e92d4070          PUSH     {r4-r6,lr}
;;;1000   {
001564  e1a04000          MOV      r4,r0
001568  e1a05001          MOV      r5,r1
00156c  e1a06002          MOV      r6,r2
;;;1001   	return yaffs_open_sharing(path, oflag, mode,
001570  e3a03003          MOV      r3,#3
001574  e1a02006          MOV      r2,r6
001578  e1a01005          MOV      r1,r5
00157c  e1a00004          MOV      r0,r4
001580  ebfffffe          BL       yaffs_open_sharing
;;;1002   				  YAFFS_SHARE_READ | YAFFS_SHARE_WRITE);
;;;1003   }
001584  e8bd8070          POP      {r4-r6,pc}
;;;1004   
                          ENDP

                  yaffs_Dofsync PROC
;;;1005   int yaffs_Dofsync(int handle, int datasync)
001588  e92d41f0          PUSH     {r4-r8,lr}
;;;1006   {
00158c  e1a06000          MOV      r6,r0
001590  e1a05001          MOV      r5,r1
;;;1007   	int retVal = -1;
001594  e3e07000          MVN      r7,#0
;;;1008   	struct yaffs_obj *obj;
;;;1009   
;;;1010   	yaffsfs_Lock();
001598  ebfffffe          BL       yaffsfs_Lock
;;;1011   
;;;1012   	obj = yaffsfs_HandleToObject(handle);
00159c  e1a00006          MOV      r0,r6
0015a0  ebfffffe          BL       yaffsfs_HandleToObject
0015a4  e1a04000          MOV      r4,r0
;;;1013   
;;;1014   	if (!obj)
0015a8  e3540000          CMP      r4,#0
0015ac  1a000002          BNE      |L1.5564|
;;;1015   		yaffsfs_SetError(-EBADF);
0015b0  e3e00008          MVN      r0,#8
0015b4  ebfffffe          BL       yaffsfs_SetError
0015b8  ea00000b          B        |L1.5612|
                  |L1.5564|
;;;1016   	else if (obj->my_dev->read_only)
0015bc  e5940008          LDR      r0,[r4,#8]
0015c0  e59000c8          LDR      r0,[r0,#0xc8]
0015c4  e3500000          CMP      r0,#0
0015c8  0a000002          BEQ      |L1.5592|
;;;1017   		yaffsfs_SetError(-EROFS);
0015cc  e3e0001d          MVN      r0,#0x1d
0015d0  ebfffffe          BL       yaffsfs_SetError
0015d4  ea000004          B        |L1.5612|
                  |L1.5592|
;;;1018   	else {
;;;1019   		yaffs_flush_file(obj, 1, datasync);
0015d8  e1a02005          MOV      r2,r5
0015dc  e3a01001          MOV      r1,#1
0015e0  e1a00004          MOV      r0,r4
0015e4  ebfffffe          BL       yaffs_flush_file
;;;1020   		retVal = 0;
0015e8  e3a07000          MOV      r7,#0
                  |L1.5612|
;;;1021   	}
;;;1022   
;;;1023   	yaffsfs_Unlock();
0015ec  ebfffffe          BL       yaffsfs_Unlock
;;;1024   
;;;1025   	return retVal;
0015f0  e1a00007          MOV      r0,r7
;;;1026   }
0015f4  e8bd81f0          POP      {r4-r8,pc}
;;;1027   
                          ENDP

                  yaffs_fsync PROC
;;;1028   int yaffs_fsync(int handle)
0015f8  e92d4010          PUSH     {r4,lr}
;;;1029   {
0015fc  e1a04000          MOV      r4,r0
;;;1030   	return yaffs_Dofsync(handle, 0);
001600  e3a01000          MOV      r1,#0
001604  e1a00004          MOV      r0,r4
001608  ebfffffe          BL       yaffs_Dofsync
;;;1031   }
00160c  e8bd8010          POP      {r4,pc}
;;;1032   
                          ENDP

                  yaffs_flush PROC
;;;1033   int yaffs_flush(int handle)
001610  e92d4010          PUSH     {r4,lr}
;;;1034   {
001614  e1a04000          MOV      r4,r0
;;;1035   	return yaffs_fsync(handle);
001618  e1a00004          MOV      r0,r4
00161c  ebfffffe          BL       yaffs_fsync
;;;1036   }
001620  e8bd8010          POP      {r4,pc}
;;;1037   
                          ENDP

                  yaffs_fdatasync PROC
;;;1038   int yaffs_fdatasync(int handle)
001624  e92d4010          PUSH     {r4,lr}
;;;1039   {
001628  e1a04000          MOV      r4,r0
;;;1040   	return yaffs_Dofsync(handle, 1);
00162c  e3a01001          MOV      r1,#1
001630  e1a00004          MOV      r0,r4
001634  ebfffffe          BL       yaffs_Dofsync
;;;1041   }
001638  e8bd8010          POP      {r4,pc}
;;;1042   
                          ENDP

                  yaffs_close PROC
;;;1043   int yaffs_close(int handle)
00163c  e92d41f0          PUSH     {r4-r8,lr}
;;;1044   {
001640  e1a05000          MOV      r5,r0
;;;1045   	struct yaffsfs_Handle *h = NULL;
001644  e3a06000          MOV      r6,#0
;;;1046   	struct yaffs_obj *obj = NULL;
001648  e3a04000          MOV      r4,#0
;;;1047   	int retVal = -1;
00164c  e3e07000          MVN      r7,#0
;;;1048   
;;;1049   	yaffsfs_Lock();
001650  ebfffffe          BL       yaffsfs_Lock
;;;1050   
;;;1051   	h = yaffsfs_HandleToPointer(handle);
001654  e1a00005          MOV      r0,r5
001658  ebfffffe          BL       yaffsfs_HandleToPointer
00165c  e1a06000          MOV      r6,r0
;;;1052   	obj = yaffsfs_HandleToObject(handle);
001660  e1a00005          MOV      r0,r5
001664  ebfffffe          BL       yaffsfs_HandleToObject
001668  e1a04000          MOV      r4,r0
;;;1053   
;;;1054   	if (!h || !obj)
00166c  e3560000          CMP      r6,#0
001670  0a000001          BEQ      |L1.5756|
001674  e3540000          CMP      r4,#0
001678  1a000002          BNE      |L1.5768|
                  |L1.5756|
;;;1055   		yaffsfs_SetError(-EBADF);
00167c  e3e00008          MVN      r0,#8
001680  ebfffffe          BL       yaffsfs_SetError
001684  ea000006          B        |L1.5796|
                  |L1.5768|
;;;1056   	else {
;;;1057   		/* clean up */
;;;1058   		yaffs_flush_file(obj, 1, 0);
001688  e3a02000          MOV      r2,#0
00168c  e3a01001          MOV      r1,#1
001690  e1a00004          MOV      r0,r4
001694  ebfffffe          BL       yaffs_flush_file
;;;1059   		yaffsfs_PutHandle(handle);
001698  e1a00005          MOV      r0,r5
00169c  ebfffffe          BL       yaffsfs_PutHandle
;;;1060   		retVal = 0;
0016a0  e3a07000          MOV      r7,#0
                  |L1.5796|
;;;1061   	}
;;;1062   
;;;1063   	yaffsfs_Unlock();
0016a4  ebfffffe          BL       yaffsfs_Unlock
;;;1064   
;;;1065   	return retVal;
0016a8  e1a00007          MOV      r0,r7
;;;1066   }
0016ac  e8bd81f0          POP      {r4-r8,pc}
;;;1067   
                          ENDP

                  yaffsfs_do_read PROC
;;;1068   int yaffsfs_do_read(int handle, void *vbuf, unsigned int nbyte,
0016b0  e92d4fff          PUSH     {r0-r11,lr}
;;;1069   		    int isPread, loff_t offset)
;;;1070   {
0016b4  e24dd024          SUB      sp,sp,#0x24
0016b8  e1a0a002          MOV      r10,r2
;;;1071   	struct yaffsfs_FileDes *fd = NULL;
0016bc  e3a00000          MOV      r0,#0
0016c0  e58d001c          STR      r0,[sp,#0x1c]
;;;1072   	struct yaffs_obj *obj = NULL;
0016c4  e58d0018          STR      r0,[sp,#0x18]
;;;1073   	loff_t pos = 0;
0016c8  e1a00000          MOV      r0,r0
;;;1074   	loff_t startPos = 0;
0016cc  e1a00000          MOV      r0,r0
;;;1075   	loff_t endPos = 0;
0016d0  e1a00000          MOV      r0,r0
;;;1076   	int nRead = 0;
0016d4  e3a0b000          MOV      r11,#0
;;;1077   	int nToRead = 0;
0016d8  e58d000c          STR      r0,[sp,#0xc]
;;;1078   	int totalRead = 0;
0016dc  e58d0008          STR      r0,[sp,#8]
;;;1079   	loff_t maxRead;
;;;1080   	u8 *buf = (u8 *) vbuf;
0016e0  e59d0028          LDR      r0,[sp,#0x28]
0016e4  e58d0004          STR      r0,[sp,#4]
;;;1081   
;;;1082   	if (!vbuf) {
0016e8  e59d0028          LDR      r0,[sp,#0x28]
0016ec  e3500000          CMP      r0,#0
0016f0  1a000004          BNE      |L1.5896|
;;;1083   		yaffsfs_SetError(-EFAULT);
0016f4  e3e0000d          MVN      r0,#0xd
0016f8  ebfffffe          BL       yaffsfs_SetError
;;;1084   		return -1;
0016fc  e3e00000          MVN      r0,#0
                  |L1.5888|
001700  e28dd034          ADD      sp,sp,#0x34
;;;1085   	}
;;;1086   
;;;1087   	yaffsfs_Lock();
;;;1088   	fd = yaffsfs_HandleToFileDes(handle);
;;;1089   	obj = yaffsfs_HandleToObject(handle);
;;;1090   
;;;1091   	if (!fd || !obj) {
;;;1092   		/* bad handle */
;;;1093   		yaffsfs_SetError(-EBADF);
;;;1094   		totalRead = -1;
;;;1095   	} else if (!fd->reading) {
;;;1096   		/* Not a reading handle */
;;;1097   		yaffsfs_SetError(-EINVAL);
;;;1098   		totalRead = -1;
;;;1099   	} else if (nbyte > YAFFS_MAX_FILE_SIZE) {
;;;1100   		yaffsfs_SetError(-EINVAL);
;;;1101   		totalRead = -1;
;;;1102   	} else {
;;;1103   		if (isPread)
;;;1104   			startPos = offset;
;;;1105   		else
;;;1106   			startPos = fd->position;
;;;1107   
;;;1108   		pos = startPos;
;;;1109   
;;;1110   		if (yaffs_get_obj_length(obj) > pos)
;;;1111   			maxRead = yaffs_get_obj_length(obj) - pos;
;;;1112   		else
;;;1113   			maxRead = 0;
;;;1114   
;;;1115   		if (nbyte > maxRead)
;;;1116   			nbyte = maxRead;
;;;1117   
;;;1118   		yaffsfs_GetHandle(handle);
;;;1119   
;;;1120   		endPos = pos + nbyte;
;;;1121   
;;;1122   		if (pos < 0 || pos > YAFFS_MAX_FILE_SIZE ||
;;;1123   		    nbyte > YAFFS_MAX_FILE_SIZE ||
;;;1124   		    endPos < 0 || endPos > YAFFS_MAX_FILE_SIZE) {
;;;1125   			totalRead = -1;
;;;1126   			nbyte = 0;
;;;1127   		}
;;;1128   
;;;1129   		while (nbyte > 0) {
;;;1130   			nToRead = YAFFSFS_RW_SIZE -
;;;1131   			    (pos & (YAFFSFS_RW_SIZE - 1));
;;;1132   			if (nToRead > nbyte)
;;;1133   				nToRead = nbyte;
;;;1134   
;;;1135   			/* Tricky bit...
;;;1136   			 * Need to reverify object in case the device was
;;;1137   			 * unmounted in another thread.
;;;1138   			 */
;;;1139   			obj = yaffsfs_HandleToObject(handle);
;;;1140   			if (!obj)
;;;1141   				nRead = 0;
;;;1142   			else
;;;1143   				nRead = yaffs_file_rd(obj, buf, pos, nToRead);
;;;1144   
;;;1145   			if (nRead > 0) {
;;;1146   				totalRead += nRead;
;;;1147   				pos += nRead;
;;;1148   				buf += nRead;
;;;1149   			}
;;;1150   
;;;1151   			if (nRead == nToRead)
;;;1152   				nbyte -= nRead;
;;;1153   			else
;;;1154   				nbyte = 0;	/* no more to read */
;;;1155   
;;;1156   			if (nbyte > 0) {
;;;1157   				yaffsfs_Unlock();
;;;1158   				yaffsfs_Lock();
;;;1159   			}
;;;1160   
;;;1161   		}
;;;1162   
;;;1163   		yaffsfs_PutHandle(handle);
;;;1164   
;;;1165   		if (!isPread) {
;;;1166   			if (totalRead >= 0)
;;;1167   				fd->position = startPos + totalRead;
;;;1168   			else
;;;1169   				yaffsfs_SetError(-EINVAL);
;;;1170   		}
;;;1171   
;;;1172   	}
;;;1173   
;;;1174   	yaffsfs_Unlock();
;;;1175   
;;;1176   	return (totalRead >= 0) ? totalRead : -1;
;;;1177   
;;;1178   }
001704  e8bd8ff0          POP      {r4-r11,pc}
                  |L1.5896|
001708  ebfffffe          BL       yaffsfs_Lock
00170c  e59d0024          LDR      r0,[sp,#0x24]         ;1088
001710  ebfffffe          BL       yaffsfs_HandleToFileDes
001714  e58d001c          STR      r0,[sp,#0x1c]         ;1088
001718  e59d0024          LDR      r0,[sp,#0x24]         ;1089
00171c  ebfffffe          BL       yaffsfs_HandleToObject
001720  e58d0018          STR      r0,[sp,#0x18]         ;1089
001724  e59d001c          LDR      r0,[sp,#0x1c]         ;1091
001728  e3500000          CMP      r0,#0                 ;1091
00172c  0a000002          BEQ      |L1.5948|
001730  e59d0018          LDR      r0,[sp,#0x18]         ;1091
001734  e3500000          CMP      r0,#0                 ;1091
001738  1a000004          BNE      |L1.5968|
                  |L1.5948|
00173c  e3e00008          MVN      r0,#8                 ;1093
001740  ebfffffe          BL       yaffsfs_SetError
001744  e3e00000          MVN      r0,#0                 ;1094
001748  e58d0008          STR      r0,[sp,#8]            ;1094
00174c  ea00008d          B        |L1.6536|
                  |L1.5968|
001750  e59d001c          LDR      r0,[sp,#0x1c]         ;1095
001754  e5d00000          LDRB     r0,[r0,#0]            ;1095
001758  e3100001          TST      r0,#1                 ;1095
00175c  1a000004          BNE      |L1.6004|
001760  e3e00015          MVN      r0,#0x15              ;1097
001764  ebfffffe          BL       yaffsfs_SetError
001768  e3e00000          MVN      r0,#0                 ;1098
00176c  e58d0008          STR      r0,[sp,#8]            ;1098
001770  ea000084          B        |L1.6536|
                  |L1.6004|
001774  e3e02000          MVN      r2,#0                 ;1098
001778  e3a00007          MOV      r0,#7                 ;1098
00177c  e052200a          SUBS     r2,r2,r10             ;1098
001780  e2d00000          SBCS     r0,r0,#0              ;1098
001784  aa000004          BGE      |L1.6044|
001788  e3e00015          MVN      r0,#0x15              ;1100
00178c  ebfffffe          BL       yaffsfs_SetError
001790  e3e00000          MVN      r0,#0                 ;1101
001794  e58d0008          STR      r0,[sp,#8]            ;1101
001798  ea00007a          B        |L1.6536|
                  |L1.6044|
00179c  e59d0030          LDR      r0,[sp,#0x30]         ;1103
0017a0  e3500000          CMP      r0,#0                 ;1103
0017a4  0a000001          BEQ      |L1.6064|
0017a8  e1cd65d8          LDRD     r6,r7,[sp,#0x58]      ;1104
0017ac  ea000001          B        |L1.6072|
                  |L1.6064|
0017b0  e59d001c          LDR      r0,[sp,#0x1c]         ;1106
0017b4  e1c060d8          LDRD     r6,r7,[r0,#8]         ;1106
                  |L1.6072|
0017b8  e1a04006          MOV      r4,r6                 ;1108
0017bc  e1a05007          MOV      r5,r7                 ;1108
0017c0  e59d0018          LDR      r0,[sp,#0x18]         ;1110
0017c4  ebfffffe          BL       yaffs_get_obj_length
0017c8  e0540000          SUBS     r0,r4,r0              ;1110
0017cc  e0d50001          SBCS     r0,r5,r1              ;1110
0017d0  aa000004          BGE      |L1.6120|
0017d4  e59d0018          LDR      r0,[sp,#0x18]         ;1111
0017d8  ebfffffe          BL       yaffs_get_obj_length
0017dc  e0508004          SUBS     r8,r0,r4              ;1111
0017e0  e0c19005          SBC      r9,r1,r5              ;1111
0017e4  ea000001          B        |L1.6128|
                  |L1.6120|
0017e8  e3a08000          MOV      r8,#0                 ;1111
0017ec  e1a09008          MOV      r9,r8                 ;1111
                  |L1.6128|
0017f0  e058100a          SUBS     r1,r8,r10             ;1113
0017f4  e2d90000          SBCS     r0,r9,#0              ;1113
0017f8  aa000000          BGE      |L1.6144|
0017fc  e1a0a008          MOV      r10,r8                ;1116
                  |L1.6144|
001800  e59d0024          LDR      r0,[sp,#0x24]         ;1118
001804  ebfffffe          BL       yaffsfs_GetHandle
001808  e094100a          ADDS     r1,r4,r10             ;1118
00180c  e2a50000          ADC      r0,r5,#0              ;1118
001810  e58d0014          STR      r0,[sp,#0x14]         ;1120
001814  e58d1010          STR      r1,[sp,#0x10]         ;1120
001818  e3a01000          MOV      r1,#0                 ;1120
00181c  e1a00001          MOV      r0,r1                 ;1120
001820  e0541001          SUBS     r1,r4,r1              ;1120
001824  e0d50000          SBCS     r0,r5,r0              ;1120
001828  ba000012          BLT      |L1.6264|
00182c  e3e00000          MVN      r0,#0                 ;1122
001830  e0500004          SUBS     r0,r0,r4              ;1122
001834  e2f50007          RSCS     r0,r5,#7              ;1122
001838  ba00000e          BLT      |L1.6264|
00183c  e3e01000          MVN      r1,#0                 ;1122
001840  e3a02007          MOV      r2,#7                 ;1122
001844  e051100a          SUBS     r1,r1,r10             ;1122
001848  e2d20000          SBCS     r0,r2,#0              ;1122
00184c  ba000009          BLT      |L1.6264|
001850  e3a03000          MOV      r3,#0                 ;1124
001854  e1cd01d0          LDRD     r0,r1,[sp,#0x10]      ;1124
001858  e0500003          SUBS     r0,r0,r3              ;1124
00185c  e0d10003          SBCS     r0,r1,r3              ;1124
001860  ba000004          BLT      |L1.6264|
001864  e3e02000          MVN      r2,#0                 ;1124
001868  e1cd01d0          LDRD     r0,r1,[sp,#0x10]      ;1124
00186c  e0520000          SUBS     r0,r2,r0              ;1124
001870  e2f10007          RSCS     r0,r1,#7              ;1124
001874  aa000002          BGE      |L1.6276|
                  |L1.6264|
001878  e3e00000          MVN      r0,#0                 ;1125
00187c  e58d0008          STR      r0,[sp,#8]            ;1125
001880  e3a0a000          MOV      r10,#0                ;1126
                  |L1.6276|
001884  ea00002b          B        |L1.6456|
                  |L1.6280|
001888  e59f0aac          LDR      r0,|L1.9020|
00188c  e0041000          AND      r1,r4,r0              ;1129
001890  e2710a02          RSBS     r0,r1,#0x2000         ;1129
001894  e58d000c          STR      r0,[sp,#0xc]          ;1130
001898  e59d000c          LDR      r0,[sp,#0xc]          ;1132
00189c  e150000a          CMP      r0,r10                ;1132
0018a0  9a000000          BLS      |L1.6312|
0018a4  e58da00c          STR      r10,[sp,#0xc]         ;1133
                  |L1.6312|
0018a8  e59d0024          LDR      r0,[sp,#0x24]         ;1139
0018ac  ebfffffe          BL       yaffsfs_HandleToObject
0018b0  e58d0018          STR      r0,[sp,#0x18]         ;1139
0018b4  e59d0018          LDR      r0,[sp,#0x18]         ;1140
0018b8  e3500000          CMP      r0,#0                 ;1140
0018bc  1a000001          BNE      |L1.6344|
0018c0  e3a0b000          MOV      r11,#0                ;1141
0018c4  ea000007          B        |L1.6376|
                  |L1.6344|
0018c8  e59d000c          LDR      r0,[sp,#0xc]          ;1143
0018cc  e1a02004          MOV      r2,r4                 ;1143
0018d0  e1a03005          MOV      r3,r5                 ;1143
0018d4  e58d0000          STR      r0,[sp,#0]            ;1143
0018d8  e59d0018          LDR      r0,[sp,#0x18]         ;1143
0018dc  e59d1004          LDR      r1,[sp,#4]            ;1143
0018e0  ebfffffe          BL       yaffs_file_rd
0018e4  e1a0b000          MOV      r11,r0                ;1143
                  |L1.6376|
0018e8  e35b0000          CMP      r11,#0                ;1145
0018ec  da000007          BLE      |L1.6416|
0018f0  e59d0008          LDR      r0,[sp,#8]            ;1146
0018f4  e080000b          ADD      r0,r0,r11             ;1146
0018f8  e58d0008          STR      r0,[sp,#8]            ;1146
0018fc  e094400b          ADDS     r4,r4,r11             ;1146
001900  e0a55fcb          ADC      r5,r5,r11,ASR #31     ;1146
001904  e59d0004          LDR      r0,[sp,#4]            ;1148
001908  e080000b          ADD      r0,r0,r11             ;1148
00190c  e58d0004          STR      r0,[sp,#4]            ;1148
                  |L1.6416|
001910  e59d000c          LDR      r0,[sp,#0xc]          ;1151
001914  e15b0000          CMP      r11,r0                ;1151
001918  1a000001          BNE      |L1.6436|
00191c  e04aa00b          SUB      r10,r10,r11           ;1152
001920  ea000000          B        |L1.6440|
                  |L1.6436|
001924  e3a0a000          MOV      r10,#0                ;1154
                  |L1.6440|
001928  e35a0000          CMP      r10,#0                ;1156
00192c  0a000001          BEQ      |L1.6456|
001930  ebfffffe          BL       yaffsfs_Unlock
001934  ebfffffe          BL       yaffsfs_Lock
                  |L1.6456|
001938  e35a0000          CMP      r10,#0                ;1129
00193c  1affffd1          BNE      |L1.6280|
001940  e59d0024          LDR      r0,[sp,#0x24]         ;1163
001944  ebfffffe          BL       yaffsfs_PutHandle
001948  e59d0030          LDR      r0,[sp,#0x30]         ;1165
00194c  e3500000          CMP      r0,#0                 ;1165
001950  1a00000c          BNE      |L1.6536|
001954  e59d0008          LDR      r0,[sp,#8]            ;1166
001958  e3500000          CMP      r0,#0                 ;1166
00195c  ba000007          BLT      |L1.6528|
001960  e59d0008          LDR      r0,[sp,#8]            ;1167
001964  e1a01fc0          ASR      r1,r0,#31             ;1167
001968  e0900006          ADDS     r0,r0,r6              ;1167
00196c  e0a72001          ADC      r2,r7,r1              ;1167
001970  e59d101c          LDR      r1,[sp,#0x1c]         ;1167
001974  e5810008          STR      r0,[r1,#8]            ;1167
001978  e581200c          STR      r2,[r1,#0xc]          ;1167
00197c  ea000001          B        |L1.6536|
                  |L1.6528|
001980  e3e00015          MVN      r0,#0x15              ;1169
001984  ebfffffe          BL       yaffsfs_SetError
                  |L1.6536|
001988  ebfffffe          BL       yaffsfs_Unlock
00198c  e59d0008          LDR      r0,[sp,#8]            ;1176
001990  e3500000          CMP      r0,#0                 ;1176
001994  ba000001          BLT      |L1.6560|
001998  e59d0008          LDR      r0,[sp,#8]            ;1176
00199c  eaffff57          B        |L1.5888|
                  |L1.6560|
0019a0  e3e00000          MVN      r0,#0                 ;1176
0019a4  eaffff55          B        |L1.5888|
;;;1179   
                          ENDP

                  yaffs_read PROC
;;;1180   int yaffs_read(int handle, void *buf, unsigned int nbyte)
0019a8  e92d407c          PUSH     {r2-r6,lr}
;;;1181   {
0019ac  e1a04000          MOV      r4,r0
0019b0  e1a05001          MOV      r5,r1
0019b4  e1a06002          MOV      r6,r2
0019b8  e3a01000          MOV      r1,#0
;;;1182   	return yaffsfs_do_read(handle, buf, nbyte, 0, 0);
0019bc  e58d1000          STR      r1,[sp,#0]
0019c0  e58d1004          STR      r1,[sp,#4]
0019c4  e1a03001          MOV      r3,r1
0019c8  e1a02006          MOV      r2,r6
0019cc  e1a01005          MOV      r1,r5
0019d0  e1a00004          MOV      r0,r4
0019d4  ebfffffe          BL       yaffsfs_do_read
;;;1183   }
0019d8  e8bd807c          POP      {r2-r6,pc}
;;;1184   
                          ENDP

                  yaffs_pread PROC
;;;1185   int yaffs_pread(int handle, void *buf, unsigned int nbyte, loff_t offset)
0019dc  e92d41fc          PUSH     {r2-r8,lr}
;;;1186   {
0019e0  e1a06000          MOV      r6,r0
0019e4  e1a07001          MOV      r7,r1
0019e8  e1a08002          MOV      r8,r2
0019ec  e1cd42d0          LDRD     r4,r5,[sp,#0x20]
;;;1187   	return yaffsfs_do_read(handle, buf, nbyte, 1, offset);
0019f0  e3a03001          MOV      r3,#1
0019f4  e1a02008          MOV      r2,r8
0019f8  e1a01007          MOV      r1,r7
0019fc  e1a00006          MOV      r0,r6
001a00  e1cd40f0          STRD     r4,r5,[sp,#0]
001a04  ebfffffe          BL       yaffsfs_do_read
;;;1188   }
001a08  e8bd81fc          POP      {r2-r8,pc}
;;;1189   
                          ENDP

                  yaffsfs_do_write PROC
;;;1190   int yaffsfs_do_write(int handle, const void *vbuf, unsigned int nbyte,
001a0c  e92d4fff          PUSH     {r0-r11,lr}
;;;1191   		     int isPwrite, loff_t offset)
;;;1192   {
001a10  e24dd024          SUB      sp,sp,#0x24
001a14  e1a06002          MOV      r6,r2
;;;1193   	struct yaffsfs_FileDes *fd = NULL;
001a18  e3a0b000          MOV      r11,#0
;;;1194   	struct yaffs_obj *obj = NULL;
001a1c  e3a00000          MOV      r0,#0
001a20  e58d0020          STR      r0,[sp,#0x20]
;;;1195   	loff_t pos = 0;
001a24  e1a00000          MOV      r0,r0
;;;1196   	loff_t startPos = 0;
001a28  e1a00000          MOV      r0,r0
;;;1197   	loff_t endPos;
;;;1198   	int nWritten = 0;
001a2c  e3a09000          MOV      r9,#0
;;;1199   	int totalWritten = 0;
001a30  e3a0a000          MOV      r10,#0
;;;1200   	int write_trhrough = 0;
001a34  e58d0014          STR      r0,[sp,#0x14]
;;;1201   	int nToWrite = 0;
001a38  e58d0010          STR      r0,[sp,#0x10]
;;;1202   	const u8 *buf = (const u8 *)vbuf;
001a3c  e59d0028          LDR      r0,[sp,#0x28]
001a40  e58d000c          STR      r0,[sp,#0xc]
;;;1203   
;;;1204   	if (!vbuf) {
001a44  e59d0028          LDR      r0,[sp,#0x28]
001a48  e3500000          CMP      r0,#0
001a4c  1a000004          BNE      |L1.6756|
;;;1205   		yaffsfs_SetError(-EFAULT);
001a50  e3e0000d          MVN      r0,#0xd
001a54  ebfffffe          BL       yaffsfs_SetError
;;;1206   		return -1;
001a58  e3e00000          MVN      r0,#0
                  |L1.6748|
001a5c  e28dd034          ADD      sp,sp,#0x34
;;;1207   	}
;;;1208   
;;;1209   	yaffsfs_Lock();
;;;1210   	fd = yaffsfs_HandleToFileDes(handle);
;;;1211   	obj = yaffsfs_HandleToObject(handle);
;;;1212   
;;;1213   	if (!fd || !obj) {
;;;1214   		/* bad handle */
;;;1215   		yaffsfs_SetError(-EBADF);
;;;1216   		totalWritten = -1;
;;;1217   	} else if (!fd->writing) {
;;;1218   		yaffsfs_SetError(-EINVAL);
;;;1219   		totalWritten = -1;
;;;1220   	} else if (obj->my_dev->read_only) {
;;;1221   		yaffsfs_SetError(-EROFS);
;;;1222   		totalWritten = -1;
;;;1223   	} else {
;;;1224   		if (fd->append)
;;;1225   			startPos = yaffs_get_obj_length(obj);
;;;1226   		else if (isPwrite)
;;;1227   			startPos = offset;
;;;1228   		else
;;;1229   			startPos = fd->position;
;;;1230   
;;;1231   		yaffsfs_GetHandle(handle);
;;;1232   		pos = startPos;
;;;1233   		endPos = pos + nbyte;
;;;1234   
;;;1235   		if (pos < 0 || pos > YAFFS_MAX_FILE_SIZE ||
;;;1236   		    nbyte > YAFFS_MAX_FILE_SIZE ||
;;;1237   		    endPos < 0 || endPos > YAFFS_MAX_FILE_SIZE) {
;;;1238   			totalWritten = -1;
;;;1239   			nbyte = 0;
;;;1240   		}
;;;1241   
;;;1242   		while (nbyte > 0) {
;;;1243   
;;;1244   			nToWrite = YAFFSFS_RW_SIZE -
;;;1245   			    (pos & (YAFFSFS_RW_SIZE - 1));
;;;1246   			if (nToWrite > nbyte)
;;;1247   				nToWrite = nbyte;
;;;1248   
;;;1249   			/* Tricky bit...
;;;1250   			 * Need to reverify object in case the device was
;;;1251   			 * remounted or unmounted in another thread.
;;;1252   			 */
;;;1253   			obj = yaffsfs_HandleToObject(handle);
;;;1254   			if (!obj || obj->my_dev->read_only)
;;;1255   				nWritten = 0;
;;;1256   			else
;;;1257   				nWritten =
;;;1258   				    yaffs_wr_file(obj, buf, pos, nToWrite,
;;;1259   						  write_trhrough);
;;;1260   			if (nWritten > 0) {
;;;1261   				totalWritten += nWritten;
;;;1262   				pos += nWritten;
;;;1263   				buf += nWritten;
;;;1264   			}
;;;1265   
;;;1266   			if (nWritten == nToWrite)
;;;1267   				nbyte -= nToWrite;
;;;1268   			else
;;;1269   				nbyte = 0;
;;;1270   
;;;1271   			if (nWritten < 1 && totalWritten < 1) {
;;;1272   				yaffsfs_SetError(-ENOSPC);
;;;1273   				totalWritten = -1;
;;;1274   			}
;;;1275   
;;;1276   			if (nbyte > 0) {
;;;1277   				yaffsfs_Unlock();
;;;1278   				yaffsfs_Lock();
;;;1279   			}
;;;1280   		}
;;;1281   
;;;1282   		yaffsfs_PutHandle(handle);
;;;1283   
;;;1284   		if (!isPwrite) {
;;;1285   			if (totalWritten > 0)
;;;1286   				fd->position = startPos + totalWritten;
;;;1287   			else
;;;1288   				yaffsfs_SetError(-EINVAL);
;;;1289   		}
;;;1290   	}
;;;1291   
;;;1292   	yaffsfs_Unlock();
;;;1293   
;;;1294   	return (totalWritten >= 0) ? totalWritten : -1;
;;;1295   }
001a60  e8bd8ff0          POP      {r4-r11,pc}
                  |L1.6756|
001a64  ebfffffe          BL       yaffsfs_Lock
001a68  e59d0024          LDR      r0,[sp,#0x24]         ;1210
001a6c  ebfffffe          BL       yaffsfs_HandleToFileDes
001a70  e1a0b000          MOV      r11,r0                ;1210
001a74  e59d0024          LDR      r0,[sp,#0x24]         ;1211
001a78  ebfffffe          BL       yaffsfs_HandleToObject
001a7c  e58d0020          STR      r0,[sp,#0x20]         ;1211
001a80  e35b0000          CMP      r11,#0                ;1213
001a84  0a000002          BEQ      |L1.6804|
001a88  e59d0020          LDR      r0,[sp,#0x20]         ;1213
001a8c  e3500000          CMP      r0,#0                 ;1213
001a90  1a000003          BNE      |L1.6820|
                  |L1.6804|
001a94  e3e00008          MVN      r0,#8                 ;1215
001a98  ebfffffe          BL       yaffsfs_SetError
001a9c  e3e0a000          MVN      r10,#0                ;1216
001aa0  ea00008a          B        |L1.7376|
                  |L1.6820|
001aa4  e5db0000          LDRB     r0,[r11,#0]           ;1217
001aa8  e1a00f00          LSL      r0,r0,#30             ;1217
001aac  e1b00fa0          LSRS     r0,r0,#31             ;1217
001ab0  1a000003          BNE      |L1.6852|
001ab4  e3e00015          MVN      r0,#0x15              ;1218
001ab8  ebfffffe          BL       yaffsfs_SetError
001abc  e3e0a000          MVN      r10,#0                ;1219
001ac0  ea000082          B        |L1.7376|
                  |L1.6852|
001ac4  e59d0020          LDR      r0,[sp,#0x20]         ;1220
001ac8  e5900008          LDR      r0,[r0,#8]            ;1220
001acc  e59000c8          LDR      r0,[r0,#0xc8]         ;1220
001ad0  e3500000          CMP      r0,#0                 ;1220
001ad4  0a000003          BEQ      |L1.6888|
001ad8  e3e0001d          MVN      r0,#0x1d              ;1221
001adc  ebfffffe          BL       yaffsfs_SetError
001ae0  e3e0a000          MVN      r10,#0                ;1222
001ae4  ea000079          B        |L1.7376|
                  |L1.6888|
001ae8  e5db0000          LDRB     r0,[r11,#0]           ;1224
001aec  e1a00e80          LSL      r0,r0,#29             ;1224
001af0  e1b00fa0          LSRS     r0,r0,#31             ;1224
001af4  0a000004          BEQ      |L1.6924|
001af8  e59d0020          LDR      r0,[sp,#0x20]         ;1225
001afc  ebfffffe          BL       yaffs_get_obj_length
001b00  e1a04000          MOV      r4,r0                 ;1225
001b04  e1a05001          MOV      r5,r1                 ;1225
001b08  ea000005          B        |L1.6948|
                  |L1.6924|
001b0c  e59d0030          LDR      r0,[sp,#0x30]         ;1226
001b10  e3500000          CMP      r0,#0                 ;1226
001b14  0a000001          BEQ      |L1.6944|
001b18  e1cd45d8          LDRD     r4,r5,[sp,#0x58]      ;1227
001b1c  ea000000          B        |L1.6948|
                  |L1.6944|
001b20  e1cb40d8          LDRD     r4,r5,[r11,#8]        ;1229
                  |L1.6948|
001b24  e59d0024          LDR      r0,[sp,#0x24]         ;1231
001b28  ebfffffe          BL       yaffsfs_GetHandle
001b2c  e1a07004          MOV      r7,r4                 ;1232
001b30  e1a08005          MOV      r8,r5                 ;1232
001b34  e0970006          ADDS     r0,r7,r6              ;1232
001b38  e2a81000          ADC      r1,r8,#0              ;1232
001b3c  e1cd01f8          STRD     r0,r1,[sp,#0x18]      ;1233
001b40  e1a05008          MOV      r5,r8                 ;1235
001b44  e3a01000          MOV      r1,#0                 ;1235
001b48  e1a00001          MOV      r0,r1                 ;1235
001b4c  e0571001          SUBS     r1,r7,r1              ;1235
001b50  e0d80000          SBCS     r0,r8,r0              ;1235
001b54  ba000013          BLT      |L1.7080|
001b58  e3e00000          MVN      r0,#0                 ;1235
001b5c  e0500007          SUBS     r0,r0,r7              ;1235
001b60  e2f80007          RSCS     r0,r8,#7              ;1235
001b64  ba00000f          BLT      |L1.7080|
001b68  e3e01000          MVN      r1,#0                 ;1235
001b6c  e3a02007          MOV      r2,#7                 ;1235
001b70  e0511006          SUBS     r1,r1,r6              ;1235
001b74  e2d20000          SBCS     r0,r2,#0              ;1235
001b78  ba00000a          BLT      |L1.7080|
001b7c  e3a03000          MOV      r3,#0                 ;1237
001b80  e59d1018          LDR      r1,[sp,#0x18]         ;1237
001b84  e0511003          SUBS     r1,r1,r3              ;1237
001b88  e59d001c          LDR      r0,[sp,#0x1c]         ;1237
001b8c  e0d00003          SBCS     r0,r0,r3              ;1237
001b90  ba000004          BLT      |L1.7080|
001b94  e3e02000          MVN      r2,#0                 ;1237
001b98  e1cd01d8          LDRD     r0,r1,[sp,#0x18]      ;1237
001b9c  e0520000          SUBS     r0,r2,r0              ;1237
001ba0  e2f10007          RSCS     r0,r1,#7              ;1237
001ba4  aa000001          BGE      |L1.7088|
                  |L1.7080|
001ba8  e3e0a000          MVN      r10,#0                ;1238
001bac  e3a06000          MOV      r6,#0                 ;1239
                  |L1.7088|
001bb0  ea000036          B        |L1.7312|
                  |L1.7092|
001bb4  e59f0780          LDR      r0,|L1.9020|
001bb8  e0071000          AND      r1,r7,r0              ;1242
001bbc  e2710a02          RSBS     r0,r1,#0x2000         ;1242
001bc0  e58d0010          STR      r0,[sp,#0x10]         ;1244
001bc4  e59d0010          LDR      r0,[sp,#0x10]         ;1246
001bc8  e1500006          CMP      r0,r6                 ;1246
001bcc  9a000000          BLS      |L1.7124|
001bd0  e58d6010          STR      r6,[sp,#0x10]         ;1247
                  |L1.7124|
001bd4  e59d0024          LDR      r0,[sp,#0x24]         ;1253
001bd8  ebfffffe          BL       yaffsfs_HandleToObject
001bdc  e58d0020          STR      r0,[sp,#0x20]         ;1253
001be0  e59d0020          LDR      r0,[sp,#0x20]         ;1254
001be4  e3500000          CMP      r0,#0                 ;1254
001be8  0a000004          BEQ      |L1.7168|
001bec  e59d0020          LDR      r0,[sp,#0x20]         ;1254
001bf0  e5900008          LDR      r0,[r0,#8]            ;1254
001bf4  e59000c8          LDR      r0,[r0,#0xc8]         ;1254
001bf8  e3500000          CMP      r0,#0                 ;1254
001bfc  0a000001          BEQ      |L1.7176|
                  |L1.7168|
001c00  e3a09000          MOV      r9,#0                 ;1255
001c04  ea000007          B        |L1.7208|
                  |L1.7176|
001c08  e1cd01d0          LDRD     r0,r1,[sp,#0x10]      ;1257
001c0c  e1a02007          MOV      r2,r7                 ;1257
001c10  e1a03008          MOV      r3,r8                 ;1257
001c14  e1cd00f0          STRD     r0,r1,[sp,#0]         ;1257
001c18  e59d0020          LDR      r0,[sp,#0x20]         ;1257
001c1c  e59d100c          LDR      r1,[sp,#0xc]          ;1257
001c20  ebfffffe          BL       yaffs_wr_file
001c24  e1a09000          MOV      r9,r0                 ;1257
                  |L1.7208|
001c28  e3590000          CMP      r9,#0                 ;1260
001c2c  da000005          BLE      |L1.7240|
001c30  e08aa009          ADD      r10,r10,r9            ;1261
001c34  e0977009          ADDS     r7,r7,r9              ;1261
001c38  e0a88fc9          ADC      r8,r8,r9,ASR #31      ;1261
001c3c  e59d000c          LDR      r0,[sp,#0xc]          ;1263
001c40  e0800009          ADD      r0,r0,r9              ;1263
001c44  e58d000c          STR      r0,[sp,#0xc]          ;1263
                  |L1.7240|
001c48  e59d0010          LDR      r0,[sp,#0x10]         ;1266
001c4c  e1590000          CMP      r9,r0                 ;1266
001c50  1a000002          BNE      |L1.7264|
001c54  e59d0010          LDR      r0,[sp,#0x10]         ;1267
001c58  e0466000          SUB      r6,r6,r0              ;1267
001c5c  ea000000          B        |L1.7268|
                  |L1.7264|
001c60  e3a06000          MOV      r6,#0                 ;1269
                  |L1.7268|
001c64  e3590001          CMP      r9,#1                 ;1271
001c68  aa000004          BGE      |L1.7296|
001c6c  e35a0001          CMP      r10,#1                ;1271
001c70  aa000002          BGE      |L1.7296|
001c74  e3e0001b          MVN      r0,#0x1b              ;1272
001c78  ebfffffe          BL       yaffsfs_SetError
001c7c  e3e0a000          MVN      r10,#0                ;1273
                  |L1.7296|
001c80  e3560000          CMP      r6,#0                 ;1276
001c84  0a000001          BEQ      |L1.7312|
001c88  ebfffffe          BL       yaffsfs_Unlock
001c8c  ebfffffe          BL       yaffsfs_Lock
                  |L1.7312|
001c90  e3560000          CMP      r6,#0                 ;1242
001c94  1affffc6          BNE      |L1.7092|
001c98  e59d0024          LDR      r0,[sp,#0x24]         ;1282
001c9c  ebfffffe          BL       yaffsfs_PutHandle
001ca0  e59d0030          LDR      r0,[sp,#0x30]         ;1284
001ca4  e3500000          CMP      r0,#0                 ;1284
001ca8  1a000008          BNE      |L1.7376|
001cac  e35a0000          CMP      r10,#0                ;1285
001cb0  da000004          BLE      |L1.7368|
001cb4  e094100a          ADDS     r1,r4,r10             ;1285
001cb8  e0a50fca          ADC      r0,r5,r10,ASR #31     ;1285
001cbc  e58b000c          STR      r0,[r11,#0xc]         ;1286
001cc0  e58b1008          STR      r1,[r11,#8]           ;1286
001cc4  ea000001          B        |L1.7376|
                  |L1.7368|
001cc8  e3e00015          MVN      r0,#0x15              ;1288
001ccc  ebfffffe          BL       yaffsfs_SetError
                  |L1.7376|
001cd0  ebfffffe          BL       yaffsfs_Unlock
001cd4  e35a0000          CMP      r10,#0                ;1294
001cd8  ba000001          BLT      |L1.7396|
001cdc  e1a0000a          MOV      r0,r10                ;1294
001ce0  eaffff5d          B        |L1.6748|
                  |L1.7396|
001ce4  e3e00000          MVN      r0,#0                 ;1294
001ce8  eaffff5b          B        |L1.6748|
;;;1296   
                          ENDP

                  yaffs_write PROC
;;;1297   int yaffs_write(int fd, const void *buf, unsigned int nbyte)
001cec  e92d407c          PUSH     {r2-r6,lr}
;;;1298   {
001cf0  e1a04000          MOV      r4,r0
001cf4  e1a05001          MOV      r5,r1
001cf8  e1a06002          MOV      r6,r2
001cfc  e3a01000          MOV      r1,#0
;;;1299   	return yaffsfs_do_write(fd, buf, nbyte, 0, 0);
001d00  e58d1000          STR      r1,[sp,#0]
001d04  e58d1004          STR      r1,[sp,#4]
001d08  e1a03001          MOV      r3,r1
001d0c  e1a02006          MOV      r2,r6
001d10  e1a01005          MOV      r1,r5
001d14  e1a00004          MOV      r0,r4
001d18  ebfffffe          BL       yaffsfs_do_write
;;;1300   }
001d1c  e8bd807c          POP      {r2-r6,pc}
;;;1301   
                          ENDP

                  yaffs_pwrite PROC
;;;1302   int yaffs_pwrite(int fd, const void *buf, unsigned int nbyte, loff_t offset)
001d20  e92d41fc          PUSH     {r2-r8,lr}
;;;1303   {
001d24  e1a06000          MOV      r6,r0
001d28  e1a07001          MOV      r7,r1
001d2c  e1a08002          MOV      r8,r2
001d30  e1cd42d0          LDRD     r4,r5,[sp,#0x20]
;;;1304   	return yaffsfs_do_write(fd, buf, nbyte, 1, offset);
001d34  e3a03001          MOV      r3,#1
001d38  e1a02008          MOV      r2,r8
001d3c  e1a01007          MOV      r1,r7
001d40  e1a00006          MOV      r0,r6
001d44  e1cd40f0          STRD     r4,r5,[sp,#0]
001d48  ebfffffe          BL       yaffsfs_do_write
;;;1305   }
001d4c  e8bd81fc          POP      {r2-r8,pc}
;;;1306   
                          ENDP

                  yaffs_truncate PROC
;;;1307   int yaffs_truncate(const YCHAR *path, loff_t new_size)
001d50  e92d41f0          PUSH     {r4-r8,lr}
;;;1308   {
001d54  e24dd018          SUB      sp,sp,#0x18
001d58  e1a07000          MOV      r7,r0
001d5c  e1a04002          MOV      r4,r2
001d60  e1a05003          MOV      r5,r3
;;;1309   	struct yaffs_obj *obj = NULL;
001d64  e3a06000          MOV      r6,#0
;;;1310   	struct yaffs_obj *dir = NULL;
001d68  e3a00000          MOV      r0,#0
001d6c  e58d0014          STR      r0,[sp,#0x14]
;;;1311   	int result = YAFFS_FAIL;
001d70  e3a08000          MOV      r8,#0
;;;1312   	int notDir = 0;
001d74  e58d0010          STR      r0,[sp,#0x10]
;;;1313   	int loop = 0;
001d78  e58d000c          STR      r0,[sp,#0xc]
;;;1314   
;;;1315   	if (!path) {
001d7c  e3570000          CMP      r7,#0
001d80  1a000004          BNE      |L1.7576|
;;;1316   		yaffsfs_SetError(-EFAULT);
001d84  e3e0000d          MVN      r0,#0xd
001d88  ebfffffe          BL       yaffsfs_SetError
;;;1317   		return -1;
001d8c  e3e00000          MVN      r0,#0
                  |L1.7568|
001d90  e28dd018          ADD      sp,sp,#0x18
;;;1318   	}
;;;1319   
;;;1320   	if (yaffsfs_CheckPath(path) < 0) {
;;;1321   		yaffsfs_SetError(-ENAMETOOLONG);
;;;1322   		return -1;
;;;1323   	}
;;;1324   
;;;1325   	yaffsfs_Lock();
;;;1326   
;;;1327   	obj = yaffsfs_FindObject(NULL, path, 0, 1, &dir, &notDir, &loop);
;;;1328   	obj = yaffsfs_FollowLink(obj, 0, &loop);
;;;1329   
;;;1330   	if (!dir && notDir)
;;;1331   		yaffsfs_SetError(-ENOTDIR);
;;;1332   	else if (loop)
;;;1333   		yaffsfs_SetError(-ELOOP);
;;;1334   	else if (!dir || !obj)
;;;1335   		yaffsfs_SetError(-ENOENT);
;;;1336   	else if (obj->my_dev->read_only)
;;;1337   		yaffsfs_SetError(-EROFS);
;;;1338   	else if (obj->variant_type != YAFFS_OBJECT_TYPE_FILE)
;;;1339   		yaffsfs_SetError(-EISDIR);
;;;1340   	else if (obj->my_dev->read_only)
;;;1341   		yaffsfs_SetError(-EROFS);
;;;1342   	else if (new_size < 0 || new_size > YAFFS_MAX_FILE_SIZE)
;;;1343   		yaffsfs_SetError(-EINVAL);
;;;1344   	else
;;;1345   		result = yaffs_resize_file(obj, new_size);
;;;1346   
;;;1347   	yaffsfs_Unlock();
;;;1348   
;;;1349   	return (result) ? 0 : -1;
;;;1350   }
001d94  e8bd81f0          POP      {r4-r8,pc}
                  |L1.7576|
001d98  e1a00007          MOV      r0,r7                 ;1320
001d9c  ebfffffe          BL       yaffsfs_CheckPath
001da0  e3500000          CMP      r0,#0                 ;1320
001da4  aa000003          BGE      |L1.7608|
001da8  e3e00023          MVN      r0,#0x23              ;1321
001dac  ebfffffe          BL       yaffsfs_SetError
001db0  e3e00000          MVN      r0,#0                 ;1322
001db4  eafffff5          B        |L1.7568|
                  |L1.7608|
001db8  ebfffffe          BL       yaffsfs_Lock
001dbc  e28d000c          ADD      r0,sp,#0xc            ;1327
001dc0  e28d1010          ADD      r1,sp,#0x10           ;1327
001dc4  e28d2014          ADD      r2,sp,#0x14           ;1327
001dc8  e3a03001          MOV      r3,#1                 ;1327
001dcc  e58d2000          STR      r2,[sp,#0]            ;1327
001dd0  e3a02000          MOV      r2,#0                 ;1327
001dd4  e58d1004          STR      r1,[sp,#4]            ;1327
001dd8  e1a01007          MOV      r1,r7                 ;1327
001ddc  e58d0008          STR      r0,[sp,#8]            ;1327
001de0  e1a00002          MOV      r0,r2                 ;1327
001de4  ebfffffe          BL       yaffsfs_FindObject
001de8  e1a06000          MOV      r6,r0                 ;1327
001dec  e28d200c          ADD      r2,sp,#0xc            ;1328
001df0  e3a01000          MOV      r1,#0                 ;1328
001df4  e1a00006          MOV      r0,r6                 ;1328
001df8  ebfffffe          BL       yaffsfs_FollowLink
001dfc  e1a06000          MOV      r6,r0                 ;1328
001e00  e59d0014          LDR      r0,[sp,#0x14]         ;1330
001e04  e3500000          CMP      r0,#0                 ;1330
001e08  1a000005          BNE      |L1.7716|
001e0c  e59d0010          LDR      r0,[sp,#0x10]         ;1330
001e10  e3500000          CMP      r0,#0                 ;1330
001e14  0a000002          BEQ      |L1.7716|
001e18  e3e00013          MVN      r0,#0x13              ;1331
001e1c  ebfffffe          BL       yaffsfs_SetError
001e20  ea000032          B        |L1.7920|
                  |L1.7716|
001e24  e59d000c          LDR      r0,[sp,#0xc]          ;1332
001e28  e3500000          CMP      r0,#0                 ;1332
001e2c  0a000002          BEQ      |L1.7740|
001e30  e3e00027          MVN      r0,#0x27              ;1333
001e34  ebfffffe          BL       yaffsfs_SetError
001e38  ea00002c          B        |L1.7920|
                  |L1.7740|
001e3c  e59d0014          LDR      r0,[sp,#0x14]         ;1334
001e40  e3500000          CMP      r0,#0                 ;1334
001e44  0a000001          BEQ      |L1.7760|
001e48  e3560000          CMP      r6,#0                 ;1334
001e4c  1a000002          BNE      |L1.7772|
                  |L1.7760|
001e50  e3e00001          MVN      r0,#1                 ;1335
001e54  ebfffffe          BL       yaffsfs_SetError
001e58  ea000024          B        |L1.7920|
                  |L1.7772|
001e5c  e5960008          LDR      r0,[r6,#8]            ;1336
001e60  e59000c8          LDR      r0,[r0,#0xc8]         ;1336
001e64  e3500000          CMP      r0,#0                 ;1336
001e68  0a000002          BEQ      |L1.7800|
001e6c  e3e0001d          MVN      r0,#0x1d              ;1337
001e70  ebfffffe          BL       yaffsfs_SetError
001e74  ea00001d          B        |L1.7920|
                  |L1.7800|
001e78  e5d60064          LDRB     r0,[r6,#0x64]         ;1338
001e7c  e3500001          CMP      r0,#1                 ;1338
001e80  0a000002          BEQ      |L1.7824|
001e84  e3e00014          MVN      r0,#0x14              ;1339
001e88  ebfffffe          BL       yaffsfs_SetError
001e8c  ea000017          B        |L1.7920|
                  |L1.7824|
001e90  e5960008          LDR      r0,[r6,#8]            ;1340
001e94  e59000c8          LDR      r0,[r0,#0xc8]         ;1340
001e98  e3500000          CMP      r0,#0                 ;1340
001e9c  0a000002          BEQ      |L1.7852|
001ea0  e3e0001d          MVN      r0,#0x1d              ;1341
001ea4  ebfffffe          BL       yaffsfs_SetError
001ea8  ea000010          B        |L1.7920|
                  |L1.7852|
001eac  e3a01000          MOV      r1,#0                 ;1341
001eb0  e1a00001          MOV      r0,r1                 ;1341
001eb4  e0541001          SUBS     r1,r4,r1              ;1341
001eb8  e0d50000          SBCS     r0,r5,r0              ;1341
001ebc  ba000003          BLT      |L1.7888|
001ec0  e3e00000          MVN      r0,#0                 ;1342
001ec4  e0500004          SUBS     r0,r0,r4              ;1342
001ec8  e2f50007          RSCS     r0,r5,#7              ;1342
001ecc  aa000002          BGE      |L1.7900|
                  |L1.7888|
001ed0  e3e00015          MVN      r0,#0x15              ;1343
001ed4  ebfffffe          BL       yaffsfs_SetError
001ed8  ea000004          B        |L1.7920|
                  |L1.7900|
001edc  e1a02004          MOV      r2,r4                 ;1345
001ee0  e1a03005          MOV      r3,r5                 ;1345
001ee4  e1a00006          MOV      r0,r6                 ;1345
001ee8  ebfffffe          BL       yaffs_resize_file
001eec  e1a08000          MOV      r8,r0                 ;1345
                  |L1.7920|
001ef0  ebfffffe          BL       yaffsfs_Unlock
001ef4  e3580000          CMP      r8,#0                 ;1349
001ef8  0a000001          BEQ      |L1.7940|
001efc  e3a00000          MOV      r0,#0                 ;1349
001f00  eaffffa2          B        |L1.7568|
                  |L1.7940|
001f04  e3e00000          MVN      r0,#0                 ;1349
001f08  eaffffa0          B        |L1.7568|
;;;1351   
                          ENDP

                  yaffs_ftruncate PROC
;;;1352   int yaffs_ftruncate(int handle, loff_t new_size)
001f0c  e92d47f0          PUSH     {r4-r10,lr}
;;;1353   {
001f10  e1a08000          MOV      r8,r0
001f14  e1a04002          MOV      r4,r2
001f18  e1a05003          MOV      r5,r3
;;;1354   	struct yaffsfs_FileDes *fd = NULL;
001f1c  e3a07000          MOV      r7,#0
;;;1355   	struct yaffs_obj *obj = NULL;
001f20  e3a06000          MOV      r6,#0
;;;1356   	int result = 0;
001f24  e3a09000          MOV      r9,#0
;;;1357   
;;;1358   	yaffsfs_Lock();
001f28  ebfffffe          BL       yaffsfs_Lock
;;;1359   	fd = yaffsfs_HandleToFileDes(handle);
001f2c  e1a00008          MOV      r0,r8
001f30  ebfffffe          BL       yaffsfs_HandleToFileDes
001f34  e1a07000          MOV      r7,r0
;;;1360   	obj = yaffsfs_HandleToObject(handle);
001f38  e1a00008          MOV      r0,r8
001f3c  ebfffffe          BL       yaffsfs_HandleToObject
001f40  e1a06000          MOV      r6,r0
;;;1361   
;;;1362   	if (!fd || !obj)
001f44  e3570000          CMP      r7,#0
001f48  0a000001          BEQ      |L1.8020|
001f4c  e3560000          CMP      r6,#0
001f50  1a000002          BNE      |L1.8032|
                  |L1.8020|
;;;1363   		/* bad handle */
;;;1364   		yaffsfs_SetError(-EBADF);
001f54  e3e00008          MVN      r0,#8
001f58  ebfffffe          BL       yaffsfs_SetError
001f5c  ea00001e          B        |L1.8156|
                  |L1.8032|
;;;1365   	else if (!fd->writing)
001f60  e5d70000          LDRB     r0,[r7,#0]
001f64  e1a00f00          LSL      r0,r0,#30
001f68  e1b00fa0          LSRS     r0,r0,#31
001f6c  1a000002          BNE      |L1.8060|
;;;1366   		yaffsfs_SetError(-EINVAL);
001f70  e3e00015          MVN      r0,#0x15
001f74  ebfffffe          BL       yaffsfs_SetError
001f78  ea000017          B        |L1.8156|
                  |L1.8060|
;;;1367   	else if (obj->my_dev->read_only)
001f7c  e5960008          LDR      r0,[r6,#8]
001f80  e59000c8          LDR      r0,[r0,#0xc8]
001f84  e3500000          CMP      r0,#0
001f88  0a000002          BEQ      |L1.8088|
;;;1368   		yaffsfs_SetError(-EROFS);
001f8c  e3e0001d          MVN      r0,#0x1d
001f90  ebfffffe          BL       yaffsfs_SetError
001f94  ea000010          B        |L1.8156|
                  |L1.8088|
001f98  e3a01000          MOV      r1,#0
001f9c  e1a00001          MOV      r0,r1
001fa0  e0541001          SUBS     r1,r4,r1
001fa4  e0d50000          SBCS     r0,r5,r0
;;;1369   	else if (new_size < 0 || new_size > YAFFS_MAX_FILE_SIZE)
001fa8  ba000003          BLT      |L1.8124|
001fac  e3e00000          MVN      r0,#0
001fb0  e0500004          SUBS     r0,r0,r4
001fb4  e2f50007          RSCS     r0,r5,#7
001fb8  aa000002          BGE      |L1.8136|
                  |L1.8124|
;;;1370   		yaffsfs_SetError(-EINVAL);
001fbc  e3e00015          MVN      r0,#0x15
001fc0  ebfffffe          BL       yaffsfs_SetError
001fc4  ea000004          B        |L1.8156|
                  |L1.8136|
;;;1371   	else
;;;1372   		/* resize the file */
;;;1373   		result = yaffs_resize_file(obj, new_size);
001fc8  e1a02004          MOV      r2,r4
001fcc  e1a03005          MOV      r3,r5
001fd0  e1a00006          MOV      r0,r6
001fd4  ebfffffe          BL       yaffs_resize_file
001fd8  e1a09000          MOV      r9,r0
                  |L1.8156|
;;;1374   	yaffsfs_Unlock();
001fdc  ebfffffe          BL       yaffsfs_Unlock
;;;1375   
;;;1376   	return (result) ? 0 : -1;
001fe0  e3590000          CMP      r9,#0
001fe4  0a000001          BEQ      |L1.8176|
001fe8  e3a00000          MOV      r0,#0
                  |L1.8172|
;;;1377   
;;;1378   }
001fec  e8bd87f0          POP      {r4-r10,pc}
                  |L1.8176|
001ff0  e3e00000          MVN      r0,#0                 ;1376
001ff4  eafffffc          B        |L1.8172|
;;;1379   
                          ENDP

                  yaffs_lseek PROC
;;;1380   loff_t yaffs_lseek(int handle, loff_t offset, int whence)
001ff8  e92d5fff          PUSH     {r0-r12,lr}
;;;1381   {
001ffc  e24dd008          SUB      sp,sp,#8
002000  e1a04002          MOV      r4,r2
002004  e1a05003          MOV      r5,r3
002008  e59db040          LDR      r11,[sp,#0x40]
;;;1382   	struct yaffsfs_FileDes *fd = NULL;
00200c  e3a0a000          MOV      r10,#0
;;;1383   	struct yaffs_obj *obj = NULL;
002010  e3a00000          MOV      r0,#0
002014  e58d0004          STR      r0,[sp,#4]
002018  e3e01000          MVN      r1,#0
;;;1384   	loff_t pos = -1;
00201c  e1a06001          MOV      r6,r1
002020  e1a07001          MOV      r7,r1
;;;1385   	loff_t fSize = -1;
002024  e1a00000          MOV      r0,r0
;;;1386   
;;;1387   	yaffsfs_Lock();
002028  ebfffffe          BL       yaffsfs_Lock
;;;1388   	fd = yaffsfs_HandleToFileDes(handle);
00202c  e59d0008          LDR      r0,[sp,#8]
002030  ebfffffe          BL       yaffsfs_HandleToFileDes
002034  e1a0a000          MOV      r10,r0
;;;1389   	obj = yaffsfs_HandleToObject(handle);
002038  e59d0008          LDR      r0,[sp,#8]
00203c  ebfffffe          BL       yaffsfs_HandleToObject
002040  e58d0004          STR      r0,[sp,#4]
;;;1390   
;;;1391   	if (!fd || !obj)
002044  e35a0000          CMP      r10,#0
002048  0a000002          BEQ      |L1.8280|
00204c  e59d0004          LDR      r0,[sp,#4]
002050  e3500000          CMP      r0,#0
002054  1a000002          BNE      |L1.8292|
                  |L1.8280|
;;;1392   		yaffsfs_SetError(-EBADF);
002058  e3e00008          MVN      r0,#8
00205c  ebfffffe          BL       yaffsfs_SetError
002060  ea000041          B        |L1.8556|
                  |L1.8292|
002064  e3e00000          MVN      r0,#0
002068  e0500004          SUBS     r0,r0,r4
00206c  e2f50007          RSCS     r0,r5,#7
;;;1393   	else if (offset > YAFFS_MAX_FILE_SIZE)
002070  aa000002          BGE      |L1.8320|
;;;1394   		yaffsfs_SetError(-EINVAL);
002074  e3e00015          MVN      r0,#0x15
002078  ebfffffe          BL       yaffsfs_SetError
00207c  ea00003a          B        |L1.8556|
                  |L1.8320|
;;;1395   	else {
;;;1396   		if (whence == SEEK_SET) {
002080  e35b0000          CMP      r11,#0
002084  1a000007          BNE      |L1.8360|
002088  e3a01000          MOV      r1,#0
00208c  e1a00001          MOV      r0,r1
002090  e0541001          SUBS     r1,r4,r1
002094  e0d50000          SBCS     r0,r5,r0
;;;1397   			if (offset >= 0)
002098  ba000024          BLT      |L1.8496|
;;;1398   				pos = offset;
00209c  e1a06004          MOV      r6,r4
0020a0  e1a07005          MOV      r7,r5
0020a4  ea000021          B        |L1.8496|
                  |L1.8360|
;;;1399   		} else if (whence == SEEK_CUR) {
0020a8  e35b0001          CMP      r11,#1
0020ac  1a00000c          BNE      |L1.8420|
;;;1400   			if ((fd->position + offset) >= 0)
0020b0  e1ca00d8          LDRD     r0,r1,[r10,#8]
0020b4  e0903004          ADDS     r3,r0,r4
0020b8  e0a1c005          ADC      r12,r1,r5
0020bc  e3a02000          MOV      r2,#0
0020c0  e1a01003          MOV      r1,r3
0020c4  e0511002          SUBS     r1,r1,r2
0020c8  e0dc0002          SBCS     r0,r12,r2
0020cc  ba000017          BLT      |L1.8496|
;;;1401   				pos = (fd->position + offset);
0020d0  e59a1008          LDR      r1,[r10,#8]
0020d4  e0916004          ADDS     r6,r1,r4
0020d8  e59a000c          LDR      r0,[r10,#0xc]
0020dc  e0a07005          ADC      r7,r0,r5
0020e0  ea000012          B        |L1.8496|
                  |L1.8420|
;;;1402   		} else if (whence == SEEK_END) {
0020e4  e35b0002          CMP      r11,#2
0020e8  1a000010          BNE      |L1.8496|
;;;1403   			fSize = yaffs_get_obj_length(obj);
0020ec  e59d0004          LDR      r0,[sp,#4]
0020f0  ebfffffe          BL       yaffs_get_obj_length
0020f4  e1a08000          MOV      r8,r0
0020f8  e1a09001          MOV      r9,r1
0020fc  e3a03000          MOV      r3,#0
002100  e0580003          SUBS     r0,r8,r3
002104  e0d90003          SBCS     r0,r9,r3
;;;1404   			if (fSize >= 0 && (fSize + offset) >= 0)
002108  ba000008          BLT      |L1.8496|
00210c  e0983004          ADDS     r3,r8,r4
002110  e0a90005          ADC      r0,r9,r5
002114  e3a01000          MOV      r1,#0
002118  e1a02001          MOV      r2,r1
00211c  e0531001          SUBS     r1,r3,r1
002120  e0d00002          SBCS     r0,r0,r2
002124  ba000001          BLT      |L1.8496|
002128  e0986004          ADDS     r6,r8,r4
00212c  e0a97005          ADC      r7,r9,r5
                  |L1.8496|
;;;1405   				pos = fSize + offset;
002130  e3a01000          MOV      r1,#0
002134  e1a00001          MOV      r0,r1
002138  e0561001          SUBS     r1,r6,r1
00213c  e0d70000          SBCS     r0,r7,r0
;;;1406   		}
;;;1407   
;;;1408   		if (pos >= 0 && pos <= YAFFS_MAX_FILE_SIZE)
002140  ba000005          BLT      |L1.8540|
002144  e3e00000          MVN      r0,#0
002148  e0500006          SUBS     r0,r0,r6
00214c  e2f70007          RSCS     r0,r7,#7
002150  ba000001          BLT      |L1.8540|
;;;1409   			fd->position = pos;
002154  e1ca60f8          STRD     r6,r7,[r10,#8]
002158  ea000003          B        |L1.8556|
                  |L1.8540|
;;;1410   		else {
;;;1411   			yaffsfs_SetError(-EINVAL);
00215c  e3e00015          MVN      r0,#0x15
002160  ebfffffe          BL       yaffsfs_SetError
002164  e3e06000          MVN      r6,#0
002168  e1a07006          MOV      r7,r6
                  |L1.8556|
;;;1412   			pos = -1;
;;;1413   		}
;;;1414   	}
;;;1415   
;;;1416   	yaffsfs_Unlock();
00216c  ebfffffe          BL       yaffsfs_Unlock
;;;1417   
;;;1418   	return pos;
002170  e1a00006          MOV      r0,r6
002174  e1a01007          MOV      r1,r7
002178  e28dd018          ADD      sp,sp,#0x18
;;;1419   }
00217c  e8bd9ff0          POP      {r4-r12,pc}
;;;1420   
                          ENDP

                  yaffsfs_DoUnlink PROC
;;;1421   int yaffsfs_DoUnlink(const YCHAR *path, int isDirectory)
002180  e92d41f0          PUSH     {r4-r8,lr}
;;;1422   {
002184  e24dd018          SUB      sp,sp,#0x18
002188  e1a06000          MOV      r6,r0
00218c  e1a05001          MOV      r5,r1
;;;1423   	struct yaffs_obj *dir = NULL;
002190  e3a07000          MOV      r7,#0
;;;1424   	struct yaffs_obj *obj = NULL;
002194  e3a04000          MOV      r4,#0
;;;1425   	YCHAR *name;
;;;1426   	int result = YAFFS_FAIL;
002198  e3a08000          MOV      r8,#0
;;;1427   	int notDir = 0;
00219c  e3a00000          MOV      r0,#0
0021a0  e58d0010          STR      r0,[sp,#0x10]
;;;1428   	int loop = 0;
0021a4  e58d000c          STR      r0,[sp,#0xc]
;;;1429   
;;;1430   	if (!path) {
0021a8  e3560000          CMP      r6,#0
0021ac  1a000004          BNE      |L1.8644|
;;;1431   		yaffsfs_SetError(-EFAULT);
0021b0  e3e0000d          MVN      r0,#0xd
0021b4  ebfffffe          BL       yaffsfs_SetError
;;;1432   		return -1;
0021b8  e3e00000          MVN      r0,#0
                  |L1.8636|
0021bc  e28dd018          ADD      sp,sp,#0x18
;;;1433   	}
;;;1434   
;;;1435   	if (yaffsfs_CheckPath(path) < 0) {
;;;1436   		yaffsfs_SetError(-ENAMETOOLONG);
;;;1437   		return -1;
;;;1438   	}
;;;1439   
;;;1440   	yaffsfs_Lock();
;;;1441   
;;;1442   	obj = yaffsfs_FindObject(NULL, path, 0, 0, NULL, NULL, NULL);
;;;1443   	dir = yaffsfs_FindDirectory(NULL, path, &name, 0, &notDir, &loop);
;;;1444   
;;;1445   	if (!dir && notDir)
;;;1446   		yaffsfs_SetError(-ENOTDIR);
;;;1447   	else if (loop)
;;;1448   		yaffsfs_SetError(-ELOOP);
;;;1449   	else if (!dir)
;;;1450   		yaffsfs_SetError(-ENOENT);
;;;1451   	else if (yaffs_strncmp(name, _Y("."), 2) == 0)
;;;1452   		yaffsfs_SetError(-EINVAL);
;;;1453   	else if (!obj)
;;;1454   		yaffsfs_SetError(-ENOENT);
;;;1455   	else if (obj->my_dev->read_only)
;;;1456   		yaffsfs_SetError(-EROFS);
;;;1457   	else if (!isDirectory &&
;;;1458   		 obj->variant_type == YAFFS_OBJECT_TYPE_DIRECTORY)
;;;1459   		yaffsfs_SetError(-EISDIR);
;;;1460   	else if (isDirectory &&
;;;1461   		 obj->variant_type != YAFFS_OBJECT_TYPE_DIRECTORY)
;;;1462   		yaffsfs_SetError(-ENOTDIR);
;;;1463   	else if (isDirectory && obj == obj->my_dev->root_dir)
;;;1464   		yaffsfs_SetError(-EBUSY);	/* Can't rmdir a root */
;;;1465   	else {
;;;1466   		result = yaffs_unlinker(dir, name);
;;;1467   
;;;1468   		if (result == YAFFS_FAIL && isDirectory)
;;;1469   			yaffsfs_SetError(-ENOTEMPTY);
;;;1470   	}
;;;1471   
;;;1472   	yaffsfs_Unlock();
;;;1473   
;;;1474   	return (result == YAFFS_FAIL) ? -1 : 0;
;;;1475   }
0021c0  e8bd81f0          POP      {r4-r8,pc}
                  |L1.8644|
0021c4  e1a00006          MOV      r0,r6                 ;1435
0021c8  ebfffffe          BL       yaffsfs_CheckPath
0021cc  e3500000          CMP      r0,#0                 ;1435
0021d0  aa000003          BGE      |L1.8676|
0021d4  e3e00023          MVN      r0,#0x23              ;1436
0021d8  ebfffffe          BL       yaffsfs_SetError
0021dc  e3e00000          MVN      r0,#0                 ;1437
0021e0  eafffff5          B        |L1.8636|
                  |L1.8676|
0021e4  ebfffffe          BL       yaffsfs_Lock
0021e8  e3a00000          MOV      r0,#0                 ;1442
0021ec  e58d0000          STR      r0,[sp,#0]            ;1442
0021f0  e58d0004          STR      r0,[sp,#4]            ;1442
0021f4  e58d0008          STR      r0,[sp,#8]            ;1442
0021f8  e1a03000          MOV      r3,r0                 ;1442
0021fc  e1a02000          MOV      r2,r0                 ;1442
002200  e1a01006          MOV      r1,r6                 ;1442
002204  ebfffffe          BL       yaffsfs_FindObject
002208  e1a04000          MOV      r4,r0                 ;1442
00220c  e28d000c          ADD      r0,sp,#0xc            ;1443
002210  e28d1010          ADD      r1,sp,#0x10           ;1443
002214  e3a03000          MOV      r3,#0                 ;1443
002218  e58d0004          STR      r0,[sp,#4]            ;1443
00221c  e58d1000          STR      r1,[sp,#0]            ;1443
002220  e28d2014          ADD      r2,sp,#0x14           ;1443
002224  e1a01006          MOV      r1,r6                 ;1443
002228  e1a00003          MOV      r0,r3                 ;1443
00222c  ebfffffe          BL       yaffsfs_FindDirectory
002230  e1a07000          MOV      r7,r0                 ;1443
002234  e3570000          CMP      r7,#0                 ;1445
002238  1a000005          BNE      |L1.8788|
00223c  e59d0010          LDR      r0,[sp,#0x10]         ;1445
002240  e3500000          CMP      r0,#0                 ;1445
002244  0a000002          BEQ      |L1.8788|
002248  e3e00013          MVN      r0,#0x13              ;1446
00224c  ebfffffe          BL       yaffsfs_SetError
002250  ea000045          B        |L1.9068|
                  |L1.8788|
002254  e59d000c          LDR      r0,[sp,#0xc]          ;1447
002258  e3500000          CMP      r0,#0                 ;1447
00225c  0a000002          BEQ      |L1.8812|
002260  e3e00027          MVN      r0,#0x27              ;1448
002264  ebfffffe          BL       yaffsfs_SetError
002268  ea00003f          B        |L1.9068|
                  |L1.8812|
00226c  e3570000          CMP      r7,#0                 ;1449
002270  1a000002          BNE      |L1.8832|
002274  e3e00001          MVN      r0,#1                 ;1450
002278  ebfffffe          BL       yaffsfs_SetError
00227c  ea00003a          B        |L1.9068|
                  |L1.8832|
002280  e3a02002          MOV      r2,#2                 ;1451
002284  e28f10b4          ADR      r1,|L1.9024|
002288  e59d0014          LDR      r0,[sp,#0x14]         ;1451
00228c  ebfffffe          BL       strncmp
002290  e3500000          CMP      r0,#0                 ;1451
002294  1a000002          BNE      |L1.8868|
002298  e3e00015          MVN      r0,#0x15              ;1452
00229c  ebfffffe          BL       yaffsfs_SetError
0022a0  ea000031          B        |L1.9068|
                  |L1.8868|
0022a4  e3540000          CMP      r4,#0                 ;1453
0022a8  1a000002          BNE      |L1.8888|
0022ac  e3e00001          MVN      r0,#1                 ;1454
0022b0  ebfffffe          BL       yaffsfs_SetError
0022b4  ea00002c          B        |L1.9068|
                  |L1.8888|
0022b8  e5940008          LDR      r0,[r4,#8]            ;1455
0022bc  e59000c8          LDR      r0,[r0,#0xc8]         ;1455
0022c0  e3500000          CMP      r0,#0                 ;1455
0022c4  0a000002          BEQ      |L1.8916|
0022c8  e3e0001d          MVN      r0,#0x1d              ;1456
0022cc  ebfffffe          BL       yaffsfs_SetError
0022d0  ea000025          B        |L1.9068|
                  |L1.8916|
0022d4  e3550000          CMP      r5,#0                 ;1457
0022d8  1a000005          BNE      |L1.8948|
0022dc  e5d40064          LDRB     r0,[r4,#0x64]         ;1458
0022e0  e3500003          CMP      r0,#3                 ;1458
0022e4  1a000002          BNE      |L1.8948|
0022e8  e3e00014          MVN      r0,#0x14              ;1459
0022ec  ebfffffe          BL       yaffsfs_SetError
0022f0  ea00001d          B        |L1.9068|
                  |L1.8948|
0022f4  e3550000          CMP      r5,#0                 ;1460
0022f8  0a000005          BEQ      |L1.8980|
0022fc  e5d40064          LDRB     r0,[r4,#0x64]         ;1461
002300  e3500003          CMP      r0,#3                 ;1461
002304  0a000002          BEQ      |L1.8980|
002308  e3e00013          MVN      r0,#0x13              ;1462
00230c  ebfffffe          BL       yaffsfs_SetError
002310  ea000015          B        |L1.9068|
                  |L1.8980|
002314  e3550000          CMP      r5,#0                 ;1463
002318  0a000009          BEQ      |L1.9028|
00231c  e5940008          LDR      r0,[r4,#8]            ;1463
002320  e5900d80          LDR      r0,[r0,#0xd80]        ;1463
002324  e1500004          CMP      r0,r4                 ;1463
002328  1a000005          BNE      |L1.9028|
00232c  e3e0000f          MVN      r0,#0xf               ;1464
002330  ebfffffe          BL       yaffsfs_SetError
002334  ea00000c          B        |L1.9068|
                  |L1.9016|
                          DCD      0x0001ffe0
                  |L1.9020|
                          DCD      0x00001fff
                  |L1.9024|
002340  2e00              DCB      ".",0
002342  00                DCB      0
002343  00                DCB      0
                  |L1.9028|
002344  e1a00007          MOV      r0,r7                 ;1466
002348  e59d1014          LDR      r1,[sp,#0x14]         ;1466
00234c  ebfffffe          BL       yaffs_unlinker
002350  e1a08000          MOV      r8,r0                 ;1466
002354  e3580000          CMP      r8,#0                 ;1468
002358  1a000003          BNE      |L1.9068|
00235c  e3550000          CMP      r5,#0                 ;1468
002360  0a000001          BEQ      |L1.9068|
002364  e3e00026          MVN      r0,#0x26              ;1469
002368  ebfffffe          BL       yaffsfs_SetError
                  |L1.9068|
00236c  ebfffffe          BL       yaffsfs_Unlock
002370  e3580000          CMP      r8,#0                 ;1474
002374  1a000001          BNE      |L1.9088|
002378  e3e00000          MVN      r0,#0                 ;1474
00237c  eaffff8e          B        |L1.8636|
                  |L1.9088|
002380  e3a00000          MOV      r0,#0                 ;1474
002384  eaffff8c          B        |L1.8636|
;;;1476   
                          ENDP

                  yaffs_unlink PROC
;;;1477   int yaffs_unlink(const YCHAR *path)
002388  e92d4010          PUSH     {r4,lr}
;;;1478   {
00238c  e1a04000          MOV      r4,r0
;;;1479   	return yaffsfs_DoUnlink(path, 0);
002390  e3a01000          MOV      r1,#0
002394  e1a00004          MOV      r0,r4
002398  ebfffffe          BL       yaffsfs_DoUnlink
;;;1480   }
00239c  e8bd8010          POP      {r4,pc}
;;;1481   
                          ENDP

                  yaffs_rename PROC
;;;1482   int yaffs_rename(const YCHAR *oldPath, const YCHAR *newPath)
0023a0  e92d4ff0          PUSH     {r4-r11,lr}
;;;1483   {
0023a4  e24dd02c          SUB      sp,sp,#0x2c
0023a8  e1a07000          MOV      r7,r0
0023ac  e1a08001          MOV      r8,r1
;;;1484   	struct yaffs_obj *olddir = NULL;
0023b0  e3a04000          MOV      r4,#0
;;;1485   	struct yaffs_obj *newdir = NULL;
0023b4  e3a06000          MOV      r6,#0
;;;1486   	struct yaffs_obj *obj = NULL;
0023b8  e3a05000          MOV      r5,#0
;;;1487   	struct yaffs_obj *newobj = NULL;
0023bc  e3a00000          MOV      r0,#0
0023c0  e58d0028          STR      r0,[sp,#0x28]
;;;1488   	YCHAR *oldname;
;;;1489   	YCHAR *newname;
;;;1490   	int result = YAFFS_FAIL;
0023c4  e3a0b000          MOV      r11,#0
;;;1491   	int rename_allowed = 1;
0023c8  e3a09001          MOV      r9,#1
;;;1492   	int notOldDir = 0;
0023cc  e58d001c          STR      r0,[sp,#0x1c]
;;;1493   	int notNewDir = 0;
0023d0  e58d0018          STR      r0,[sp,#0x18]
;;;1494   	int oldLoop = 0;
0023d4  e58d0014          STR      r0,[sp,#0x14]
;;;1495   	int newLoop = 0;
0023d8  e58d0010          STR      r0,[sp,#0x10]
;;;1496   
;;;1497   	YCHAR *alt_newpath = NULL;
0023dc  e58d000c          STR      r0,[sp,#0xc]
;;;1498   
;;;1499   	if (!oldPath || !newPath) {
0023e0  e3570000          CMP      r7,#0
0023e4  0a000001          BEQ      |L1.9200|
0023e8  e3580000          CMP      r8,#0
0023ec  1a000004          BNE      |L1.9220|
                  |L1.9200|
;;;1500   		yaffsfs_SetError(-EFAULT);
0023f0  e3e0000d          MVN      r0,#0xd
0023f4  ebfffffe          BL       yaffsfs_SetError
;;;1501   		return -1;
0023f8  e3e00000          MVN      r0,#0
                  |L1.9212|
0023fc  e28dd02c          ADD      sp,sp,#0x2c
;;;1502   	}
;;;1503   
;;;1504   	if (yaffsfs_CheckPath(oldPath) < 0 || yaffsfs_CheckPath(newPath) < 0) {
;;;1505   		yaffsfs_SetError(-ENAMETOOLONG);
;;;1506   		return -1;
;;;1507   	}
;;;1508   
;;;1509   	if (yaffsfs_alt_dir_path(newPath, &alt_newpath) < 0) {
;;;1510   		yaffsfs_SetError(-ENOMEM);
;;;1511   		return -1;
;;;1512   	}
;;;1513   	if (alt_newpath)
;;;1514   		newPath = alt_newpath;
;;;1515   
;;;1516   	yaffsfs_Lock();
;;;1517   
;;;1518   	olddir = yaffsfs_FindDirectory(NULL, oldPath, &oldname, 0,
;;;1519   				       &notOldDir, &oldLoop);
;;;1520   	newdir = yaffsfs_FindDirectory(NULL, newPath, &newname, 0,
;;;1521   				       &notNewDir, &newLoop);
;;;1522   	obj = yaffsfs_FindObject(NULL, oldPath, 0, 0, NULL, NULL, NULL);
;;;1523   	newobj = yaffsfs_FindObject(NULL, newPath, 0, 0, NULL, NULL, NULL);
;;;1524   
;;;1525   	/* If the object being renamed is a directory and the
;;;1526   	 * path ended with a "/" then the olddir == obj.
;;;1527   	 * We pass through NULL for the old name to tell the lower layers
;;;1528   	 * to use olddir as the object.
;;;1529   	 */
;;;1530   
;;;1531   	if (olddir == obj)
;;;1532   		oldname = NULL;
;;;1533   
;;;1534   	if ((!olddir && notOldDir) || (!newdir && notNewDir)) {
;;;1535   		yaffsfs_SetError(-ENOTDIR);
;;;1536   		rename_allowed = 0;
;;;1537   	} else if (oldLoop || newLoop) {
;;;1538   		yaffsfs_SetError(-ELOOP);
;;;1539   		rename_allowed = 0;
;;;1540   	} else if (olddir && oldname &&
;;;1541   			yaffs_strncmp(oldname, _Y("."), 2) == 0) {
;;;1542   		yaffsfs_SetError(-EINVAL);
;;;1543   		rename_allowed = 0;
;;;1544   	} else if (!olddir || !newdir || !obj) {
;;;1545   		yaffsfs_SetError(-ENOENT);
;;;1546   		rename_allowed = 0;
;;;1547   	} else if (obj->my_dev->read_only) {
;;;1548   		yaffsfs_SetError(-EROFS);
;;;1549   		rename_allowed = 0;
;;;1550   	} else if (yaffs_is_non_empty_dir(newobj)) {
;;;1551   		yaffsfs_SetError(-ENOTEMPTY);
;;;1552   		rename_allowed = 0;
;;;1553   	} else if (olddir->my_dev != newdir->my_dev) {
;;;1554   		/* Rename must be on same device */
;;;1555   		yaffsfs_SetError(-EXDEV);
;;;1556   		rename_allowed = 0;
;;;1557   	} else if (obj && obj->variant_type == YAFFS_OBJECT_TYPE_DIRECTORY) {
;;;1558   		/*
;;;1559   		 * It is a directory, check that it is not being renamed to
;;;1560   		 * being its own decendent.
;;;1561   		 * Do this by tracing from the new directory back to the root,
;;;1562   		 * checking for obj
;;;1563   		 */
;;;1564   
;;;1565   		struct yaffs_obj *xx = newdir;
;;;1566   
;;;1567   		while (rename_allowed && xx) {
;;;1568   			if (xx == obj)
;;;1569   				rename_allowed = 0;
;;;1570   			xx = xx->parent;
;;;1571   		}
;;;1572   		if (!rename_allowed)
;;;1573   			yaffsfs_SetError(-EINVAL);
;;;1574   	}
;;;1575   
;;;1576   	if (rename_allowed)
;;;1577   		result = yaffs_rename_obj(olddir, oldname, newdir, newname);
;;;1578   
;;;1579   	yaffsfs_Unlock();
;;;1580   
;;;1581   	yaffs_free(alt_newpath);
;;;1582   
;;;1583   	return (result == YAFFS_FAIL) ? -1 : 0;
;;;1584   }
002400  e8bd8ff0          POP      {r4-r11,pc}
                  |L1.9220|
002404  e1a00007          MOV      r0,r7                 ;1504
002408  ebfffffe          BL       yaffsfs_CheckPath
00240c  e3500000          CMP      r0,#0                 ;1504
002410  ba000003          BLT      |L1.9252|
002414  e1a00008          MOV      r0,r8                 ;1504
002418  ebfffffe          BL       yaffsfs_CheckPath
00241c  e3500000          CMP      r0,#0                 ;1504
002420  aa000003          BGE      |L1.9268|
                  |L1.9252|
002424  e3e00023          MVN      r0,#0x23              ;1505
002428  ebfffffe          BL       yaffsfs_SetError
00242c  e3e00000          MVN      r0,#0                 ;1506
002430  eafffff1          B        |L1.9212|
                  |L1.9268|
002434  e28d100c          ADD      r1,sp,#0xc            ;1509
002438  e1a00008          MOV      r0,r8                 ;1509
00243c  ebfffffe          BL       yaffsfs_alt_dir_path
002440  e3500000          CMP      r0,#0                 ;1509
002444  aa000003          BGE      |L1.9304|
002448  e3e0000b          MVN      r0,#0xb               ;1510
00244c  ebfffffe          BL       yaffsfs_SetError
002450  e3e00000          MVN      r0,#0                 ;1511
002454  eaffffe8          B        |L1.9212|
                  |L1.9304|
002458  e59d000c          LDR      r0,[sp,#0xc]          ;1513
00245c  e3500000          CMP      r0,#0                 ;1513
002460  0a000000          BEQ      |L1.9320|
002464  e59d800c          LDR      r8,[sp,#0xc]          ;1514
                  |L1.9320|
002468  ebfffffe          BL       yaffsfs_Lock
00246c  e28d0014          ADD      r0,sp,#0x14           ;1518
002470  e28d101c          ADD      r1,sp,#0x1c           ;1518
002474  e3a03000          MOV      r3,#0                 ;1518
002478  e58d0004          STR      r0,[sp,#4]            ;1518
00247c  e58d1000          STR      r1,[sp,#0]            ;1518
002480  e28d2024          ADD      r2,sp,#0x24           ;1518
002484  e1a01007          MOV      r1,r7                 ;1518
002488  e1a00003          MOV      r0,r3                 ;1518
00248c  ebfffffe          BL       yaffsfs_FindDirectory
002490  e1a04000          MOV      r4,r0                 ;1518
002494  e28d0010          ADD      r0,sp,#0x10           ;1520
002498  e28d1018          ADD      r1,sp,#0x18           ;1520
00249c  e3a03000          MOV      r3,#0                 ;1520
0024a0  e58d0004          STR      r0,[sp,#4]            ;1520
0024a4  e58d1000          STR      r1,[sp,#0]            ;1520
0024a8  e28d2020          ADD      r2,sp,#0x20           ;1520
0024ac  e1a01008          MOV      r1,r8                 ;1520
0024b0  e1a00003          MOV      r0,r3                 ;1520
0024b4  ebfffffe          BL       yaffsfs_FindDirectory
0024b8  e1a06000          MOV      r6,r0                 ;1520
0024bc  e3a00000          MOV      r0,#0                 ;1522
0024c0  e58d0000          STR      r0,[sp,#0]            ;1522
0024c4  e58d0004          STR      r0,[sp,#4]            ;1522
0024c8  e58d0008          STR      r0,[sp,#8]            ;1522
0024cc  e1a03000          MOV      r3,r0                 ;1522
0024d0  e1a02000          MOV      r2,r0                 ;1522
0024d4  e1a01007          MOV      r1,r7                 ;1522
0024d8  ebfffffe          BL       yaffsfs_FindObject
0024dc  e1a05000          MOV      r5,r0                 ;1522
0024e0  e3a00000          MOV      r0,#0                 ;1523
0024e4  e58d0000          STR      r0,[sp,#0]            ;1523
0024e8  e58d0004          STR      r0,[sp,#4]            ;1523
0024ec  e58d0008          STR      r0,[sp,#8]            ;1523
0024f0  e1a03000          MOV      r3,r0                 ;1523
0024f4  e1a02000          MOV      r2,r0                 ;1523
0024f8  e1a01008          MOV      r1,r8                 ;1523
0024fc  ebfffffe          BL       yaffsfs_FindObject
002500  e58d0028          STR      r0,[sp,#0x28]         ;1523
002504  e1540005          CMP      r4,r5                 ;1531
002508  1a000001          BNE      |L1.9492|
00250c  e3a00000          MOV      r0,#0                 ;1532
002510  e58d0024          STR      r0,[sp,#0x24]         ;1532
                  |L1.9492|
002514  e3540000          CMP      r4,#0                 ;1534
002518  1a000002          BNE      |L1.9512|
00251c  e59d001c          LDR      r0,[sp,#0x1c]         ;1534
002520  e3500000          CMP      r0,#0                 ;1534
002524  1a000004          BNE      |L1.9532|
                  |L1.9512|
002528  e3560000          CMP      r6,#0                 ;1534
00252c  1a000006          BNE      |L1.9548|
002530  e59d0018          LDR      r0,[sp,#0x18]         ;1534
002534  e3500000          CMP      r0,#0                 ;1534
002538  0a000003          BEQ      |L1.9548|
                  |L1.9532|
00253c  e3e00013          MVN      r0,#0x13              ;1535
002540  ebfffffe          BL       yaffsfs_SetError
002544  e3a09000          MOV      r9,#0                 ;1536
002548  ea00004e          B        |L1.9864|
                  |L1.9548|
00254c  e59d0014          LDR      r0,[sp,#0x14]         ;1537
002550  e3500000          CMP      r0,#0                 ;1537
002554  1a000002          BNE      |L1.9572|
002558  e59d0010          LDR      r0,[sp,#0x10]         ;1537
00255c  e3500000          CMP      r0,#0                 ;1537
002560  0a000003          BEQ      |L1.9588|
                  |L1.9572|
002564  e3e00027          MVN      r0,#0x27              ;1538
002568  ebfffffe          BL       yaffsfs_SetError
00256c  e3a09000          MOV      r9,#0                 ;1539
002570  ea000044          B        |L1.9864|
                  |L1.9588|
002574  e3540000          CMP      r4,#0                 ;1540
002578  0a00000c          BEQ      |L1.9648|
00257c  e59d0024          LDR      r0,[sp,#0x24]         ;1540
002580  e3500000          CMP      r0,#0                 ;1540
002584  0a000009          BEQ      |L1.9648|
002588  e3a02002          MOV      r2,#2                 ;1541
00258c  e24f1f95          ADR      r1,|L1.9024|
002590  e59d0024          LDR      r0,[sp,#0x24]         ;1541
002594  ebfffffe          BL       strncmp
002598  e3500000          CMP      r0,#0                 ;1541
00259c  1a000003          BNE      |L1.9648|
0025a0  e3e00015          MVN      r0,#0x15              ;1542
0025a4  ebfffffe          BL       yaffsfs_SetError
0025a8  e3a09000          MOV      r9,#0                 ;1543
0025ac  ea000035          B        |L1.9864|
                  |L1.9648|
0025b0  e3540000          CMP      r4,#0                 ;1544
0025b4  0a000003          BEQ      |L1.9672|
0025b8  e3560000          CMP      r6,#0                 ;1544
0025bc  0a000001          BEQ      |L1.9672|
0025c0  e3550000          CMP      r5,#0                 ;1544
0025c4  1a000003          BNE      |L1.9688|
                  |L1.9672|
0025c8  e3e00001          MVN      r0,#1                 ;1545
0025cc  ebfffffe          BL       yaffsfs_SetError
0025d0  e3a09000          MOV      r9,#0                 ;1546
0025d4  ea00002b          B        |L1.9864|
                  |L1.9688|
0025d8  e5950008          LDR      r0,[r5,#8]            ;1547
0025dc  e59000c8          LDR      r0,[r0,#0xc8]         ;1547
0025e0  e3500000          CMP      r0,#0                 ;1547
0025e4  0a000003          BEQ      |L1.9720|
0025e8  e3e0001d          MVN      r0,#0x1d              ;1548
0025ec  ebfffffe          BL       yaffsfs_SetError
0025f0  e3a09000          MOV      r9,#0                 ;1549
0025f4  ea000023          B        |L1.9864|
                  |L1.9720|
0025f8  e59d0028          LDR      r0,[sp,#0x28]         ;1550
0025fc  ebfffffe          BL       yaffs_is_non_empty_dir
002600  e3500000          CMP      r0,#0                 ;1550
002604  0a000003          BEQ      |L1.9752|
002608  e3e00026          MVN      r0,#0x26              ;1551
00260c  ebfffffe          BL       yaffsfs_SetError
002610  e3a09000          MOV      r9,#0                 ;1552
002614  ea00001b          B        |L1.9864|
                  |L1.9752|
002618  e5940008          LDR      r0,[r4,#8]            ;1553
00261c  e5961008          LDR      r1,[r6,#8]            ;1553
002620  e1500001          CMP      r0,r1                 ;1553
002624  0a000003          BEQ      |L1.9784|
002628  e3e00011          MVN      r0,#0x11              ;1555
00262c  ebfffffe          BL       yaffsfs_SetError
002630  e3a09000          MOV      r9,#0                 ;1556
002634  ea000013          B        |L1.9864|
                  |L1.9784|
002638  e3550000          CMP      r5,#0                 ;1557
00263c  0a000011          BEQ      |L1.9864|
002640  e5d50064          LDRB     r0,[r5,#0x64]         ;1557
002644  e3500003          CMP      r0,#3                 ;1557
002648  1a00000e          BNE      |L1.9864|
00264c  e1a0a006          MOV      r10,r6                ;1565
002650  ea000003          B        |L1.9828|
                  |L1.9812|
002654  e15a0005          CMP      r10,r5                ;1568
002658  1a000000          BNE      |L1.9824|
00265c  e3a09000          MOV      r9,#0                 ;1569
                  |L1.9824|
002660  e59aa01c          LDR      r10,[r10,#0x1c]       ;1570
                  |L1.9828|
002664  e3590000          CMP      r9,#0                 ;1567
002668  0a000001          BEQ      |L1.9844|
00266c  e35a0000          CMP      r10,#0                ;1567
002670  1afffff7          BNE      |L1.9812|
                  |L1.9844|
002674  e3590000          CMP      r9,#0                 ;1572
002678  1a000001          BNE      |L1.9860|
00267c  e3e00015          MVN      r0,#0x15              ;1573
002680  ebfffffe          BL       yaffsfs_SetError
                  |L1.9860|
002684  e1a00000          MOV      r0,r0                 ;1574
                  |L1.9864|
002688  e3590000          CMP      r9,#0                 ;1576
00268c  0a000005          BEQ      |L1.9896|
002690  e1a02006          MOV      r2,r6                 ;1577
002694  e1a00004          MOV      r0,r4                 ;1577
002698  e59d1024          LDR      r1,[sp,#0x24]         ;1577
00269c  e59d3020          LDR      r3,[sp,#0x20]         ;1577
0026a0  ebfffffe          BL       yaffs_rename_obj
0026a4  e1a0b000          MOV      r11,r0                ;1577
                  |L1.9896|
0026a8  ebfffffe          BL       yaffsfs_Unlock
0026ac  e59d000c          LDR      r0,[sp,#0xc]          ;1581
0026b0  ebfffffe          BL       yaffs_free
0026b4  e35b0000          CMP      r11,#0                ;1583
0026b8  1a000001          BNE      |L1.9924|
0026bc  e3e00000          MVN      r0,#0                 ;1583
0026c0  eaffff4d          B        |L1.9212|
                  |L1.9924|
0026c4  e3a00000          MOV      r0,#0                 ;1583
0026c8  eaffff4b          B        |L1.9212|
;;;1585   
                          ENDP

                  yaffsfs_DoStat PROC
;;;1586   static int yaffsfs_DoStat(struct yaffs_obj *obj, struct yaffs_stat *buf)
0026cc  e92d41f0          PUSH     {r4-r8,lr}
;;;1587   {
0026d0  e1a05000          MOV      r5,r0
0026d4  e1a04001          MOV      r4,r1
;;;1588   	int retVal = -1;
0026d8  e3e08000          MVN      r8,#0
;;;1589   
;;;1590   	obj = yaffs_get_equivalent_obj(obj);
0026dc  e1a00005          MOV      r0,r5
0026e0  ebfffffe          BL       yaffs_get_equivalent_obj
0026e4  e1a05000          MOV      r5,r0
;;;1591   
;;;1592   	if (obj && buf) {
0026e8  e3550000          CMP      r5,#0
0026ec  0a00003e          BEQ      |L1.10220|
0026f0  e3540000          CMP      r4,#0
0026f4  0a00003c          BEQ      |L1.10220|
;;;1593   		buf->st_dev = (int)obj->my_dev->os_context;
0026f8  e5950008          LDR      r0,[r5,#8]
0026fc  e5900094          LDR      r0,[r0,#0x94]
002700  e5840000          STR      r0,[r4,#0]
;;;1594   		buf->st_ino = obj->obj_id;
002704  e5950030          LDR      r0,[r5,#0x30]
002708  e5840004          STR      r0,[r4,#4]
;;;1595   		buf->st_mode = obj->yst_mode & ~S_IFMT;
00270c  e5950034          LDR      r0,[r5,#0x34]
002710  e3c00a0f          BIC      r0,r0,#0xf000
002714  e5840008          STR      r0,[r4,#8]
;;;1596   
;;;1597   		if (obj->variant_type == YAFFS_OBJECT_TYPE_DIRECTORY)
002718  e5d50064          LDRB     r0,[r5,#0x64]
00271c  e3500003          CMP      r0,#3
002720  1a000003          BNE      |L1.10036|
;;;1598   			buf->st_mode |= S_IFDIR;
002724  e5940008          LDR      r0,[r4,#8]
002728  e3800901          ORR      r0,r0,#0x4000
00272c  e5840008          STR      r0,[r4,#8]
002730  ea00000c          B        |L1.10088|
                  |L1.10036|
;;;1599   		else if (obj->variant_type == YAFFS_OBJECT_TYPE_SYMLINK)
002734  e5d50064          LDRB     r0,[r5,#0x64]
002738  e3500002          CMP      r0,#2
00273c  1a000003          BNE      |L1.10064|
;;;1600   			buf->st_mode |= S_IFLNK;
002740  e5940008          LDR      r0,[r4,#8]
002744  e3800a0a          ORR      r0,r0,#0xa000
002748  e5840008          STR      r0,[r4,#8]
00274c  ea000005          B        |L1.10088|
                  |L1.10064|
;;;1601   		else if (obj->variant_type == YAFFS_OBJECT_TYPE_FILE)
002750  e5d50064          LDRB     r0,[r5,#0x64]
002754  e3500001          CMP      r0,#1
002758  1a000002          BNE      |L1.10088|
;;;1602   			buf->st_mode |= S_IFREG;
00275c  e5940008          LDR      r0,[r4,#8]
002760  e3800902          ORR      r0,r0,#0x8000
002764  e5840008          STR      r0,[r4,#8]
                  |L1.10088|
;;;1603   
;;;1604   		buf->st_nlink = yaffs_get_obj_link_count(obj);
002768  e1a00005          MOV      r0,r5
00276c  ebfffffe          BL       yaffs_get_obj_link_count
002770  e584000c          STR      r0,[r4,#0xc]
;;;1605   		buf->st_uid = 0;
002774  e3a00000          MOV      r0,#0
002778  e5840010          STR      r0,[r4,#0x10]
;;;1606   		buf->st_gid = 0;
00277c  e5840014          STR      r0,[r4,#0x14]
;;;1607   		buf->st_rdev = obj->yst_rdev;
002780  e595005c          LDR      r0,[r5,#0x5c]
002784  e5840018          STR      r0,[r4,#0x18]
;;;1608   		buf->st_size = yaffs_get_obj_length(obj);
002788  e1a00005          MOV      r0,r5
00278c  ebfffffe          BL       yaffs_get_obj_length
002790  e1c402f0          STRD     r0,r1,[r4,#0x20]
;;;1609   		buf->st_blksize = obj->my_dev->data_bytes_per_chunk;
002794  e5950008          LDR      r0,[r5,#8]
002798  e59000a4          LDR      r0,[r0,#0xa4]
00279c  e5840028          STR      r0,[r4,#0x28]
;;;1610   		buf->st_blocks = (buf->st_size + buf->st_blksize - 1) /
0027a0  e5943020          LDR      r3,[r4,#0x20]
0027a4  e5942024          LDR      r2,[r4,#0x24]
0027a8  e594c028          LDR      r12,[r4,#0x28]
0027ac  e093000c          ADDS     r0,r3,r12
0027b0  e2a23000          ADC      r3,r2,#0
0027b4  e2506001          SUBS     r6,r0,#1
0027b8  e2c31000          SBC      r1,r3,#0
0027bc  e1a0200c          MOV      r2,r12
0027c0  e3a03000          MOV      r3,#0
0027c4  e1a00006          MOV      r0,r6
0027c8  ebfffffe          BL       __aeabi_ldivmod
0027cc  e584002c          STR      r0,[r4,#0x2c]
;;;1611   		    buf->st_blksize;
;;;1612   #if CONFIG_YAFFS_WINCE
;;;1613   		buf->yst_wince_atime[0] = obj->win_atime[0];
;;;1614   		buf->yst_wince_atime[1] = obj->win_atime[1];
;;;1615   		buf->yst_wince_ctime[0] = obj->win_ctime[0];
;;;1616   		buf->yst_wince_ctime[1] = obj->win_ctime[1];
;;;1617   		buf->yst_wince_mtime[0] = obj->win_mtime[0];
;;;1618   		buf->yst_wince_mtime[1] = obj->win_mtime[1];
;;;1619   #else
;;;1620   		buf->yst_atime = obj->yst_atime;
0027d0  e5950050          LDR      r0,[r5,#0x50]
0027d4  e5840030          STR      r0,[r4,#0x30]
;;;1621   		buf->yst_ctime = obj->yst_ctime;
0027d8  e5950058          LDR      r0,[r5,#0x58]
0027dc  e5840038          STR      r0,[r4,#0x38]
;;;1622   		buf->yst_mtime = obj->yst_mtime;
0027e0  e5950054          LDR      r0,[r5,#0x54]
0027e4  e5840034          STR      r0,[r4,#0x34]
;;;1623   #endif
;;;1624   		retVal = 0;
0027e8  e3a08000          MOV      r8,#0
                  |L1.10220|
;;;1625   	}
;;;1626   	return retVal;
0027ec  e1a00008          MOV      r0,r8
;;;1627   }
0027f0  e8bd81f0          POP      {r4-r8,pc}
;;;1628   
                          ENDP

                  yaffsfs_DoStatOrLStat PROC
;;;1629   static int yaffsfs_DoStatOrLStat(const YCHAR *path,
0027f4  e92d41f0          PUSH     {r4-r8,lr}
;;;1630   				 struct yaffs_stat *buf, int doLStat)
;;;1631   {
0027f8  e24dd018          SUB      sp,sp,#0x18
0027fc  e1a04000          MOV      r4,r0
002800  e1a06001          MOV      r6,r1
002804  e1a07002          MOV      r7,r2
;;;1632   	struct yaffs_obj *obj = NULL;
002808  e3a05000          MOV      r5,#0
;;;1633   	struct yaffs_obj *dir = NULL;
00280c  e3a00000          MOV      r0,#0
002810  e58d0014          STR      r0,[sp,#0x14]
;;;1634   	int retVal = -1;
002814  e3e08000          MVN      r8,#0
;;;1635   	int notDir = 0;
002818  e58d0010          STR      r0,[sp,#0x10]
;;;1636   	int loop = 0;
00281c  e58d000c          STR      r0,[sp,#0xc]
;;;1637   
;;;1638   	if (!path || !buf) {
002820  e3540000          CMP      r4,#0
002824  0a000001          BEQ      |L1.10288|
002828  e3560000          CMP      r6,#0
00282c  1a000004          BNE      |L1.10308|
                  |L1.10288|
;;;1639   		yaffsfs_SetError(-EFAULT);
002830  e3e0000d          MVN      r0,#0xd
002834  ebfffffe          BL       yaffsfs_SetError
;;;1640   		return -1;
002838  e3e00000          MVN      r0,#0
                  |L1.10300|
00283c  e28dd018          ADD      sp,sp,#0x18
;;;1641   	}
;;;1642   
;;;1643   	if (yaffsfs_CheckPath(path) < 0) {
;;;1644   		yaffsfs_SetError(-ENAMETOOLONG);
;;;1645   		return -1;
;;;1646   	}
;;;1647   
;;;1648   	yaffsfs_Lock();
;;;1649   
;;;1650   	obj = yaffsfs_FindObject(NULL, path, 0, 1, &dir, &notDir, &loop);
;;;1651   
;;;1652   	if (!doLStat && obj)
;;;1653   		obj = yaffsfs_FollowLink(obj, 0, &loop);
;;;1654   
;;;1655   	if (!dir && notDir)
;;;1656   		yaffsfs_SetError(-ENOTDIR);
;;;1657   	else if (loop)
;;;1658   		yaffsfs_SetError(-ELOOP);
;;;1659   	else if (!dir || !obj)
;;;1660   		yaffsfs_SetError(-ENOENT);
;;;1661   	else
;;;1662   		retVal = yaffsfs_DoStat(obj, buf);
;;;1663   
;;;1664   	yaffsfs_Unlock();
;;;1665   
;;;1666   	return retVal;
;;;1667   
;;;1668   }
002840  e8bd81f0          POP      {r4-r8,pc}
                  |L1.10308|
002844  e1a00004          MOV      r0,r4                 ;1643
002848  ebfffffe          BL       yaffsfs_CheckPath
00284c  e3500000          CMP      r0,#0                 ;1643
002850  aa000003          BGE      |L1.10340|
002854  e3e00023          MVN      r0,#0x23              ;1644
002858  ebfffffe          BL       yaffsfs_SetError
00285c  e3e00000          MVN      r0,#0                 ;1645
002860  eafffff5          B        |L1.10300|
                  |L1.10340|
002864  ebfffffe          BL       yaffsfs_Lock
002868  e28d000c          ADD      r0,sp,#0xc            ;1650
00286c  e28d1010          ADD      r1,sp,#0x10           ;1650
002870  e28d2014          ADD      r2,sp,#0x14           ;1650
002874  e3a03001          MOV      r3,#1                 ;1650
002878  e58d2000          STR      r2,[sp,#0]            ;1650
00287c  e3a02000          MOV      r2,#0                 ;1650
002880  e58d1004          STR      r1,[sp,#4]            ;1650
002884  e1a01004          MOV      r1,r4                 ;1650
002888  e58d0008          STR      r0,[sp,#8]            ;1650
00288c  e1a00002          MOV      r0,r2                 ;1650
002890  ebfffffe          BL       yaffsfs_FindObject
002894  e1a05000          MOV      r5,r0                 ;1650
002898  e3570000          CMP      r7,#0                 ;1652
00289c  1a000006          BNE      |L1.10428|
0028a0  e3550000          CMP      r5,#0                 ;1652
0028a4  0a000004          BEQ      |L1.10428|
0028a8  e28d200c          ADD      r2,sp,#0xc            ;1653
0028ac  e3a01000          MOV      r1,#0                 ;1653
0028b0  e1a00005          MOV      r0,r5                 ;1653
0028b4  ebfffffe          BL       yaffsfs_FollowLink
0028b8  e1a05000          MOV      r5,r0                 ;1653
                  |L1.10428|
0028bc  e59d0014          LDR      r0,[sp,#0x14]         ;1655
0028c0  e3500000          CMP      r0,#0                 ;1655
0028c4  1a000005          BNE      |L1.10464|
0028c8  e59d0010          LDR      r0,[sp,#0x10]         ;1655
0028cc  e3500000          CMP      r0,#0                 ;1655
0028d0  0a000002          BEQ      |L1.10464|
0028d4  e3e00013          MVN      r0,#0x13              ;1656
0028d8  ebfffffe          BL       yaffsfs_SetError
0028dc  ea000011          B        |L1.10536|
                  |L1.10464|
0028e0  e59d000c          LDR      r0,[sp,#0xc]          ;1657
0028e4  e3500000          CMP      r0,#0                 ;1657
0028e8  0a000002          BEQ      |L1.10488|
0028ec  e3e00027          MVN      r0,#0x27              ;1658
0028f0  ebfffffe          BL       yaffsfs_SetError
0028f4  ea00000b          B        |L1.10536|
                  |L1.10488|
0028f8  e59d0014          LDR      r0,[sp,#0x14]         ;1659
0028fc  e3500000          CMP      r0,#0                 ;1659
002900  0a000001          BEQ      |L1.10508|
002904  e3550000          CMP      r5,#0                 ;1659
002908  1a000002          BNE      |L1.10520|
                  |L1.10508|
00290c  e3e00001          MVN      r0,#1                 ;1660
002910  ebfffffe          BL       yaffsfs_SetError
002914  ea000003          B        |L1.10536|
                  |L1.10520|
002918  e1a01006          MOV      r1,r6                 ;1662
00291c  e1a00005          MOV      r0,r5                 ;1662
002920  ebfffffe          BL       yaffsfs_DoStat
002924  e1a08000          MOV      r8,r0                 ;1662
                  |L1.10536|
002928  ebfffffe          BL       yaffsfs_Unlock
00292c  e1a00008          MOV      r0,r8                 ;1666
002930  eaffffc1          B        |L1.10300|
;;;1669   
                          ENDP

                  yaffs_stat PROC
;;;1670   int yaffs_stat(const YCHAR *path, struct yaffs_stat *buf)
002934  e92d4070          PUSH     {r4-r6,lr}
;;;1671   {
002938  e1a04000          MOV      r4,r0
00293c  e1a05001          MOV      r5,r1
;;;1672   	return yaffsfs_DoStatOrLStat(path, buf, 0);
002940  e3a02000          MOV      r2,#0
002944  e1a01005          MOV      r1,r5
002948  e1a00004          MOV      r0,r4
00294c  ebfffffe          BL       yaffsfs_DoStatOrLStat
;;;1673   }
002950  e8bd8070          POP      {r4-r6,pc}
;;;1674   
                          ENDP

                  yaffs_lstat PROC
;;;1675   int yaffs_lstat(const YCHAR *path, struct yaffs_stat *buf)
002954  e92d4070          PUSH     {r4-r6,lr}
;;;1676   {
002958  e1a04000          MOV      r4,r0
00295c  e1a05001          MOV      r5,r1
;;;1677   	return yaffsfs_DoStatOrLStat(path, buf, 1);
002960  e3a02001          MOV      r2,#1
002964  e1a01005          MOV      r1,r5
002968  e1a00004          MOV      r0,r4
00296c  ebfffffe          BL       yaffsfs_DoStatOrLStat
;;;1678   }
002970  e8bd8070          POP      {r4-r6,pc}
;;;1679   
                          ENDP

                  yaffs_fstat PROC
;;;1680   int yaffs_fstat(int fd, struct yaffs_stat *buf)
002974  e92d41f0          PUSH     {r4-r8,lr}
;;;1681   {
002978  e1a06000          MOV      r6,r0
00297c  e1a05001          MOV      r5,r1
;;;1682   	struct yaffs_obj *obj;
;;;1683   
;;;1684   	int retVal = -1;
002980  e3e07000          MVN      r7,#0
;;;1685   
;;;1686   	if (!buf) {
002984  e3550000          CMP      r5,#0
002988  1a000003          BNE      |L1.10652|
;;;1687   		yaffsfs_SetError(-EFAULT);
00298c  e3e0000d          MVN      r0,#0xd
002990  ebfffffe          BL       yaffsfs_SetError
;;;1688   		return -1;
002994  e3e00000          MVN      r0,#0
                  |L1.10648|
;;;1689   	}
;;;1690   
;;;1691   	yaffsfs_Lock();
;;;1692   	obj = yaffsfs_HandleToObject(fd);
;;;1693   
;;;1694   	if (obj)
;;;1695   		retVal = yaffsfs_DoStat(obj, buf);
;;;1696   	else
;;;1697   		/* bad handle */
;;;1698   		yaffsfs_SetError(-EBADF);
;;;1699   
;;;1700   	yaffsfs_Unlock();
;;;1701   
;;;1702   	return retVal;
;;;1703   }
002998  e8bd81f0          POP      {r4-r8,pc}
                  |L1.10652|
00299c  ebfffffe          BL       yaffsfs_Lock
0029a0  e1a00006          MOV      r0,r6                 ;1692
0029a4  ebfffffe          BL       yaffsfs_HandleToObject
0029a8  e1a04000          MOV      r4,r0                 ;1692
0029ac  e3540000          CMP      r4,#0                 ;1694
0029b0  0a000004          BEQ      |L1.10696|
0029b4  e1a01005          MOV      r1,r5                 ;1695
0029b8  e1a00004          MOV      r0,r4                 ;1695
0029bc  ebfffffe          BL       yaffsfs_DoStat
0029c0  e1a07000          MOV      r7,r0                 ;1695
0029c4  ea000001          B        |L1.10704|
                  |L1.10696|
0029c8  e3e00008          MVN      r0,#8                 ;1698
0029cc  ebfffffe          BL       yaffsfs_SetError
                  |L1.10704|
0029d0  ebfffffe          BL       yaffsfs_Unlock
0029d4  e1a00007          MOV      r0,r7                 ;1702
0029d8  eaffffee          B        |L1.10648|
;;;1704   
                          ENDP

                  yaffsfs_DoUtime PROC
;;;1705   static int yaffsfs_DoUtime(struct yaffs_obj *obj,
0029dc  e92d41fc          PUSH     {r2-r8,lr}
;;;1706   			   const struct yaffs_utimbuf *buf)
;;;1707   {
0029e0  e1a04000          MOV      r4,r0
0029e4  e1a05001          MOV      r5,r1
;;;1708   	int retVal = -1;
0029e8  e3e07000          MVN      r7,#0
;;;1709   	int result;
;;;1710   
;;;1711   	struct yaffs_utimbuf local;
;;;1712   
;;;1713   	obj = yaffs_get_equivalent_obj(obj);
0029ec  e1a00004          MOV      r0,r4
0029f0  ebfffffe          BL       yaffs_get_equivalent_obj
0029f4  e1a04000          MOV      r4,r0
;;;1714   
;;;1715   	if (obj && obj->my_dev->read_only) {
0029f8  e3540000          CMP      r4,#0
0029fc  0a000007          BEQ      |L1.10784|
002a00  e5940008          LDR      r0,[r4,#8]
002a04  e59000c8          LDR      r0,[r0,#0xc8]
002a08  e3500000          CMP      r0,#0
002a0c  0a000003          BEQ      |L1.10784|
;;;1716   		yaffsfs_SetError(-EROFS);
002a10  e3e0001d          MVN      r0,#0x1d
002a14  ebfffffe          BL       yaffsfs_SetError
;;;1717   		return -1;
002a18  e3e00000          MVN      r0,#0
                  |L1.10780|
;;;1718   	}
;;;1719   
;;;1720   	if (!buf) {
;;;1721   		local.actime = Y_CURRENT_TIME;
;;;1722   		local.modtime = local.actime;
;;;1723   		buf = &local;
;;;1724   	}
;;;1725   
;;;1726   	if (obj) {
;;;1727   		obj->yst_atime = buf->actime;
;;;1728   		obj->yst_mtime = buf->modtime;
;;;1729   		obj->dirty = 1;
;;;1730   		result = yaffs_flush_file(obj, 0, 0);
;;;1731   		retVal = result == YAFFS_OK ? 0 : -1;
;;;1732   	}
;;;1733   
;;;1734   	return retVal;
;;;1735   }
002a1c  e8bd81fc          POP      {r2-r8,pc}
                  |L1.10784|
002a20  e3550000          CMP      r5,#0                 ;1720
002a24  1a000004          BNE      |L1.10812|
002a28  ebfffffe          BL       yaffsfs_CurrentTime
002a2c  e58d0000          STR      r0,[sp,#0]            ;1721
002a30  e59d0000          LDR      r0,[sp,#0]            ;1722
002a34  e58d0004          STR      r0,[sp,#4]            ;1722
002a38  e1a0500d          MOV      r5,sp                 ;1723
                  |L1.10812|
002a3c  e3540000          CMP      r4,#0                 ;1726
002a40  0a000011          BEQ      |L1.10892|
002a44  e5950000          LDR      r0,[r5,#0]            ;1727
002a48  e5840050          STR      r0,[r4,#0x50]         ;1727
002a4c  e5950004          LDR      r0,[r5,#4]            ;1728
002a50  e5840054          STR      r0,[r4,#0x54]         ;1728
002a54  e5d40000          LDRB     r0,[r4,#0]            ;1729
002a58  e3800040          ORR      r0,r0,#0x40           ;1729
002a5c  e5c40000          STRB     r0,[r4,#0]            ;1729
002a60  e3a02000          MOV      r2,#0                 ;1730
002a64  e1a01002          MOV      r1,r2                 ;1730
002a68  e1a00004          MOV      r0,r4                 ;1730
002a6c  ebfffffe          BL       yaffs_flush_file
002a70  e1a06000          MOV      r6,r0                 ;1730
002a74  e3560001          CMP      r6,#1                 ;1731
002a78  1a000001          BNE      |L1.10884|
002a7c  e3a00000          MOV      r0,#0                 ;1731
002a80  ea000000          B        |L1.10888|
                  |L1.10884|
002a84  e3e00000          MVN      r0,#0                 ;1731
                  |L1.10888|
002a88  e1a07000          MOV      r7,r0                 ;1731
                  |L1.10892|
002a8c  e1a00007          MOV      r0,r7                 ;1734
002a90  eaffffe1          B        |L1.10780|
;;;1736   
                          ENDP

                  yaffs_utime PROC
;;;1737   int yaffs_utime(const YCHAR *path, const struct yaffs_utimbuf *buf)
002a94  e92d40f0          PUSH     {r4-r7,lr}
;;;1738   {
002a98  e24dd01c          SUB      sp,sp,#0x1c
002a9c  e1a04000          MOV      r4,r0
002aa0  e1a06001          MOV      r6,r1
;;;1739   	struct yaffs_obj *obj = NULL;
002aa4  e3a05000          MOV      r5,#0
;;;1740   	struct yaffs_obj *dir = NULL;
002aa8  e3a00000          MOV      r0,#0
002aac  e58d0018          STR      r0,[sp,#0x18]
;;;1741   	int retVal = -1;
002ab0  e3e07000          MVN      r7,#0
;;;1742   	int notDir = 0;
002ab4  e58d0014          STR      r0,[sp,#0x14]
;;;1743   	int loop = 0;
002ab8  e58d0010          STR      r0,[sp,#0x10]
;;;1744   
;;;1745   	if (!path) {
002abc  e3540000          CMP      r4,#0
002ac0  1a000004          BNE      |L1.10968|
;;;1746   		yaffsfs_SetError(-EFAULT);
002ac4  e3e0000d          MVN      r0,#0xd
002ac8  ebfffffe          BL       yaffsfs_SetError
;;;1747   		return -1;
002acc  e3e00000          MVN      r0,#0
                  |L1.10960|
002ad0  e28dd01c          ADD      sp,sp,#0x1c
;;;1748   	}
;;;1749   
;;;1750   	if (yaffsfs_CheckPath(path) < 0) {
;;;1751   		yaffsfs_SetError(-ENAMETOOLONG);
;;;1752   		return -1;
;;;1753   	}
;;;1754   
;;;1755   	yaffsfs_Lock();
;;;1756   
;;;1757   	obj = yaffsfs_FindObject(NULL, path, 0, 1, &dir, &notDir, &loop);
;;;1758   
;;;1759   	if (!dir && notDir)
;;;1760   		yaffsfs_SetError(-ENOTDIR);
;;;1761   	else if (loop)
;;;1762   		yaffsfs_SetError(-ELOOP);
;;;1763   	else if (!dir || !obj)
;;;1764   		yaffsfs_SetError(-ENOENT);
;;;1765   	else
;;;1766   		retVal = yaffsfs_DoUtime(obj, buf);
;;;1767   
;;;1768   	yaffsfs_Unlock();
;;;1769   
;;;1770   	return retVal;
;;;1771   
;;;1772   }
002ad4  e8bd80f0          POP      {r4-r7,pc}
                  |L1.10968|
002ad8  e1a00004          MOV      r0,r4                 ;1750
002adc  ebfffffe          BL       yaffsfs_CheckPath
002ae0  e3500000          CMP      r0,#0                 ;1750
002ae4  aa000003          BGE      |L1.11000|
002ae8  e3e00023          MVN      r0,#0x23              ;1751
002aec  ebfffffe          BL       yaffsfs_SetError
002af0  e3e00000          MVN      r0,#0                 ;1752
002af4  eafffff5          B        |L1.10960|
                  |L1.11000|
002af8  ebfffffe          BL       yaffsfs_Lock
002afc  e28d0010          ADD      r0,sp,#0x10           ;1757
002b00  e28d1014          ADD      r1,sp,#0x14           ;1757
002b04  e28d2018          ADD      r2,sp,#0x18           ;1757
002b08  e3a03001          MOV      r3,#1                 ;1757
002b0c  e58d2000          STR      r2,[sp,#0]            ;1757
002b10  e3a02000          MOV      r2,#0                 ;1757
002b14  e58d1004          STR      r1,[sp,#4]            ;1757
002b18  e1a01004          MOV      r1,r4                 ;1757
002b1c  e58d0008          STR      r0,[sp,#8]            ;1757
002b20  e1a00002          MOV      r0,r2                 ;1757
002b24  ebfffffe          BL       yaffsfs_FindObject
002b28  e1a05000          MOV      r5,r0                 ;1757
002b2c  e59d0018          LDR      r0,[sp,#0x18]         ;1759
002b30  e3500000          CMP      r0,#0                 ;1759
002b34  1a000005          BNE      |L1.11088|
002b38  e59d0014          LDR      r0,[sp,#0x14]         ;1759
002b3c  e3500000          CMP      r0,#0                 ;1759
002b40  0a000002          BEQ      |L1.11088|
002b44  e3e00013          MVN      r0,#0x13              ;1760
002b48  ebfffffe          BL       yaffsfs_SetError
002b4c  ea000011          B        |L1.11160|
                  |L1.11088|
002b50  e59d0010          LDR      r0,[sp,#0x10]         ;1761
002b54  e3500000          CMP      r0,#0                 ;1761
002b58  0a000002          BEQ      |L1.11112|
002b5c  e3e00027          MVN      r0,#0x27              ;1762
002b60  ebfffffe          BL       yaffsfs_SetError
002b64  ea00000b          B        |L1.11160|
                  |L1.11112|
002b68  e59d0018          LDR      r0,[sp,#0x18]         ;1763
002b6c  e3500000          CMP      r0,#0                 ;1763
002b70  0a000001          BEQ      |L1.11132|
002b74  e3550000          CMP      r5,#0                 ;1763
002b78  1a000002          BNE      |L1.11144|
                  |L1.11132|
002b7c  e3e00001          MVN      r0,#1                 ;1764
002b80  ebfffffe          BL       yaffsfs_SetError
002b84  ea000003          B        |L1.11160|
                  |L1.11144|
002b88  e1a01006          MOV      r1,r6                 ;1766
002b8c  e1a00005          MOV      r0,r5                 ;1766
002b90  ebfffffe          BL       yaffsfs_DoUtime
002b94  e1a07000          MOV      r7,r0                 ;1766
                  |L1.11160|
002b98  ebfffffe          BL       yaffsfs_Unlock
002b9c  e1a00007          MOV      r0,r7                 ;1770
002ba0  eaffffca          B        |L1.10960|
;;;1773   
                          ENDP

                  yaffs_futime PROC
;;;1774   int yaffs_futime(int fd, const struct yaffs_utimbuf *buf)
002ba4  e92d41f0          PUSH     {r4-r8,lr}
;;;1775   {
002ba8  e1a05000          MOV      r5,r0
002bac  e1a06001          MOV      r6,r1
;;;1776   	struct yaffs_obj *obj;
;;;1777   
;;;1778   	int retVal = -1;
002bb0  e3e07000          MVN      r7,#0
;;;1779   
;;;1780   	yaffsfs_Lock();
002bb4  ebfffffe          BL       yaffsfs_Lock
;;;1781   	obj = yaffsfs_HandleToObject(fd);
002bb8  e1a00005          MOV      r0,r5
002bbc  ebfffffe          BL       yaffsfs_HandleToObject
002bc0  e1a04000          MOV      r4,r0
;;;1782   
;;;1783   	if (obj)
002bc4  e3540000          CMP      r4,#0
002bc8  0a000004          BEQ      |L1.11232|
;;;1784   		retVal = yaffsfs_DoUtime(obj, buf);
002bcc  e1a01006          MOV      r1,r6
002bd0  e1a00004          MOV      r0,r4
002bd4  ebfffffe          BL       yaffsfs_DoUtime
002bd8  e1a07000          MOV      r7,r0
002bdc  ea000001          B        |L1.11240|
                  |L1.11232|
;;;1785   	else
;;;1786   		/* bad handle */
;;;1787   		yaffsfs_SetError(-EBADF);
002be0  e3e00008          MVN      r0,#8
002be4  ebfffffe          BL       yaffsfs_SetError
                  |L1.11240|
;;;1788   
;;;1789   	yaffsfs_Unlock();
002be8  ebfffffe          BL       yaffsfs_Unlock
;;;1790   
;;;1791   	return retVal;
002bec  e1a00007          MOV      r0,r7
;;;1792   }
002bf0  e8bd81f0          POP      {r4-r8,pc}
;;;1793   
                          ENDP

                  yaffs_do_setxattr PROC
;;;1796   
;;;1797   static int yaffs_do_setxattr(const YCHAR *path, const char *name,
002bf4  e92d4ff0          PUSH     {r4-r11,lr}
;;;1798   			     const void *data, int size, int flags, int follow)
;;;1799   {
002bf8  e24dd01c          SUB      sp,sp,#0x1c
002bfc  e1a04000          MOV      r4,r0
002c00  e1a06001          MOV      r6,r1
002c04  e1a07002          MOV      r7,r2
002c08  e1a09003          MOV      r9,r3
002c0c  e1cda4d0          LDRD     r10,r11,[sp,#0x40]
;;;1800   	struct yaffs_obj *obj;
;;;1801   	struct yaffs_obj *dir;
;;;1802   	int notDir = 0;
002c10  e3a00000          MOV      r0,#0
002c14  e58d0014          STR      r0,[sp,#0x14]
;;;1803   	int loop = 0;
002c18  e58d0010          STR      r0,[sp,#0x10]
;;;1804   
;;;1805   	int retVal = -1;
002c1c  e3e08000          MVN      r8,#0
;;;1806   
;;;1807   	if (!path || !name || !data) {
002c20  e3540000          CMP      r4,#0
002c24  0a000003          BEQ      |L1.11320|
002c28  e3560000          CMP      r6,#0
002c2c  0a000001          BEQ      |L1.11320|
002c30  e3570000          CMP      r7,#0
002c34  1a000004          BNE      |L1.11340|
                  |L1.11320|
;;;1808   		yaffsfs_SetError(-EFAULT);
002c38  e3e0000d          MVN      r0,#0xd
002c3c  ebfffffe          BL       yaffsfs_SetError
;;;1809   		return -1;
002c40  e3e00000          MVN      r0,#0
                  |L1.11332|
002c44  e28dd01c          ADD      sp,sp,#0x1c
;;;1810   	}
;;;1811   
;;;1812   	if (yaffsfs_CheckPath(path) < 0) {
;;;1813   		yaffsfs_SetError(-ENAMETOOLONG);
;;;1814   		return -1;
;;;1815   	}
;;;1816   
;;;1817   	yaffsfs_Lock();
;;;1818   
;;;1819   	obj = yaffsfs_FindObject(NULL, path, 0, 1, &dir, &notDir, &loop);
;;;1820   
;;;1821   	if (follow)
;;;1822   		obj = yaffsfs_FollowLink(obj, 0, &loop);
;;;1823   
;;;1824   	if (!dir && notDir)
;;;1825   		yaffsfs_SetError(-ENOTDIR);
;;;1826   	else if (loop)
;;;1827   		yaffsfs_SetError(-ELOOP);
;;;1828   	else if (!dir || !obj)
;;;1829   		yaffsfs_SetError(-ENOENT);
;;;1830   	else {
;;;1831   		retVal = yaffs_set_xattrib(obj, name, data, size, flags);
;;;1832   		if (retVal < 0) {
;;;1833   			yaffsfs_SetError(retVal);
;;;1834   			retVal = -1;
;;;1835   		}
;;;1836   	}
;;;1837   
;;;1838   	yaffsfs_Unlock();
;;;1839   
;;;1840   	return retVal;
;;;1841   
;;;1842   }
002c48  e8bd8ff0          POP      {r4-r11,pc}
                  |L1.11340|
002c4c  e1a00004          MOV      r0,r4                 ;1812
002c50  ebfffffe          BL       yaffsfs_CheckPath
002c54  e3500000          CMP      r0,#0                 ;1812
002c58  aa000003          BGE      |L1.11372|
002c5c  e3e00023          MVN      r0,#0x23              ;1813
002c60  ebfffffe          BL       yaffsfs_SetError
002c64  e3e00000          MVN      r0,#0                 ;1814
002c68  eafffff5          B        |L1.11332|
                  |L1.11372|
002c6c  ebfffffe          BL       yaffsfs_Lock
002c70  e28d0010          ADD      r0,sp,#0x10           ;1819
002c74  e28d1014          ADD      r1,sp,#0x14           ;1819
002c78  e28d2018          ADD      r2,sp,#0x18           ;1819
002c7c  e3a03001          MOV      r3,#1                 ;1819
002c80  e58d2000          STR      r2,[sp,#0]            ;1819
002c84  e3a02000          MOV      r2,#0                 ;1819
002c88  e58d1004          STR      r1,[sp,#4]            ;1819
002c8c  e1a01004          MOV      r1,r4                 ;1819
002c90  e58d0008          STR      r0,[sp,#8]            ;1819
002c94  e1a00002          MOV      r0,r2                 ;1819
002c98  ebfffffe          BL       yaffsfs_FindObject
002c9c  e1a05000          MOV      r5,r0                 ;1819
002ca0  e35b0000          CMP      r11,#0                ;1821
002ca4  0a000004          BEQ      |L1.11452|
002ca8  e28d2010          ADD      r2,sp,#0x10           ;1822
002cac  e3a01000          MOV      r1,#0                 ;1822
002cb0  e1a00005          MOV      r0,r5                 ;1822
002cb4  ebfffffe          BL       yaffsfs_FollowLink
002cb8  e1a05000          MOV      r5,r0                 ;1822
                  |L1.11452|
002cbc  e59d0018          LDR      r0,[sp,#0x18]         ;1824
002cc0  e3500000          CMP      r0,#0                 ;1824
002cc4  1a000005          BNE      |L1.11488|
002cc8  e59d0014          LDR      r0,[sp,#0x14]         ;1824
002ccc  e3500000          CMP      r0,#0                 ;1824
002cd0  0a000002          BEQ      |L1.11488|
002cd4  e3e00013          MVN      r0,#0x13              ;1825
002cd8  ebfffffe          BL       yaffsfs_SetError
002cdc  ea000019          B        |L1.11592|
                  |L1.11488|
002ce0  e59d0010          LDR      r0,[sp,#0x10]         ;1826
002ce4  e3500000          CMP      r0,#0                 ;1826
002ce8  0a000002          BEQ      |L1.11512|
002cec  e3e00027          MVN      r0,#0x27              ;1827
002cf0  ebfffffe          BL       yaffsfs_SetError
002cf4  ea000013          B        |L1.11592|
                  |L1.11512|
002cf8  e59d0018          LDR      r0,[sp,#0x18]         ;1828
002cfc  e3500000          CMP      r0,#0                 ;1828
002d00  0a000001          BEQ      |L1.11532|
002d04  e3550000          CMP      r5,#0                 ;1828
002d08  1a000002          BNE      |L1.11544|
                  |L1.11532|
002d0c  e3e00001          MVN      r0,#1                 ;1829
002d10  ebfffffe          BL       yaffsfs_SetError
002d14  ea00000b          B        |L1.11592|
                  |L1.11544|
002d18  e1a03009          MOV      r3,r9                 ;1831
002d1c  e1a02007          MOV      r2,r7                 ;1831
002d20  e1a01006          MOV      r1,r6                 ;1831
002d24  e1a00005          MOV      r0,r5                 ;1831
002d28  e58da000          STR      r10,[sp,#0]           ;1831
002d2c  ebfffffe          BL       yaffs_set_xattrib
002d30  e1a08000          MOV      r8,r0                 ;1831
002d34  e3580000          CMP      r8,#0                 ;1832
002d38  aa000002          BGE      |L1.11592|
002d3c  e1a00008          MOV      r0,r8                 ;1833
002d40  ebfffffe          BL       yaffsfs_SetError
002d44  e3e08000          MVN      r8,#0                 ;1834
                  |L1.11592|
002d48  ebfffffe          BL       yaffsfs_Unlock
002d4c  e1a00008          MOV      r0,r8                 ;1840
002d50  eaffffbb          B        |L1.11332|
;;;1843   
                          ENDP

                  yaffs_setxattr PROC
;;;1844   int yaffs_setxattr(const YCHAR *path, const char *name,
002d54  e92d41fc          PUSH     {r2-r8,lr}
;;;1845   		   const void *data, int size, int flags)
;;;1846   {
002d58  e1a04000          MOV      r4,r0
002d5c  e1a05001          MOV      r5,r1
002d60  e1a06002          MOV      r6,r2
002d64  e1a07003          MOV      r7,r3
002d68  e59d8020          LDR      r8,[sp,#0x20]
;;;1847   	return yaffs_do_setxattr(path, name, data, size, flags, 1);
002d6c  e3a00001          MOV      r0,#1
002d70  e1a03007          MOV      r3,r7
002d74  e1a02006          MOV      r2,r6
002d78  e1a01005          MOV      r1,r5
002d7c  e58d0004          STR      r0,[sp,#4]
002d80  e1a00004          MOV      r0,r4
002d84  e58d8000          STR      r8,[sp,#0]
002d88  ebfffffe          BL       yaffs_do_setxattr
;;;1848   }
002d8c  e8bd81fc          POP      {r2-r8,pc}
;;;1849   
                          ENDP

                  yaffs_lsetxattr PROC
;;;1850   int yaffs_lsetxattr(const YCHAR *path, const char *name,
002d90  e92d41fc          PUSH     {r2-r8,lr}
;;;1851   		    const void *data, int size, int flags)
;;;1852   {
002d94  e1a04000          MOV      r4,r0
002d98  e1a05001          MOV      r5,r1
002d9c  e1a06002          MOV      r6,r2
002da0  e1a07003          MOV      r7,r3
002da4  e59d8020          LDR      r8,[sp,#0x20]
;;;1853   	return yaffs_do_setxattr(path, name, data, size, flags, 0);
002da8  e3a00000          MOV      r0,#0
002dac  e1a03007          MOV      r3,r7
002db0  e1a02006          MOV      r2,r6
002db4  e1a01005          MOV      r1,r5
002db8  e58d0004          STR      r0,[sp,#4]
002dbc  e1a00004          MOV      r0,r4
002dc0  e58d8000          STR      r8,[sp,#0]
002dc4  ebfffffe          BL       yaffs_do_setxattr
;;;1854   }
002dc8  e8bd81fc          POP      {r2-r8,pc}
;;;1855   
                          ENDP

                  yaffs_fsetxattr PROC
;;;1856   int yaffs_fsetxattr(int fd, const char *name,
002dcc  e92d4ff8          PUSH     {r3-r11,lr}
;;;1857   		    const void *data, int size, int flags)
;;;1858   {
002dd0  e1a08000          MOV      r8,r0
002dd4  e1a05001          MOV      r5,r1
002dd8  e1a06002          MOV      r6,r2
002ddc  e1a09003          MOV      r9,r3
002de0  e59da028          LDR      r10,[sp,#0x28]
;;;1859   	struct yaffs_obj *obj;
;;;1860   
;;;1861   	int retVal = -1;
002de4  e3e07000          MVN      r7,#0
;;;1862   
;;;1863   	if (!name || !data) {
002de8  e3550000          CMP      r5,#0
002dec  0a000001          BEQ      |L1.11768|
002df0  e3560000          CMP      r6,#0
002df4  1a000003          BNE      |L1.11784|
                  |L1.11768|
;;;1864   		yaffsfs_SetError(-EFAULT);
002df8  e3e0000d          MVN      r0,#0xd
002dfc  ebfffffe          BL       yaffsfs_SetError
;;;1865   		return -1;
002e00  e3e00000          MVN      r0,#0
                  |L1.11780|
;;;1866   	}
;;;1867   
;;;1868   	yaffsfs_Lock();
;;;1869   	obj = yaffsfs_HandleToObject(fd);
;;;1870   
;;;1871   	if (!obj)
;;;1872   		yaffsfs_SetError(-EBADF);
;;;1873   	else {
;;;1874   		retVal = yaffs_set_xattrib(obj, name, data, size, flags);
;;;1875   		if (retVal < 0) {
;;;1876   			yaffsfs_SetError(retVal);
;;;1877   			retVal = -1;
;;;1878   		}
;;;1879   	}
;;;1880   
;;;1881   	yaffsfs_Unlock();
;;;1882   
;;;1883   	return retVal;
;;;1884   }
002e04  e8bd8ff8          POP      {r3-r11,pc}
                  |L1.11784|
002e08  ebfffffe          BL       yaffsfs_Lock
002e0c  e1a00008          MOV      r0,r8                 ;1869
002e10  ebfffffe          BL       yaffsfs_HandleToObject
002e14  e1a04000          MOV      r4,r0                 ;1869
002e18  e3540000          CMP      r4,#0                 ;1871
002e1c  1a000002          BNE      |L1.11820|
002e20  e3e00008          MVN      r0,#8                 ;1872
002e24  ebfffffe          BL       yaffsfs_SetError
002e28  ea00000b          B        |L1.11868|
                  |L1.11820|
002e2c  e1a03009          MOV      r3,r9                 ;1874
002e30  e1a02006          MOV      r2,r6                 ;1874
002e34  e1a01005          MOV      r1,r5                 ;1874
002e38  e1a00004          MOV      r0,r4                 ;1874
002e3c  e58da000          STR      r10,[sp,#0]           ;1874
002e40  ebfffffe          BL       yaffs_set_xattrib
002e44  e1a07000          MOV      r7,r0                 ;1874
002e48  e3570000          CMP      r7,#0                 ;1875
002e4c  aa000002          BGE      |L1.11868|
002e50  e1a00007          MOV      r0,r7                 ;1876
002e54  ebfffffe          BL       yaffsfs_SetError
002e58  e3e07000          MVN      r7,#0                 ;1877
                  |L1.11868|
002e5c  ebfffffe          BL       yaffsfs_Unlock
002e60  e1a00007          MOV      r0,r7                 ;1883
002e64  eaffffe6          B        |L1.11780|
;;;1885   
                          ENDP

                  yaffs_do_getxattr PROC
;;;1886   static int yaffs_do_getxattr(const YCHAR *path, const char *name,
002e68  e92d47f0          PUSH     {r4-r10,lr}
;;;1887   			     void *data, int size, int follow)
;;;1888   {
002e6c  e24dd018          SUB      sp,sp,#0x18
002e70  e1a04000          MOV      r4,r0
002e74  e1a06001          MOV      r6,r1
002e78  e1a07002          MOV      r7,r2
002e7c  e1a09003          MOV      r9,r3
002e80  e59da038          LDR      r10,[sp,#0x38]
;;;1889   	struct yaffs_obj *obj;
;;;1890   	struct yaffs_obj *dir;
;;;1891   	int retVal = -1;
002e84  e3e08000          MVN      r8,#0
;;;1892   	int notDir = 0;
002e88  e3a00000          MOV      r0,#0
002e8c  e58d0010          STR      r0,[sp,#0x10]
;;;1893   	int loop = 0;
002e90  e58d000c          STR      r0,[sp,#0xc]
;;;1894   
;;;1895   	if (!path || !name || !data) {
002e94  e3540000          CMP      r4,#0
002e98  0a000003          BEQ      |L1.11948|
002e9c  e3560000          CMP      r6,#0
002ea0  0a000001          BEQ      |L1.11948|
002ea4  e3570000          CMP      r7,#0
002ea8  1a000004          BNE      |L1.11968|
                  |L1.11948|
;;;1896   		yaffsfs_SetError(-EFAULT);
002eac  e3e0000d          MVN      r0,#0xd
002eb0  ebfffffe          BL       yaffsfs_SetError
;;;1897   		return -1;
002eb4  e3e00000          MVN      r0,#0
                  |L1.11960|
002eb8  e28dd018          ADD      sp,sp,#0x18
;;;1898   	}
;;;1899   
;;;1900   	if (yaffsfs_CheckPath(path) < 0) {
;;;1901   		yaffsfs_SetError(-ENAMETOOLONG);
;;;1902   		return -1;
;;;1903   	}
;;;1904   
;;;1905   	yaffsfs_Lock();
;;;1906   
;;;1907   	obj = yaffsfs_FindObject(NULL, path, 0, 1, &dir, &notDir, &loop);
;;;1908   
;;;1909   	if (follow)
;;;1910   		obj = yaffsfs_FollowLink(obj, 0, &loop);
;;;1911   
;;;1912   	if (!dir && notDir)
;;;1913   		yaffsfs_SetError(-ENOTDIR);
;;;1914   	else if (loop)
;;;1915   		yaffsfs_SetError(-ELOOP);
;;;1916   	else if (!dir || !obj)
;;;1917   		yaffsfs_SetError(-ENOENT);
;;;1918   	else {
;;;1919   		retVal = yaffs_get_xattrib(obj, name, data, size);
;;;1920   		if (retVal < 0) {
;;;1921   			yaffsfs_SetError(retVal);
;;;1922   			retVal = -1;
;;;1923   		}
;;;1924   	}
;;;1925   	yaffsfs_Unlock();
;;;1926   
;;;1927   	return retVal;
;;;1928   
;;;1929   }
002ebc  e8bd87f0          POP      {r4-r10,pc}
                  |L1.11968|
002ec0  e1a00004          MOV      r0,r4                 ;1900
002ec4  ebfffffe          BL       yaffsfs_CheckPath
002ec8  e3500000          CMP      r0,#0                 ;1900
002ecc  aa000003          BGE      |L1.12000|
002ed0  e3e00023          MVN      r0,#0x23              ;1901
002ed4  ebfffffe          BL       yaffsfs_SetError
002ed8  e3e00000          MVN      r0,#0                 ;1902
002edc  eafffff5          B        |L1.11960|
                  |L1.12000|
002ee0  ebfffffe          BL       yaffsfs_Lock
002ee4  e28d000c          ADD      r0,sp,#0xc            ;1907
002ee8  e28d1010          ADD      r1,sp,#0x10           ;1907
002eec  e28d2014          ADD      r2,sp,#0x14           ;1907
002ef0  e3a03001          MOV      r3,#1                 ;1907
002ef4  e58d2000          STR      r2,[sp,#0]            ;1907
002ef8  e3a02000          MOV      r2,#0                 ;1907
002efc  e58d1004          STR      r1,[sp,#4]            ;1907
002f00  e1a01004          MOV      r1,r4                 ;1907
002f04  e58d0008          STR      r0,[sp,#8]            ;1907
002f08  e1a00002          MOV      r0,r2                 ;1907
002f0c  ebfffffe          BL       yaffsfs_FindObject
002f10  e1a05000          MOV      r5,r0                 ;1907
002f14  e35a0000          CMP      r10,#0                ;1909
002f18  0a000004          BEQ      |L1.12080|
002f1c  e28d200c          ADD      r2,sp,#0xc            ;1910
002f20  e3a01000          MOV      r1,#0                 ;1910
002f24  e1a00005          MOV      r0,r5                 ;1910
002f28  ebfffffe          BL       yaffsfs_FollowLink
002f2c  e1a05000          MOV      r5,r0                 ;1910
                  |L1.12080|
002f30  e59d0014          LDR      r0,[sp,#0x14]         ;1912
002f34  e3500000          CMP      r0,#0                 ;1912
002f38  1a000005          BNE      |L1.12116|
002f3c  e59d0010          LDR      r0,[sp,#0x10]         ;1912
002f40  e3500000          CMP      r0,#0                 ;1912
002f44  0a000002          BEQ      |L1.12116|
002f48  e3e00013          MVN      r0,#0x13              ;1913
002f4c  ebfffffe          BL       yaffsfs_SetError
002f50  ea000018          B        |L1.12216|
                  |L1.12116|
002f54  e59d000c          LDR      r0,[sp,#0xc]          ;1914
002f58  e3500000          CMP      r0,#0                 ;1914
002f5c  0a000002          BEQ      |L1.12140|
002f60  e3e00027          MVN      r0,#0x27              ;1915
002f64  ebfffffe          BL       yaffsfs_SetError
002f68  ea000012          B        |L1.12216|
                  |L1.12140|
002f6c  e59d0014          LDR      r0,[sp,#0x14]         ;1916
002f70  e3500000          CMP      r0,#0                 ;1916
002f74  0a000001          BEQ      |L1.12160|
002f78  e3550000          CMP      r5,#0                 ;1916
002f7c  1a000002          BNE      |L1.12172|
                  |L1.12160|
002f80  e3e00001          MVN      r0,#1                 ;1917
002f84  ebfffffe          BL       yaffsfs_SetError
002f88  ea00000a          B        |L1.12216|
                  |L1.12172|
002f8c  e1a03009          MOV      r3,r9                 ;1919
002f90  e1a02007          MOV      r2,r7                 ;1919
002f94  e1a01006          MOV      r1,r6                 ;1919
002f98  e1a00005          MOV      r0,r5                 ;1919
002f9c  ebfffffe          BL       yaffs_get_xattrib
002fa0  e1a08000          MOV      r8,r0                 ;1919
002fa4  e3580000          CMP      r8,#0                 ;1920
002fa8  aa000002          BGE      |L1.12216|
002fac  e1a00008          MOV      r0,r8                 ;1921
002fb0  ebfffffe          BL       yaffsfs_SetError
002fb4  e3e08000          MVN      r8,#0                 ;1922
                  |L1.12216|
002fb8  ebfffffe          BL       yaffsfs_Unlock
002fbc  e1a00008          MOV      r0,r8                 ;1927
002fc0  eaffffbc          B        |L1.11960|
;;;1930   
                          ENDP

                  yaffs_getxattr PROC
;;;1931   int yaffs_getxattr(const YCHAR *path, const char *name, void *data, int size)
002fc4  e92d40f8          PUSH     {r3-r7,lr}
;;;1932   {
002fc8  e1a04000          MOV      r4,r0
002fcc  e1a05001          MOV      r5,r1
002fd0  e1a06002          MOV      r6,r2
002fd4  e1a07003          MOV      r7,r3
;;;1933   	return yaffs_do_getxattr(path, name, data, size, 1);
002fd8  e3a00001          MOV      r0,#1
002fdc  e1a03007          MOV      r3,r7
002fe0  e1a02006          MOV      r2,r6
002fe4  e1a01005          MOV      r1,r5
002fe8  e58d0000          STR      r0,[sp,#0]
002fec  e1a00004          MOV      r0,r4
002ff0  ebfffffe          BL       yaffs_do_getxattr
;;;1934   }
002ff4  e8bd80f8          POP      {r3-r7,pc}
;;;1935   
                          ENDP

                  yaffs_lgetxattr PROC
;;;1936   int yaffs_lgetxattr(const YCHAR *path, const char *name, void *data, int size)
002ff8  e92d40f8          PUSH     {r3-r7,lr}
;;;1937   {
002ffc  e1a04000          MOV      r4,r0
003000  e1a05001          MOV      r5,r1
003004  e1a06002          MOV      r6,r2
003008  e1a07003          MOV      r7,r3
;;;1938   	return yaffs_do_getxattr(path, name, data, size, 0);
00300c  e3a00000          MOV      r0,#0
003010  e1a03007          MOV      r3,r7
003014  e1a02006          MOV      r2,r6
003018  e1a01005          MOV      r1,r5
00301c  e58d0000          STR      r0,[sp,#0]
003020  e1a00004          MOV      r0,r4
003024  ebfffffe          BL       yaffs_do_getxattr
;;;1939   }
003028  e8bd80f8          POP      {r3-r7,pc}
;;;1940   
                          ENDP

                  yaffs_fgetxattr PROC
;;;1941   int yaffs_fgetxattr(int fd, const char *name, void *data, int size)
00302c  e92d47f0          PUSH     {r4-r10,lr}
;;;1942   {
003030  e1a08000          MOV      r8,r0
003034  e1a05001          MOV      r5,r1
003038  e1a06002          MOV      r6,r2
00303c  e1a09003          MOV      r9,r3
;;;1943   	struct yaffs_obj *obj;
;;;1944   
;;;1945   	int retVal = -1;
003040  e3e07000          MVN      r7,#0
;;;1946   
;;;1947   	if (!name || !data) {
003044  e3550000          CMP      r5,#0
003048  0a000001          BEQ      |L1.12372|
00304c  e3560000          CMP      r6,#0
003050  1a000003          BNE      |L1.12388|
                  |L1.12372|
;;;1948   		yaffsfs_SetError(-EFAULT);
003054  e3e0000d          MVN      r0,#0xd
003058  ebfffffe          BL       yaffsfs_SetError
;;;1949   		return -1;
00305c  e3e00000          MVN      r0,#0
                  |L1.12384|
;;;1950   	}
;;;1951   
;;;1952   	yaffsfs_Lock();
;;;1953   	obj = yaffsfs_HandleToObject(fd);
;;;1954   
;;;1955   	if (obj) {
;;;1956   		retVal = yaffs_get_xattrib(obj, name, data, size);
;;;1957   		if (retVal < 0) {
;;;1958   			yaffsfs_SetError(retVal);
;;;1959   			retVal = -1;
;;;1960   		}
;;;1961   	} else
;;;1962   		/* bad handle */
;;;1963   		yaffsfs_SetError(-EBADF);
;;;1964   
;;;1965   	yaffsfs_Unlock();
;;;1966   
;;;1967   	return retVal;
;;;1968   }
003060  e8bd87f0          POP      {r4-r10,pc}
                  |L1.12388|
003064  ebfffffe          BL       yaffsfs_Lock
003068  e1a00008          MOV      r0,r8                 ;1953
00306c  ebfffffe          BL       yaffsfs_HandleToObject
003070  e1a04000          MOV      r4,r0                 ;1953
003074  e3540000          CMP      r4,#0                 ;1955
003078  0a00000b          BEQ      |L1.12460|
00307c  e1a03009          MOV      r3,r9                 ;1956
003080  e1a02006          MOV      r2,r6                 ;1956
003084  e1a01005          MOV      r1,r5                 ;1956
003088  e1a00004          MOV      r0,r4                 ;1956
00308c  ebfffffe          BL       yaffs_get_xattrib
003090  e1a07000          MOV      r7,r0                 ;1956
003094  e3570000          CMP      r7,#0                 ;1957
003098  aa000005          BGE      |L1.12468|
00309c  e1a00007          MOV      r0,r7                 ;1958
0030a0  ebfffffe          BL       yaffsfs_SetError
0030a4  e3e07000          MVN      r7,#0                 ;1959
0030a8  ea000001          B        |L1.12468|
                  |L1.12460|
0030ac  e3e00008          MVN      r0,#8                 ;1963
0030b0  ebfffffe          BL       yaffsfs_SetError
                  |L1.12468|
0030b4  ebfffffe          BL       yaffsfs_Unlock
0030b8  e1a00007          MOV      r0,r7                 ;1967
0030bc  eaffffe7          B        |L1.12384|
;;;1969   
                          ENDP

                  yaffs_do_listxattr PROC
;;;1970   static int yaffs_do_listxattr(const YCHAR *path, char *data,
0030c0  e92d43f0          PUSH     {r4-r9,lr}
;;;1971   			      int size, int follow)
;;;1972   {
0030c4  e24dd01c          SUB      sp,sp,#0x1c
0030c8  e1a04000          MOV      r4,r0
0030cc  e1a05001          MOV      r5,r1
0030d0  e1a09002          MOV      r9,r2
0030d4  e1a06003          MOV      r6,r3
;;;1973   	struct yaffs_obj *obj = NULL;
0030d8  e3a07000          MOV      r7,#0
;;;1974   	struct yaffs_obj *dir = NULL;
0030dc  e3a00000          MOV      r0,#0
0030e0  e58d0018          STR      r0,[sp,#0x18]
;;;1975   	int retVal = -1;
0030e4  e3e08000          MVN      r8,#0
;;;1976   	int notDir = 0;
0030e8  e58d0014          STR      r0,[sp,#0x14]
;;;1977   	int loop = 0;
0030ec  e58d0010          STR      r0,[sp,#0x10]
;;;1978   
;;;1979   	if (!path || !data) {
0030f0  e3540000          CMP      r4,#0
0030f4  0a000001          BEQ      |L1.12544|
0030f8  e3550000          CMP      r5,#0
0030fc  1a000004          BNE      |L1.12564|
                  |L1.12544|
;;;1980   		yaffsfs_SetError(-EFAULT);
003100  e3e0000d          MVN      r0,#0xd
003104  ebfffffe          BL       yaffsfs_SetError
;;;1981   		return -1;
003108  e3e00000          MVN      r0,#0
                  |L1.12556|
00310c  e28dd01c          ADD      sp,sp,#0x1c
;;;1982   	}
;;;1983   
;;;1984   	if (yaffsfs_CheckPath(path) < 0) {
;;;1985   		yaffsfs_SetError(-ENAMETOOLONG);
;;;1986   		return -1;
;;;1987   	}
;;;1988   
;;;1989   	yaffsfs_Lock();
;;;1990   
;;;1991   	obj = yaffsfs_FindObject(NULL, path, 0, 1, &dir, &notDir, &loop);
;;;1992   
;;;1993   	if (follow)
;;;1994   		obj = yaffsfs_FollowLink(obj, 0, &loop);
;;;1995   
;;;1996   	if (!dir && notDir)
;;;1997   		yaffsfs_SetError(-ENOTDIR);
;;;1998   	else if (loop)
;;;1999   		yaffsfs_SetError(-ELOOP);
;;;2000   	else if (!dir || !obj)
;;;2001   		yaffsfs_SetError(-ENOENT);
;;;2002   	else {
;;;2003   		retVal = yaffs_list_xattrib(obj, data, size);
;;;2004   		if (retVal < 0) {
;;;2005   			yaffsfs_SetError(retVal);
;;;2006   			retVal = -1;
;;;2007   		}
;;;2008   	}
;;;2009   
;;;2010   	yaffsfs_Unlock();
;;;2011   
;;;2012   	return retVal;
;;;2013   
;;;2014   }
003110  e8bd83f0          POP      {r4-r9,pc}
                  |L1.12564|
003114  e1a00004          MOV      r0,r4                 ;1984
003118  ebfffffe          BL       yaffsfs_CheckPath
00311c  e3500000          CMP      r0,#0                 ;1984
003120  aa000003          BGE      |L1.12596|
003124  e3e00023          MVN      r0,#0x23              ;1985
003128  ebfffffe          BL       yaffsfs_SetError
00312c  e3e00000          MVN      r0,#0                 ;1986
003130  eafffff5          B        |L1.12556|
                  |L1.12596|
003134  ebfffffe          BL       yaffsfs_Lock
003138  e28d0010          ADD      r0,sp,#0x10           ;1991
00313c  e28d1014          ADD      r1,sp,#0x14           ;1991
003140  e28d2018          ADD      r2,sp,#0x18           ;1991
003144  e3a03001          MOV      r3,#1                 ;1991
003148  e58d2000          STR      r2,[sp,#0]            ;1991
00314c  e3a02000          MOV      r2,#0                 ;1991
003150  e58d1004          STR      r1,[sp,#4]            ;1991
003154  e1a01004          MOV      r1,r4                 ;1991
003158  e58d0008          STR      r0,[sp,#8]            ;1991
00315c  e1a00002          MOV      r0,r2                 ;1991
003160  ebfffffe          BL       yaffsfs_FindObject
003164  e1a07000          MOV      r7,r0                 ;1991
003168  e3560000          CMP      r6,#0                 ;1993
00316c  0a000004          BEQ      |L1.12676|
003170  e28d2010          ADD      r2,sp,#0x10           ;1994
003174  e3a01000          MOV      r1,#0                 ;1994
003178  e1a00007          MOV      r0,r7                 ;1994
00317c  ebfffffe          BL       yaffsfs_FollowLink
003180  e1a07000          MOV      r7,r0                 ;1994
                  |L1.12676|
003184  e59d0018          LDR      r0,[sp,#0x18]         ;1996
003188  e3500000          CMP      r0,#0                 ;1996
00318c  1a000005          BNE      |L1.12712|
003190  e59d0014          LDR      r0,[sp,#0x14]         ;1996
003194  e3500000          CMP      r0,#0                 ;1996
003198  0a000002          BEQ      |L1.12712|
00319c  e3e00013          MVN      r0,#0x13              ;1997
0031a0  ebfffffe          BL       yaffsfs_SetError
0031a4  ea000017          B        |L1.12808|
                  |L1.12712|
0031a8  e59d0010          LDR      r0,[sp,#0x10]         ;1998
0031ac  e3500000          CMP      r0,#0                 ;1998
0031b0  0a000002          BEQ      |L1.12736|
0031b4  e3e00027          MVN      r0,#0x27              ;1999
0031b8  ebfffffe          BL       yaffsfs_SetError
0031bc  ea000011          B        |L1.12808|
                  |L1.12736|
0031c0  e59d0018          LDR      r0,[sp,#0x18]         ;2000
0031c4  e3500000          CMP      r0,#0                 ;2000
0031c8  0a000001          BEQ      |L1.12756|
0031cc  e3570000          CMP      r7,#0                 ;2000
0031d0  1a000002          BNE      |L1.12768|
                  |L1.12756|
0031d4  e3e00001          MVN      r0,#1                 ;2001
0031d8  ebfffffe          BL       yaffsfs_SetError
0031dc  ea000009          B        |L1.12808|
                  |L1.12768|
0031e0  e1a02009          MOV      r2,r9                 ;2003
0031e4  e1a01005          MOV      r1,r5                 ;2003
0031e8  e1a00007          MOV      r0,r7                 ;2003
0031ec  ebfffffe          BL       yaffs_list_xattrib
0031f0  e1a08000          MOV      r8,r0                 ;2003
0031f4  e3580000          CMP      r8,#0                 ;2004
0031f8  aa000002          BGE      |L1.12808|
0031fc  e1a00008          MOV      r0,r8                 ;2005
003200  ebfffffe          BL       yaffsfs_SetError
003204  e3e08000          MVN      r8,#0                 ;2006
                  |L1.12808|
003208  ebfffffe          BL       yaffsfs_Unlock
00320c  e1a00008          MOV      r0,r8                 ;2012
003210  eaffffbd          B        |L1.12556|
;;;2015   
                          ENDP

                  yaffs_listxattr PROC
;;;2016   int yaffs_listxattr(const YCHAR *path, char *data, int size)
003214  e92d4070          PUSH     {r4-r6,lr}
;;;2017   {
003218  e1a04000          MOV      r4,r0
00321c  e1a05001          MOV      r5,r1
003220  e1a06002          MOV      r6,r2
;;;2018   	return yaffs_do_listxattr(path, data, size, 1);
003224  e3a03001          MOV      r3,#1
003228  e1a02006          MOV      r2,r6
00322c  e1a01005          MOV      r1,r5
003230  e1a00004          MOV      r0,r4
003234  ebfffffe          BL       yaffs_do_listxattr
;;;2019   }
003238  e8bd8070          POP      {r4-r6,pc}
;;;2020   
                          ENDP

                  yaffs_llistxattr PROC
;;;2021   int yaffs_llistxattr(const YCHAR *path, char *data, int size)
00323c  e92d4070          PUSH     {r4-r6,lr}
;;;2022   {
003240  e1a04000          MOV      r4,r0
003244  e1a05001          MOV      r5,r1
003248  e1a06002          MOV      r6,r2
;;;2023   	return yaffs_do_listxattr(path, data, size, 0);
00324c  e3a03000          MOV      r3,#0
003250  e1a02006          MOV      r2,r6
003254  e1a01005          MOV      r1,r5
003258  e1a00004          MOV      r0,r4
00325c  ebfffffe          BL       yaffs_do_listxattr
;;;2024   }
003260  e8bd8070          POP      {r4-r6,pc}
;;;2025   
                          ENDP

                  yaffs_flistxattr PROC
;;;2026   int yaffs_flistxattr(int fd, char *data, int size)
003264  e92d41f0          PUSH     {r4-r8,lr}
;;;2027   {
003268  e1a07000          MOV      r7,r0
00326c  e1a05001          MOV      r5,r1
003270  e1a08002          MOV      r8,r2
;;;2028   	struct yaffs_obj *obj;
;;;2029   
;;;2030   	int retVal = -1;
003274  e3e06000          MVN      r6,#0
;;;2031   
;;;2032   	if (!data) {
003278  e3550000          CMP      r5,#0
00327c  1a000003          BNE      |L1.12944|
;;;2033   		yaffsfs_SetError(-EFAULT);
003280  e3e0000d          MVN      r0,#0xd
003284  ebfffffe          BL       yaffsfs_SetError
;;;2034   		return -1;
003288  e3e00000          MVN      r0,#0
                  |L1.12940|
;;;2035   	}
;;;2036   
;;;2037   	yaffsfs_Lock();
;;;2038   	obj = yaffsfs_HandleToObject(fd);
;;;2039   
;;;2040   	if (obj) {
;;;2041   		retVal = yaffs_list_xattrib(obj, data, size);
;;;2042   		if (retVal < 0) {
;;;2043   			yaffsfs_SetError(retVal);
;;;2044   			retVal = -1;
;;;2045   		}
;;;2046   	} else
;;;2047   		/* bad handle */
;;;2048   		yaffsfs_SetError(-EBADF);
;;;2049   
;;;2050   	yaffsfs_Unlock();
;;;2051   
;;;2052   	return retVal;
;;;2053   }
00328c  e8bd81f0          POP      {r4-r8,pc}
                  |L1.12944|
003290  ebfffffe          BL       yaffsfs_Lock
003294  e1a00007          MOV      r0,r7                 ;2038
003298  ebfffffe          BL       yaffsfs_HandleToObject
00329c  e1a04000          MOV      r4,r0                 ;2038
0032a0  e3540000          CMP      r4,#0                 ;2040
0032a4  0a00000a          BEQ      |L1.13012|
0032a8  e1a02008          MOV      r2,r8                 ;2041
0032ac  e1a01005          MOV      r1,r5                 ;2041
0032b0  e1a00004          MOV      r0,r4                 ;2041
0032b4  ebfffffe          BL       yaffs_list_xattrib
0032b8  e1a06000          MOV      r6,r0                 ;2041
0032bc  e3560000          CMP      r6,#0                 ;2042
0032c0  aa000005          BGE      |L1.13020|
0032c4  e1a00006          MOV      r0,r6                 ;2043
0032c8  ebfffffe          BL       yaffsfs_SetError
0032cc  e3e06000          MVN      r6,#0                 ;2044
0032d0  ea000001          B        |L1.13020|
                  |L1.13012|
0032d4  e3e00008          MVN      r0,#8                 ;2048
0032d8  ebfffffe          BL       yaffsfs_SetError
                  |L1.13020|
0032dc  ebfffffe          BL       yaffsfs_Unlock
0032e0  e1a00006          MOV      r0,r6                 ;2052
0032e4  eaffffe8          B        |L1.12940|
;;;2054   
                          ENDP

                  yaffs_do_removexattr PROC
;;;2055   static int yaffs_do_removexattr(const YCHAR *path, const char *name,
0032e8  e92d41f0          PUSH     {r4-r8,lr}
;;;2056   				int follow)
;;;2057   {
0032ec  e24dd018          SUB      sp,sp,#0x18
0032f0  e1a04000          MOV      r4,r0
0032f4  e1a05001          MOV      r5,r1
0032f8  e1a06002          MOV      r6,r2
;;;2058   	struct yaffs_obj *obj = NULL;
0032fc  e3a07000          MOV      r7,#0
;;;2059   	struct yaffs_obj *dir = NULL;
003300  e3a00000          MOV      r0,#0
003304  e58d0014          STR      r0,[sp,#0x14]
;;;2060   	int notDir = 0;
003308  e58d0010          STR      r0,[sp,#0x10]
;;;2061   	int loop = 0;
00330c  e58d000c          STR      r0,[sp,#0xc]
;;;2062   	int retVal = -1;
003310  e3e08000          MVN      r8,#0
;;;2063   
;;;2064   	if (!path || !name) {
003314  e3540000          CMP      r4,#0
003318  0a000001          BEQ      |L1.13092|
00331c  e3550000          CMP      r5,#0
003320  1a000004          BNE      |L1.13112|
                  |L1.13092|
;;;2065   		yaffsfs_SetError(-EFAULT);
003324  e3e0000d          MVN      r0,#0xd
003328  ebfffffe          BL       yaffsfs_SetError
;;;2066   		return -1;
00332c  e3e00000          MVN      r0,#0
                  |L1.13104|
003330  e28dd018          ADD      sp,sp,#0x18
;;;2067   	}
;;;2068   
;;;2069   	if (yaffsfs_CheckPath(path) < 0) {
;;;2070   		yaffsfs_SetError(-ENAMETOOLONG);
;;;2071   		return -1;
;;;2072   	}
;;;2073   
;;;2074   	yaffsfs_Lock();
;;;2075   
;;;2076   	obj = yaffsfs_FindObject(NULL, path, 0, 1, &dir, &notDir, &loop);
;;;2077   
;;;2078   	if (follow)
;;;2079   		obj = yaffsfs_FollowLink(obj, 0, &loop);
;;;2080   
;;;2081   	if (!dir && notDir)
;;;2082   		yaffsfs_SetError(-ENOTDIR);
;;;2083   	else if (loop)
;;;2084   		yaffsfs_SetError(-ELOOP);
;;;2085   	else if (!dir || !obj)
;;;2086   		yaffsfs_SetError(-ENOENT);
;;;2087   	else {
;;;2088   		retVal = yaffs_remove_xattrib(obj, name);
;;;2089   		if (retVal < 0) {
;;;2090   			yaffsfs_SetError(retVal);
;;;2091   			retVal = -1;
;;;2092   		}
;;;2093   	}
;;;2094   
;;;2095   	yaffsfs_Unlock();
;;;2096   
;;;2097   	return retVal;
;;;2098   
;;;2099   }
003334  e8bd81f0          POP      {r4-r8,pc}
                  |L1.13112|
003338  e1a00004          MOV      r0,r4                 ;2069
00333c  ebfffffe          BL       yaffsfs_CheckPath
003340  e3500000          CMP      r0,#0                 ;2069
003344  aa000003          BGE      |L1.13144|
003348  e3e00023          MVN      r0,#0x23              ;2070
00334c  ebfffffe          BL       yaffsfs_SetError
003350  e3e00000          MVN      r0,#0                 ;2071
003354  eafffff5          B        |L1.13104|
                  |L1.13144|
003358  ebfffffe          BL       yaffsfs_Lock
00335c  e28d000c          ADD      r0,sp,#0xc            ;2076
003360  e28d1010          ADD      r1,sp,#0x10           ;2076
003364  e28d2014          ADD      r2,sp,#0x14           ;2076
003368  e3a03001          MOV      r3,#1                 ;2076
00336c  e58d2000          STR      r2,[sp,#0]            ;2076
003370  e3a02000          MOV      r2,#0                 ;2076
003374  e58d1004          STR      r1,[sp,#4]            ;2076
003378  e1a01004          MOV      r1,r4                 ;2076
00337c  e58d0008          STR      r0,[sp,#8]            ;2076
003380  e1a00002          MOV      r0,r2                 ;2076
003384  ebfffffe          BL       yaffsfs_FindObject
003388  e1a07000          MOV      r7,r0                 ;2076
00338c  e3560000          CMP      r6,#0                 ;2078
003390  0a000004          BEQ      |L1.13224|
003394  e28d200c          ADD      r2,sp,#0xc            ;2079
003398  e3a01000          MOV      r1,#0                 ;2079
00339c  e1a00007          MOV      r0,r7                 ;2079
0033a0  ebfffffe          BL       yaffsfs_FollowLink
0033a4  e1a07000          MOV      r7,r0                 ;2079
                  |L1.13224|
0033a8  e59d0014          LDR      r0,[sp,#0x14]         ;2081
0033ac  e3500000          CMP      r0,#0                 ;2081
0033b0  1a000005          BNE      |L1.13260|
0033b4  e59d0010          LDR      r0,[sp,#0x10]         ;2081
0033b8  e3500000          CMP      r0,#0                 ;2081
0033bc  0a000002          BEQ      |L1.13260|
0033c0  e3e00013          MVN      r0,#0x13              ;2082
0033c4  ebfffffe          BL       yaffsfs_SetError
0033c8  ea000016          B        |L1.13352|
                  |L1.13260|
0033cc  e59d000c          LDR      r0,[sp,#0xc]          ;2083
0033d0  e3500000          CMP      r0,#0                 ;2083
0033d4  0a000002          BEQ      |L1.13284|
0033d8  e3e00027          MVN      r0,#0x27              ;2084
0033dc  ebfffffe          BL       yaffsfs_SetError
0033e0  ea000010          B        |L1.13352|
                  |L1.13284|
0033e4  e59d0014          LDR      r0,[sp,#0x14]         ;2085
0033e8  e3500000          CMP      r0,#0                 ;2085
0033ec  0a000001          BEQ      |L1.13304|
0033f0  e3570000          CMP      r7,#0                 ;2085
0033f4  1a000002          BNE      |L1.13316|
                  |L1.13304|
0033f8  e3e00001          MVN      r0,#1                 ;2086
0033fc  ebfffffe          BL       yaffsfs_SetError
003400  ea000008          B        |L1.13352|
                  |L1.13316|
003404  e1a01005          MOV      r1,r5                 ;2088
003408  e1a00007          MOV      r0,r7                 ;2088
00340c  ebfffffe          BL       yaffs_remove_xattrib
003410  e1a08000          MOV      r8,r0                 ;2088
003414  e3580000          CMP      r8,#0                 ;2089
003418  aa000002          BGE      |L1.13352|
00341c  e1a00008          MOV      r0,r8                 ;2090
003420  ebfffffe          BL       yaffsfs_SetError
003424  e3e08000          MVN      r8,#0                 ;2091
                  |L1.13352|
003428  ebfffffe          BL       yaffsfs_Unlock
00342c  e1a00008          MOV      r0,r8                 ;2097
003430  eaffffbe          B        |L1.13104|
;;;2100   
                          ENDP

                  yaffs_removexattr PROC
;;;2101   int yaffs_removexattr(const YCHAR *path, const char *name)
003434  e92d4070          PUSH     {r4-r6,lr}
;;;2102   {
003438  e1a04000          MOV      r4,r0
00343c  e1a05001          MOV      r5,r1
;;;2103   	return yaffs_do_removexattr(path, name, 1);
003440  e3a02001          MOV      r2,#1
003444  e1a01005          MOV      r1,r5
003448  e1a00004          MOV      r0,r4
00344c  ebfffffe          BL       yaffs_do_removexattr
;;;2104   }
003450  e8bd8070          POP      {r4-r6,pc}
;;;2105   
                          ENDP

                  yaffs_lremovexattr PROC
;;;2106   int yaffs_lremovexattr(const YCHAR *path, const char *name)
003454  e92d4070          PUSH     {r4-r6,lr}
;;;2107   {
003458  e1a04000          MOV      r4,r0
00345c  e1a05001          MOV      r5,r1
;;;2108   	return yaffs_do_removexattr(path, name, 0);
003460  e3a02000          MOV      r2,#0
003464  e1a01005          MOV      r1,r5
003468  e1a00004          MOV      r0,r4
00346c  ebfffffe          BL       yaffs_do_removexattr
;;;2109   }
003470  e8bd8070          POP      {r4-r6,pc}
;;;2110   
                          ENDP

                  yaffs_fremovexattr PROC
;;;2111   int yaffs_fremovexattr(int fd, const char *name)
003474  e92d41f0          PUSH     {r4-r8,lr}
;;;2112   {
003478  e1a07000          MOV      r7,r0
00347c  e1a05001          MOV      r5,r1
;;;2113   	struct yaffs_obj *obj;
;;;2114   
;;;2115   	int retVal = -1;
003480  e3e06000          MVN      r6,#0
;;;2116   
;;;2117   	if (!name) {
003484  e3550000          CMP      r5,#0
003488  1a000003          BNE      |L1.13468|
;;;2118   		yaffsfs_SetError(-EFAULT);
00348c  e3e0000d          MVN      r0,#0xd
003490  ebfffffe          BL       yaffsfs_SetError
;;;2119   		return -1;
003494  e3e00000          MVN      r0,#0
                  |L1.13464|
;;;2120   	}
;;;2121   
;;;2122   	yaffsfs_Lock();
;;;2123   	obj = yaffsfs_HandleToObject(fd);
;;;2124   
;;;2125   	if (obj) {
;;;2126   		retVal = yaffs_remove_xattrib(obj, name);
;;;2127   		if (retVal < 0) {
;;;2128   			yaffsfs_SetError(retVal);
;;;2129   			retVal = -1;
;;;2130   		}
;;;2131   	} else
;;;2132   		/* bad handle */
;;;2133   		yaffsfs_SetError(-EBADF);
;;;2134   
;;;2135   	yaffsfs_Unlock();
;;;2136   
;;;2137   	return retVal;
;;;2138   }
003498  e8bd81f0          POP      {r4-r8,pc}
                  |L1.13468|
00349c  ebfffffe          BL       yaffsfs_Lock
0034a0  e1a00007          MOV      r0,r7                 ;2123
0034a4  ebfffffe          BL       yaffsfs_HandleToObject
0034a8  e1a04000          MOV      r4,r0                 ;2123
0034ac  e3540000          CMP      r4,#0                 ;2125
0034b0  0a000009          BEQ      |L1.13532|
0034b4  e1a01005          MOV      r1,r5                 ;2126
0034b8  e1a00004          MOV      r0,r4                 ;2126
0034bc  ebfffffe          BL       yaffs_remove_xattrib
0034c0  e1a06000          MOV      r6,r0                 ;2126
0034c4  e3560000          CMP      r6,#0                 ;2127
0034c8  aa000005          BGE      |L1.13540|
0034cc  e1a00006          MOV      r0,r6                 ;2128
0034d0  ebfffffe          BL       yaffsfs_SetError
0034d4  e3e06000          MVN      r6,#0                 ;2129
0034d8  ea000001          B        |L1.13540|
                  |L1.13532|
0034dc  e3e00008          MVN      r0,#8                 ;2133
0034e0  ebfffffe          BL       yaffsfs_SetError
                  |L1.13540|
0034e4  ebfffffe          BL       yaffsfs_Unlock
0034e8  e1a00006          MOV      r0,r6                 ;2137
0034ec  eaffffe9          B        |L1.13464|
;;;2139   #endif
                          ENDP

                  yaffsfs_DoChMod PROC
;;;2216   
;;;2217   static int yaffsfs_DoChMod(struct yaffs_obj *obj, mode_t mode)
0034f0  e92d4070          PUSH     {r4-r6,lr}
;;;2218   {
0034f4  e1a04000          MOV      r4,r0
0034f8  e1a05001          MOV      r5,r1
;;;2219   	int result = -1;
0034fc  e3e06000          MVN      r6,#0
;;;2220   
;;;2221   	if (obj)
003500  e3540000          CMP      r4,#0
003504  0a000002          BEQ      |L1.13588|
;;;2222   		obj = yaffs_get_equivalent_obj(obj);
003508  e1a00004          MOV      r0,r4
00350c  ebfffffe          BL       yaffs_get_equivalent_obj
003510  e1a04000          MOV      r4,r0
                  |L1.13588|
;;;2223   
;;;2224   	if (obj) {
003514  e3540000          CMP      r4,#0
003518  0a000008          BEQ      |L1.13632|
;;;2225   		obj->yst_mode = mode;
00351c  e5845034          STR      r5,[r4,#0x34]
;;;2226   		obj->dirty = 1;
003520  e5d40000          LDRB     r0,[r4,#0]
003524  e3800040          ORR      r0,r0,#0x40
003528  e5c40000          STRB     r0,[r4,#0]
;;;2227   		result = yaffs_flush_file(obj, 0, 0);
00352c  e3a02000          MOV      r2,#0
003530  e1a01002          MOV      r1,r2
003534  e1a00004          MOV      r0,r4
003538  ebfffffe          BL       yaffs_flush_file
00353c  e1a06000          MOV      r6,r0
                  |L1.13632|
;;;2228   	}
;;;2229   
;;;2230   	return result == YAFFS_OK ? 0 : -1;
003540  e3560001          CMP      r6,#1
003544  1a000001          BNE      |L1.13648|
003548  e3a00000          MOV      r0,#0
                  |L1.13644|
;;;2231   }
00354c  e8bd8070          POP      {r4-r6,pc}
                  |L1.13648|
003550  e3e00000          MVN      r0,#0                 ;2230
003554  eafffffc          B        |L1.13644|
;;;2232   
                          ENDP

                  yaffs_access PROC
;;;2233   int yaffs_access(const YCHAR *path, int amode)
003558  e92d41f0          PUSH     {r4-r8,lr}
;;;2234   {
00355c  e24dd018          SUB      sp,sp,#0x18
003560  e1a06000          MOV      r6,r0
003564  e1a04001          MOV      r4,r1
;;;2235   	struct yaffs_obj *obj = NULL;
003568  e3a05000          MOV      r5,#0
;;;2236   	struct yaffs_obj *dir = NULL;
00356c  e3a00000          MOV      r0,#0
003570  e58d0014          STR      r0,[sp,#0x14]
;;;2237   	int notDir = 0;
003574  e58d0010          STR      r0,[sp,#0x10]
;;;2238   	int loop = 0;
003578  e58d000c          STR      r0,[sp,#0xc]
;;;2239   	int retval = -1;
00357c  e3e07000          MVN      r7,#0
;;;2240   
;;;2241   	if (!path) {
003580  e3560000          CMP      r6,#0
003584  1a000004          BNE      |L1.13724|
;;;2242   		yaffsfs_SetError(-EFAULT);
003588  e3e0000d          MVN      r0,#0xd
00358c  ebfffffe          BL       yaffsfs_SetError
;;;2243   		return -1;
003590  e3e00000          MVN      r0,#0
                  |L1.13716|
003594  e28dd018          ADD      sp,sp,#0x18
;;;2244   	}
;;;2245   
;;;2246   	if (yaffsfs_CheckPath(path) < 0) {
;;;2247   		yaffsfs_SetError(-ENAMETOOLONG);
;;;2248   		return -1;
;;;2249   	}
;;;2250   
;;;2251   	if (amode & ~(R_OK | W_OK | X_OK)) {
;;;2252   		yaffsfs_SetError(-EINVAL);
;;;2253   		return -1;
;;;2254   	}
;;;2255   
;;;2256   	yaffsfs_Lock();
;;;2257   
;;;2258   	obj = yaffsfs_FindObject(NULL, path, 0, 1, &dir, &notDir, &loop);
;;;2259   	obj = yaffsfs_FollowLink(obj, 0, &loop);
;;;2260   
;;;2261   	if (!dir && notDir)
;;;2262   		yaffsfs_SetError(-ENOTDIR);
;;;2263   	else if (loop)
;;;2264   		yaffsfs_SetError(-ELOOP);
;;;2265   	else if (!dir || !obj)
;;;2266   		yaffsfs_SetError(-ENOENT);
;;;2267   	else if ((amode & W_OK) && obj->my_dev->read_only)
;;;2268   		yaffsfs_SetError(-EROFS);
;;;2269   	else {
;;;2270   		int access_ok = 1;
;;;2271   
;;;2272   		if ((amode & R_OK) && !(obj->yst_mode & S_IREAD))
;;;2273   			access_ok = 0;
;;;2274   		if ((amode & W_OK) && !(obj->yst_mode & S_IWRITE))
;;;2275   			access_ok = 0;
;;;2276   		if ((amode & X_OK) && !(obj->yst_mode & S_IEXEC))
;;;2277   			access_ok = 0;
;;;2278   
;;;2279   		if (!access_ok)
;;;2280   			yaffsfs_SetError(-EACCES);
;;;2281   		else
;;;2282   			retval = 0;
;;;2283   	}
;;;2284   
;;;2285   	yaffsfs_Unlock();
;;;2286   
;;;2287   	return retval;
;;;2288   
;;;2289   }
003598  e8bd81f0          POP      {r4-r8,pc}
                  |L1.13724|
00359c  e1a00006          MOV      r0,r6                 ;2246
0035a0  ebfffffe          BL       yaffsfs_CheckPath
0035a4  e3500000          CMP      r0,#0                 ;2246
0035a8  aa000003          BGE      |L1.13756|
0035ac  e3e00023          MVN      r0,#0x23              ;2247
0035b0  ebfffffe          BL       yaffsfs_SetError
0035b4  e3e00000          MVN      r0,#0                 ;2248
0035b8  eafffff5          B        |L1.13716|
                  |L1.13756|
0035bc  e3d40007          BICS     r0,r4,#7              ;2251
0035c0  0a000003          BEQ      |L1.13780|
0035c4  e3e00015          MVN      r0,#0x15              ;2252
0035c8  ebfffffe          BL       yaffsfs_SetError
0035cc  e3e00000          MVN      r0,#0                 ;2253
0035d0  eaffffef          B        |L1.13716|
                  |L1.13780|
0035d4  ebfffffe          BL       yaffsfs_Lock
0035d8  e28d000c          ADD      r0,sp,#0xc            ;2258
0035dc  e28d1010          ADD      r1,sp,#0x10           ;2258
0035e0  e28d2014          ADD      r2,sp,#0x14           ;2258
0035e4  e3a03001          MOV      r3,#1                 ;2258
0035e8  e58d2000          STR      r2,[sp,#0]            ;2258
0035ec  e3a02000          MOV      r2,#0                 ;2258
0035f0  e58d1004          STR      r1,[sp,#4]            ;2258
0035f4  e1a01006          MOV      r1,r6                 ;2258
0035f8  e58d0008          STR      r0,[sp,#8]            ;2258
0035fc  e1a00002          MOV      r0,r2                 ;2258
003600  ebfffffe          BL       yaffsfs_FindObject
003604  e1a05000          MOV      r5,r0                 ;2258
003608  e28d200c          ADD      r2,sp,#0xc            ;2259
00360c  e3a01000          MOV      r1,#0                 ;2259
003610  e1a00005          MOV      r0,r5                 ;2259
003614  ebfffffe          BL       yaffsfs_FollowLink
003618  e1a05000          MOV      r5,r0                 ;2259
00361c  e59d0014          LDR      r0,[sp,#0x14]         ;2261
003620  e3500000          CMP      r0,#0                 ;2261
003624  1a000005          BNE      |L1.13888|
003628  e59d0010          LDR      r0,[sp,#0x10]         ;2261
00362c  e3500000          CMP      r0,#0                 ;2261
003630  0a000002          BEQ      |L1.13888|
003634  e3e00013          MVN      r0,#0x13              ;2262
003638  ebfffffe          BL       yaffsfs_SetError
00363c  ea000030          B        |L1.14084|
                  |L1.13888|
003640  e59d000c          LDR      r0,[sp,#0xc]          ;2263
003644  e3500000          CMP      r0,#0                 ;2263
003648  0a000002          BEQ      |L1.13912|
00364c  e3e00027          MVN      r0,#0x27              ;2264
003650  ebfffffe          BL       yaffsfs_SetError
003654  ea00002a          B        |L1.14084|
                  |L1.13912|
003658  e59d0014          LDR      r0,[sp,#0x14]         ;2265
00365c  e3500000          CMP      r0,#0                 ;2265
003660  0a000001          BEQ      |L1.13932|
003664  e3550000          CMP      r5,#0                 ;2265
003668  1a000002          BNE      |L1.13944|
                  |L1.13932|
00366c  e3e00001          MVN      r0,#1                 ;2266
003670  ebfffffe          BL       yaffsfs_SetError
003674  ea000022          B        |L1.14084|
                  |L1.13944|
003678  e3140002          TST      r4,#2                 ;2267
00367c  0a000006          BEQ      |L1.13980|
003680  e5950008          LDR      r0,[r5,#8]            ;2267
003684  e59000c8          LDR      r0,[r0,#0xc8]         ;2267
003688  e3500000          CMP      r0,#0                 ;2267
00368c  0a000002          BEQ      |L1.13980|
003690  e3e0001d          MVN      r0,#0x1d              ;2268
003694  ebfffffe          BL       yaffsfs_SetError
003698  ea000019          B        |L1.14084|
                  |L1.13980|
00369c  e3a08001          MOV      r8,#1                 ;2270
0036a0  e3140004          TST      r4,#4                 ;2272
0036a4  0a000003          BEQ      |L1.14008|
0036a8  e1d503b4          LDRH     r0,[r5,#0x34]         ;2272
0036ac  e3100c01          TST      r0,#0x100             ;2272
0036b0  1a000000          BNE      |L1.14008|
0036b4  e3a08000          MOV      r8,#0                 ;2273
                  |L1.14008|
0036b8  e3140002          TST      r4,#2                 ;2274
0036bc  0a000003          BEQ      |L1.14032|
0036c0  e5d50034          LDRB     r0,[r5,#0x34]         ;2274
0036c4  e3100080          TST      r0,#0x80              ;2274
0036c8  1a000000          BNE      |L1.14032|
0036cc  e3a08000          MOV      r8,#0                 ;2275
                  |L1.14032|
0036d0  e3140001          TST      r4,#1                 ;2276
0036d4  0a000003          BEQ      |L1.14056|
0036d8  e5d50034          LDRB     r0,[r5,#0x34]         ;2276
0036dc  e3100040          TST      r0,#0x40              ;2276
0036e0  1a000000          BNE      |L1.14056|
0036e4  e3a08000          MOV      r8,#0                 ;2277
                  |L1.14056|
0036e8  e3580000          CMP      r8,#0                 ;2279
0036ec  1a000002          BNE      |L1.14076|
0036f0  e3e0000c          MVN      r0,#0xc               ;2280
0036f4  ebfffffe          BL       yaffsfs_SetError
0036f8  ea000000          B        |L1.14080|
                  |L1.14076|
0036fc  e3a07000          MOV      r7,#0                 ;2282
                  |L1.14080|
003700  e1a00000          MOV      r0,r0                 ;2283
                  |L1.14084|
003704  ebfffffe          BL       yaffsfs_Unlock
003708  e1a00007          MOV      r0,r7                 ;2287
00370c  eaffffa0          B        |L1.13716|
;;;2290   
                          ENDP

                  yaffs_chmod PROC
;;;2291   int yaffs_chmod(const YCHAR *path, mode_t mode)
003710  e92d40f0          PUSH     {r4-r7,lr}
;;;2292   {
003714  e24dd01c          SUB      sp,sp,#0x1c
003718  e1a04000          MOV      r4,r0
00371c  e1a06001          MOV      r6,r1
;;;2293   	struct yaffs_obj *obj = NULL;
003720  e3a05000          MOV      r5,#0
;;;2294   	struct yaffs_obj *dir = NULL;
003724  e3a00000          MOV      r0,#0
003728  e58d0018          STR      r0,[sp,#0x18]
;;;2295   	int retVal = -1;
00372c  e3e07000          MVN      r7,#0
;;;2296   	int notDir = 0;
003730  e58d0014          STR      r0,[sp,#0x14]
;;;2297   	int loop = 0;
003734  e58d0010          STR      r0,[sp,#0x10]
;;;2298   
;;;2299   	if (!path) {
003738  e3540000          CMP      r4,#0
00373c  1a000004          BNE      |L1.14164|
;;;2300   		yaffsfs_SetError(-EFAULT);
003740  e3e0000d          MVN      r0,#0xd
003744  ebfffffe          BL       yaffsfs_SetError
;;;2301   		return -1;
003748  e3e00000          MVN      r0,#0
                  |L1.14156|
00374c  e28dd01c          ADD      sp,sp,#0x1c
;;;2302   	}
;;;2303   
;;;2304   	if (yaffsfs_CheckPath(path) < 0) {
;;;2305   		yaffsfs_SetError(-ENAMETOOLONG);
;;;2306   		return -1;
;;;2307   	}
;;;2308   
;;;2309   	if (mode & ~(0777)) {
;;;2310   		yaffsfs_SetError(-EINVAL);
;;;2311   		return -1;
;;;2312   	}
;;;2313   
;;;2314   	yaffsfs_Lock();
;;;2315   
;;;2316   	obj = yaffsfs_FindObject(NULL, path, 0, 1, &dir, &notDir, &loop);
;;;2317   	obj = yaffsfs_FollowLink(obj, 0, &loop);
;;;2318   
;;;2319   	if (!dir && notDir)
;;;2320   		yaffsfs_SetError(-ENOTDIR);
;;;2321   	else if (loop)
;;;2322   		yaffsfs_SetError(-ELOOP);
;;;2323   	else if (!dir || !obj)
;;;2324   		yaffsfs_SetError(-ENOENT);
;;;2325   	else if (obj->my_dev->read_only)
;;;2326   		yaffsfs_SetError(-EROFS);
;;;2327   	else
;;;2328   		retVal = yaffsfs_DoChMod(obj, mode);
;;;2329   
;;;2330   	yaffsfs_Unlock();
;;;2331   
;;;2332   	return retVal;
;;;2333   
;;;2334   }
003750  e8bd80f0          POP      {r4-r7,pc}
                  |L1.14164|
003754  e1a00004          MOV      r0,r4                 ;2304
003758  ebfffffe          BL       yaffsfs_CheckPath
00375c  e3500000          CMP      r0,#0                 ;2304
003760  aa000003          BGE      |L1.14196|
003764  e3e00023          MVN      r0,#0x23              ;2305
003768  ebfffffe          BL       yaffsfs_SetError
00376c  e3e00000          MVN      r0,#0                 ;2306
003770  eafffff5          B        |L1.14156|
                  |L1.14196|
003774  e1b004c6          ASRS     r0,r6,#9              ;2309
003778  0a000003          BEQ      |L1.14220|
00377c  e3e00015          MVN      r0,#0x15              ;2310
003780  ebfffffe          BL       yaffsfs_SetError
003784  e3e00000          MVN      r0,#0                 ;2311
003788  eaffffef          B        |L1.14156|
                  |L1.14220|
00378c  ebfffffe          BL       yaffsfs_Lock
003790  e28d0010          ADD      r0,sp,#0x10           ;2316
003794  e28d1014          ADD      r1,sp,#0x14           ;2316
003798  e28d2018          ADD      r2,sp,#0x18           ;2316
00379c  e3a03001          MOV      r3,#1                 ;2316
0037a0  e58d2000          STR      r2,[sp,#0]            ;2316
0037a4  e3a02000          MOV      r2,#0                 ;2316
0037a8  e58d1004          STR      r1,[sp,#4]            ;2316
0037ac  e1a01004          MOV      r1,r4                 ;2316
0037b0  e58d0008          STR      r0,[sp,#8]            ;2316
0037b4  e1a00002          MOV      r0,r2                 ;2316
0037b8  ebfffffe          BL       yaffsfs_FindObject
0037bc  e1a05000          MOV      r5,r0                 ;2316
0037c0  e28d2010          ADD      r2,sp,#0x10           ;2317
0037c4  e3a01000          MOV      r1,#0                 ;2317
0037c8  e1a00005          MOV      r0,r5                 ;2317
0037cc  ebfffffe          BL       yaffsfs_FollowLink
0037d0  e1a05000          MOV      r5,r0                 ;2317
0037d4  e59d0018          LDR      r0,[sp,#0x18]         ;2319
0037d8  e3500000          CMP      r0,#0                 ;2319
0037dc  1a000005          BNE      |L1.14328|
0037e0  e59d0014          LDR      r0,[sp,#0x14]         ;2319
0037e4  e3500000          CMP      r0,#0                 ;2319
0037e8  0a000002          BEQ      |L1.14328|
0037ec  e3e00013          MVN      r0,#0x13              ;2320
0037f0  ebfffffe          BL       yaffsfs_SetError
0037f4  ea000018          B        |L1.14428|
                  |L1.14328|
0037f8  e59d0010          LDR      r0,[sp,#0x10]         ;2321
0037fc  e3500000          CMP      r0,#0                 ;2321
003800  0a000002          BEQ      |L1.14352|
003804  e3e00027          MVN      r0,#0x27              ;2322
003808  ebfffffe          BL       yaffsfs_SetError
00380c  ea000012          B        |L1.14428|
                  |L1.14352|
003810  e59d0018          LDR      r0,[sp,#0x18]         ;2323
003814  e3500000          CMP      r0,#0                 ;2323
003818  0a000001          BEQ      |L1.14372|
00381c  e3550000          CMP      r5,#0                 ;2323
003820  1a000002          BNE      |L1.14384|
                  |L1.14372|
003824  e3e00001          MVN      r0,#1                 ;2324
003828  ebfffffe          BL       yaffsfs_SetError
00382c  ea00000a          B        |L1.14428|
                  |L1.14384|
003830  e5950008          LDR      r0,[r5,#8]            ;2325
003834  e59000c8          LDR      r0,[r0,#0xc8]         ;2325
003838  e3500000          CMP      r0,#0                 ;2325
00383c  0a000002          BEQ      |L1.14412|
003840  e3e0001d          MVN      r0,#0x1d              ;2326
003844  ebfffffe          BL       yaffsfs_SetError
003848  ea000003          B        |L1.14428|
                  |L1.14412|
00384c  e1a01006          MOV      r1,r6                 ;2328
003850  e1a00005          MOV      r0,r5                 ;2328
003854  ebfffffe          BL       yaffsfs_DoChMod
003858  e1a07000          MOV      r7,r0                 ;2328
                  |L1.14428|
00385c  ebfffffe          BL       yaffsfs_Unlock
003860  e1a00007          MOV      r0,r7                 ;2332
003864  eaffffb8          B        |L1.14156|
;;;2335   
                          ENDP

                  yaffs_fchmod PROC
;;;2336   int yaffs_fchmod(int fd, mode_t mode)
003868  e92d41f0          PUSH     {r4-r8,lr}
;;;2337   {
00386c  e1a06000          MOV      r6,r0
003870  e1a05001          MOV      r5,r1
;;;2338   	struct yaffs_obj *obj;
;;;2339   	int retVal = -1;
003874  e3e07000          MVN      r7,#0
;;;2340   
;;;2341   	if (mode & ~(0777)) {
003878  e1b004c5          ASRS     r0,r5,#9
00387c  0a000003          BEQ      |L1.14480|
;;;2342   		yaffsfs_SetError(-EINVAL);
003880  e3e00015          MVN      r0,#0x15
003884  ebfffffe          BL       yaffsfs_SetError
;;;2343   		return -1;
003888  e3e00000          MVN      r0,#0
                  |L1.14476|
;;;2344   	}
;;;2345   
;;;2346   	yaffsfs_Lock();
;;;2347   	obj = yaffsfs_HandleToObject(fd);
;;;2348   
;;;2349   	if (!obj)
;;;2350   		yaffsfs_SetError(-EBADF);
;;;2351   	else if (obj->my_dev->read_only)
;;;2352   		yaffsfs_SetError(-EROFS);
;;;2353   	else
;;;2354   		retVal = yaffsfs_DoChMod(obj, mode);
;;;2355   
;;;2356   	yaffsfs_Unlock();
;;;2357   
;;;2358   	return retVal;
;;;2359   }
00388c  e8bd81f0          POP      {r4-r8,pc}
                  |L1.14480|
003890  ebfffffe          BL       yaffsfs_Lock
003894  e1a00006          MOV      r0,r6                 ;2347
003898  ebfffffe          BL       yaffsfs_HandleToObject
00389c  e1a04000          MOV      r4,r0                 ;2347
0038a0  e3540000          CMP      r4,#0                 ;2349
0038a4  1a000002          BNE      |L1.14516|
0038a8  e3e00008          MVN      r0,#8                 ;2350
0038ac  ebfffffe          BL       yaffsfs_SetError
0038b0  ea00000a          B        |L1.14560|
                  |L1.14516|
0038b4  e5940008          LDR      r0,[r4,#8]            ;2351
0038b8  e59000c8          LDR      r0,[r0,#0xc8]         ;2351
0038bc  e3500000          CMP      r0,#0                 ;2351
0038c0  0a000002          BEQ      |L1.14544|
0038c4  e3e0001d          MVN      r0,#0x1d              ;2352
0038c8  ebfffffe          BL       yaffsfs_SetError
0038cc  ea000003          B        |L1.14560|
                  |L1.14544|
0038d0  e1a01005          MOV      r1,r5                 ;2354
0038d4  e1a00004          MOV      r0,r4                 ;2354
0038d8  ebfffffe          BL       yaffsfs_DoChMod
0038dc  e1a07000          MOV      r7,r0                 ;2354
                  |L1.14560|
0038e0  ebfffffe          BL       yaffsfs_Unlock
0038e4  e1a00007          MOV      r0,r7                 ;2358
0038e8  eaffffe7          B        |L1.14476|
;;;2360   
                          ENDP

                  yaffs_mkdir PROC
;;;2361   int yaffs_mkdir(const YCHAR *path, mode_t mode)
0038ec  e92d41f0          PUSH     {r4-r8,lr}
;;;2362   {
0038f0  e24dd018          SUB      sp,sp,#0x18
0038f4  e1a05000          MOV      r5,r0
0038f8  e1a06001          MOV      r6,r1
;;;2363   	struct yaffs_obj *parent = NULL;
0038fc  e3a04000          MOV      r4,#0
;;;2364   	struct yaffs_obj *dir = NULL;
003900  e3a07000          MOV      r7,#0
;;;2365   	YCHAR *name;
;;;2366   	YCHAR *alt_path = NULL;
003904  e3a00000          MOV      r0,#0
003908  e58d0010          STR      r0,[sp,#0x10]
;;;2367   	int retVal = -1;
00390c  e3e08000          MVN      r8,#0
;;;2368   	int notDir = 0;
003910  e58d000c          STR      r0,[sp,#0xc]
;;;2369   	int loop = 0;
003914  e58d0008          STR      r0,[sp,#8]
;;;2370   
;;;2371   	if (!path) {
003918  e3550000          CMP      r5,#0
00391c  1a000004          BNE      |L1.14644|
;;;2372   		yaffsfs_SetError(-EFAULT);
003920  e3e0000d          MVN      r0,#0xd
003924  ebfffffe          BL       yaffsfs_SetError
;;;2373   		return -1;
003928  e3e00000          MVN      r0,#0
                  |L1.14636|
00392c  e28dd018          ADD      sp,sp,#0x18
;;;2374   	}
;;;2375   
;;;2376   	if (yaffsfs_CheckPath(path) < 0) {
;;;2377   		yaffsfs_SetError(-ENAMETOOLONG);
;;;2378   		return -1;
;;;2379   	}
;;;2380   
;;;2381   	if (yaffsfs_alt_dir_path(path, &alt_path) < 0) {
;;;2382   		yaffsfs_SetError(-ENOMEM);
;;;2383   		return -1;
;;;2384   	}
;;;2385   	if (alt_path)
;;;2386   		path = alt_path;
;;;2387   
;;;2388   	yaffsfs_Lock();
;;;2389   	parent = yaffsfs_FindDirectory(NULL, path, &name, 0, &notDir, &loop);
;;;2390   	if (!parent && notDir)
;;;2391   		yaffsfs_SetError(-ENOTDIR);
;;;2392   	else if (loop)
;;;2393   		yaffsfs_SetError(-ELOOP);
;;;2394   	else if (!parent)
;;;2395   		yaffsfs_SetError(-ENOENT);
;;;2396   	else if (yaffsfs_TooManyObjects(parent->my_dev))
;;;2397   		yaffsfs_SetError(-ENFILE);
;;;2398   	else if (yaffs_strnlen(name, 5) == 0) {
;;;2399   		/* Trying to make the root itself */
;;;2400   		yaffsfs_SetError(-EEXIST);
;;;2401   	} else if (parent->my_dev->read_only)
;;;2402   		yaffsfs_SetError(-EROFS);
;;;2403   	else {
;;;2404   		dir = yaffs_create_dir(parent, name, mode, 0, 0);
;;;2405   		if (dir)
;;;2406   			retVal = 0;
;;;2407   		else if (yaffs_find_by_name(parent, name))
;;;2408   			yaffsfs_SetError(-EEXIST);	/* name exists */
;;;2409   		else
;;;2410   			yaffsfs_SetError(-ENOSPC);	/* assume no space */
;;;2411   	}
;;;2412   
;;;2413   	yaffsfs_Unlock();
;;;2414   
;;;2415   	yaffs_free(alt_path);
;;;2416   
;;;2417   	return retVal;
;;;2418   }
003930  e8bd81f0          POP      {r4-r8,pc}
                  |L1.14644|
003934  e1a00005          MOV      r0,r5                 ;2376
003938  ebfffffe          BL       yaffsfs_CheckPath
00393c  e3500000          CMP      r0,#0                 ;2376
003940  aa000003          BGE      |L1.14676|
003944  e3e00023          MVN      r0,#0x23              ;2377
003948  ebfffffe          BL       yaffsfs_SetError
00394c  e3e00000          MVN      r0,#0                 ;2378
003950  eafffff5          B        |L1.14636|
                  |L1.14676|
003954  e28d1010          ADD      r1,sp,#0x10           ;2381
003958  e1a00005          MOV      r0,r5                 ;2381
00395c  ebfffffe          BL       yaffsfs_alt_dir_path
003960  e3500000          CMP      r0,#0                 ;2381
003964  aa000003          BGE      |L1.14712|
003968  e3e0000b          MVN      r0,#0xb               ;2382
00396c  ebfffffe          BL       yaffsfs_SetError
003970  e3e00000          MVN      r0,#0                 ;2383
003974  eaffffec          B        |L1.14636|
                  |L1.14712|
003978  e59d0010          LDR      r0,[sp,#0x10]         ;2385
00397c  e3500000          CMP      r0,#0                 ;2385
003980  0a000000          BEQ      |L1.14728|
003984  e59d5010          LDR      r5,[sp,#0x10]         ;2386
                  |L1.14728|
003988  ebfffffe          BL       yaffsfs_Lock
00398c  e28d0008          ADD      r0,sp,#8              ;2389
003990  e28d100c          ADD      r1,sp,#0xc            ;2389
003994  e3a03000          MOV      r3,#0                 ;2389
003998  e58d0004          STR      r0,[sp,#4]            ;2389
00399c  e58d1000          STR      r1,[sp,#0]            ;2389
0039a0  e28d2014          ADD      r2,sp,#0x14           ;2389
0039a4  e1a01005          MOV      r1,r5                 ;2389
0039a8  e1a00003          MOV      r0,r3                 ;2389
0039ac  ebfffffe          BL       yaffsfs_FindDirectory
0039b0  e1a04000          MOV      r4,r0                 ;2389
0039b4  e3540000          CMP      r4,#0                 ;2390
0039b8  1a000005          BNE      |L1.14804|
0039bc  e59d000c          LDR      r0,[sp,#0xc]          ;2390
0039c0  e3500000          CMP      r0,#0                 ;2390
0039c4  0a000002          BEQ      |L1.14804|
0039c8  e3e00013          MVN      r0,#0x13              ;2391
0039cc  ebfffffe          BL       yaffsfs_SetError
0039d0  ea00003b          B        |L1.15044|
                  |L1.14804|
0039d4  e59d0008          LDR      r0,[sp,#8]            ;2392
0039d8  e3500000          CMP      r0,#0                 ;2392
0039dc  0a000002          BEQ      |L1.14828|
0039e0  e3e00027          MVN      r0,#0x27              ;2393
0039e4  ebfffffe          BL       yaffsfs_SetError
0039e8  ea000035          B        |L1.15044|
                  |L1.14828|
0039ec  e3540000          CMP      r4,#0                 ;2394
0039f0  1a000002          BNE      |L1.14848|
0039f4  e3e00001          MVN      r0,#1                 ;2395
0039f8  ebfffffe          BL       yaffsfs_SetError
0039fc  ea000030          B        |L1.15044|
                  |L1.14848|
003a00  e5940008          LDR      r0,[r4,#8]            ;2396
003a04  ebfffffe          BL       yaffsfs_TooManyObjects
003a08  e3500000          CMP      r0,#0                 ;2396
003a0c  0a000002          BEQ      |L1.14876|
003a10  e3e00016          MVN      r0,#0x16              ;2397
003a14  ebfffffe          BL       yaffsfs_SetError
003a18  ea000029          B        |L1.15044|
                  |L1.14876|
003a1c  e59d0014          LDR      r0,[sp,#0x14]         ;2398
003a20  ebfffffe          BL       strlen
003a24  e3500005          CMP      r0,#5                 ;2398
003a28  9a000001          BLS      |L1.14900|
003a2c  e3a00005          MOV      r0,#5                 ;2398
003a30  ea000001          B        |L1.14908|
                  |L1.14900|
003a34  e59d0014          LDR      r0,[sp,#0x14]         ;2398
003a38  ebfffffe          BL       strlen
                  |L1.14908|
003a3c  e3500000          CMP      r0,#0                 ;2398
003a40  1a000002          BNE      |L1.14928|
003a44  e3e00010          MVN      r0,#0x10              ;2400
003a48  ebfffffe          BL       yaffsfs_SetError
003a4c  ea00001c          B        |L1.15044|
                  |L1.14928|
003a50  e5940008          LDR      r0,[r4,#8]            ;2401
003a54  e59000c8          LDR      r0,[r0,#0xc8]         ;2401
003a58  e3500000          CMP      r0,#0                 ;2401
003a5c  0a000002          BEQ      |L1.14956|
003a60  e3e0001d          MVN      r0,#0x1d              ;2402
003a64  ebfffffe          BL       yaffsfs_SetError
003a68  ea000015          B        |L1.15044|
                  |L1.14956|
003a6c  e3a00000          MOV      r0,#0                 ;2404
003a70  e58d0000          STR      r0,[sp,#0]            ;2404
003a74  e1a03000          MOV      r3,r0                 ;2404
003a78  e1a02006          MOV      r2,r6                 ;2404
003a7c  e1a00004          MOV      r0,r4                 ;2404
003a80  e59d1014          LDR      r1,[sp,#0x14]         ;2404
003a84  ebfffffe          BL       yaffs_create_dir
003a88  e1a07000          MOV      r7,r0                 ;2404
003a8c  e3570000          CMP      r7,#0                 ;2405
003a90  0a000001          BEQ      |L1.15004|
003a94  e3a08000          MOV      r8,#0                 ;2406
003a98  ea000009          B        |L1.15044|
                  |L1.15004|
003a9c  e1a00004          MOV      r0,r4                 ;2407
003aa0  e59d1014          LDR      r1,[sp,#0x14]         ;2407
003aa4  ebfffffe          BL       yaffs_find_by_name
003aa8  e3500000          CMP      r0,#0                 ;2407
003aac  0a000002          BEQ      |L1.15036|
003ab0  e3e00010          MVN      r0,#0x10              ;2408
003ab4  ebfffffe          BL       yaffsfs_SetError
003ab8  ea000001          B        |L1.15044|
                  |L1.15036|
003abc  e3e0001b          MVN      r0,#0x1b              ;2410
003ac0  ebfffffe          BL       yaffsfs_SetError
                  |L1.15044|
003ac4  ebfffffe          BL       yaffsfs_Unlock
003ac8  e59d0010          LDR      r0,[sp,#0x10]         ;2415
003acc  ebfffffe          BL       yaffs_free
003ad0  e1a00008          MOV      r0,r8                 ;2417
003ad4  eaffff94          B        |L1.14636|
;;;2419   
                          ENDP

                  yaffs_rmdir PROC
;;;2420   int yaffs_rmdir(const YCHAR *path)
003ad8  e92d4038          PUSH     {r3-r5,lr}
;;;2421   {
003adc  e1a04000          MOV      r4,r0
;;;2422   	int result;
;;;2423   	YCHAR *alt_path;
;;;2424   
;;;2425   	if (!path) {
003ae0  e3540000          CMP      r4,#0
003ae4  1a000003          BNE      |L1.15096|
;;;2426   		yaffsfs_SetError(-EFAULT);
003ae8  e3e0000d          MVN      r0,#0xd
003aec  ebfffffe          BL       yaffsfs_SetError
;;;2427   		return -1;
003af0  e3e00000          MVN      r0,#0
                  |L1.15092|
;;;2428   	}
;;;2429   
;;;2430   	if (yaffsfs_CheckPath(path) < 0) {
;;;2431   		yaffsfs_SetError(-ENAMETOOLONG);
;;;2432   		return -1;
;;;2433   	}
;;;2434   
;;;2435   	if (yaffsfs_alt_dir_path(path, &alt_path) < 0) {
;;;2436   		yaffsfs_SetError(-ENOMEM);
;;;2437   		return -1;
;;;2438   	}
;;;2439   	if (alt_path)
;;;2440   		path = alt_path;
;;;2441   	result = yaffsfs_DoUnlink(path, 1);
;;;2442   
;;;2443   	yaffs_free(alt_path);
;;;2444   
;;;2445   	return result;
;;;2446   }
003af4  e8bd8038          POP      {r3-r5,pc}
                  |L1.15096|
003af8  e1a00004          MOV      r0,r4                 ;2430
003afc  ebfffffe          BL       yaffsfs_CheckPath
003b00  e3500000          CMP      r0,#0                 ;2430
003b04  aa000003          BGE      |L1.15128|
003b08  e3e00023          MVN      r0,#0x23              ;2431
003b0c  ebfffffe          BL       yaffsfs_SetError
003b10  e3e00000          MVN      r0,#0                 ;2432
003b14  eafffff6          B        |L1.15092|
                  |L1.15128|
003b18  e1a0100d          MOV      r1,sp                 ;2435
003b1c  e1a00004          MOV      r0,r4                 ;2435
003b20  ebfffffe          BL       yaffsfs_alt_dir_path
003b24  e3500000          CMP      r0,#0                 ;2435
003b28  aa000003          BGE      |L1.15164|
003b2c  e3e0000b          MVN      r0,#0xb               ;2436
003b30  ebfffffe          BL       yaffsfs_SetError
003b34  e3e00000          MVN      r0,#0                 ;2437
003b38  eaffffed          B        |L1.15092|
                  |L1.15164|
003b3c  e59d0000          LDR      r0,[sp,#0]            ;2439
003b40  e3500000          CMP      r0,#0                 ;2439
003b44  0a000000          BEQ      |L1.15180|
003b48  e59d4000          LDR      r4,[sp,#0]            ;2440
                  |L1.15180|
003b4c  e3a01001          MOV      r1,#1                 ;2441
003b50  e1a00004          MOV      r0,r4                 ;2441
003b54  ebfffffe          BL       yaffsfs_DoUnlink
003b58  e1a05000          MOV      r5,r0                 ;2441
003b5c  e59d0000          LDR      r0,[sp,#0]            ;2443
003b60  ebfffffe          BL       yaffs_free
003b64  e1a00005          MOV      r0,r5                 ;2445
003b68  eaffffe1          B        |L1.15092|
;;;2447   
                          ENDP

                  yaffs_getdev PROC
;;;2448   void *yaffs_getdev(const YCHAR *path)
003b6c  e92d4038          PUSH     {r3-r5,lr}
;;;2449   {
003b70  e1a04000          MOV      r4,r0
;;;2450   	struct yaffs_dev *dev = NULL;
003b74  e3a05000          MOV      r5,#0
;;;2451   	YCHAR *dummy;
;;;2452   	dev = yaffsfs_FindDevice(path, &dummy);
003b78  e1a0100d          MOV      r1,sp
003b7c  e1a00004          MOV      r0,r4
003b80  ebfffffe          BL       yaffsfs_FindDevice
003b84  e1a05000          MOV      r5,r0
;;;2453   	return (void *)dev;
003b88  e1a00005          MOV      r0,r5
;;;2454   }
003b8c  e8bd8038          POP      {r3-r5,pc}
;;;2455   
                          ENDP

                  yaffs_mount_common PROC
;;;2456   int yaffs_mount_common(const YCHAR *path, int read_only, int skip_checkpt)
003b90  e92d47f0          PUSH     {r4-r10,lr}
;;;2457   {
003b94  e1a05000          MOV      r5,r0
003b98  e1a06001          MOV      r6,r1
003b9c  e1a07002          MOV      r7,r2
;;;2458   	int retVal = -1;
003ba0  e3e09000          MVN      r9,#0
;;;2459   	int result = YAFFS_FAIL;
003ba4  e3a08000          MOV      r8,#0
;;;2460   	struct yaffs_dev *dev = NULL;
003ba8  e3a04000          MOV      r4,#0
;;;2461   
;;;2462   	if (!path) {
003bac  e3550000          CMP      r5,#0
003bb0  1a000003          BNE      |L1.15300|
;;;2463   		yaffsfs_SetError(-EFAULT);
003bb4  e3e0000d          MVN      r0,#0xd
003bb8  ebfffffe          BL       yaffsfs_SetError
;;;2464   		return -1;
003bbc  e3e00000          MVN      r0,#0
                  |L1.15296|
;;;2465   	}
;;;2466   
;;;2467   	yaffs_trace(YAFFS_TRACE_MOUNT, "yaffs: Mounting %s", path);
;;;2468   
;;;2469   	if (yaffsfs_CheckPath(path) < 0) {
;;;2470   		yaffsfs_SetError(-ENAMETOOLONG);
;;;2471   		return -1;
;;;2472   	}
;;;2473   
;;;2474   	yaffsfs_Lock();
;;;2475   
;;;2476   	yaffsfs_InitHandles();
;;;2477   
;;;2478   	dev = yaffsfs_FindMountPoint(path);
;;;2479   	if (dev) {
;;;2480   		if (!dev->is_mounted) {
;;;2481   			dev->read_only = read_only ? 1 : 0;
;;;2482   			if (skip_checkpt) {
;;;2483   				u8 skip = dev->param.skip_checkpt_rd;
;;;2484   				dev->param.skip_checkpt_rd = 1;
;;;2485   				result = yaffs_guts_initialise(dev);
;;;2486   				dev->param.skip_checkpt_rd = skip;
;;;2487   			} else {
;;;2488   				result = yaffs_guts_initialise(dev);
;;;2489   			}
;;;2490   
;;;2491   			if (result == YAFFS_FAIL)
;;;2492   				yaffsfs_SetError(-ENOMEM);
;;;2493   			retVal = result ? 0 : -1;
;;;2494   
;;;2495   		} else
;;;2496   			yaffsfs_SetError(-EBUSY);
;;;2497   	} else
;;;2498   		yaffsfs_SetError(-ENODEV);
;;;2499   
;;;2500   	yaffsfs_Unlock();
;;;2501   	return retVal;
;;;2502   
;;;2503   }
003bc0  e8bd87f0          POP      {r4-r10,pc}
                  |L1.15300|
003bc4  e59f01f0          LDR      r0,|L1.15804|
003bc8  e5900000          LDR      r0,[r0,#0]            ;2467  ; yaffs_trace_mask
003bcc  e3100502          TST      r0,#0x800000          ;2467
003bd0  0a000002          BEQ      |L1.15328|
003bd4  e1a01005          MOV      r1,r5                 ;2467
003bd8  e28f0e1e          ADR      r0,|L1.15808|
003bdc  ebfffffe          BL       sysprintf
                  |L1.15328|
003be0  e1a00005          MOV      r0,r5                 ;2469
003be4  ebfffffe          BL       yaffsfs_CheckPath
003be8  e3500000          CMP      r0,#0                 ;2469
003bec  aa000003          BGE      |L1.15360|
003bf0  e3e00023          MVN      r0,#0x23              ;2470
003bf4  ebfffffe          BL       yaffsfs_SetError
003bf8  e3e00000          MVN      r0,#0                 ;2471
003bfc  eaffffef          B        |L1.15296|
                  |L1.15360|
003c00  ebfffffe          BL       yaffsfs_Lock
003c04  ebfffffe          BL       yaffsfs_InitHandles
003c08  e1a00005          MOV      r0,r5                 ;2478
003c0c  ebfffffe          BL       yaffsfs_FindMountPoint
003c10  e1a04000          MOV      r4,r0                 ;2478
003c14  e3540000          CMP      r4,#0                 ;2479
003c18  0a000023          BEQ      |L1.15532|
003c1c  e59400c4          LDR      r0,[r4,#0xc4]         ;2480
003c20  e3500000          CMP      r0,#0                 ;2480
003c24  1a00001d          BNE      |L1.15520|
003c28  e3560000          CMP      r6,#0                 ;2481
003c2c  0a000001          BEQ      |L1.15416|
003c30  e3a00001          MOV      r0,#1                 ;2481
003c34  ea000000          B        |L1.15420|
                  |L1.15416|
003c38  e3a00000          MOV      r0,#0                 ;2481
                  |L1.15420|
003c3c  e58400c8          STR      r0,[r4,#0xc8]         ;2481
003c40  e3570000          CMP      r7,#0                 ;2482
003c44  0a000007          BEQ      |L1.15464|
003c48  e5d4a03c          LDRB     r10,[r4,#0x3c]        ;2483
003c4c  e3a00001          MOV      r0,#1                 ;2484
003c50  e5c4003c          STRB     r0,[r4,#0x3c]         ;2484
003c54  e1a00004          MOV      r0,r4                 ;2485
003c58  ebfffffe          BL       yaffs_guts_initialise
003c5c  e1a08000          MOV      r8,r0                 ;2485
003c60  e5c4a03c          STRB     r10,[r4,#0x3c]        ;2486
003c64  ea000002          B        |L1.15476|
                  |L1.15464|
003c68  e1a00004          MOV      r0,r4                 ;2488
003c6c  ebfffffe          BL       yaffs_guts_initialise
003c70  e1a08000          MOV      r8,r0                 ;2488
                  |L1.15476|
003c74  e3580000          CMP      r8,#0                 ;2491
003c78  1a000001          BNE      |L1.15492|
003c7c  e3e0000b          MVN      r0,#0xb               ;2492
003c80  ebfffffe          BL       yaffsfs_SetError
                  |L1.15492|
003c84  e3580000          CMP      r8,#0                 ;2493
003c88  0a000001          BEQ      |L1.15508|
003c8c  e3a00000          MOV      r0,#0                 ;2493
003c90  ea000000          B        |L1.15512|
                  |L1.15508|
003c94  e3e00000          MVN      r0,#0                 ;2493
                  |L1.15512|
003c98  e1a09000          MOV      r9,r0                 ;2493
003c9c  ea000004          B        |L1.15540|
                  |L1.15520|
003ca0  e3e0000f          MVN      r0,#0xf               ;2496
003ca4  ebfffffe          BL       yaffsfs_SetError
003ca8  ea000001          B        |L1.15540|
                  |L1.15532|
003cac  e3e00012          MVN      r0,#0x12              ;2498
003cb0  ebfffffe          BL       yaffsfs_SetError
                  |L1.15540|
003cb4  ebfffffe          BL       yaffsfs_Unlock
003cb8  e1a00009          MOV      r0,r9                 ;2501
003cbc  eaffffbf          B        |L1.15296|
;;;2504   
                          ENDP

                  yaffs_mount2 PROC
;;;2505   int yaffs_mount2(const YCHAR *path, int readonly)
003cc0  e92d4070          PUSH     {r4-r6,lr}
;;;2506   {
003cc4  e1a04000          MOV      r4,r0
003cc8  e1a05001          MOV      r5,r1
;;;2507   	return yaffs_mount_common(path, readonly, 0);
003ccc  e3a02000          MOV      r2,#0
003cd0  e1a01005          MOV      r1,r5
003cd4  e1a00004          MOV      r0,r4
003cd8  ebfffffe          BL       yaffs_mount_common
;;;2508   }
003cdc  e8bd8070          POP      {r4-r6,pc}
;;;2509   
                          ENDP

                  yaffs_mount PROC
;;;2510   int yaffs_mount(const YCHAR *path)
003ce0  e92d4010          PUSH     {r4,lr}
;;;2511   {
003ce4  e1a04000          MOV      r4,r0
;;;2512   	return yaffs_mount_common(path, 0, 0);
003ce8  e3a02000          MOV      r2,#0
003cec  e1a01002          MOV      r1,r2
003cf0  e1a00004          MOV      r0,r4
003cf4  ebfffffe          BL       yaffs_mount_common
;;;2513   }
003cf8  e8bd8010          POP      {r4,pc}
;;;2514   
                          ENDP

                  yaffs_sync PROC
;;;2515   int yaffs_sync(const YCHAR *path)
003cfc  e92d40f8          PUSH     {r3-r7,lr}
;;;2516   {
003d00  e1a05000          MOV      r5,r0
;;;2517   	int retVal = -1;
003d04  e3e06000          MVN      r6,#0
;;;2518   	struct yaffs_dev *dev = NULL;
003d08  e3a04000          MOV      r4,#0
;;;2519   	YCHAR *dummy;
;;;2520   
;;;2521   	if (!path) {
003d0c  e3550000          CMP      r5,#0
003d10  1a000003          BNE      |L1.15652|
;;;2522   		yaffsfs_SetError(-EFAULT);
003d14  e3e0000d          MVN      r0,#0xd
003d18  ebfffffe          BL       yaffsfs_SetError
;;;2523   		return -1;
003d1c  e3e00000          MVN      r0,#0
                  |L1.15648|
;;;2524   	}
;;;2525   
;;;2526   	if (yaffsfs_CheckPath(path) < 0) {
;;;2527   		yaffsfs_SetError(-ENAMETOOLONG);
;;;2528   		return -1;
;;;2529   	}
;;;2530   
;;;2531   	yaffsfs_Lock();
;;;2532   	dev = yaffsfs_FindDevice(path, &dummy);
;;;2533   	if (dev) {
;;;2534   		if (!dev->is_mounted)
;;;2535   			yaffsfs_SetError(-EINVAL);
;;;2536   		else if (dev->read_only)
;;;2537   			yaffsfs_SetError(-EROFS);
;;;2538   		else {
;;;2539   
;;;2540   			yaffs_flush_whole_cache(dev);
;;;2541   			yaffs_checkpoint_save(dev);
;;;2542   			retVal = 0;
;;;2543   
;;;2544   		}
;;;2545   	} else
;;;2546   		yaffsfs_SetError(-ENODEV);
;;;2547   
;;;2548   	yaffsfs_Unlock();
;;;2549   	return retVal;
;;;2550   }
003d20  e8bd80f8          POP      {r3-r7,pc}
                  |L1.15652|
003d24  e1a00005          MOV      r0,r5                 ;2526
003d28  ebfffffe          BL       yaffsfs_CheckPath
003d2c  e3500000          CMP      r0,#0                 ;2526
003d30  aa000003          BGE      |L1.15684|
003d34  e3e00023          MVN      r0,#0x23              ;2527
003d38  ebfffffe          BL       yaffsfs_SetError
003d3c  e3e00000          MVN      r0,#0                 ;2528
003d40  eafffff6          B        |L1.15648|
                  |L1.15684|
003d44  ebfffffe          BL       yaffsfs_Lock
003d48  e1a0100d          MOV      r1,sp                 ;2532
003d4c  e1a00005          MOV      r0,r5                 ;2532
003d50  ebfffffe          BL       yaffsfs_FindDevice
003d54  e1a04000          MOV      r4,r0                 ;2532
003d58  e3540000          CMP      r4,#0                 ;2533
003d5c  0a000011          BEQ      |L1.15784|
003d60  e59400c4          LDR      r0,[r4,#0xc4]         ;2534
003d64  e3500000          CMP      r0,#0                 ;2534
003d68  1a000002          BNE      |L1.15736|
003d6c  e3e00015          MVN      r0,#0x15              ;2535
003d70  ebfffffe          BL       yaffsfs_SetError
003d74  ea00000d          B        |L1.15792|
                  |L1.15736|
003d78  e59400c8          LDR      r0,[r4,#0xc8]         ;2536
003d7c  e3500000          CMP      r0,#0                 ;2536
003d80  0a000002          BEQ      |L1.15760|
003d84  e3e0001d          MVN      r0,#0x1d              ;2537
003d88  ebfffffe          BL       yaffsfs_SetError
003d8c  ea000007          B        |L1.15792|
                  |L1.15760|
003d90  e1a00004          MOV      r0,r4                 ;2540
003d94  ebfffffe          BL       yaffs_flush_whole_cache
003d98  e1a00004          MOV      r0,r4                 ;2541
003d9c  ebfffffe          BL       yaffs_checkpoint_save
003da0  e3a06000          MOV      r6,#0                 ;2542
003da4  ea000001          B        |L1.15792|
                  |L1.15784|
003da8  e3e00012          MVN      r0,#0x12              ;2546
003dac  ebfffffe          BL       yaffsfs_SetError
                  |L1.15792|
003db0  ebfffffe          BL       yaffsfs_Unlock
003db4  e1a00006          MOV      r0,r6                 ;2549
003db8  eaffffd8          B        |L1.15648|
                  |L1.15804|
                          DCD      yaffs_trace_mask
                  |L1.15808|
003dc0  79616666          DCB      "yaffs: yaffs: Mounting %s\n",0
003dc4  733a2079
003dc8  61666673
003dcc  3a204d6f
003dd0  756e7469
003dd4  6e672025
003dd8  730a00  
003ddb  00                DCB      0
                          ENDP

                  yaffsfs_IsDevBusy PROC
;;;2551   
;;;2552   static int yaffsfs_IsDevBusy(struct yaffs_dev *dev)
003ddc  e92d4070          PUSH     {r4-r6,lr}
;;;2553   {
003de0  e1a06000          MOV      r6,r0
;;;2554   	int i;
;;;2555   	struct yaffs_obj *obj;
;;;2556   
;;;2557   	for (i = 0; i < YAFFSFS_N_HANDLES; i++) {
003de4  e3a05000          MOV      r5,#0
003de8  ea00000a          B        |L1.15896|
                  |L1.15852|
;;;2558   		obj = yaffsfs_HandleToObject(i);
003dec  e1a00005          MOV      r0,r5
003df0  ebfffffe          BL       yaffsfs_HandleToObject
003df4  e1a04000          MOV      r4,r0
;;;2559   		if (obj && obj->my_dev == dev)
003df8  e3540000          CMP      r4,#0
003dfc  0a000004          BEQ      |L1.15892|
003e00  e5940008          LDR      r0,[r4,#8]
003e04  e1500006          CMP      r0,r6
003e08  1a000001          BNE      |L1.15892|
;;;2560   			return 1;
003e0c  e3a00001          MOV      r0,#1
                  |L1.15888|
;;;2561   	}
;;;2562   	return 0;
;;;2563   }
003e10  e8bd8070          POP      {r4-r6,pc}
                  |L1.15892|
003e14  e2855001          ADD      r5,r5,#1              ;2557
                  |L1.15896|
003e18  e3550064          CMP      r5,#0x64              ;2557
003e1c  bafffff2          BLT      |L1.15852|
003e20  e3a00000          MOV      r0,#0                 ;2562
003e24  eafffff9          B        |L1.15888|
;;;2564   
                          ENDP

                  yaffs_remount PROC
;;;2565   int yaffs_remount(const YCHAR *path, int force, int read_only)
003e28  e92d41f0          PUSH     {r4-r8,lr}
;;;2566   {
003e2c  e1a06000          MOV      r6,r0
003e30  e1a07001          MOV      r7,r1
003e34  e1a05002          MOV      r5,r2
;;;2567   	int retVal = -1;
003e38  e3e08000          MVN      r8,#0
;;;2568   	struct yaffs_dev *dev = NULL;
003e3c  e3a04000          MOV      r4,#0
;;;2569   
;;;2570   	if (!path) {
003e40  e3560000          CMP      r6,#0
003e44  1a000003          BNE      |L1.15960|
;;;2571   		yaffsfs_SetError(-EFAULT);
003e48  e3e0000d          MVN      r0,#0xd
003e4c  ebfffffe          BL       yaffsfs_SetError
;;;2572   		return -1;
003e50  e3e00000          MVN      r0,#0
                  |L1.15956|
;;;2573   	}
;;;2574   
;;;2575   	if (yaffsfs_CheckPath(path) < 0) {
;;;2576   		yaffsfs_SetError(-ENAMETOOLONG);
;;;2577   		return -1;
;;;2578   	}
;;;2579   
;;;2580   	yaffsfs_Lock();
;;;2581   	dev = yaffsfs_FindMountPoint(path);
;;;2582   	if (dev) {
;;;2583   		if (dev->is_mounted) {
;;;2584   			yaffs_flush_whole_cache(dev);
;;;2585   
;;;2586   			if (force || !yaffsfs_IsDevBusy(dev)) {
;;;2587   				if (read_only)
;;;2588   					yaffs_checkpoint_save(dev);
;;;2589   				dev->read_only = read_only ? 1 : 0;
;;;2590   				retVal = 0;
;;;2591   			} else
;;;2592   				yaffsfs_SetError(-EBUSY);
;;;2593   
;;;2594   		} else
;;;2595   			yaffsfs_SetError(-EINVAL);
;;;2596   
;;;2597   	} else
;;;2598   		yaffsfs_SetError(-ENODEV);
;;;2599   
;;;2600   	yaffsfs_Unlock();
;;;2601   	return retVal;
;;;2602   
;;;2603   }
003e54  e8bd81f0          POP      {r4-r8,pc}
                  |L1.15960|
003e58  e1a00006          MOV      r0,r6                 ;2575
003e5c  ebfffffe          BL       yaffsfs_CheckPath
003e60  e3500000          CMP      r0,#0                 ;2575
003e64  aa000003          BGE      |L1.15992|
003e68  e3e00023          MVN      r0,#0x23              ;2576
003e6c  ebfffffe          BL       yaffsfs_SetError
003e70  e3e00000          MVN      r0,#0                 ;2577
003e74  eafffff6          B        |L1.15956|
                  |L1.15992|
003e78  ebfffffe          BL       yaffsfs_Lock
003e7c  e1a00006          MOV      r0,r6                 ;2581
003e80  ebfffffe          BL       yaffsfs_FindMountPoint
003e84  e1a04000          MOV      r4,r0                 ;2581
003e88  e3540000          CMP      r4,#0                 ;2582
003e8c  0a00001c          BEQ      |L1.16132|
003e90  e59400c4          LDR      r0,[r4,#0xc4]         ;2583
003e94  e3500000          CMP      r0,#0                 ;2583
003e98  0a000016          BEQ      |L1.16120|
003e9c  e1a00004          MOV      r0,r4                 ;2584
003ea0  ebfffffe          BL       yaffs_flush_whole_cache
003ea4  e3570000          CMP      r7,#0                 ;2586
003ea8  1a000003          BNE      |L1.16060|
003eac  e1a00004          MOV      r0,r4                 ;2586
003eb0  ebfffffe          BL       yaffsfs_IsDevBusy
003eb4  e3500000          CMP      r0,#0                 ;2586
003eb8  1a00000b          BNE      |L1.16108|
                  |L1.16060|
003ebc  e3550000          CMP      r5,#0                 ;2587
003ec0  0a000001          BEQ      |L1.16076|
003ec4  e1a00004          MOV      r0,r4                 ;2588
003ec8  ebfffffe          BL       yaffs_checkpoint_save
                  |L1.16076|
003ecc  e3550000          CMP      r5,#0                 ;2589
003ed0  0a000001          BEQ      |L1.16092|
003ed4  e3a00001          MOV      r0,#1                 ;2589
003ed8  ea000000          B        |L1.16096|
                  |L1.16092|
003edc  e3a00000          MOV      r0,#0                 ;2589
                  |L1.16096|
003ee0  e58400c8          STR      r0,[r4,#0xc8]         ;2589
003ee4  e3a08000          MOV      r8,#0                 ;2590
003ee8  ea000007          B        |L1.16140|
                  |L1.16108|
003eec  e3e0000f          MVN      r0,#0xf               ;2592
003ef0  ebfffffe          BL       yaffsfs_SetError
003ef4  ea000004          B        |L1.16140|
                  |L1.16120|
003ef8  e3e00015          MVN      r0,#0x15              ;2595
003efc  ebfffffe          BL       yaffsfs_SetError
003f00  ea000001          B        |L1.16140|
                  |L1.16132|
003f04  e3e00012          MVN      r0,#0x12              ;2598
003f08  ebfffffe          BL       yaffsfs_SetError
                  |L1.16140|
003f0c  ebfffffe          BL       yaffsfs_Unlock
003f10  e1a00008          MOV      r0,r8                 ;2601
003f14  eaffffce          B        |L1.15956|
;;;2604   
                          ENDP

                  yaffs_unmount2 PROC
;;;2605   int yaffs_unmount2(const YCHAR *path, int force)
003f18  e92d41f0          PUSH     {r4-r8,lr}
;;;2606   {
003f1c  e1a05000          MOV      r5,r0
003f20  e1a06001          MOV      r6,r1
;;;2607   	int retVal = -1;
003f24  e3e08000          MVN      r8,#0
;;;2608   	struct yaffs_dev *dev = NULL;
003f28  e3a04000          MOV      r4,#0
;;;2609   
;;;2610   	if (!path) {
003f2c  e3550000          CMP      r5,#0
003f30  1a000003          BNE      |L1.16196|
;;;2611   		yaffsfs_SetError(-EFAULT);
003f34  e3e0000d          MVN      r0,#0xd
003f38  ebfffffe          BL       yaffsfs_SetError
;;;2612   		return -1;
003f3c  e3e00000          MVN      r0,#0
                  |L1.16192|
;;;2613   	}
;;;2614   
;;;2615   	if (yaffsfs_CheckPath(path) < 0) {
;;;2616   		yaffsfs_SetError(-ENAMETOOLONG);
;;;2617   		return -1;
;;;2618   	}
;;;2619   
;;;2620   	yaffsfs_Lock();
;;;2621   	dev = yaffsfs_FindMountPoint(path);
;;;2622   	if (dev) {
;;;2623   		if (dev->is_mounted) {
;;;2624   			int inUse;
;;;2625   			yaffs_flush_whole_cache(dev);
;;;2626   			yaffs_checkpoint_save(dev);
;;;2627   			inUse = yaffsfs_IsDevBusy(dev);
;;;2628   			if (!inUse || force) {
;;;2629   				if (inUse)
;;;2630   					yaffsfs_BreakDeviceHandles(dev);
;;;2631   				yaffs_deinitialise(dev);
;;;2632   
;;;2633   				retVal = 0;
;;;2634   			} else
;;;2635   				yaffsfs_SetError(-EBUSY);
;;;2636   
;;;2637   		} else
;;;2638   			yaffsfs_SetError(-EINVAL);
;;;2639   
;;;2640   	} else
;;;2641   		yaffsfs_SetError(-ENODEV);
;;;2642   
;;;2643   	yaffsfs_Unlock();
;;;2644   	return retVal;
;;;2645   
;;;2646   }
003f40  e8bd81f0          POP      {r4-r8,pc}
                  |L1.16196|
003f44  e1a00005          MOV      r0,r5                 ;2615
003f48  ebfffffe          BL       yaffsfs_CheckPath
003f4c  e3500000          CMP      r0,#0                 ;2615
003f50  aa000003          BGE      |L1.16228|
003f54  e3e00023          MVN      r0,#0x23              ;2616
003f58  ebfffffe          BL       yaffsfs_SetError
003f5c  e3e00000          MVN      r0,#0                 ;2617
003f60  eafffff6          B        |L1.16192|
                  |L1.16228|
003f64  ebfffffe          BL       yaffsfs_Lock
003f68  e1a00005          MOV      r0,r5                 ;2621
003f6c  ebfffffe          BL       yaffsfs_FindMountPoint
003f70  e1a04000          MOV      r4,r0                 ;2621
003f74  e3540000          CMP      r4,#0                 ;2622
003f78  0a00001b          BEQ      |L1.16364|
003f7c  e59400c4          LDR      r0,[r4,#0xc4]         ;2623
003f80  e3500000          CMP      r0,#0                 ;2623
003f84  0a000015          BEQ      |L1.16352|
003f88  e1a00004          MOV      r0,r4                 ;2625
003f8c  ebfffffe          BL       yaffs_flush_whole_cache
003f90  e1a00004          MOV      r0,r4                 ;2626
003f94  ebfffffe          BL       yaffs_checkpoint_save
003f98  e1a00004          MOV      r0,r4                 ;2627
003f9c  ebfffffe          BL       yaffsfs_IsDevBusy
003fa0  e1a07000          MOV      r7,r0                 ;2627
003fa4  e3570000          CMP      r7,#0                 ;2628
003fa8  0a000001          BEQ      |L1.16308|
003fac  e3560000          CMP      r6,#0                 ;2628
003fb0  0a000007          BEQ      |L1.16340|
                  |L1.16308|
003fb4  e3570000          CMP      r7,#0                 ;2629
003fb8  0a000001          BEQ      |L1.16324|
003fbc  e1a00004          MOV      r0,r4                 ;2630
003fc0  ebfffffe          BL       yaffsfs_BreakDeviceHandles
                  |L1.16324|
003fc4  e1a00004          MOV      r0,r4                 ;2631
003fc8  ebfffffe          BL       yaffs_deinitialise
003fcc  e3a08000          MOV      r8,#0                 ;2633
003fd0  ea000001          B        |L1.16348|
                  |L1.16340|
003fd4  e3e0000f          MVN      r0,#0xf               ;2635
003fd8  ebfffffe          BL       yaffsfs_SetError
                  |L1.16348|
003fdc  ea000004          B        |L1.16372|
                  |L1.16352|
003fe0  e3e00015          MVN      r0,#0x15              ;2638
003fe4  ebfffffe          BL       yaffsfs_SetError
003fe8  ea000001          B        |L1.16372|
                  |L1.16364|
003fec  e3e00012          MVN      r0,#0x12              ;2641
003ff0  ebfffffe          BL       yaffsfs_SetError
                  |L1.16372|
003ff4  ebfffffe          BL       yaffsfs_Unlock
003ff8  e1a00008          MOV      r0,r8                 ;2644
003ffc  eaffffcf          B        |L1.16192|
;;;2647   
                          ENDP

                  yaffs_unmount PROC
;;;2648   int yaffs_unmount(const YCHAR *path)
004000  e92d4010          PUSH     {r4,lr}
;;;2649   {
004004  e1a04000          MOV      r4,r0
;;;2650   	return yaffs_unmount2(path, 0);
004008  e3a01000          MOV      r1,#0
00400c  e1a00004          MOV      r0,r4
004010  ebfffffe          BL       yaffs_unmount2
;;;2651   }
004014  e8bd8010          POP      {r4,pc}
;;;2652   
                          ENDP

                  yaffs_freespace PROC
;;;2653   loff_t yaffs_freespace(const YCHAR *path)
004018  e92d43f8          PUSH     {r3-r9,lr}
;;;2654   {
00401c  e1a05000          MOV      r5,r0
004020  e3e01000          MVN      r1,#0
;;;2655   	loff_t retVal = -1;
004024  e1a06001          MOV      r6,r1
004028  e1a07001          MOV      r7,r1
;;;2656   	struct yaffs_dev *dev = NULL;
00402c  e3a04000          MOV      r4,#0
;;;2657   	YCHAR *dummy;
;;;2658   
;;;2659   	if (!path) {
004030  e3550000          CMP      r5,#0
004034  1a000004          BNE      |L1.16460|
;;;2660   		yaffsfs_SetError(-EFAULT);
004038  e3e0000d          MVN      r0,#0xd
00403c  ebfffffe          BL       yaffsfs_SetError
004040  e3e00000          MVN      r0,#0
004044  e1a01000          MOV      r1,r0
                  |L1.16456|
;;;2661   		return -1;
;;;2662   	}
;;;2663   
;;;2664   	if (yaffsfs_CheckPath(path) < 0) {
;;;2665   		yaffsfs_SetError(-ENAMETOOLONG);
;;;2666   		return -1;
;;;2667   	}
;;;2668   
;;;2669   	yaffsfs_Lock();
;;;2670   	dev = yaffsfs_FindDevice(path, &dummy);
;;;2671   	if (dev && dev->is_mounted) {
;;;2672   		retVal = yaffs_get_n_free_chunks(dev);
;;;2673   		retVal *= dev->data_bytes_per_chunk;
;;;2674   
;;;2675   	} else
;;;2676   		yaffsfs_SetError(-EINVAL);
;;;2677   
;;;2678   	yaffsfs_Unlock();
;;;2679   	return retVal;
;;;2680   }
004048  e8bd83f8          POP      {r3-r9,pc}
                  |L1.16460|
00404c  e1a00005          MOV      r0,r5                 ;2664
004050  ebfffffe          BL       yaffsfs_CheckPath
004054  e3500000          CMP      r0,#0                 ;2664
004058  aa000004          BGE      |L1.16496|
00405c  e3e00023          MVN      r0,#0x23              ;2665
004060  ebfffffe          BL       yaffsfs_SetError
004064  e3e00000          MVN      r0,#0                 ;2665
004068  e1a01000          MOV      r1,r0                 ;2665
00406c  eafffff5          B        |L1.16456|
                  |L1.16496|
004070  ebfffffe          BL       yaffsfs_Lock
004074  e1a0100d          MOV      r1,sp                 ;2670
004078  e1a00005          MOV      r0,r5                 ;2670
00407c  ebfffffe          BL       yaffsfs_FindDevice
004080  e1a04000          MOV      r4,r0                 ;2670
004084  e3540000          CMP      r4,#0                 ;2671
004088  0a00000e          BEQ      |L1.16584|
00408c  e59400c4          LDR      r0,[r4,#0xc4]         ;2671
004090  e3500000          CMP      r0,#0                 ;2671
004094  0a00000b          BEQ      |L1.16584|
004098  e1a00004          MOV      r0,r4                 ;2672
00409c  ebfffffe          BL       yaffs_get_n_free_chunks
0040a0  e1a07fc0          ASR      r7,r0,#31             ;2672
0040a4  e1a06000          MOV      r6,r0                 ;2672
0040a8  e59400a4          LDR      r0,[r4,#0xa4]         ;2673
0040ac  e1a01fc0          ASR      r1,r0,#31             ;2673
0040b0  e1a02006          MOV      r2,r6                 ;2673
0040b4  e088c290          UMULL    r12,r8,r0,r2          ;2673
0040b8  e0218196          MLA      r1,r6,r1,r8           ;2673
0040bc  e0271790          MLA      r7,r0,r7,r1           ;2673
0040c0  e1a0600c          MOV      r6,r12                ;2673
0040c4  ea000001          B        |L1.16592|
                  |L1.16584|
0040c8  e3e00015          MVN      r0,#0x15              ;2676
0040cc  ebfffffe          BL       yaffsfs_SetError
                  |L1.16592|
0040d0  ebfffffe          BL       yaffsfs_Unlock
0040d4  e1a00006          MOV      r0,r6                 ;2679
0040d8  e1a01007          MOV      r1,r7                 ;2679
0040dc  eaffffd9          B        |L1.16456|
;;;2681   
                          ENDP

                  yaffs_totalspace PROC
;;;2682   loff_t yaffs_totalspace(const YCHAR *path)
0040e0  e92d43f8          PUSH     {r3-r9,lr}
;;;2683   {
0040e4  e1a07000          MOV      r7,r0
0040e8  e3e01000          MVN      r1,#0
;;;2684   	loff_t retVal = -1;
0040ec  e1a05001          MOV      r5,r1
0040f0  e1a06001          MOV      r6,r1
;;;2685   	struct yaffs_dev *dev = NULL;
0040f4  e3a04000          MOV      r4,#0
;;;2686   	YCHAR *dummy;
;;;2687   
;;;2688   	if (!path) {
0040f8  e3570000          CMP      r7,#0
0040fc  1a000004          BNE      |L1.16660|
;;;2689   		yaffsfs_SetError(-EFAULT);
004100  e3e0000d          MVN      r0,#0xd
004104  ebfffffe          BL       yaffsfs_SetError
004108  e3e00000          MVN      r0,#0
00410c  e1a01000          MOV      r1,r0
                  |L1.16656|
;;;2690   		return -1;
;;;2691   	}
;;;2692   
;;;2693   	if (yaffsfs_CheckPath(path) < 0) {
;;;2694   		yaffsfs_SetError(-ENAMETOOLONG);
;;;2695   		return -1;
;;;2696   	}
;;;2697   
;;;2698   	yaffsfs_Lock();
;;;2699   	dev = yaffsfs_FindDevice(path, &dummy);
;;;2700   	if (dev && dev->is_mounted) {
;;;2701   		retVal = (dev->param.end_block - dev->param.start_block + 1) -
;;;2702   		    dev->param.n_reserved_blocks;
;;;2703   		retVal *= dev->param.chunks_per_block;
;;;2704   		retVal *= dev->data_bytes_per_chunk;
;;;2705   
;;;2706   	} else
;;;2707   		yaffsfs_SetError(-EINVAL);
;;;2708   
;;;2709   	yaffsfs_Unlock();
;;;2710   	return retVal;
;;;2711   }
004110  e8bd83f8          POP      {r3-r9,pc}
                  |L1.16660|
004114  e1a00007          MOV      r0,r7                 ;2693
004118  ebfffffe          BL       yaffsfs_CheckPath
00411c  e3500000          CMP      r0,#0                 ;2693
004120  aa000004          BGE      |L1.16696|
004124  e3e00023          MVN      r0,#0x23              ;2694
004128  ebfffffe          BL       yaffsfs_SetError
00412c  e3e00000          MVN      r0,#0                 ;2694
004130  e1a01000          MOV      r1,r0                 ;2694
004134  eafffff5          B        |L1.16656|
                  |L1.16696|
004138  ebfffffe          BL       yaffsfs_Lock
00413c  e1a0100d          MOV      r1,sp                 ;2699
004140  e1a00007          MOV      r0,r7                 ;2699
004144  ebfffffe          BL       yaffsfs_FindDevice
004148  e1a04000          MOV      r4,r0                 ;2699
00414c  e3540000          CMP      r4,#0                 ;2700
004150  0a000019          BEQ      |L1.16828|
004154  e59400c4          LDR      r0,[r4,#0xc4]         ;2700
004158  e3500000          CMP      r0,#0                 ;2700
00415c  0a000016          BEQ      |L1.16828|
004160  e5940018          LDR      r0,[r4,#0x18]         ;2701
004164  e5941014          LDR      r1,[r4,#0x14]         ;2701
004168  e0400001          SUB      r0,r0,r1              ;2701
00416c  e2800001          ADD      r0,r0,#1              ;2701
004170  e594101c          LDR      r1,[r4,#0x1c]         ;2701
004174  e0400001          SUB      r0,r0,r1              ;2701
004178  e1a06fc0          ASR      r6,r0,#31             ;2701
00417c  e1a05000          MOV      r5,r0                 ;2701
004180  e594000c          LDR      r0,[r4,#0xc]          ;2703
004184  e1a01fc0          ASR      r1,r0,#31             ;2703
004188  e1a02005          MOV      r2,r5                 ;2703
00418c  e0883290          UMULL    r3,r8,r0,r2           ;2703
004190  e0218195          MLA      r1,r5,r1,r8           ;2703
004194  e0261690          MLA      r6,r0,r6,r1           ;2703
004198  e1a05003          MOV      r5,r3                 ;2703
00419c  e59400a4          LDR      r0,[r4,#0xa4]         ;2704
0041a0  e1a01fc0          ASR      r1,r0,#31             ;2704
0041a4  e1a02005          MOV      r2,r5                 ;2704
0041a8  e0883290          UMULL    r3,r8,r0,r2           ;2704
0041ac  e0218195          MLA      r1,r5,r1,r8           ;2704
0041b0  e0261690          MLA      r6,r0,r6,r1           ;2704
0041b4  e1a05003          MOV      r5,r3                 ;2704
0041b8  ea000001          B        |L1.16836|
                  |L1.16828|
0041bc  e3e00015          MVN      r0,#0x15              ;2707
0041c0  ebfffffe          BL       yaffsfs_SetError
                  |L1.16836|
0041c4  ebfffffe          BL       yaffsfs_Unlock
0041c8  e1a00005          MOV      r0,r5                 ;2710
0041cc  e1a01006          MOV      r1,r6                 ;2710
0041d0  eaffffce          B        |L1.16656|
;;;2712   
                          ENDP

                  yaffs_inodecount PROC
;;;2713   int yaffs_inodecount(const YCHAR *path)
0041d4  e92d40f8          PUSH     {r3-r7,lr}
;;;2714   {
0041d8  e1a07000          MOV      r7,r0
0041dc  e3e01000          MVN      r1,#0
;;;2715   	loff_t retVal = -1;
0041e0  e1a04001          MOV      r4,r1
0041e4  e1a05001          MOV      r5,r1
;;;2716   	struct yaffs_dev *dev = NULL;
0041e8  e3a06000          MOV      r6,#0
;;;2717   	YCHAR *dummy;
;;;2718   
;;;2719   	if (!path) {
0041ec  e3570000          CMP      r7,#0
0041f0  1a000003          BNE      |L1.16900|
;;;2720   		yaffsfs_SetError(-EFAULT);
0041f4  e3e0000d          MVN      r0,#0xd
0041f8  ebfffffe          BL       yaffsfs_SetError
;;;2721   		return -1;
0041fc  e3e00000          MVN      r0,#0
                  |L1.16896|
;;;2722   	}
;;;2723   
;;;2724   	if (yaffsfs_CheckPath(path) < 0) {
;;;2725   		yaffsfs_SetError(-ENAMETOOLONG);
;;;2726   		return -1;
;;;2727   	}
;;;2728   
;;;2729   	yaffsfs_Lock();
;;;2730   	dev = yaffsfs_FindDevice(path, &dummy);
;;;2731   	if (dev && dev->is_mounted) {
;;;2732   		int n_obj = dev->n_obj;
;;;2733   		if (n_obj > dev->n_hardlinks)
;;;2734   			retVal = n_obj - dev->n_hardlinks;
;;;2735   	}
;;;2736   
;;;2737   	if (retVal < 0)
;;;2738   		yaffsfs_SetError(-EINVAL);
;;;2739   
;;;2740   	yaffsfs_Unlock();
;;;2741   	return retVal;
;;;2742   }
004200  e8bd80f8          POP      {r3-r7,pc}
                  |L1.16900|
004204  e1a00007          MOV      r0,r7                 ;2724
004208  ebfffffe          BL       yaffsfs_CheckPath
00420c  e3500000          CMP      r0,#0                 ;2724
004210  aa000003          BGE      |L1.16932|
004214  e3e00023          MVN      r0,#0x23              ;2725
004218  ebfffffe          BL       yaffsfs_SetError
00421c  e3e00000          MVN      r0,#0                 ;2726
004220  eafffff6          B        |L1.16896|
                  |L1.16932|
004224  ebfffffe          BL       yaffsfs_Lock
004228  e1a0100d          MOV      r1,sp                 ;2730
00422c  e1a00007          MOV      r0,r7                 ;2730
004230  ebfffffe          BL       yaffsfs_FindDevice
004234  e1a06000          MOV      r6,r0                 ;2730
004238  e3560000          CMP      r6,#0                 ;2731
00423c  0a00000a          BEQ      |L1.17004|
004240  e59600c4          LDR      r0,[r6,#0xc4]         ;2731
004244  e3500000          CMP      r0,#0                 ;2731
004248  0a000007          BEQ      |L1.17004|
00424c  e596013c          LDR      r0,[r6,#0x13c]        ;2732
004250  e5961144          LDR      r1,[r6,#0x144]        ;2733
004254  e1510000          CMP      r1,r0                 ;2733
004258  aa000002          BGE      |L1.17000|
00425c  e5961144          LDR      r1,[r6,#0x144]        ;2734
004260  e0404001          SUB      r4,r0,r1              ;2734
004264  e1a05fc4          ASR      r5,r4,#31             ;2734
                  |L1.17000|
004268  e1a00000          MOV      r0,r0                 ;2735
                  |L1.17004|
00426c  e3a01000          MOV      r1,#0                 ;2735
004270  e1a00001          MOV      r0,r1                 ;2735
004274  e0541001          SUBS     r1,r4,r1              ;2735
004278  e0d50000          SBCS     r0,r5,r0              ;2735
00427c  aa000001          BGE      |L1.17032|
004280  e3e00015          MVN      r0,#0x15              ;2738
004284  ebfffffe          BL       yaffsfs_SetError
                  |L1.17032|
004288  ebfffffe          BL       yaffsfs_Unlock
00428c  e1a00004          MOV      r0,r4                 ;2741
004290  eaffffda          B        |L1.16896|
;;;2743   
                          ENDP

                  yaffsfs_DirAdvance PROC
;;;2813   
;;;2814   static void yaffsfs_DirAdvance(struct yaffsfs_DirSearchContxt *dsc)
004294  e92d4010          PUSH     {r4,lr}
;;;2815   {
004298  e1a04000          MOV      r4,r0
;;;2816   	if (dsc &&
00429c  e3540000          CMP      r4,#0
0042a0  0a00001d          BEQ      |L1.17180|
;;;2817   	    dsc->dirObj &&
0042a4  e5940214          LDR      r0,[r4,#0x214]
0042a8  e3500000          CMP      r0,#0
0042ac  0a00001a          BEQ      |L1.17180|
;;;2818   	    dsc->dirObj->variant_type == YAFFS_OBJECT_TYPE_DIRECTORY) {
0042b0  e5940214          LDR      r0,[r4,#0x214]
0042b4  e5d00064          LDRB     r0,[r0,#0x64]
0042b8  e3500003          CMP      r0,#3
0042bc  1a000016          BNE      |L1.17180|
;;;2819   
;;;2820   		if (dsc->nextReturn == NULL ||
0042c0  e5940218          LDR      r0,[r4,#0x218]
0042c4  e3500000          CMP      r0,#0
0042c8  0a000004          BEQ      |L1.17120|
;;;2821   		    list_empty(&dsc->dirObj->variant.dir_variant.children))
0042cc  e5941214          LDR      r1,[r4,#0x214]
0042d0  e2810068          ADD      r0,r1,#0x68
0042d4  ebfffffe          BL       list_empty
0042d8  e3500000          CMP      r0,#0
0042dc  0a000002          BEQ      |L1.17132|
                  |L1.17120|
;;;2822   			dsc->nextReturn = NULL;
0042e0  e3a00000          MOV      r0,#0
0042e4  e5840218          STR      r0,[r4,#0x218]
0042e8  ea00000b          B        |L1.17180|
                  |L1.17132|
;;;2823   		else {
;;;2824   			struct list_head *next = dsc->nextReturn->siblings.next;
0042ec  e5941218          LDR      r1,[r4,#0x218]
0042f0  e5910020          LDR      r0,[r1,#0x20]
;;;2825   
;;;2826   			if (next == &dsc->dirObj->variant.dir_variant.children)
0042f4  e5941214          LDR      r1,[r4,#0x214]
0042f8  e2811068          ADD      r1,r1,#0x68
0042fc  e1510000          CMP      r1,r0
004300  1a000002          BNE      |L1.17168|
;;;2827   				dsc->nextReturn = NULL;	/* end of list */
004304  e3a01000          MOV      r1,#0
004308  e5841218          STR      r1,[r4,#0x218]
00430c  ea000001          B        |L1.17176|
                  |L1.17168|
;;;2828   			else
;;;2829   				dsc->nextReturn = list_entry(next,
004310  e2401020          SUB      r1,r0,#0x20
004314  e5841218          STR      r1,[r4,#0x218]
                  |L1.17176|
;;;2830   							     struct yaffs_obj,
;;;2831   							     siblings);
;;;2832   		}
004318  e1a00000          MOV      r0,r0
                  |L1.17180|
;;;2833   	} else {
;;;2834   		/* Hey someone isn't playing nice! */
;;;2835   	}
;;;2836   }
00431c  e8bd8010          POP      {r4,pc}
;;;2837   
                          ENDP

                  yaffsfs_RemoveObjectCallback PROC
;;;2838   static void yaffsfs_RemoveObjectCallback(struct yaffs_obj *obj)
004320  e92d4070          PUSH     {r4-r6,lr}
;;;2839   {
004324  e1a06000          MOV      r6,r0
;;;2840   
;;;2841   	struct list_head *i;
;;;2842   	struct yaffsfs_DirSearchContxt *dsc;
;;;2843   
;;;2844   	/* if search contexts not initilised then skip */
;;;2845   	if (!search_contexts.next)
004328  e59f06f4          LDR      r0,|L1.18980|
00432c  e5900000          LDR      r0,[r0,#0]  ; search_contexts
004330  e3500000          CMP      r0,#0
004334  1a000000          BNE      |L1.17212|
                  |L1.17208|
;;;2846   		return;
;;;2847   
;;;2848   	/* Iterate through the directory search contexts.
;;;2849   	 * If any are the one being removed, then advance the dsc to
;;;2850   	 * the next one to prevent a hanging ptr.
;;;2851   	 */
;;;2852   	list_for_each(i, &search_contexts) {
;;;2853   		if (i) {
;;;2854   			dsc = list_entry(i, struct yaffsfs_DirSearchContxt,
;;;2855   					 others);
;;;2856   			if (dsc->nextReturn == obj)
;;;2857   				yaffsfs_DirAdvance(dsc);
;;;2858   		}
;;;2859   	}
;;;2860   
;;;2861   }
004338  e8bd8070          POP      {r4-r6,pc}
                  |L1.17212|
00433c  e59f06e0          LDR      r0,|L1.18980|
004340  e5904000          LDR      r4,[r0,#0]            ;2852  ; search_contexts
004344  ea000008          B        |L1.17260|
                  |L1.17224|
004348  e3540000          CMP      r4,#0                 ;2853
00434c  0a000005          BEQ      |L1.17256|
004350  e2445f87          SUB      r5,r4,#0x21c          ;2854
004354  e5950218          LDR      r0,[r5,#0x218]        ;2856
004358  e1500006          CMP      r0,r6                 ;2856
00435c  1a000001          BNE      |L1.17256|
004360  e1a00005          MOV      r0,r5                 ;2857
004364  ebfffffe          BL       yaffsfs_DirAdvance
                  |L1.17256|
004368  e5944000          LDR      r4,[r4,#0]            ;2852
                  |L1.17260|
00436c  e59f06b0          LDR      r0,|L1.18980|
004370  e1540000          CMP      r4,r0                 ;2852
004374  1afffff3          BNE      |L1.17224|
004378  e1a00000          MOV      r0,r0
00437c  eaffffed          B        |L1.17208|
;;;2862   
                          ENDP

                  yaffs_add_device PROC
;;;2743   
;;;2744   void yaffs_add_device(struct yaffs_dev *dev)
004380  e92d4070          PUSH     {r4-r6,lr}
;;;2745   {
004384  e1a04000          MOV      r4,r0
;;;2746   	struct list_head *cfg;
;;;2747   	/* First check that the device is not in the list. */
;;;2748   
;;;2749   	list_for_each(cfg, &yaffsfs_deviceList) {
004388  e59f0698          LDR      r0,|L1.18984|
00438c  e5905000          LDR      r5,[r0,#0]  ; yaffsfs_deviceList
004390  ea000004          B        |L1.17320|
                  |L1.17300|
;;;2750   		if (dev == list_entry(cfg, struct yaffs_dev, dev_list))
004394  e245009c          SUB      r0,r5,#0x9c
004398  e1500004          CMP      r0,r4
00439c  1a000000          BNE      |L1.17316|
                  |L1.17312|
;;;2751   			return;
;;;2752   	}
;;;2753   
;;;2754   	dev->is_mounted = 0;
;;;2755   	dev->param.remove_obj_fn = yaffsfs_RemoveObjectCallback;
;;;2756   
;;;2757   	if (!dev->dev_list.next)
;;;2758   		INIT_LIST_HEAD(&dev->dev_list);
;;;2759   
;;;2760   	list_add(&dev->dev_list, &yaffsfs_deviceList);
;;;2761   }
0043a0  e8bd8070          POP      {r4-r6,pc}
                  |L1.17316|
0043a4  e5955000          LDR      r5,[r5,#0]            ;2749
                  |L1.17320|
0043a8  e59f0678          LDR      r0,|L1.18984|
0043ac  e1550000          CMP      r5,r0                 ;2749
0043b0  1afffff7          BNE      |L1.17300|
0043b4  e3a00000          MOV      r0,#0                 ;2754
0043b8  e58400c4          STR      r0,[r4,#0xc4]         ;2754
0043bc  e59f0668          LDR      r0,|L1.18988|
0043c0  e5840068          STR      r0,[r4,#0x68]         ;2755
0043c4  e594009c          LDR      r0,[r4,#0x9c]         ;2757
0043c8  e3500000          CMP      r0,#0                 ;2757
0043cc  1a000005          BNE      |L1.17384|
0043d0  e1a00000          MOV      r0,r0                 ;2758
0043d4  e284009c          ADD      r0,r4,#0x9c           ;2758
0043d8  e584009c          STR      r0,[r4,#0x9c]         ;2758
0043dc  e284009c          ADD      r0,r4,#0x9c           ;2758
0043e0  e58400a0          STR      r0,[r4,#0xa0]         ;2758
0043e4  e1a00000          MOV      r0,r0                 ;2758
                  |L1.17384|
0043e8  e59f1638          LDR      r1,|L1.18984|
0043ec  e284009c          ADD      r0,r4,#0x9c           ;2760
0043f0  ebfffffe          BL       list_add
0043f4  e1a00000          MOV      r0,r0
0043f8  eaffffe8          B        |L1.17312|
;;;2762   
                          ENDP

                  yaffs_remove_device PROC
;;;2763   void yaffs_remove_device(struct yaffs_dev *dev)
0043fc  e92d4070          PUSH     {r4-r6,lr}
;;;2764   {
004400  e1a05000          MOV      r5,r0
;;;2765   	list_del_init(&dev->dev_list);
004404  e285409c          ADD      r4,r5,#0x9c
004408  e1a00004          MOV      r0,r4
00440c  ebfffffe          BL       list_del
004410  e5844004          STR      r4,[r4,#4]
004414  e5844000          STR      r4,[r4,#0]
004418  e1a00000          MOV      r0,r0
;;;2766   }
00441c  e8bd8070          POP      {r4-r6,pc}
;;;2767   
                          ENDP

                  yaffs_dev_rewind PROC
;;;2770   static struct list_head *dev_iterator;
;;;2771   void yaffs_dev_rewind(void)
004420  e59f0600          LDR      r0,|L1.18984|
;;;2772   {
;;;2773   	dev_iterator = yaffsfs_deviceList.next;
004424  e5900000          LDR      r0,[r0,#0]  ; yaffsfs_deviceList
004428  e59f1600          LDR      r1,|L1.18992|
00442c  e5810000          STR      r0,[r1,#0]  ; dev_iterator
;;;2774   }
004430  e12fff1e          BX       lr
;;;2775   
                          ENDP

                  yaffs_next_dev PROC
;;;2776   struct yaffs_dev *yaffs_next_dev(void)
004434  e59f05f4          LDR      r0,|L1.18992|
;;;2777   {
;;;2778   	struct yaffs_dev *retval;
;;;2779   
;;;2780   	if (!dev_iterator)
004438  e5900000          LDR      r0,[r0,#0]  ; dev_iterator
00443c  e3500000          CMP      r0,#0
004440  1a000001          BNE      |L1.17484|
;;;2781   		return NULL;
004444  e3a00000          MOV      r0,#0
                  |L1.17480|
;;;2782   	if (dev_iterator == &yaffsfs_deviceList)
;;;2783   		return NULL;
;;;2784   
;;;2785   	retval = list_entry(dev_iterator, struct yaffs_dev, dev_list);
;;;2786   	dev_iterator = dev_iterator->next;
;;;2787   	return retval;
;;;2788   }
004448  e12fff1e          BX       lr
                  |L1.17484|
00444c  e59f05dc          LDR      r0,|L1.18992|
004450  e5900000          LDR      r0,[r0,#0]            ;2782  ; dev_iterator
004454  e59f25cc          LDR      r2,|L1.18984|
004458  e1500002          CMP      r0,r2                 ;2782
00445c  1a000001          BNE      |L1.17512|
004460  e3a00000          MOV      r0,#0                 ;2783
004464  eafffff7          B        |L1.17480|
                  |L1.17512|
004468  e59f05c0          LDR      r0,|L1.18992|
00446c  e5900000          LDR      r0,[r0,#0]            ;2785  ; dev_iterator
004470  e240109c          SUB      r1,r0,#0x9c           ;2785
004474  e59f05b4          LDR      r0,|L1.18992|
004478  e5900000          LDR      r0,[r0,#0]            ;2786  ; dev_iterator
00447c  e5900000          LDR      r0,[r0,#0]            ;2786
004480  e59f25a8          LDR      r2,|L1.18992|
004484  e5820000          STR      r0,[r2,#0]            ;2786  ; dev_iterator
004488  e1a00001          MOV      r0,r1                 ;2787
00448c  eaffffed          B        |L1.17480|
;;;2789   
                          ENDP

                  yaffsfs_SetDirRewound PROC
;;;2793   
;;;2794   static void yaffsfs_SetDirRewound(struct yaffsfs_DirSearchContxt *dsc)
004490  e92d4010          PUSH     {r4,lr}
;;;2795   {
004494  e1a04000          MOV      r4,r0
;;;2796   	if (dsc &&
004498  e3540000          CMP      r4,#0
00449c  0a000016          BEQ      |L1.17660|
;;;2797   	    dsc->dirObj &&
0044a0  e5940214          LDR      r0,[r4,#0x214]
0044a4  e3500000          CMP      r0,#0
0044a8  0a000013          BEQ      |L1.17660|
;;;2798   	    dsc->dirObj->variant_type == YAFFS_OBJECT_TYPE_DIRECTORY) {
0044ac  e5940214          LDR      r0,[r4,#0x214]
0044b0  e5d00064          LDRB     r0,[r0,#0x64]
0044b4  e3500003          CMP      r0,#3
0044b8  1a00000f          BNE      |L1.17660|
;;;2799   
;;;2800   		dsc->offset = 0;
0044bc  e5940224          LDR      r0,[r4,#0x224]
0044c0  e1a00a20          LSR      r0,r0,#20
0044c4  e1a00a00          LSL      r0,r0,#20
0044c8  e5840224          STR      r0,[r4,#0x224]
;;;2801   
;;;2802   		if (list_empty(&dsc->dirObj->variant.dir_variant.children))
0044cc  e5941214          LDR      r1,[r4,#0x214]
0044d0  e2810068          ADD      r0,r1,#0x68
0044d4  ebfffffe          BL       list_empty
0044d8  e3500000          CMP      r0,#0
0044dc  0a000002          BEQ      |L1.17644|
;;;2803   			dsc->nextReturn = NULL;
0044e0  e3a00000          MOV      r0,#0
0044e4  e5840218          STR      r0,[r4,#0x218]
0044e8  ea000003          B        |L1.17660|
                  |L1.17644|
;;;2804   		else
;;;2805   			dsc->nextReturn =
0044ec  e5940214          LDR      r0,[r4,#0x214]
0044f0  e5900068          LDR      r0,[r0,#0x68]
0044f4  e2400020          SUB      r0,r0,#0x20
0044f8  e5840218          STR      r0,[r4,#0x218]
                  |L1.17660|
;;;2806   			    list_entry(dsc->dirObj->variant.dir_variant.
;;;2807   				       children.next, struct yaffs_obj,
;;;2808   				       siblings);
;;;2809   	} else {
;;;2810   		/* Hey someone isn't playing nice! */
;;;2811   	}
;;;2812   }
0044fc  e8bd8010          POP      {r4,pc}
;;;2813   
                          ENDP

                  yaffs_opendir PROC
;;;2862   
;;;2863   yaffs_DIR *yaffs_opendir(const YCHAR *dirname)
004500  e92d41f0          PUSH     {r4-r8,lr}
;;;2864   {
004504  e24dd018          SUB      sp,sp,#0x18
004508  e1a07000          MOV      r7,r0
;;;2865   	yaffs_DIR *dir = NULL;
00450c  e3a08000          MOV      r8,#0
;;;2866   	struct yaffs_obj *obj = NULL;
004510  e3a05000          MOV      r5,#0
;;;2867   	struct yaffsfs_DirSearchContxt *dsc = NULL;
004514  e3a04000          MOV      r4,#0
;;;2868   	int notDir = 0;
004518  e3a00000          MOV      r0,#0
00451c  e58d0014          STR      r0,[sp,#0x14]
;;;2869   	int loop = 0;
004520  e58d0010          STR      r0,[sp,#0x10]
;;;2870   
;;;2871   	if (!dirname) {
004524  e3570000          CMP      r7,#0
004528  1a000004          BNE      |L1.17728|
;;;2872   		yaffsfs_SetError(-EFAULT);
00452c  e3e0000d          MVN      r0,#0xd
004530  ebfffffe          BL       yaffsfs_SetError
;;;2873   		return NULL;
004534  e3a00000          MOV      r0,#0
                  |L1.17720|
004538  e28dd018          ADD      sp,sp,#0x18
;;;2874   	}
;;;2875   
;;;2876   	if (yaffsfs_CheckPath(dirname) < 0) {
;;;2877   		yaffsfs_SetError(-ENAMETOOLONG);
;;;2878   		return NULL;
;;;2879   	}
;;;2880   
;;;2881   	yaffsfs_Lock();
;;;2882   
;;;2883   	obj = yaffsfs_FindObject(NULL, dirname, 0, 1, NULL, &notDir, &loop);
;;;2884   
;;;2885   	if (!obj && notDir)
;;;2886   		yaffsfs_SetError(-ENOTDIR);
;;;2887   	else if (loop)
;;;2888   		yaffsfs_SetError(-ELOOP);
;;;2889   	else if (!obj)
;;;2890   		yaffsfs_SetError(-ENOENT);
;;;2891   	else if (obj->variant_type != YAFFS_OBJECT_TYPE_DIRECTORY)
;;;2892   		yaffsfs_SetError(-ENOTDIR);
;;;2893   	else {
;;;2894   		int i;
;;;2895   
;;;2896   		for (i = 0, dsc = NULL; i < YAFFSFS_N_DSC && !dsc; i++) {
;;;2897   			if (!yaffsfs_dsc[i].inUse)
;;;2898   				dsc = &yaffsfs_dsc[i];
;;;2899   		}
;;;2900   
;;;2901   		dir = (yaffs_DIR *) dsc;
;;;2902   
;;;2903   		if (dsc) {
;;;2904   			memset(dsc, 0, sizeof(struct yaffsfs_DirSearchContxt));
;;;2905   			dsc->inUse = 1;
;;;2906   			dsc->dirObj = obj;
;;;2907   			yaffs_strncpy(dsc->name, dirname, NAME_MAX);
;;;2908   			INIT_LIST_HEAD(&dsc->others);
;;;2909   
;;;2910   			if (!search_contexts.next)
;;;2911   				INIT_LIST_HEAD(&search_contexts);
;;;2912   
;;;2913   			list_add(&dsc->others, &search_contexts);
;;;2914   			yaffsfs_SetDirRewound(dsc);
;;;2915   		}
;;;2916   
;;;2917   	}
;;;2918   
;;;2919   	yaffsfs_Unlock();
;;;2920   
;;;2921   	return dir;
;;;2922   }
00453c  e8bd81f0          POP      {r4-r8,pc}
                  |L1.17728|
004540  e1a00007          MOV      r0,r7                 ;2876
004544  ebfffffe          BL       yaffsfs_CheckPath
004548  e3500000          CMP      r0,#0                 ;2876
00454c  aa000003          BGE      |L1.17760|
004550  e3e00023          MVN      r0,#0x23              ;2877
004554  ebfffffe          BL       yaffsfs_SetError
004558  e3a00000          MOV      r0,#0                 ;2878
00455c  eafffff5          B        |L1.17720|
                  |L1.17760|
004560  ebfffffe          BL       yaffsfs_Lock
004564  e28d0010          ADD      r0,sp,#0x10           ;2883
004568  e28d1014          ADD      r1,sp,#0x14           ;2883
00456c  e3a02000          MOV      r2,#0                 ;2883
004570  e3a03001          MOV      r3,#1                 ;2883
004574  e58d1004          STR      r1,[sp,#4]            ;2883
004578  e1a01007          MOV      r1,r7                 ;2883
00457c  e58d0008          STR      r0,[sp,#8]            ;2883
004580  e58d2000          STR      r2,[sp,#0]            ;2883
004584  e1a00002          MOV      r0,r2                 ;2883
004588  ebfffffe          BL       yaffsfs_FindObject
00458c  e1a05000          MOV      r5,r0                 ;2883
004590  e3550000          CMP      r5,#0                 ;2885
004594  1a000005          BNE      |L1.17840|
004598  e59d0014          LDR      r0,[sp,#0x14]         ;2885
00459c  e3500000          CMP      r0,#0                 ;2885
0045a0  0a000002          BEQ      |L1.17840|
0045a4  e3e00013          MVN      r0,#0x13              ;2886
0045a8  ebfffffe          BL       yaffsfs_SetError
0045ac  ea000048          B        |L1.18132|
                  |L1.17840|
0045b0  e59d0010          LDR      r0,[sp,#0x10]         ;2887
0045b4  e3500000          CMP      r0,#0                 ;2887
0045b8  0a000002          BEQ      |L1.17864|
0045bc  e3e00027          MVN      r0,#0x27              ;2888
0045c0  ebfffffe          BL       yaffsfs_SetError
0045c4  ea000042          B        |L1.18132|
                  |L1.17864|
0045c8  e3550000          CMP      r5,#0                 ;2889
0045cc  1a000002          BNE      |L1.17884|
0045d0  e3e00001          MVN      r0,#1                 ;2890
0045d4  ebfffffe          BL       yaffsfs_SetError
0045d8  ea00003d          B        |L1.18132|
                  |L1.17884|
0045dc  e5d50064          LDRB     r0,[r5,#0x64]         ;2891
0045e0  e3500003          CMP      r0,#3                 ;2891
0045e4  0a000002          BEQ      |L1.17908|
0045e8  e3e00013          MVN      r0,#0x13              ;2892
0045ec  ebfffffe          BL       yaffsfs_SetError
0045f0  ea000037          B        |L1.18132|
                  |L1.17908|
0045f4  e3a06000          MOV      r6,#0                 ;2896
0045f8  e3a04000          MOV      r4,#0                 ;2896
0045fc  ea00000b          B        |L1.17968|
                  |L1.17920|
004600  e0860106          ADD      r0,r6,r6,LSL #2       ;2897
004604  e0800306          ADD      r0,r0,r6,LSL #6       ;2897
004608  e59f1424          LDR      r1,|L1.18996|
00460c  e0810180          ADD      r0,r1,r0,LSL #3       ;2897
004610  e5900224          LDR      r0,[r0,#0x224]        ;2897
004614  e1a00580          LSL      r0,r0,#11             ;2897
004618  e1b00fa0          LSRS     r0,r0,#31             ;2897
00461c  1a000002          BNE      |L1.17964|
004620  e0860106          ADD      r0,r6,r6,LSL #2       ;2898
004624  e0800306          ADD      r0,r0,r6,LSL #6       ;2898
004628  e0814180          ADD      r4,r1,r0,LSL #3       ;2898
                  |L1.17964|
00462c  e2866001          ADD      r6,r6,#1              ;2896
                  |L1.17968|
004630  e3560014          CMP      r6,#0x14              ;2896
004634  aa000001          BGE      |L1.17984|
004638  e3540000          CMP      r4,#0                 ;2896
00463c  0affffef          BEQ      |L1.17920|
                  |L1.17984|
004640  e1a08004          MOV      r8,r4                 ;2901
004644  e3540000          CMP      r4,#0                 ;2903
004648  0a000020          BEQ      |L1.18128|
00464c  e3a01f8a          MOV      r1,#0x228             ;2904
004650  e1a00004          MOV      r0,r4                 ;2904
004654  ebfffffe          BL       __aeabi_memclr4
004658  e5940224          LDR      r0,[r4,#0x224]        ;2905
00465c  e3800601          ORR      r0,r0,#0x100000       ;2905
004660  e5840224          STR      r0,[r4,#0x224]        ;2905
004664  e5845214          STR      r5,[r4,#0x214]        ;2906
004668  e3a02c01          MOV      r2,#0x100             ;2907
00466c  e1a01007          MOV      r1,r7                 ;2907
004670  e2840e11          ADD      r0,r4,#0x110          ;2907
004674  ebfffffe          BL       strncpy
004678  e1a00000          MOV      r0,r0                 ;2908
00467c  e2840f87          ADD      r0,r4,#0x21c          ;2908
004680  e584021c          STR      r0,[r4,#0x21c]        ;2908
004684  e2840f87          ADD      r0,r4,#0x21c          ;2908
004688  e5840220          STR      r0,[r4,#0x220]        ;2908
00468c  e1a00000          MOV      r0,r0                 ;2908
004690  e59f038c          LDR      r0,|L1.18980|
004694  e5900000          LDR      r0,[r0,#0]            ;2910  ; search_contexts
004698  e3500000          CMP      r0,#0                 ;2910
00469c  1a000006          BNE      |L1.18108|
0046a0  e1a00000          MOV      r0,r0                 ;2911
0046a4  e59f0378          LDR      r0,|L1.18980|
0046a8  e2801000          ADD      r1,r0,#0              ;2911
0046ac  e5810000          STR      r0,[r1,#0]            ;2911  ; search_contexts
0046b0  e2801000          ADD      r1,r0,#0              ;2911
0046b4  e5810004          STR      r0,[r1,#4]            ;2911  ; search_contexts
0046b8  e1a00000          MOV      r0,r0                 ;2911
                  |L1.18108|
0046bc  e59f1360          LDR      r1,|L1.18980|
0046c0  e2840f87          ADD      r0,r4,#0x21c          ;2913
0046c4  ebfffffe          BL       list_add
0046c8  e1a00004          MOV      r0,r4                 ;2914
0046cc  ebfffffe          BL       yaffsfs_SetDirRewound
                  |L1.18128|
0046d0  e1a00000          MOV      r0,r0                 ;2917
                  |L1.18132|
0046d4  ebfffffe          BL       yaffsfs_Unlock
0046d8  e1a00008          MOV      r0,r8                 ;2921
0046dc  eaffff95          B        |L1.17720|
;;;2923   
                          ENDP

                  yaffs_readdir PROC
;;;2924   struct yaffs_dirent *yaffs_readdir(yaffs_DIR * dirp)
0046e0  e92d4070          PUSH     {r4-r6,lr}
;;;2925   {
0046e4  e1a05000          MOV      r5,r0
;;;2926   	struct yaffsfs_DirSearchContxt *dsc;
;;;2927   	struct yaffs_dirent *retVal = NULL;
0046e8  e3a06000          MOV      r6,#0
;;;2928   
;;;2929   	dsc = (struct yaffsfs_DirSearchContxt *) dirp;
0046ec  e1a04005          MOV      r4,r5
;;;2930   	yaffsfs_Lock();
0046f0  ebfffffe          BL       yaffsfs_Lock
;;;2931   
;;;2932   	if (dsc && dsc->inUse) {
0046f4  e3540000          CMP      r4,#0
0046f8  0a000035          BEQ      |L1.18388|
0046fc  e5940224          LDR      r0,[r4,#0x224]
004700  e1a00580          LSL      r0,r0,#11
004704  e1b00fa0          LSRS     r0,r0,#31
004708  0a000031          BEQ      |L1.18388|
;;;2933   		yaffsfs_SetError(0);
00470c  e3a00000          MOV      r0,#0
004710  ebfffffe          BL       yaffsfs_SetError
;;;2934   		if (dsc->nextReturn) {
004714  e5940218          LDR      r0,[r4,#0x218]
004718  e3500000          CMP      r0,#0
00471c  0a00002a          BEQ      |L1.18380|
;;;2935   			dsc->de.d_ino =
004720  e5940218          LDR      r0,[r4,#0x218]
004724  ebfffffe          BL       yaffs_get_equivalent_obj
004728  e5900030          LDR      r0,[r0,#0x30]
00472c  e5840000          STR      r0,[r4,#0]
;;;2936   			    yaffs_get_equivalent_obj(dsc->nextReturn)->obj_id;
;;;2937   			dsc->de.d_dont_use = (unsigned)dsc->nextReturn;
004730  e5940218          LDR      r0,[r4,#0x218]
004734  e584010c          STR      r0,[r4,#0x10c]
;;;2938   			dsc->de.d_off = dsc->offset++;
004738  e5940224          LDR      r0,[r4,#0x224]
00473c  e1a00600          LSL      r0,r0,#12
004740  e1a00620          LSR      r0,r0,#12
004744  e5840004          STR      r0,[r4,#4]
004748  e5940224          LDR      r0,[r4,#0x224]
00474c  e1a00a20          LSR      r0,r0,#20
004750  e1a00a00          LSL      r0,r0,#20
004754  e5941224          LDR      r1,[r4,#0x224]
004758  e2811001          ADD      r1,r1,#1
00475c  e1a01601          LSL      r1,r1,#12
004760  e1a01621          LSR      r1,r1,#12
004764  e1800001          ORR      r0,r0,r1
004768  e5840224          STR      r0,[r4,#0x224]
;;;2939   			yaffs_get_obj_name(dsc->nextReturn,
00476c  e3a02c01          MOV      r2,#0x100
004770  e5940218          LDR      r0,[r4,#0x218]
004774  e284100b          ADD      r1,r4,#0xb
004778  ebfffffe          BL       yaffs_get_obj_name
;;;2940   					   dsc->de.d_name, NAME_MAX);
;;;2941   			if (yaffs_strnlen(dsc->de.d_name, NAME_MAX + 1) == 0) {
00477c  e284000b          ADD      r0,r4,#0xb
004780  ebfffffe          BL       strlen
004784  e59f12ac          LDR      r1,|L1.19000|
004788  e1500001          CMP      r0,r1
00478c  9a000001          BLS      |L1.18328|
004790  e1a00001          MOV      r0,r1
004794  ea000001          B        |L1.18336|
                  |L1.18328|
004798  e284000b          ADD      r0,r4,#0xb
00479c  ebfffffe          BL       strlen
                  |L1.18336|
0047a0  e3500000          CMP      r0,#0
0047a4  1a000002          BNE      |L1.18356|
;;;2942   				/* this should not happen! */
;;;2943   				yaffs_strcpy(dsc->de.d_name, _Y("zz"));
0047a8  e28f1fa3          ADR      r1,|L1.19004|
0047ac  e284000b          ADD      r0,r4,#0xb
0047b0  ebfffffe          BL       strcpy
                  |L1.18356|
;;;2944   			}
;;;2945   			dsc->de.d_reclen = sizeof(struct yaffs_dirent);
0047b4  e3a00e11          MOV      r0,#0x110
0047b8  e1c400b8          STRH     r0,[r4,#8]
;;;2946   			retVal = &dsc->de;
0047bc  e1a06004          MOV      r6,r4
;;;2947   			yaffsfs_DirAdvance(dsc);
0047c0  e1a00004          MOV      r0,r4
0047c4  ebfffffe          BL       yaffsfs_DirAdvance
0047c8  ea000003          B        |L1.18396|
                  |L1.18380|
;;;2948   		} else
;;;2949   			retVal = NULL;
0047cc  e3a06000          MOV      r6,#0
0047d0  ea000001          B        |L1.18396|
                  |L1.18388|
;;;2950   	} else
;;;2951   		yaffsfs_SetError(-EBADF);
0047d4  e3e00008          MVN      r0,#8
0047d8  ebfffffe          BL       yaffsfs_SetError
                  |L1.18396|
;;;2952   
;;;2953   	yaffsfs_Unlock();
0047dc  ebfffffe          BL       yaffsfs_Unlock
;;;2954   
;;;2955   	return retVal;
0047e0  e1a00006          MOV      r0,r6
;;;2956   
;;;2957   }
0047e4  e8bd8070          POP      {r4-r6,pc}
;;;2958   
                          ENDP

                  yaffs_rewinddir PROC
;;;2959   void yaffs_rewinddir(yaffs_DIR *dirp)
0047e8  e92d4070          PUSH     {r4-r6,lr}
;;;2960   {
0047ec  e1a04000          MOV      r4,r0
;;;2961   	struct yaffsfs_DirSearchContxt *dsc;
;;;2962   
;;;2963   	dsc = (struct yaffsfs_DirSearchContxt *) dirp;
0047f0  e1a05004          MOV      r5,r4
;;;2964   
;;;2965   	yaffsfs_Lock();
0047f4  ebfffffe          BL       yaffsfs_Lock
;;;2966   
;;;2967   	yaffsfs_SetDirRewound(dsc);
0047f8  e1a00005          MOV      r0,r5
0047fc  ebfffffe          BL       yaffsfs_SetDirRewound
;;;2968   
;;;2969   	yaffsfs_Unlock();
004800  ebfffffe          BL       yaffsfs_Unlock
;;;2970   }
004804  e8bd8070          POP      {r4-r6,pc}
;;;2971   
                          ENDP

                  yaffs_closedir PROC
;;;2972   int yaffs_closedir(yaffs_DIR *dirp)
004808  e92d4070          PUSH     {r4-r6,lr}
;;;2973   {
00480c  e1a05000          MOV      r5,r0
;;;2974   	struct yaffsfs_DirSearchContxt *dsc;
;;;2975   
;;;2976   	dsc = (struct yaffsfs_DirSearchContxt *) dirp;
004810  e1a04005          MOV      r4,r5
;;;2977   
;;;2978   	if (!dsc) {
004814  e3540000          CMP      r4,#0
004818  1a000003          BNE      |L1.18476|
;;;2979   		yaffsfs_SetError(-EFAULT);
00481c  e3e0000d          MVN      r0,#0xd
004820  ebfffffe          BL       yaffsfs_SetError
;;;2980   		return -1;
004824  e3e00000          MVN      r0,#0
                  |L1.18472|
;;;2981   	}
;;;2982   
;;;2983   	yaffsfs_Lock();
;;;2984   	dsc->inUse = 0;
;;;2985   	list_del(&dsc->others);	/* unhook from list */
;;;2986   	yaffsfs_Unlock();
;;;2987   	return 0;
;;;2988   }
004828  e8bd8070          POP      {r4-r6,pc}
                  |L1.18476|
00482c  ebfffffe          BL       yaffsfs_Lock
004830  e5940224          LDR      r0,[r4,#0x224]        ;2984
004834  e3c00601          BIC      r0,r0,#0x100000       ;2984
004838  e5840224          STR      r0,[r4,#0x224]        ;2984
00483c  e2840f87          ADD      r0,r4,#0x21c          ;2985
004840  ebfffffe          BL       list_del
004844  ebfffffe          BL       yaffsfs_Unlock
004848  e3a00000          MOV      r0,#0                 ;2987
00484c  eafffff5          B        |L1.18472|
;;;2989   
                          ENDP

                  yaffs_symlink PROC
;;;2991   
;;;2992   int yaffs_symlink(const YCHAR *oldpath, const YCHAR *newpath)
004850  e92d43f0          PUSH     {r4-r9,lr}
;;;2993   {
004854  e24dd01c          SUB      sp,sp,#0x1c
004858  e1a05000          MOV      r5,r0
00485c  e1a06001          MOV      r6,r1
;;;2994   	struct yaffs_obj *parent = NULL;
004860  e3a04000          MOV      r4,#0
;;;2995   	struct yaffs_obj *obj;
;;;2996   	YCHAR *name;
;;;2997   	int retVal = -1;
004864  e3e08000          MVN      r8,#0
;;;2998   	int mode = 0;		/* ignore for now */
004868  e3a09000          MOV      r9,#0
;;;2999   	int notDir = 0;
00486c  e3a00000          MOV      r0,#0
004870  e58d0014          STR      r0,[sp,#0x14]
;;;3000   	int loop = 0;
004874  e58d0010          STR      r0,[sp,#0x10]
;;;3001   
;;;3002   	if (!oldpath || !newpath) {
004878  e3550000          CMP      r5,#0
00487c  0a000001          BEQ      |L1.18568|
004880  e3560000          CMP      r6,#0
004884  1a000004          BNE      |L1.18588|
                  |L1.18568|
;;;3003   		yaffsfs_SetError(-EFAULT);
004888  e3e0000d          MVN      r0,#0xd
00488c  ebfffffe          BL       yaffsfs_SetError
;;;3004   		return -1;
004890  e3e00000          MVN      r0,#0
                  |L1.18580|
004894  e28dd01c          ADD      sp,sp,#0x1c
;;;3005   	}
;;;3006   
;;;3007   	if (yaffsfs_CheckPath(newpath) < 0 || yaffsfs_CheckPath(oldpath) < 0) {
;;;3008   		yaffsfs_SetError(-ENAMETOOLONG);
;;;3009   		return -1;
;;;3010   	}
;;;3011   
;;;3012   	yaffsfs_Lock();
;;;3013   	parent = yaffsfs_FindDirectory(NULL, newpath, &name, 0, &notDir, &loop);
;;;3014   	if (!parent && notDir)
;;;3015   		yaffsfs_SetError(-ENOTDIR);
;;;3016   	else if (loop)
;;;3017   		yaffsfs_SetError(-ELOOP);
;;;3018   	else if (!parent || yaffs_strnlen(name, 5) < 1)
;;;3019   		yaffsfs_SetError(-ENOENT);
;;;3020   	else if (yaffsfs_TooManyObjects(parent->my_dev))
;;;3021   		yaffsfs_SetError(-ENFILE);
;;;3022   	else if (parent->my_dev->read_only)
;;;3023   		yaffsfs_SetError(-EROFS);
;;;3024   	else if (parent) {
;;;3025   		obj = yaffs_create_symlink(parent, name, mode, 0, 0, oldpath);
;;;3026   		if (obj)
;;;3027   			retVal = 0;
;;;3028   		else if (yaffsfs_FindObject
;;;3029   			 (NULL, newpath, 0, 0, NULL, NULL, NULL))
;;;3030   			yaffsfs_SetError(-EEXIST);
;;;3031   		else
;;;3032   			yaffsfs_SetError(-ENOSPC);
;;;3033   	}
;;;3034   
;;;3035   	yaffsfs_Unlock();
;;;3036   
;;;3037   	return retVal;
;;;3038   
;;;3039   }
004898  e8bd83f0          POP      {r4-r9,pc}
                  |L1.18588|
00489c  e1a00006          MOV      r0,r6                 ;3007
0048a0  ebfffffe          BL       yaffsfs_CheckPath
0048a4  e3500000          CMP      r0,#0                 ;3007
0048a8  ba000003          BLT      |L1.18620|
0048ac  e1a00005          MOV      r0,r5                 ;3007
0048b0  ebfffffe          BL       yaffsfs_CheckPath
0048b4  e3500000          CMP      r0,#0                 ;3007
0048b8  aa000003          BGE      |L1.18636|
                  |L1.18620|
0048bc  e3e00023          MVN      r0,#0x23              ;3008
0048c0  ebfffffe          BL       yaffsfs_SetError
0048c4  e3e00000          MVN      r0,#0                 ;3009
0048c8  eafffff1          B        |L1.18580|
                  |L1.18636|
0048cc  ebfffffe          BL       yaffsfs_Lock
0048d0  e28d0010          ADD      r0,sp,#0x10           ;3013
0048d4  e28d1014          ADD      r1,sp,#0x14           ;3013
0048d8  e3a03000          MOV      r3,#0                 ;3013
0048dc  e58d0004          STR      r0,[sp,#4]            ;3013
0048e0  e58d1000          STR      r1,[sp,#0]            ;3013
0048e4  e28d2018          ADD      r2,sp,#0x18           ;3013
0048e8  e1a01006          MOV      r1,r6                 ;3013
0048ec  e1a00003          MOV      r0,r3                 ;3013
0048f0  ebfffffe          BL       yaffsfs_FindDirectory
0048f4  e1a04000          MOV      r4,r0                 ;3013
0048f8  e3540000          CMP      r4,#0                 ;3014
0048fc  1a000005          BNE      |L1.18712|
004900  e59d0014          LDR      r0,[sp,#0x14]         ;3014
004904  e3500000          CMP      r0,#0                 ;3014
004908  0a000002          BEQ      |L1.18712|
00490c  e3e00013          MVN      r0,#0x13              ;3015
004910  ebfffffe          BL       yaffsfs_SetError
004914  ea00003f          B        |L1.18968|
                  |L1.18712|
004918  e59d0010          LDR      r0,[sp,#0x10]         ;3016
00491c  e3500000          CMP      r0,#0                 ;3016
004920  0a000002          BEQ      |L1.18736|
004924  e3e00027          MVN      r0,#0x27              ;3017
004928  ebfffffe          BL       yaffsfs_SetError
00492c  ea000039          B        |L1.18968|
                  |L1.18736|
004930  e3540000          CMP      r4,#0                 ;3018
004934  0a000009          BEQ      |L1.18784|
004938  e59d0018          LDR      r0,[sp,#0x18]         ;3018
00493c  ebfffffe          BL       strlen
004940  e3500005          CMP      r0,#5                 ;3018
004944  9a000001          BLS      |L1.18768|
004948  e3a00005          MOV      r0,#5                 ;3018
00494c  ea000001          B        |L1.18776|
                  |L1.18768|
004950  e59d0018          LDR      r0,[sp,#0x18]         ;3018
004954  ebfffffe          BL       strlen
                  |L1.18776|
004958  e3500000          CMP      r0,#0                 ;3018
00495c  1a000002          BNE      |L1.18796|
                  |L1.18784|
004960  e3e00001          MVN      r0,#1                 ;3019
004964  ebfffffe          BL       yaffsfs_SetError
004968  ea00002a          B        |L1.18968|
                  |L1.18796|
00496c  e5940008          LDR      r0,[r4,#8]            ;3020
004970  ebfffffe          BL       yaffsfs_TooManyObjects
004974  e3500000          CMP      r0,#0                 ;3020
004978  0a000002          BEQ      |L1.18824|
00497c  e3e00016          MVN      r0,#0x16              ;3021
004980  ebfffffe          BL       yaffsfs_SetError
004984  ea000023          B        |L1.18968|
                  |L1.18824|
004988  e5940008          LDR      r0,[r4,#8]            ;3022
00498c  e59000c8          LDR      r0,[r0,#0xc8]         ;3022
004990  e3500000          CMP      r0,#0                 ;3022
004994  0a000002          BEQ      |L1.18852|
004998  e3e0001d          MVN      r0,#0x1d              ;3023
00499c  ebfffffe          BL       yaffsfs_SetError
0049a0  ea00001c          B        |L1.18968|
                  |L1.18852|
0049a4  e3540000          CMP      r4,#0                 ;3024
0049a8  0a00001a          BEQ      |L1.18968|
0049ac  e3a00000          MOV      r0,#0                 ;3025
0049b0  e88d0021          STM      sp,{r0,r5}            ;3025
0049b4  e1a03000          MOV      r3,r0                 ;3025
0049b8  e1a02009          MOV      r2,r9                 ;3025
0049bc  e1a00004          MOV      r0,r4                 ;3025
0049c0  e59d1018          LDR      r1,[sp,#0x18]         ;3025
0049c4  ebfffffe          BL       yaffs_create_symlink
0049c8  e1a07000          MOV      r7,r0                 ;3025
0049cc  e3570000          CMP      r7,#0                 ;3026
0049d0  0a000001          BEQ      |L1.18908|
0049d4  e3a08000          MOV      r8,#0                 ;3027
0049d8  ea00000e          B        |L1.18968|
                  |L1.18908|
0049dc  e3a00000          MOV      r0,#0                 ;3028
0049e0  e58d0000          STR      r0,[sp,#0]            ;3028
0049e4  e58d0004          STR      r0,[sp,#4]            ;3028
0049e8  e58d0008          STR      r0,[sp,#8]            ;3028
0049ec  e1a03000          MOV      r3,r0                 ;3028
0049f0  e1a02000          MOV      r2,r0                 ;3028
0049f4  e1a01006          MOV      r1,r6                 ;3028
0049f8  ebfffffe          BL       yaffsfs_FindObject
0049fc  e3500000          CMP      r0,#0                 ;3028
004a00  0a000002          BEQ      |L1.18960|
004a04  e3e00010          MVN      r0,#0x10              ;3030
004a08  ebfffffe          BL       yaffsfs_SetError
004a0c  ea000001          B        |L1.18968|
                  |L1.18960|
004a10  e3e0001b          MVN      r0,#0x1b              ;3032
004a14  ebfffffe          BL       yaffsfs_SetError
                  |L1.18968|
004a18  ebfffffe          BL       yaffsfs_Unlock
004a1c  e1a00008          MOV      r0,r8                 ;3037
004a20  eaffff9b          B        |L1.18580|
                  |L1.18980|
                          DCD      search_contexts
                  |L1.18984|
                          DCD      yaffsfs_deviceList
                  |L1.18988|
                          DCD      yaffsfs_RemoveObjectCallback
                  |L1.18992|
                          DCD      dev_iterator
                  |L1.18996|
                          DCD      yaffsfs_dsc
                  |L1.19000|
                          DCD      0x00000101
                  |L1.19004|
004a3c  7a7a00            DCB      "zz",0
004a3f  00                DCB      0
                          ENDP

                  yaffs_readlink PROC
;;;3040   
;;;3041   int yaffs_readlink(const YCHAR *path, YCHAR *buf, int bufsiz)
004a40  e92d43f0          PUSH     {r4-r9,lr}
;;;3042   {
004a44  e24dd01c          SUB      sp,sp,#0x1c
004a48  e1a04000          MOV      r4,r0
004a4c  e1a05001          MOV      r5,r1
004a50  e1a06002          MOV      r6,r2
;;;3043   	struct yaffs_obj *obj = NULL;
004a54  e3a07000          MOV      r7,#0
;;;3044   	struct yaffs_obj *dir = NULL;
004a58  e3a00000          MOV      r0,#0
004a5c  e58d0018          STR      r0,[sp,#0x18]
;;;3045   	int retVal = -1;
004a60  e3e08000          MVN      r8,#0
;;;3046   	int notDir = 0;
004a64  e58d0014          STR      r0,[sp,#0x14]
;;;3047   	int loop = 0;
004a68  e58d0010          STR      r0,[sp,#0x10]
;;;3048   
;;;3049   	if (!path || !buf) {
004a6c  e3540000          CMP      r4,#0
004a70  0a000001          BEQ      |L1.19068|
004a74  e3550000          CMP      r5,#0
004a78  1a000004          BNE      |L1.19088|
                  |L1.19068|
;;;3050   		yaffsfs_SetError(-EFAULT);
004a7c  e3e0000d          MVN      r0,#0xd
004a80  ebfffffe          BL       yaffsfs_SetError
;;;3051   		return -1;
004a84  e3e00000          MVN      r0,#0
                  |L1.19080|
004a88  e28dd01c          ADD      sp,sp,#0x1c
;;;3052   	}
;;;3053   
;;;3054   	yaffsfs_Lock();
;;;3055   
;;;3056   	obj = yaffsfs_FindObject(NULL, path, 0, 1, &dir, &notDir, &loop);
;;;3057   
;;;3058   	if (!dir && notDir)
;;;3059   		yaffsfs_SetError(-ENOTDIR);
;;;3060   	else if (loop)
;;;3061   		yaffsfs_SetError(-ELOOP);
;;;3062   	else if (!dir || !obj)
;;;3063   		yaffsfs_SetError(-ENOENT);
;;;3064   	else if (obj->variant_type != YAFFS_OBJECT_TYPE_SYMLINK)
;;;3065   		yaffsfs_SetError(-EINVAL);
;;;3066   	else {
;;;3067   		YCHAR *alias = obj->variant.symlink_variant.alias;
;;;3068   		memset(buf, 0, bufsiz);
;;;3069   		yaffs_strncpy(buf, alias, bufsiz - 1);
;;;3070   		retVal = 0;
;;;3071   	}
;;;3072   	yaffsfs_Unlock();
;;;3073   	return retVal;
;;;3074   }
004a8c  e8bd83f0          POP      {r4-r9,pc}
                  |L1.19088|
004a90  ebfffffe          BL       yaffsfs_Lock
004a94  e28d0010          ADD      r0,sp,#0x10           ;3056
004a98  e28d1014          ADD      r1,sp,#0x14           ;3056
004a9c  e28d2018          ADD      r2,sp,#0x18           ;3056
004aa0  e3a03001          MOV      r3,#1                 ;3056
004aa4  e58d2000          STR      r2,[sp,#0]            ;3056
004aa8  e3a02000          MOV      r2,#0                 ;3056
004aac  e58d1004          STR      r1,[sp,#4]            ;3056
004ab0  e1a01004          MOV      r1,r4                 ;3056
004ab4  e58d0008          STR      r0,[sp,#8]            ;3056
004ab8  e1a00002          MOV      r0,r2                 ;3056
004abc  ebfffffe          BL       yaffsfs_FindObject
004ac0  e1a07000          MOV      r7,r0                 ;3056
004ac4  e59d0018          LDR      r0,[sp,#0x18]         ;3058
004ac8  e3500000          CMP      r0,#0                 ;3058
004acc  1a000005          BNE      |L1.19176|
004ad0  e59d0014          LDR      r0,[sp,#0x14]         ;3058
004ad4  e3500000          CMP      r0,#0                 ;3058
004ad8  0a000002          BEQ      |L1.19176|
004adc  e3e00013          MVN      r0,#0x13              ;3059
004ae0  ebfffffe          BL       yaffsfs_SetError
004ae4  ea00001d          B        |L1.19296|
                  |L1.19176|
004ae8  e59d0010          LDR      r0,[sp,#0x10]         ;3060
004aec  e3500000          CMP      r0,#0                 ;3060
004af0  0a000002          BEQ      |L1.19200|
004af4  e3e00027          MVN      r0,#0x27              ;3061
004af8  ebfffffe          BL       yaffsfs_SetError
004afc  ea000017          B        |L1.19296|
                  |L1.19200|
004b00  e59d0018          LDR      r0,[sp,#0x18]         ;3062
004b04  e3500000          CMP      r0,#0                 ;3062
004b08  0a000001          BEQ      |L1.19220|
004b0c  e3570000          CMP      r7,#0                 ;3062
004b10  1a000002          BNE      |L1.19232|
                  |L1.19220|
004b14  e3e00001          MVN      r0,#1                 ;3063
004b18  ebfffffe          BL       yaffsfs_SetError
004b1c  ea00000f          B        |L1.19296|
                  |L1.19232|
004b20  e5d70064          LDRB     r0,[r7,#0x64]         ;3064
004b24  e3500002          CMP      r0,#2                 ;3064
004b28  0a000002          BEQ      |L1.19256|
004b2c  e3e00015          MVN      r0,#0x15              ;3065
004b30  ebfffffe          BL       yaffsfs_SetError
004b34  ea000009          B        |L1.19296|
                  |L1.19256|
004b38  e5979068          LDR      r9,[r7,#0x68]         ;3067
004b3c  e1a01006          MOV      r1,r6                 ;3068
004b40  e1a00005          MOV      r0,r5                 ;3068
004b44  ebfffffe          BL       __aeabi_memclr
004b48  e2462001          SUB      r2,r6,#1              ;3069
004b4c  e1a01009          MOV      r1,r9                 ;3069
004b50  e1a00005          MOV      r0,r5                 ;3069
004b54  ebfffffe          BL       strncpy
004b58  e3a08000          MOV      r8,#0                 ;3070
004b5c  e1a00000          MOV      r0,r0                 ;3071
                  |L1.19296|
004b60  ebfffffe          BL       yaffsfs_Unlock
004b64  e1a00008          MOV      r0,r8                 ;3073
004b68  eaffffc6          B        |L1.19080|
;;;3075   
                          ENDP

                  yaffs_link PROC
;;;3076   int yaffs_link(const YCHAR *oldpath, const YCHAR *linkpath)
004b6c  e92d43f0          PUSH     {r4-r9,lr}
;;;3077   {
004b70  e24dd024          SUB      sp,sp,#0x24
004b74  e1a06000          MOV      r6,r0
004b78  e1a07001          MOV      r7,r1
;;;3078   	/* Creates a link called newpath to existing oldpath */
;;;3079   	struct yaffs_obj *obj = NULL;
004b7c  e3a04000          MOV      r4,#0
;;;3080   	struct yaffs_obj *lnk = NULL;
004b80  e3a08000          MOV      r8,#0
;;;3081   	struct yaffs_obj *obj_dir = NULL;
004b84  e3a00000          MOV      r0,#0
004b88  e58d0020          STR      r0,[sp,#0x20]
;;;3082   	struct yaffs_obj *lnk_dir = NULL;
004b8c  e3a05000          MOV      r5,#0
;;;3083   	int retVal = -1;
004b90  e3e09000          MVN      r9,#0
;;;3084   	int notDirObj = 0;
004b94  e58d001c          STR      r0,[sp,#0x1c]
;;;3085   	int notDirLnk = 0;
004b98  e58d0018          STR      r0,[sp,#0x18]
;;;3086   	int objLoop = 0;
004b9c  e58d0014          STR      r0,[sp,#0x14]
;;;3087   	int lnkLoop = 0;
004ba0  e58d0010          STR      r0,[sp,#0x10]
;;;3088   	YCHAR *newname;
;;;3089   
;;;3090   	if (!oldpath || !linkpath) {
004ba4  e3560000          CMP      r6,#0
004ba8  0a000001          BEQ      |L1.19380|
004bac  e3570000          CMP      r7,#0
004bb0  1a000004          BNE      |L1.19400|
                  |L1.19380|
;;;3091   		yaffsfs_SetError(-EFAULT);
004bb4  e3e0000d          MVN      r0,#0xd
004bb8  ebfffffe          BL       yaffsfs_SetError
;;;3092   		return -1;
004bbc  e3e00000          MVN      r0,#0
                  |L1.19392|
004bc0  e28dd024          ADD      sp,sp,#0x24
;;;3093   	}
;;;3094   
;;;3095   	if (yaffsfs_CheckPath(linkpath) < 0 || yaffsfs_CheckPath(oldpath) < 0) {
;;;3096   		yaffsfs_SetError(-ENAMETOOLONG);
;;;3097   		return -1;
;;;3098   	}
;;;3099   
;;;3100   	yaffsfs_Lock();
;;;3101   
;;;3102   	obj = yaffsfs_FindObject(NULL, oldpath, 0, 1,
;;;3103   				 &obj_dir, &notDirObj, &objLoop);
;;;3104   	lnk = yaffsfs_FindObject(NULL, linkpath, 0, 0, NULL, NULL, NULL);
;;;3105   	lnk_dir = yaffsfs_FindDirectory(NULL, linkpath, &newname,
;;;3106   					0, &notDirLnk, &lnkLoop);
;;;3107   
;;;3108   	if ((!obj_dir && notDirObj) || (!lnk_dir && notDirLnk))
;;;3109   		yaffsfs_SetError(-ENOTDIR);
;;;3110   	else if (objLoop || lnkLoop)
;;;3111   		yaffsfs_SetError(-ELOOP);
;;;3112   	else if (!obj_dir || !lnk_dir || !obj)
;;;3113   		yaffsfs_SetError(-ENOENT);
;;;3114   	else if (obj->my_dev->read_only)
;;;3115   		yaffsfs_SetError(-EROFS);
;;;3116   	else if (yaffsfs_TooManyObjects(obj->my_dev))
;;;3117   		yaffsfs_SetError(-ENFILE);
;;;3118   	else if (lnk)
;;;3119   		yaffsfs_SetError(-EEXIST);
;;;3120   	else if (lnk_dir->my_dev != obj->my_dev)
;;;3121   		yaffsfs_SetError(-EXDEV);
;;;3122   	else {
;;;3123   		retVal = yaffsfs_CheckNameLength(newname);
;;;3124   
;;;3125   		if (retVal == 0) {
;;;3126   			lnk = yaffs_link_obj(lnk_dir, newname, obj);
;;;3127   			if (lnk)
;;;3128   				retVal = 0;
;;;3129   			else {
;;;3130   				yaffsfs_SetError(-ENOSPC);
;;;3131   				retVal = -1;
;;;3132   			}
;;;3133   		}
;;;3134   	}
;;;3135   	yaffsfs_Unlock();
;;;3136   
;;;3137   	return retVal;
;;;3138   }
004bc4  e8bd83f0          POP      {r4-r9,pc}
                  |L1.19400|
004bc8  e1a00007          MOV      r0,r7                 ;3095
004bcc  ebfffffe          BL       yaffsfs_CheckPath
004bd0  e3500000          CMP      r0,#0                 ;3095
004bd4  ba000003          BLT      |L1.19432|
004bd8  e1a00006          MOV      r0,r6                 ;3095
004bdc  ebfffffe          BL       yaffsfs_CheckPath
004be0  e3500000          CMP      r0,#0                 ;3095
004be4  aa000003          BGE      |L1.19448|
                  |L1.19432|
004be8  e3e00023          MVN      r0,#0x23              ;3096
004bec  ebfffffe          BL       yaffsfs_SetError
004bf0  e3e00000          MVN      r0,#0                 ;3097
004bf4  eafffff1          B        |L1.19392|
                  |L1.19448|
004bf8  ebfffffe          BL       yaffsfs_Lock
004bfc  e28d0014          ADD      r0,sp,#0x14           ;3102
004c00  e28d101c          ADD      r1,sp,#0x1c           ;3102
004c04  e28d2020          ADD      r2,sp,#0x20           ;3102
004c08  e3a03001          MOV      r3,#1                 ;3102
004c0c  e58d2000          STR      r2,[sp,#0]            ;3102
004c10  e3a02000          MOV      r2,#0                 ;3102
004c14  e58d1004          STR      r1,[sp,#4]            ;3102
004c18  e1a01006          MOV      r1,r6                 ;3102
004c1c  e58d0008          STR      r0,[sp,#8]            ;3102
004c20  e1a00002          MOV      r0,r2                 ;3102
004c24  ebfffffe          BL       yaffsfs_FindObject
004c28  e1a04000          MOV      r4,r0                 ;3102
004c2c  e3a00000          MOV      r0,#0                 ;3104
004c30  e58d0000          STR      r0,[sp,#0]            ;3104
004c34  e58d0004          STR      r0,[sp,#4]            ;3104
004c38  e58d0008          STR      r0,[sp,#8]            ;3104
004c3c  e1a03000          MOV      r3,r0                 ;3104
004c40  e1a02000          MOV      r2,r0                 ;3104
004c44  e1a01007          MOV      r1,r7                 ;3104
004c48  ebfffffe          BL       yaffsfs_FindObject
004c4c  e1a08000          MOV      r8,r0                 ;3104
004c50  e28d0010          ADD      r0,sp,#0x10           ;3105
004c54  e28d1018          ADD      r1,sp,#0x18           ;3105
004c58  e3a03000          MOV      r3,#0                 ;3105
004c5c  e58d0004          STR      r0,[sp,#4]            ;3105
004c60  e58d1000          STR      r1,[sp,#0]            ;3105
004c64  e28d200c          ADD      r2,sp,#0xc            ;3105
004c68  e1a01007          MOV      r1,r7                 ;3105
004c6c  e1a00003          MOV      r0,r3                 ;3105
004c70  ebfffffe          BL       yaffsfs_FindDirectory
004c74  e1a05000          MOV      r5,r0                 ;3105
004c78  e59d0020          LDR      r0,[sp,#0x20]         ;3108
004c7c  e3500000          CMP      r0,#0                 ;3108
004c80  1a000002          BNE      |L1.19600|
004c84  e59d001c          LDR      r0,[sp,#0x1c]         ;3108
004c88  e3500000          CMP      r0,#0                 ;3108
004c8c  1a000004          BNE      |L1.19620|
                  |L1.19600|
004c90  e3550000          CMP      r5,#0                 ;3108
004c94  1a000005          BNE      |L1.19632|
004c98  e59d0018          LDR      r0,[sp,#0x18]         ;3108
004c9c  e3500000          CMP      r0,#0                 ;3108
004ca0  0a000002          BEQ      |L1.19632|
                  |L1.19620|
004ca4  e3e00013          MVN      r0,#0x13              ;3109
004ca8  ebfffffe          BL       yaffsfs_SetError
004cac  ea00003d          B        |L1.19880|
                  |L1.19632|
004cb0  e59d0014          LDR      r0,[sp,#0x14]         ;3110
004cb4  e3500000          CMP      r0,#0                 ;3110
004cb8  1a000002          BNE      |L1.19656|
004cbc  e59d0010          LDR      r0,[sp,#0x10]         ;3110
004cc0  e3500000          CMP      r0,#0                 ;3110
004cc4  0a000002          BEQ      |L1.19668|
                  |L1.19656|
004cc8  e3e00027          MVN      r0,#0x27              ;3111
004ccc  ebfffffe          BL       yaffsfs_SetError
004cd0  ea000034          B        |L1.19880|
                  |L1.19668|
004cd4  e59d0020          LDR      r0,[sp,#0x20]         ;3112
004cd8  e3500000          CMP      r0,#0                 ;3112
004cdc  0a000003          BEQ      |L1.19696|
004ce0  e3550000          CMP      r5,#0                 ;3112
004ce4  0a000001          BEQ      |L1.19696|
004ce8  e3540000          CMP      r4,#0                 ;3112
004cec  1a000002          BNE      |L1.19708|
                  |L1.19696|
004cf0  e3e00001          MVN      r0,#1                 ;3113
004cf4  ebfffffe          BL       yaffsfs_SetError
004cf8  ea00002a          B        |L1.19880|
                  |L1.19708|
004cfc  e5940008          LDR      r0,[r4,#8]            ;3114
004d00  e59000c8          LDR      r0,[r0,#0xc8]         ;3114
004d04  e3500000          CMP      r0,#0                 ;3114
004d08  0a000002          BEQ      |L1.19736|
004d0c  e3e0001d          MVN      r0,#0x1d              ;3115
004d10  ebfffffe          BL       yaffsfs_SetError
004d14  ea000023          B        |L1.19880|
                  |L1.19736|
004d18  e5940008          LDR      r0,[r4,#8]            ;3116
004d1c  ebfffffe          BL       yaffsfs_TooManyObjects
004d20  e3500000          CMP      r0,#0                 ;3116
004d24  0a000002          BEQ      |L1.19764|
004d28  e3e00016          MVN      r0,#0x16              ;3117
004d2c  ebfffffe          BL       yaffsfs_SetError
004d30  ea00001c          B        |L1.19880|
                  |L1.19764|
004d34  e3580000          CMP      r8,#0                 ;3118
004d38  0a000002          BEQ      |L1.19784|
004d3c  e3e00010          MVN      r0,#0x10              ;3119
004d40  ebfffffe          BL       yaffsfs_SetError
004d44  ea000017          B        |L1.19880|
                  |L1.19784|
004d48  e5950008          LDR      r0,[r5,#8]            ;3120
004d4c  e5941008          LDR      r1,[r4,#8]            ;3120
004d50  e1500001          CMP      r0,r1                 ;3120
004d54  0a000002          BEQ      |L1.19812|
004d58  e3e00011          MVN      r0,#0x11              ;3121
004d5c  ebfffffe          BL       yaffsfs_SetError
004d60  ea000010          B        |L1.19880|
                  |L1.19812|
004d64  e59d000c          LDR      r0,[sp,#0xc]          ;3123
004d68  ebfffffe          BL       yaffsfs_CheckNameLength
004d6c  e1a09000          MOV      r9,r0                 ;3123
004d70  e3590000          CMP      r9,#0                 ;3125
004d74  1a00000b          BNE      |L1.19880|
004d78  e1a02004          MOV      r2,r4                 ;3126
004d7c  e1a00005          MOV      r0,r5                 ;3126
004d80  e59d100c          LDR      r1,[sp,#0xc]          ;3126
004d84  ebfffffe          BL       yaffs_link_obj
004d88  e1a08000          MOV      r8,r0                 ;3126
004d8c  e3580000          CMP      r8,#0                 ;3127
004d90  0a000001          BEQ      |L1.19868|
004d94  e3a09000          MOV      r9,#0                 ;3128
004d98  ea000002          B        |L1.19880|
                  |L1.19868|
004d9c  e3e0001b          MVN      r0,#0x1b              ;3130
004da0  ebfffffe          BL       yaffsfs_SetError
004da4  e3e09000          MVN      r9,#0                 ;3131
                  |L1.19880|
004da8  ebfffffe          BL       yaffsfs_Unlock
004dac  e1a00009          MOV      r0,r9                 ;3137
004db0  eaffff82          B        |L1.19392|
;;;3139   
                          ENDP

                  yaffs_mknod PROC
;;;3140   int yaffs_mknod(const YCHAR *pathname, mode_t mode, dev_t dev)
004db4  e92d4070          PUSH     {r4-r6,lr}
;;;3141   {
004db8  e1a06000          MOV      r6,r0
004dbc  e1a04001          MOV      r4,r1
004dc0  e1a05002          MOV      r5,r2
;;;3142   	pathname = pathname;
004dc4  e1a00000          MOV      r0,r0
;;;3143   	mode = mode;
004dc8  e1a00000          MOV      r0,r0
;;;3144   	dev = dev;
004dcc  e1a00000          MOV      r0,r0
;;;3145   
;;;3146   	yaffsfs_SetError(-EINVAL);
004dd0  e3e00015          MVN      r0,#0x15
004dd4  ebfffffe          BL       yaffsfs_SetError
;;;3147   	return -1;
004dd8  e3e00000          MVN      r0,#0
;;;3148   }
004ddc  e8bd8070          POP      {r4-r6,pc}
;;;3149   
                          ENDP

                  yaffs_n_handles PROC
;;;3157    */
;;;3158   int yaffs_n_handles(const YCHAR *path)
004de0  e92d403e          PUSH     {r1-r5,lr}
;;;3159   {
004de4  e1a04000          MOV      r4,r0
;;;3160   	struct yaffs_obj *obj;
;;;3161   
;;;3162   	if (!path) {
004de8  e3540000          CMP      r4,#0
004dec  1a000003          BNE      |L1.19968|
;;;3163   		yaffsfs_SetError(-EFAULT);
004df0  e3e0000d          MVN      r0,#0xd
004df4  ebfffffe          BL       yaffsfs_SetError
;;;3164   		return -1;
004df8  e3e00000          MVN      r0,#0
                  |L1.19964|
;;;3165   	}
;;;3166   
;;;3167   	if (yaffsfs_CheckPath(path) < 0) {
;;;3168   		yaffsfs_SetError(-ENAMETOOLONG);
;;;3169   		return -1;
;;;3170   	}
;;;3171   
;;;3172   	obj = yaffsfs_FindObject(NULL, path, 0, 1, NULL, NULL, NULL);
;;;3173   
;;;3174   	if (obj)
;;;3175   		return yaffsfs_CountHandles(obj);
;;;3176   	else
;;;3177   		return -1;
;;;3178   }
004dfc  e8bd803e          POP      {r1-r5,pc}
                  |L1.19968|
004e00  e1a00004          MOV      r0,r4                 ;3167
004e04  ebfffffe          BL       yaffsfs_CheckPath
004e08  e3500000          CMP      r0,#0                 ;3167
004e0c  aa000003          BGE      |L1.20000|
004e10  e3e00023          MVN      r0,#0x23              ;3168
004e14  ebfffffe          BL       yaffsfs_SetError
004e18  e3e00000          MVN      r0,#0                 ;3169
004e1c  eafffff6          B        |L1.19964|
                  |L1.20000|
004e20  e3a00000          MOV      r0,#0                 ;3172
004e24  e58d0000          STR      r0,[sp,#0]            ;3172
004e28  e58d0004          STR      r0,[sp,#4]            ;3172
004e2c  e3a03001          MOV      r3,#1                 ;3172
004e30  e58d0008          STR      r0,[sp,#8]            ;3172
004e34  e1a02000          MOV      r2,r0                 ;3172
004e38  e1a01004          MOV      r1,r4                 ;3172
004e3c  ebfffffe          BL       yaffsfs_FindObject
004e40  e1a05000          MOV      r5,r0                 ;3172
004e44  e3550000          CMP      r5,#0                 ;3174
004e48  0a000002          BEQ      |L1.20056|
004e4c  e1a00005          MOV      r0,r5                 ;3175
004e50  ebfffffe          BL       yaffsfs_CountHandles
004e54  eaffffe8          B        |L1.19964|
                  |L1.20056|
004e58  e3e00000          MVN      r0,#0                 ;3177
004e5c  eaffffe6          B        |L1.19964|
;;;3179   
                          ENDP

                  yaffs_get_error PROC
;;;3180   int yaffs_get_error(void)
004e60  e92d4010          PUSH     {r4,lr}
;;;3181   {
;;;3182   	return yaffsfs_GetLastError();
004e64  ebfffffe          BL       yaffsfs_GetLastError
;;;3183   }
004e68  e8bd8010          POP      {r4,pc}
;;;3184   
                          ENDP

                  yaffs_set_error PROC
;;;3185   int yaffs_set_error(int error)
004e6c  e92d4010          PUSH     {r4,lr}
;;;3186   {
004e70  e1a04000          MOV      r4,r0
;;;3187   	yaffsfs_SetError(error);
004e74  e1a00004          MOV      r0,r4
004e78  ebfffffe          BL       yaffsfs_SetError
;;;3188   	return 0;
004e7c  e3a00000          MOV      r0,#0
;;;3189   }
004e80  e8bd8010          POP      {r4,pc}
;;;3190   
                          ENDP

                  yaffs_dump_dev PROC
;;;3191   int yaffs_dump_dev(const YCHAR *path)
004e84  e1a01000          MOV      r1,r0
;;;3192   {
;;;3193   #if 1
;;;3194   	path = path;
004e88  e1a00000          MOV      r0,r0
;;;3195   #else
;;;3196   	YCHAR *rest;
;;;3197   
;;;3198   	struct yaffs_obj *obj = yaffsfs_FindRoot(path, &rest);
;;;3199   
;;;3200   	if (obj) {
;;;3201   		struct yaffs_dev *dev = obj->my_dev;
;;;3202   
;;;3203   		sysprintf("\n"
;;;3204   		       "n_page_writes.......... %d\n"
;;;3205   		       "n_page_reads........... %d\n"
;;;3206   		       "n_erasures....... %d\n"
;;;3207   		       "n_gc_copies............ %d\n"
;;;3208   		       "garbageCollections... %d\n"
;;;3209   		       "passiveGarbageColl'ns %d\n"
;;;3210   		       "\n",
;;;3211   		       dev->n_page_writes,
;;;3212   		       dev->n_page_reads,
;;;3213   		       dev->n_erasures,
;;;3214   		       dev->n_gc_copies,
;;;3215   		       dev->garbageCollections, dev->passiveGarbageCollections);
;;;3216   
;;;3217   	}
;;;3218   #endif
;;;3219   	return 0;
004e8c  e3a00000          MOV      r0,#0
;;;3220   }
004e90  e12fff1e          BX       lr
                          ENDP

                  list_del PROC
;;;79      * reinitialising the links.of the entry*/
;;;80     static __inline void list_del(struct list_head *entry)
004e94  e5901000          LDR      r1,[r0,#0]
;;;81     {
;;;82     	struct list_head *list_next = entry->next;
;;;83     	struct list_head *list_prev = entry->prev;
004e98  e5902004          LDR      r2,[r0,#4]
;;;84     
;;;85     	list_next->prev = list_prev;
004e9c  e5812004          STR      r2,[r1,#4]
;;;86     	list_prev->next = list_next;
004ea0  e5821000          STR      r1,[r2,#0]
;;;87     
;;;88     }
004ea4  e12fff1e          BX       lr
;;;89     
                          ENDP

                  list_empty PROC
;;;97     /* Test if the list is empty */
;;;98     static __inline int list_empty(struct list_head *entry)
004ea8  e1a01000          MOV      r1,r0
;;;99     {
;;;100    	return (entry->next == entry);
004eac  e5910000          LDR      r0,[r1,#0]
004eb0  e1500001          CMP      r0,r1
004eb4  1a000001          BNE      |L1.20160|
004eb8  e3a00001          MOV      r0,#1
                  |L1.20156|
;;;101    }
004ebc  e12fff1e          BX       lr
                  |L1.20160|
004ec0  e3a00000          MOV      r0,#0                 ;100
004ec4  eafffffc          B        |L1.20156|
;;;102    
                          ENDP


                          AREA ||.bss||, DATA, NOINIT, ALIGN=3

                  yaffsfs_dsc
                          %        11040
                  yaffsfs_inode
                          %        800
                  yaffsfs_fd
                          %        1600
                  yaffsfs_handle
                          %        400

                          AREA ||.data||, DATA, ALIGN=2

                  yaffsfs_deviceList
                          DCD      yaffsfs_deviceList
                          DCD      yaffsfs_deviceList
                  yaffs_wr_attempts
                          DCD      0x00000000
                  yaffsfs_handlesInitialised
                          DCD      0x00000000
                  dev_iterator
                          DCD      0x00000000
                  search_contexts
                          %        8
