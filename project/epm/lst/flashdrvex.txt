; generated by ARM C/C++ Compiler, 5.03 [Build 76]
; commandline ArmCC [--c99 --list --debug -c --asm --interleave -o.\obj\flashdrvex.o --asm_dir=.\lst\ --list_dir=.\lst\ --depend=.\obj\flashdrvex.d --cpu=ARM926EJ-S --apcs=interwork -O0 -I.\src -I..\..\common\src\BSP\Driver\Include -I..\..\common\src\FreeRTOS -I..\..\common\src\FreeRTOS\Source\include -I..\..\common\src\FreeRTOS\Source\portable\RVDS\ARM926EJ-S -I..\..\common\src\BSP\ThirdParty\FATFS\src -I.\src\userdrv -I.\src\syshal -I.\src\user -I.\src\userdrv\vl53l0x\core\inc -I.\src\userdrv\vl53l0x\platform\inc -I.\src\syshal\json -I.\src\syshal\modemlib -I..\..\common\src\BSP\ThirdParty\yaffs2 -I..\..\common\src\BSP\ThirdParty\yaffs2\include -I..\..\common\src\BSP\ThirdParty\yaffs2\include\asm -I..\..\common\src\BSP\ThirdParty\yaffs2\include\linux -I.\src\syshal\yaffs2 -I..\..\common\src\BSP\Library\SmartcardLib\Include -I.\src\syshal\cardlib -I.\src\syshal\cardlog -I.\src\syshal\blk -I..\..\common\src\BSP\Library\USB_HOST\Inc -I..\..\common\src\BSP\Library\USB_HOST\Inc\usb_uvc -IC:\Keil\ARM\RV31\INC -IC:\Keil\ARM\CMSIS\Include -IC:\Keil\ARM\Inc\Toshiba -DEPM_PROJECT -DCONFIG_YAFFS_DIRECT -DCONFIG_YAFFS_SHORT_NAMES_IN_RAM -DCONFIG_YAFFS_YAFFS2 -DNO_Y_INLINE -DCONFIG_YAFFS_PROVIDE_DEFS -DCONFIG_YAFFSFS_PROVIDE_VALUES --omf_browse=.\obj\flashdrvex.crf src\UserDrv\flashdrvex.c]
                          ARM

                          AREA ||.text||, CODE, READONLY, ALIGN=2

                  setFlashCS PROC
;;;97     /*-----------------------------------------*/
;;;98     static void setFlashCS(uint8_t flashIndex, BOOL flag)
000000  e92d4070          PUSH     {r4-r6,lr}
;;;99     {
000004  e1a05000          MOV      r5,r0
000008  e1a04001          MOV      r4,r1
;;;100        if(flashIndex == SPI_FLASH_EX_0_INDEX)
00000c  e3550001          CMP      r5,#1
000010  1a00000d          BNE      |L1.76|
;;;101        {
;;;102            if(flag)
000014  e3540000          CMP      r4,#0
000018  0a000005          BEQ      |L1.52|
;;;103            {
;;;104                //GPIO_SetBit(SPI_FLASH_EX_0_HD_PORT, SPI_FLASH_EX_0_HD_PIN);
;;;105                pSpiInterface->activeCSFunc(flag);
00001c  e59f0438          LDR      r0,|L1.1116|
000020  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000024  e590100c          LDR      r1,[r0,#0xc]
000028  e1a00004          MOV      r0,r4
00002c  e12fff31          BLX      r1
000030  ea00001c          B        |L1.168|
                  |L1.52|
;;;106            }
;;;107            else
;;;108            {
;;;109                pSpiInterface->activeCSFunc(flag);
000034  e59f0420          LDR      r0,|L1.1116|
000038  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
00003c  e590100c          LDR      r1,[r0,#0xc]
000040  e1a00004          MOV      r0,r4
000044  e12fff31          BLX      r1
000048  ea000016          B        |L1.168|
                  |L1.76|
;;;110                //GPIO_ClrBit(SPI_FLASH_EX_0_HD_PORT, SPI_FLASH_EX_0_HD_PIN);
;;;111            }
;;;112            
;;;113        }
;;;114        else if(flashIndex == SPI_FLASH_EX_1_INDEX)
00004c  e3550002          CMP      r5,#2
000050  1a000009          BNE      |L1.124|
;;;115        {
;;;116            if(flag)
000054  e3540000          CMP      r4,#0
000058  0a000003          BEQ      |L1.108|
;;;117            {
;;;118                //GPIO_SetBit(SPI_FLASH_EX_1_HD_PORT, SPI_FLASH_EX_1_HD_PIN);
;;;119                GPIO_ClrBit(SPI_FLASH_EX_1_CS_PORT, SPI_FLASH_EX_1_CS_PIN);
00005c  e3a01a02          MOV      r1,#0x2000
000060  e3a00c02          MOV      r0,#0x200
000064  ebfffffe          BL       GPIO_ClrBit
000068  ea00000e          B        |L1.168|
                  |L1.108|
;;;120            }
;;;121            else
;;;122            {
;;;123                GPIO_SetBit(SPI_FLASH_EX_1_CS_PORT, SPI_FLASH_EX_1_CS_PIN);
00006c  e3a01a02          MOV      r1,#0x2000
000070  e3a00c02          MOV      r0,#0x200
000074  ebfffffe          BL       GPIO_SetBit
000078  ea00000a          B        |L1.168|
                  |L1.124|
;;;124                //GPIO_ClrBit(SPI_FLASH_EX_1_HD_PORT, SPI_FLASH_EX_1_HD_PIN);
;;;125            }
;;;126        }
;;;127        else if(flashIndex == SPI_FLASH_EX_2_INDEX)
00007c  e3550003          CMP      r5,#3
000080  1a000008          BNE      |L1.168|
;;;128        {
;;;129            if(flag)
000084  e3540000          CMP      r4,#0
000088  0a000003          BEQ      |L1.156|
;;;130            {
;;;131                GPIO_ClrBit(SPI_FLASH_EX_2_CS_PORT, SPI_FLASH_EX_2_CS_PIN);
00008c  e3a01901          MOV      r1,#0x4000
000090  e3a00c02          MOV      r0,#0x200
000094  ebfffffe          BL       GPIO_ClrBit
000098  ea000002          B        |L1.168|
                  |L1.156|
;;;132            }
;;;133            else
;;;134            {
;;;135                GPIO_SetBit(SPI_FLASH_EX_2_CS_PORT, SPI_FLASH_EX_2_CS_PIN);
00009c  e3a01901          MOV      r1,#0x4000
0000a0  e3a00c02          MOV      r0,#0x200
0000a4  ebfffffe          BL       GPIO_SetBit
                  |L1.168|
;;;136            }
;;;137        }
;;;138        
;;;139        
;;;140    }
0000a8  e8bd8070          POP      {r4-r6,pc}
;;;141    
                          ENDP

                  SpiFlash_SectorErase PROC
;;;142    static void SpiFlash_SectorErase(uint8_t flashIndex, uint32_t StartAddress)
0000ac  e92d4070          PUSH     {r4-r6,lr}
;;;143    {
0000b0  e1a05000          MOV      r5,r0
0000b4  e1a04001          MOV      r4,r1
;;;144        // /CS: active
;;;145        setFlashCS(flashIndex, TRUE);
0000b8  e3a01001          MOV      r1,#1
0000bc  e1a00005          MOV      r0,r5
0000c0  ebfffffe          BL       setFlashCS
;;;146    
;;;147        // send Command: 0x06, Write enable
;;;148        pSpiInterface->writeFunc(0, 0x06);
0000c4  e59f0390          LDR      r0,|L1.1116|
0000c8  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0000cc  e3a01006          MOV      r1,#6
0000d0  e5902004          LDR      r2,[r0,#4]
0000d4  e3a00000          MOV      r0,#0
0000d8  e12fff32          BLX      r2
;;;149    
;;;150        // /CS: de-active
;;;151        setFlashCS(flashIndex, FALSE);
0000dc  e3a01000          MOV      r1,#0
0000e0  e1a00005          MOV      r0,r5
0000e4  ebfffffe          BL       setFlashCS
;;;152    
;;;153        //////////////////////////////////////////
;;;154    
;;;155        // /CS: active
;;;156        setFlashCS(flashIndex, TRUE);
0000e8  e3a01001          MOV      r1,#1
0000ec  e1a00005          MOV      r0,r5
0000f0  ebfffffe          BL       setFlashCS
;;;157    
;;;158        // send Command: 0x20, Sector Erase
;;;159        pSpiInterface->writeFunc(0, 0x20);
0000f4  e59f0360          LDR      r0,|L1.1116|
0000f8  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0000fc  e3a01020          MOV      r1,#0x20
000100  e5902004          LDR      r2,[r0,#4]
000104  e3a00000          MOV      r0,#0
000108  e12fff32          BLX      r2
;;;160        
;;;161        
;;;162        // send 24-bit start address
;;;163        pSpiInterface->writeFunc(0, (StartAddress>>16) & 0xFF);
00010c  e1a00404          LSL      r0,r4,#8
000110  e1a01c20          LSR      r1,r0,#24
000114  e59f0340          LDR      r0,|L1.1116|
000118  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
00011c  e5902004          LDR      r2,[r0,#4]
000120  e3a00000          MOV      r0,#0
000124  e12fff32          BLX      r2
;;;164    
;;;165        pSpiInterface->writeFunc(0, (StartAddress>>8) & 0xFF);
000128  e1a00804          LSL      r0,r4,#16
00012c  e1a01c20          LSR      r1,r0,#24
000130  e59f0324          LDR      r0,|L1.1116|
000134  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000138  e5902004          LDR      r2,[r0,#4]
00013c  e3a00000          MOV      r0,#0
000140  e12fff32          BLX      r2
;;;166    
;;;167        pSpiInterface->writeFunc(0, StartAddress & 0xFF);
000144  e20410ff          AND      r1,r4,#0xff
000148  e59f030c          LDR      r0,|L1.1116|
00014c  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000150  e5902004          LDR      r2,[r0,#4]
000154  e3a00000          MOV      r0,#0
000158  e12fff32          BLX      r2
;;;168    
;;;169        // /CS: de-active
;;;170        setFlashCS(flashIndex, FALSE);
00015c  e3a01000          MOV      r1,#0
000160  e1a00005          MOV      r0,r5
000164  ebfffffe          BL       setFlashCS
;;;171        //sysprintf(" !!!!! ERROR : SpiFlash_SectorErase %d [StartAddress: 0x%08X, setor: %d]...\r\n", flashIndex, StartAddress , StartAddress/SPI_FLASH_EX_SECTOR_SIZE); 
;;;172    }
000168  e8bd8070          POP      {r4-r6,pc}
;;;173    
                          ENDP

                  SpiFlash_ReadStatusReg PROC
;;;174    static uint8_t SpiFlash_ReadStatusReg(uint8_t flashIndex)
00016c  e92d4070          PUSH     {r4-r6,lr}
;;;175    {
000170  e1a04000          MOV      r4,r0
;;;176        uint8_t u8Status;
;;;177    
;;;178        // /CS: active
;;;179        setFlashCS(flashIndex, TRUE);
000174  e3a01001          MOV      r1,#1
000178  e1a00004          MOV      r0,r4
00017c  ebfffffe          BL       setFlashCS
;;;180    
;;;181        // send Command: 0x05, Read status register
;;;182        pSpiInterface->writeFunc(0, 0x05);
000180  e59f02d4          LDR      r0,|L1.1116|
000184  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000188  e3a01005          MOV      r1,#5
00018c  e5902004          LDR      r2,[r0,#4]
000190  e3a00000          MOV      r0,#0
000194  e12fff32          BLX      r2
;;;183    
;;;184        // read status
;;;185        pSpiInterface->writeFunc(0, 0x00);
000198  e59f02bc          LDR      r0,|L1.1116|
00019c  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0001a0  e3a01000          MOV      r1,#0
0001a4  e5902004          LDR      r2,[r0,#4]
0001a8  e1a00001          MOV      r0,r1
0001ac  e12fff32          BLX      r2
;;;186    
;;;187        u8Status = pSpiInterface->readFunc(0);
0001b0  e59f02a4          LDR      r0,|L1.1116|
0001b4  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0001b8  e5901008          LDR      r1,[r0,#8]
0001bc  e3a00000          MOV      r0,#0
0001c0  e12fff31          BLX      r1
0001c4  e20050ff          AND      r5,r0,#0xff
;;;188    
;;;189        // /CS: de-active
;;;190        setFlashCS(flashIndex, FALSE);
0001c8  e3a01000          MOV      r1,#0
0001cc  e1a00004          MOV      r0,r4
0001d0  ebfffffe          BL       setFlashCS
;;;191    
;;;192        return u8Status;
0001d4  e1a00005          MOV      r0,r5
;;;193    }
0001d8  e8bd8070          POP      {r4-r6,pc}
;;;194    static void SpiFlash_WaitReady(uint8_t flashIndex)
                          ENDP

                  SpiFlash_WaitReady PROC
0001dc  e92d4070          PUSH     {r4-r6,lr}
;;;195    {
0001e0  e1a05000          MOV      r5,r0
;;;196        int counter = 5000/10;
0001e4  e3a06f7d          MOV      r6,#0x1f4
;;;197        uint8_t ReturnValue;
;;;198    
;;;199        do {
0001e8  e1a00000          MOV      r0,r0
                  |L1.492|
;;;200            //vTaskDelay(1/portTICK_RATE_MS); //add by sam
;;;201            #if(FREERTOS_USE_1000MHZ)
;;;202            vTaskDelay(1/portTICK_RATE_MS); 
;;;203            #error
;;;204            #else
;;;205            //terninalPrintf("_"); 
;;;206            
;;;207            vTaskDelay(10/portTICK_RATE_MS); 
0001ec  e3a00001          MOV      r0,#1
0001f0  ebfffffe          BL       vTaskDelay
;;;208            if(counter-- == 0)
0001f4  e1b00006          MOVS     r0,r6
0001f8  e2466001          SUB      r6,r6,#1
0001fc  1a000006          BNE      |L1.540|
;;;209            {
;;;210                terninalPrintf("\r\n #################################\r\n"); 
000200  e28f0f96          ADR      r0,|L1.1120|
000204  ebfffffe          BL       terninalPrintf
;;;211                terninalPrintf(    " ### SpiFlash_WaitReady  break ### \r\n"); 
000208  e28f0f9e          ADR      r0,|L1.1160|
00020c  ebfffffe          BL       terninalPrintf
;;;212                terninalPrintf(    " ################################# \r\n"); 
000210  e28f0fa6          ADR      r0,|L1.1200|
000214  ebfffffe          BL       terninalPrintf
;;;213                break;  
000218  ea000005          B        |L1.564|
                  |L1.540|
;;;214            }            
;;;215            #endif
;;;216            ReturnValue = SpiFlash_ReadStatusReg(flashIndex);
00021c  e1a00005          MOV      r0,r5
000220  ebfffffe          BL       SpiFlash_ReadStatusReg
000224  e1a04000          MOV      r4,r0
;;;217            ReturnValue = ReturnValue & 1;
000228  e2044001          AND      r4,r4,#1
;;;218            
;;;219        } while(ReturnValue!=0); // check the BUSY bit
00022c  e3540000          CMP      r4,#0
000230  1affffed          BNE      |L1.492|
                  |L1.564|
000234  e1a00000          MOV      r0,r0                 ;213
;;;220    }
000238  e8bd8070          POP      {r4-r6,pc}
;;;221    
                          ENDP

                  SpiFlash_NormalPageProgram PROC
;;;222    static void SpiFlash_NormalPageProgram(uint8_t flashIndex, uint32_t StartAddress, uint8_t *u8DataBuffer, int BuffLen)
00023c  e92d41f0          PUSH     {r4-r8,lr}
;;;223    {
000240  e1a08000          MOV      r8,r0
000244  e1a04001          MOV      r4,r1
000248  e1a06002          MOV      r6,r2
00024c  e1a07003          MOV      r7,r3
;;;224        uint32_t i = 0;
000250  e3a05000          MOV      r5,#0
;;;225    
;;;226        // /CS: active
;;;227        setFlashCS(flashIndex, TRUE);
000254  e3a01001          MOV      r1,#1
000258  e1a00008          MOV      r0,r8
00025c  ebfffffe          BL       setFlashCS
;;;228    
;;;229        // send Command: 0x06, Write enable
;;;230        pSpiInterface->writeFunc(0, 0x06);
000260  e59f01f4          LDR      r0,|L1.1116|
000264  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000268  e3a01006          MOV      r1,#6
00026c  e5902004          LDR      r2,[r0,#4]
000270  e3a00000          MOV      r0,#0
000274  e12fff32          BLX      r2
;;;231    
;;;232        // /CS: de-active
;;;233        setFlashCS(flashIndex, FALSE);
000278  e3a01000          MOV      r1,#0
00027c  e1a00008          MOV      r0,r8
000280  ebfffffe          BL       setFlashCS
;;;234    
;;;235    
;;;236        // /CS: active
;;;237        setFlashCS(flashIndex, TRUE);
000284  e3a01001          MOV      r1,#1
000288  e1a00008          MOV      r0,r8
00028c  ebfffffe          BL       setFlashCS
;;;238    
;;;239        // send Command: 0x02, Page program
;;;240        pSpiInterface->writeFunc(0, 0x02);
000290  e59f01c4          LDR      r0,|L1.1116|
000294  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000298  e3a01002          MOV      r1,#2
00029c  e5902004          LDR      r2,[r0,#4]
0002a0  e3a00000          MOV      r0,#0
0002a4  e12fff32          BLX      r2
;;;241    
;;;242        // send 24-bit start address
;;;243        pSpiInterface->writeFunc(0, (StartAddress>>16) & 0xFF);
0002a8  e1a00404          LSL      r0,r4,#8
0002ac  e1a01c20          LSR      r1,r0,#24
0002b0  e59f01a4          LDR      r0,|L1.1116|
0002b4  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0002b8  e5902004          LDR      r2,[r0,#4]
0002bc  e3a00000          MOV      r0,#0
0002c0  e12fff32          BLX      r2
;;;244    
;;;245        pSpiInterface->writeFunc(0, (StartAddress>>8) & 0xFF);
0002c4  e1a00804          LSL      r0,r4,#16
0002c8  e1a01c20          LSR      r1,r0,#24
0002cc  e59f0188          LDR      r0,|L1.1116|
0002d0  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0002d4  e5902004          LDR      r2,[r0,#4]
0002d8  e3a00000          MOV      r0,#0
0002dc  e12fff32          BLX      r2
;;;246    
;;;247        pSpiInterface->writeFunc(0, StartAddress & 0xFF);
0002e0  e20410ff          AND      r1,r4,#0xff
0002e4  e59f0170          LDR      r0,|L1.1116|
0002e8  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0002ec  e5902004          LDR      r2,[r0,#4]
0002f0  e3a00000          MOV      r0,#0
0002f4  e12fff32          BLX      r2
;;;248    
;;;249        // write data
;;;250        for(i=0; i<BuffLen; i++) {
0002f8  e1a00000          MOV      r0,r0
0002fc  ea000006          B        |L1.796|
                  |L1.768|
;;;251            pSpiInterface->writeFunc(0, u8DataBuffer[i]);
000300  e7d61005          LDRB     r1,[r6,r5]
000304  e59f0150          LDR      r0,|L1.1116|
000308  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
00030c  e5902004          LDR      r2,[r0,#4]
000310  e3a00000          MOV      r0,#0
000314  e12fff32          BLX      r2
000318  e2855001          ADD      r5,r5,#1              ;250
                  |L1.796|
00031c  e1550007          CMP      r5,r7                 ;250
000320  3afffff6          BCC      |L1.768|
;;;252        }
;;;253    
;;;254        // /CS: de-active
;;;255        setFlashCS(flashIndex, FALSE);
000324  e3a01000          MOV      r1,#0
000328  e1a00008          MOV      r0,r8
00032c  ebfffffe          BL       setFlashCS
;;;256    }
000330  e8bd81f0          POP      {r4-r8,pc}
;;;257    static void SpiFlash_NormalSectorProgram(uint8_t flashIndex, uint32_t StartAddress, uint8_t *u8DataBuffer, int BuffLen)
                          ENDP

                  SpiFlash_NormalSectorProgram PROC
000334  e92d41f0          PUSH     {r4-r8,lr}
;;;258    {
000338  e1a08000          MOV      r8,r0
00033c  e1a05001          MOV      r5,r1
000340  e1a06002          MOV      r6,r2
000344  e1a07003          MOV      r7,r3
;;;259        uint32_t i = 0;
000348  e3a04000          MOV      r4,#0
;;;260        for(i = 0; i < BuffLen; i = i + SPI_FLASH_EX_PAGE_SIZE)
00034c  e1a00000          MOV      r0,r0
000350  ea000007          B        |L1.884|
                  |L1.852|
;;;261        {
;;;262            SpiFlash_NormalPageProgram(flashIndex, StartAddress + i, u8DataBuffer + i, SPI_FLASH_EX_PAGE_SIZE);
000354  e0862004          ADD      r2,r6,r4
000358  e0851004          ADD      r1,r5,r4
00035c  e3a03c01          MOV      r3,#0x100
000360  e1a00008          MOV      r0,r8
000364  ebfffffe          BL       SpiFlash_NormalPageProgram
;;;263            SpiFlash_WaitReady(flashIndex);
000368  e1a00008          MOV      r0,r8
00036c  ebfffffe          BL       SpiFlash_WaitReady
000370  e2844c01          ADD      r4,r4,#0x100          ;260
                  |L1.884|
000374  e1540007          CMP      r4,r7                 ;260
000378  3afffff5          BCC      |L1.852|
;;;264        }   
;;;265    }
00037c  e8bd81f0          POP      {r4-r8,pc}
;;;266    static void SpiFlash_NormalRead(uint8_t flashIndex, uint32_t StartAddress, uint8_t *u8DataBuffer, int BuffLen)
                          ENDP

                  SpiFlash_NormalRead PROC
000380  e92d41f0          PUSH     {r4-r8,lr}
;;;267    {
000384  e1a08000          MOV      r8,r0
000388  e1a04001          MOV      r4,r1
00038c  e1a06002          MOV      r6,r2
000390  e1a07003          MOV      r7,r3
;;;268        uint32_t i;
;;;269    
;;;270        // /CS: active
;;;271        setFlashCS(flashIndex, TRUE);
000394  e3a01001          MOV      r1,#1
000398  e1a00008          MOV      r0,r8
00039c  ebfffffe          BL       setFlashCS
;;;272    
;;;273        // send Command: 0x03, Read data
;;;274        pSpiInterface->writeFunc(0, 0x03);
0003a0  e59f00b4          LDR      r0,|L1.1116|
0003a4  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0003a8  e3a01003          MOV      r1,#3
0003ac  e5902004          LDR      r2,[r0,#4]
0003b0  e3a00000          MOV      r0,#0
0003b4  e12fff32          BLX      r2
;;;275    
;;;276        // send 24-bit start address
;;;277        pSpiInterface->writeFunc(0, (StartAddress>>16) & 0xFF);
0003b8  e1a00404          LSL      r0,r4,#8
0003bc  e1a01c20          LSR      r1,r0,#24
0003c0  e59f0094          LDR      r0,|L1.1116|
0003c4  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0003c8  e5902004          LDR      r2,[r0,#4]
0003cc  e3a00000          MOV      r0,#0
0003d0  e12fff32          BLX      r2
;;;278    
;;;279        pSpiInterface->writeFunc(0, (StartAddress>>8) & 0xFF);
0003d4  e1a00804          LSL      r0,r4,#16
0003d8  e1a01c20          LSR      r1,r0,#24
0003dc  e59f0078          LDR      r0,|L1.1116|
0003e0  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0003e4  e5902004          LDR      r2,[r0,#4]
0003e8  e3a00000          MOV      r0,#0
0003ec  e12fff32          BLX      r2
;;;280    
;;;281        pSpiInterface->writeFunc(0, StartAddress & 0xFF);
0003f0  e20410ff          AND      r1,r4,#0xff
0003f4  e59f0060          LDR      r0,|L1.1116|
0003f8  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0003fc  e5902004          LDR      r2,[r0,#4]
000400  e3a00000          MOV      r0,#0
000404  e12fff32          BLX      r2
;;;282    
;;;283        // read data
;;;284        for(i=0; i<BuffLen; i++) {
000408  e3a05000          MOV      r5,#0
00040c  ea00000c          B        |L1.1092|
                  |L1.1040|
;;;285            pSpiInterface->writeFunc(0, 0x00);
000410  e59f0044          LDR      r0,|L1.1116|
000414  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000418  e3a01000          MOV      r1,#0
00041c  e5902004          LDR      r2,[r0,#4]
000420  e1a00001          MOV      r0,r1
000424  e12fff32          BLX      r2
;;;286            u8DataBuffer[i] = pSpiInterface->readFunc(0);
000428  e59f002c          LDR      r0,|L1.1116|
00042c  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000430  e5901008          LDR      r1,[r0,#8]
000434  e3a00000          MOV      r0,#0
000438  e12fff31          BLX      r1
00043c  e7c60005          STRB     r0,[r6,r5]
000440  e2855001          ADD      r5,r5,#1              ;284
                  |L1.1092|
000444  e1550007          CMP      r5,r7                 ;284
000448  3afffff0          BCC      |L1.1040|
;;;287        }
;;;288        // /CS: de-active
;;;289        setFlashCS(flashIndex, FALSE);
00044c  e3a01000          MOV      r1,#0
000450  e1a00008          MOV      r0,r8
000454  ebfffffe          BL       setFlashCS
;;;290    }
000458  e8bd81f0          POP      {r4-r8,pc}
                  |L1.1116|
                          DCD      pSpiInterface
                  |L1.1120|
000460  0d0a2023          DCB      "\r\n #################################\r\n",0
000464  23232323
000468  23232323
00046c  23232323
000470  23232323
000474  23232323
000478  23232323
00047c  23232323
000480  23232323
000484  0d0a00  
000487  00                DCB      0
                  |L1.1160|
000488  20232323          DCB      " ### SpiFlash_WaitReady  break ### \r\n",0
00048c  20537069
000490  466c6173
000494  685f5761
000498  69745265
00049c  61647920
0004a0  20627265
0004a4  616b2023
0004a8  2323200d
0004ac  0a00    
0004ae  00                DCB      0
0004af  00                DCB      0
                  |L1.1200|
0004b0  20232323          DCB      " ################################# \r\n",0
0004b4  23232323
0004b8  23232323
0004bc  23232323
0004c0  23232323
0004c4  23232323
0004c8  23232323
0004cc  23232323
0004d0  2323200d
0004d4  0a00    
0004d6  00                DCB      0
0004d7  00                DCB      0
                          ENDP

                  SpiFlash_ReadMidDid PROC
;;;291    
;;;292    static uint16_t SpiFlash_ReadMidDid(uint8_t flashIndex)
0004d8  e92d4038          PUSH     {r3-r5,lr}
;;;293    {
0004dc  e1a04000          MOV      r4,r0
;;;294        uint8_t u8RxData[2];
;;;295    
;;;296        // /CS: active
;;;297        setFlashCS(flashIndex, TRUE);
0004e0  e3a01001          MOV      r1,#1
0004e4  e1a00004          MOV      r0,r4
0004e8  ebfffffe          BL       setFlashCS
;;;298    
;;;299        // send Command: 0x90, Read Manufacturer/Device ID
;;;300        pSpiInterface->writeFunc(0, 0x90);
0004ec  e51f0098          LDR      r0,|L1.1116|
0004f0  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0004f4  e3a01090          MOV      r1,#0x90
0004f8  e5902004          LDR      r2,[r0,#4]
0004fc  e3a00000          MOV      r0,#0
000500  e12fff32          BLX      r2
;;;301    
;;;302        // send 24-bit '0', dummy
;;;303        pSpiInterface->writeFunc(0, 0x00);
000504  e51f00b0          LDR      r0,|L1.1116|
000508  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
00050c  e3a01000          MOV      r1,#0
000510  e5902004          LDR      r2,[r0,#4]
000514  e1a00001          MOV      r0,r1
000518  e12fff32          BLX      r2
;;;304    
;;;305        pSpiInterface->writeFunc(0, 0x00);
00051c  e51f00c8          LDR      r0,|L1.1116|
000520  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000524  e3a01000          MOV      r1,#0
000528  e5902004          LDR      r2,[r0,#4]
00052c  e1a00001          MOV      r0,r1
000530  e12fff32          BLX      r2
;;;306    
;;;307        pSpiInterface->writeFunc(0, 0x00);
000534  e51f00e0          LDR      r0,|L1.1116|
000538  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
00053c  e3a01000          MOV      r1,#0
000540  e5902004          LDR      r2,[r0,#4]
000544  e1a00001          MOV      r0,r1
000548  e12fff32          BLX      r2
;;;308    
;;;309        // receive 16-bit
;;;310        pSpiInterface->writeFunc(0, 0x00);
00054c  e51f00f8          LDR      r0,|L1.1116|
000550  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000554  e3a01000          MOV      r1,#0
000558  e5902004          LDR      r2,[r0,#4]
00055c  e1a00001          MOV      r0,r1
000560  e12fff32          BLX      r2
;;;311        u8RxData[0] = pSpiInterface->readFunc(0);
000564  e51f0110          LDR      r0,|L1.1116|
000568  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
00056c  e5901008          LDR      r1,[r0,#8]
000570  e3a00000          MOV      r0,#0
000574  e12fff31          BLX      r1
000578  e5cd0000          STRB     r0,[sp,#0]
;;;312    
;;;313        pSpiInterface->writeFunc(0, 0x00);
00057c  e51f0128          LDR      r0,|L1.1116|
000580  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000584  e3a01000          MOV      r1,#0
000588  e5902004          LDR      r2,[r0,#4]
00058c  e1a00001          MOV      r0,r1
000590  e12fff32          BLX      r2
;;;314        u8RxData[1] = pSpiInterface->readFunc(0);
000594  e51f0140          LDR      r0,|L1.1116|
000598  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
00059c  e5901008          LDR      r1,[r0,#8]
0005a0  e3a00000          MOV      r0,#0
0005a4  e12fff31          BLX      r1
0005a8  e5cd0001          STRB     r0,[sp,#1]
;;;315    
;;;316        // /CS: de-active
;;;317        setFlashCS(flashIndex, FALSE);
0005ac  e3a01000          MOV      r1,#0
0005b0  e1a00004          MOV      r0,r4
0005b4  ebfffffe          BL       setFlashCS
;;;318        
;;;319        sysprintf("SpiFlash_ReadMidDid[0x%02X, 0x%02X]...\r\n", u8RxData[0] , u8RxData[1] ); 
0005b8  e5dd2001          LDRB     r2,[sp,#1]
0005bc  e5dd1000          LDRB     r1,[sp,#0]
0005c0  e28f0e26          ADR      r0,|L1.2088|
0005c4  ebfffffe          BL       sysprintf
;;;320    
;;;321        return ( (u8RxData[0]<<8) | u8RxData[1] );
0005c8  e5dd0001          LDRB     r0,[sp,#1]
0005cc  e5dd1000          LDRB     r1,[sp,#0]
0005d0  e1800401          ORR      r0,r0,r1,LSL #8
;;;322    }
0005d4  e8bd8038          POP      {r3-r5,pc}
;;;323    
                          ENDP

                  hwInit PROC
;;;324    static BOOL hwInit(void)
0005d8  e92d4010          PUSH     {r4,lr}
;;;325    {
;;;326        
;;;327        //GPI14 FLASH1 CS pin
;;;328        outpw(REG_SYS_GPI_MFPH,(inpw(REG_SYS_GPI_MFPH) & ~(0xF<<24)) | (0x0<<24));
0005dc  e3a0020b          MOV      r0,#0xb0000000
0005e0  e59000b4          LDR      r0,[r0,#0xb4]
0005e4  e3c0040f          BIC      r0,r0,#0xf000000
0005e8  e3a0120b          MOV      r1,#0xb0000000
0005ec  e58100b4          STR      r0,[r1,#0xb4]
;;;329        GPIO_OpenBit(SPI_FLASH_EX_2_CS_PORT, SPI_FLASH_EX_2_CS_PIN, DIR_OUTPUT, NO_PULL_UP);
0005f0  e3a03000          MOV      r3,#0
0005f4  e3a02001          MOV      r2,#1
0005f8  e3a01901          MOV      r1,#0x4000
0005fc  e3a00c02          MOV      r0,#0x200
000600  ebfffffe          BL       GPIO_OpenBit
;;;330        GPIO_SetBit(SPI_FLASH_EX_2_CS_PORT, SPI_FLASH_EX_2_CS_PIN);
000604  e3a01901          MOV      r1,#0x4000
000608  e3a00c02          MOV      r0,#0x200
00060c  ebfffffe          BL       GPIO_SetBit
;;;331        
;;;332        //GPI13 FLASH1 CS pin
;;;333        outpw(REG_SYS_GPI_MFPH,(inpw(REG_SYS_GPI_MFPH) & ~(0xF<<20)) | (0x0<<20));
000610  e3a0020b          MOV      r0,#0xb0000000
000614  e59000b4          LDR      r0,[r0,#0xb4]
000618  e3c0060f          BIC      r0,r0,#0xf00000
00061c  e3a0120b          MOV      r1,#0xb0000000
000620  e58100b4          STR      r0,[r1,#0xb4]
;;;334        GPIO_OpenBit(SPI_FLASH_EX_1_CS_PORT, SPI_FLASH_EX_1_CS_PIN, DIR_OUTPUT, NO_PULL_UP);
000624  e3a03000          MOV      r3,#0
000628  e3a02001          MOV      r2,#1
00062c  e3a01a02          MOV      r1,#0x2000
000630  e3a00c02          MOV      r0,#0x200
000634  ebfffffe          BL       GPIO_OpenBit
;;;335        GPIO_SetBit(SPI_FLASH_EX_1_CS_PORT, SPI_FLASH_EX_1_CS_PIN);
000638  e3a01a02          MOV      r1,#0x2000
00063c  e3a00c02          MOV      r0,#0x200
000640  ebfffffe          BL       GPIO_SetBit
;;;336        
;;;337        //GPI11 FLASH0 WP pin
;;;338        outpw(REG_SYS_GPI_MFPH,(inpw(REG_SYS_GPI_MFPH) & ~(0xF<<12)) | (0x0<<12));
000644  e3a0020b          MOV      r0,#0xb0000000
000648  e59000b4          LDR      r0,[r0,#0xb4]
00064c  e3c00a0f          BIC      r0,r0,#0xf000
000650  e3a0120b          MOV      r1,#0xb0000000
000654  e58100b4          STR      r0,[r1,#0xb4]
;;;339        GPIO_OpenBit(SPI_FLASH_EX_0_WP_PORT, SPI_FLASH_EX_0_WP_PIN, DIR_OUTPUT, NO_PULL_UP);
000658  e3a03000          MOV      r3,#0
00065c  e3a02001          MOV      r2,#1
000660  e3a01b02          MOV      r1,#0x800
000664  e3a00c02          MOV      r0,#0x200
000668  ebfffffe          BL       GPIO_OpenBit
;;;340        GPIO_SetBit(SPI_FLASH_EX_0_WP_PORT, SPI_FLASH_EX_0_WP_PIN);
00066c  e3a01b02          MOV      r1,#0x800
000670  e3a00c02          MOV      r0,#0x200
000674  ebfffffe          BL       GPIO_SetBit
;;;341        //GPI12 FLASH0 HD pin
;;;342        outpw(REG_SYS_GPI_MFPH,(inpw(REG_SYS_GPI_MFPH) & ~(0xF<<16)) | (0x0<<16));
000678  e3a0020b          MOV      r0,#0xb0000000
00067c  e59000b4          LDR      r0,[r0,#0xb4]
000680  e3c0080f          BIC      r0,r0,#0xf0000
000684  e3a0120b          MOV      r1,#0xb0000000
000688  e58100b4          STR      r0,[r1,#0xb4]
;;;343        GPIO_OpenBit(SPI_FLASH_EX_0_HD_PORT, SPI_FLASH_EX_0_HD_PIN, DIR_OUTPUT, NO_PULL_UP);
00068c  e3a03000          MOV      r3,#0
000690  e3a02001          MOV      r2,#1
000694  e3a01a01          MOV      r1,#0x1000
000698  e3a00c02          MOV      r0,#0x200
00069c  ebfffffe          BL       GPIO_OpenBit
;;;344        GPIO_SetBit(SPI_FLASH_EX_0_HD_PORT, SPI_FLASH_EX_0_HD_PIN);
0006a0  e3a01a01          MOV      r1,#0x1000
0006a4  e3a00c02          MOV      r0,#0x200
0006a8  ebfffffe          BL       GPIO_SetBit
;;;345        
;;;346    #if(SUPPORT_HK_10_HW)
;;;347        //GPI4 FLASH1 WP pin
;;;348        outpw(REG_SYS_GPI_MFPL,(inpw(REG_SYS_GPI_MFPL) & ~(0xF<<16)) | (0x0<<16));
0006ac  e3a0020b          MOV      r0,#0xb0000000
0006b0  e59000b0          LDR      r0,[r0,#0xb0]
0006b4  e3c0080f          BIC      r0,r0,#0xf0000
0006b8  e3a0120b          MOV      r1,#0xb0000000
0006bc  e58100b0          STR      r0,[r1,#0xb0]
;;;349        GPIO_OpenBit(SPI_FLASH_EX_1_WP_PORT, SPI_FLASH_EX_1_WP_PIN, DIR_OUTPUT, NO_PULL_UP);
0006c0  e3a03000          MOV      r3,#0
0006c4  e3a02001          MOV      r2,#1
0006c8  e3a01010          MOV      r1,#0x10
0006cc  e3a00c02          MOV      r0,#0x200
0006d0  ebfffffe          BL       GPIO_OpenBit
;;;350        GPIO_SetBit(SPI_FLASH_EX_1_WP_PORT, SPI_FLASH_EX_1_WP_PIN);
0006d4  e3a01010          MOV      r1,#0x10
0006d8  e3a00c02          MOV      r0,#0x200
0006dc  ebfffffe          BL       GPIO_SetBit
;;;351    #else
;;;352        //GPI14 FLASH1 WP pin
;;;353        outpw(REG_SYS_GPI_MFPH,(inpw(REG_SYS_GPI_MFPH) & ~(0xF<<24)) | (0x0<<24));
;;;354        GPIO_OpenBit(SPI_FLASH_EX_1_WP_PORT, SPI_FLASH_EX_1_WP_PIN, DIR_OUTPUT, NO_PULL_UP);
;;;355        GPIO_SetBit(SPI_FLASH_EX_1_WP_PORT, SPI_FLASH_EX_1_WP_PIN);
;;;356    #endif
;;;357    //    //GPI14 FLASH1 WP pin
;;;358    //    outpw(REG_SYS_GPI_MFPH,(inpw(REG_SYS_GPI_MFPH) & ~(0xF<<24)) | (0x0<<24));
;;;359    //    GPIO_OpenBit(SPI_FLASH_EX_1_WP_PORT, SPI_FLASH_EX_1_WP_PIN, DIR_OUTPUT, NO_PULL_UP);
;;;360    //    GPIO_SetBit(SPI_FLASH_EX_1_WP_PORT, SPI_FLASH_EX_1_WP_PIN);
;;;361        
;;;362        //GPI15 FLASH1 HD pin
;;;363        outpw(REG_SYS_GPI_MFPH,(inpw(REG_SYS_GPI_MFPH) & ~(0xFu<<28)) | (0x0u<<28));
0006e0  e3a0020b          MOV      r0,#0xb0000000
0006e4  e59000b4          LDR      r0,[r0,#0xb4]
0006e8  e3c0020f          BIC      r0,r0,#0xf0000000
0006ec  e3a0120b          MOV      r1,#0xb0000000
0006f0  e58100b4          STR      r0,[r1,#0xb4]
;;;364        GPIO_OpenBit(SPI_FLASH_EX_1_HD_PORT, SPI_FLASH_EX_1_HD_PIN, DIR_OUTPUT, NO_PULL_UP);
0006f4  e3a03000          MOV      r3,#0
0006f8  e3a02001          MOV      r2,#1
0006fc  e3a01902          MOV      r1,#0x8000
000700  e3a00c02          MOV      r0,#0x200
000704  ebfffffe          BL       GPIO_OpenBit
;;;365        GPIO_SetBit(SPI_FLASH_EX_1_HD_PORT, SPI_FLASH_EX_1_HD_PIN);
000708  e3a01902          MOV      r1,#0x8000
00070c  e3a00c02          MOV      r0,#0x200
000710  ebfffffe          BL       GPIO_SetBit
;;;366        
;;;367        return TRUE;
000714  e3a00001          MOV      r0,#1
;;;368    }
000718  e8bd8010          POP      {r4,pc}
;;;369    static BOOL swInitPure(void)
                          ENDP

                  swInitPure PROC
00071c  e92d4010          PUSH     {r4,lr}
;;;370    {     
;;;371        if(xSemaphore == NULL)
000720  e59f012c          LDR      r0,|L1.2132|
000724  e5900000          LDR      r0,[r0,#0]  ; xSemaphore
000728  e3500000          CMP      r0,#0
00072c  1a000003          BNE      |L1.1856|
;;;372        {
;;;373            xSemaphore = xSemaphoreCreateMutex(); 
000730  e3a00001          MOV      r0,#1
000734  ebfffffe          BL       xQueueCreateMutex
000738  e59f1114          LDR      r1,|L1.2132|
00073c  e5810000          STR      r0,[r1,#0]  ; xSemaphore
                  |L1.1856|
;;;374        }  
;;;375        return TRUE;
000740  e3a00001          MOV      r0,#1
;;;376    }
000744  e8bd8010          POP      {r4,pc}
;;;377    static BOOL swInit(uint8_t pdrv)
                          ENDP

                  swInit PROC
000748  e92d41f0          PUSH     {r4-r8,lr}
;;;378    {   
00074c  e1a05000          MOV      r5,r0
;;;379        BOOL reval = TRUE;
000750  e3a07001          MOV      r7,#1
;;;380        uint16_t u16ID;
;;;381        uint8_t targetIndex;
;;;382        
;;;383        //if(xSemaphore == NULL)
;;;384        //{
;;;385        //    xSemaphore = xSemaphoreCreateMutex(); 
;;;386        //}
;;;387        SpiFlash_WaitReady(pdrv);  
000754  e1a00005          MOV      r0,r5
000758  ebfffffe          BL       SpiFlash_WaitReady
;;;388        // check flash id
;;;389        u16ID = SpiFlash_ReadMidDid(pdrv/*SPI_FLASH_EX_0_INDEX*/);
00075c  e1a00005          MOV      r0,r5
000760  ebfffffe          BL       SpiFlash_ReadMidDid
000764  e1a06000          MOV      r6,r0
;;;390        targetIndex = pdrv -1;
000768  e2450001          SUB      r0,r5,#1
00076c  e20040ff          AND      r4,r0,#0xff
;;;391        switch(u16ID)
000770  e2460c17          SUB      r0,r6,#0x1700
000774  e25000ef          SUBS     r0,r0,#0xef
000778  0a000015          BEQ      |L1.2004|
00077c  e2400cd7          SUB      r0,r0,#0xd700
000780  e2500027          SUBS     r0,r0,#0x27
000784  0a000002          BEQ      |L1.1940|
000788  e3500001          CMP      r0,#1
00078c  1a000018          BNE      |L1.2036|
000790  ea000007          B        |L1.1972|
                  |L1.1940|
;;;392        {
;;;393            case 0xEF16:
000794  e1a00000          MOV      r0,r0
;;;394                sysprintf("Flash[%d] found: W25Q64BV ...\n", targetIndex); 
000798  e1a01004          MOV      r1,r4
00079c  e28f00b4          ADR      r0,|L1.2136|
0007a0  ebfffffe          BL       sysprintf
;;;395                existFlag[targetIndex] = TRUE;
0007a4  e3a00001          MOV      r0,#1
0007a8  e59f10c8          LDR      r1,|L1.2168|
0007ac  e7c10004          STRB     r0,[r1,r4]
;;;396                //blockSize[targetIndex] = 8;
;;;397                break;        
0007b0  ea000019          B        |L1.2076|
                  |L1.1972|
;;;398            case 0xEF17:
0007b4  e1a00000          MOV      r0,r0
;;;399                sysprintf("Flash[[%d] found: W25Q128BV ...\n", targetIndex);
0007b8  e1a01004          MOV      r1,r4
0007bc  e28f00b8          ADR      r0,|L1.2172|
0007c0  ebfffffe          BL       sysprintf
;;;400                existFlag[targetIndex] = TRUE;  
0007c4  e3a00001          MOV      r0,#1
0007c8  e59f10a8          LDR      r1,|L1.2168|
0007cc  e7c10004          STRB     r0,[r1,r4]
;;;401                //blockSize[targetIndex] = 16;       
;;;402                break;  
0007d0  ea000011          B        |L1.2076|
                  |L1.2004|
;;;403            case 0x17EF:
0007d4  e1a00000          MOV      r0,r0
;;;404                sysprintf("Flash[[%d] found: W25Q128BV ...\n", targetIndex);
0007d8  e1a01004          MOV      r1,r4
0007dc  e28f0098          ADR      r0,|L1.2172|
0007e0  ebfffffe          BL       sysprintf
;;;405                existFlag[targetIndex] = TRUE;  
0007e4  e3a00001          MOV      r0,#1
0007e8  e59f1088          LDR      r1,|L1.2168|
0007ec  e7c10004          STRB     r0,[r1,r4]
;;;406                //blockSize[targetIndex] = 16;       
;;;407                break;         
0007f0  ea000009          B        |L1.2076|
                  |L1.2036|
;;;408            default:
0007f4  e1a00000          MOV      r0,r0
;;;409                sysprintf("Flash[[%d] Wrong ID, 0x%x\n", targetIndex, u16ID);
0007f8  e1a02006          MOV      r2,r6
0007fc  e1a01004          MOV      r1,r4
000800  e28f0098          ADR      r0,|L1.2208|
000804  ebfffffe          BL       sysprintf
;;;410                reval = FALSE;  
000808  e3a07000          MOV      r7,#0
;;;411                existFlag[targetIndex] = FALSE;        
00080c  e3a00000          MOV      r0,#0
000810  e59f1060          LDR      r1,|L1.2168|
000814  e7c10004          STRB     r0,[r1,r4]
;;;412                break;         
000818  e1a00000          MOV      r0,r0
                  |L1.2076|
00081c  e1a00000          MOV      r0,r0                 ;397
;;;413        }
;;;414       
;;;415        return reval;
000820  e1a00007          MOV      r0,r7
;;;416    }
000824  e8bd81f0          POP      {r4-r8,pc}
                  |L1.2088|
000828  53706946          DCB      "SpiFlash_ReadMidDid[0x%02X, 0x%02X]...\r\n",0
00082c  6c617368
000830  5f526561
000834  644d6964
000838  4469645b
00083c  30782530
000840  32582c20
000844  30782530
000848  32585d2e
00084c  2e2e0d0a
000850  00      
000851  00                DCB      0
000852  00                DCB      0
000853  00                DCB      0
                  |L1.2132|
                          DCD      xSemaphore
                  |L1.2136|
000858  466c6173          DCB      "Flash[%d] found: W25Q64BV ...\n",0
00085c  685b2564
000860  5d20666f
000864  756e643a
000868  20573235
00086c  51363442
000870  56202e2e
000874  2e0a00  
000877  00                DCB      0
                  |L1.2168|
                          DCD      existFlag
                  |L1.2172|
00087c  466c6173          DCB      "Flash[[%d] found: W25Q128BV ...\n",0
000880  685b5b25
000884  645d2066
000888  6f756e64
00088c  3a205732
000890  35513132
000894  38425620
000898  2e2e2e0a
00089c  00      
00089d  00                DCB      0
00089e  00                DCB      0
00089f  00                DCB      0
                  |L1.2208|
0008a0  466c6173          DCB      "Flash[[%d] Wrong ID, 0x%x\n",0
0008a4  685b5b25
0008a8  645d2057
0008ac  726f6e67
0008b0  2049442c
0008b4  20307825
0008b8  780a00  
0008bb  00                DCB      0
                          ENDP

                  FlashDrvExInit PROC
;;;420    /*-----------------------------------------*/
;;;421    BOOL FlashDrvExInit(BOOL testModeFlag)
0008bc  e92d4010          PUSH     {r4,lr}
;;;422    {    
0008c0  e24dd020          SUB      sp,sp,#0x20
0008c4  e1a04000          MOV      r4,r0
;;;423        if(initFlag)
0008c8  e59f0148          LDR      r0,|L1.2584|
0008cc  e5d00000          LDRB     r0,[r0,#0]  ; initFlag
0008d0  e3500000          CMP      r0,#0
0008d4  0a000002          BEQ      |L1.2276|
;;;424            return TRUE;
0008d8  e3a00001          MOV      r0,#1
                  |L1.2268|
0008dc  e28dd020          ADD      sp,sp,#0x20
;;;425        if(pSpiInterface == NULL)
;;;426        {
;;;427            sysprintf("FlashDrvExInit!!(FS:0x%08x (page:%d~%d, sector:%d~%d), RAW:0x%08x (page:%d~%d, sector:%d~%d))\n",  
;;;428                        SPI_FLASH_EX_FS_START_ADDRESS, SPI_FLASH_EX_FS_START_PAGE, SPI_FLASH_EX_FS_END_PAGE, SPI_FLASH_EX_FS_START_SECTOR, SPI_FLASH_EX_FS_END_SECTOR,
;;;429                        SPI_FLASH_EX_RAW_START_ADDRESS, SPI_FLASH_EX_RAW_START_PAGE, SPI_FLASH_EX_RAW_END_PAGE, SPI_FLASH_EX_RAW_START_SECTOR, SPI_FLASH_EX_RAW_END_SECTOR);
;;;430            pSpiInterface = SpiGetInterface(FLASH_SPI);
;;;431            if(pSpiInterface == NULL)
;;;432            {
;;;433                sysprintf("FlashDrvExInit ERROR (pSpiInterface == NULL)!!\n");
;;;434                return FALSE;
;;;435            }
;;;436            if(pSpiInterface->initFunc() == FALSE)
;;;437            {
;;;438                sysprintf("FlashDrvExInit ERROR (initFunc false)!!\n");
;;;439                return FALSE;
;;;440            }
;;;441            if(hwInit() == FALSE)
;;;442            {
;;;443                sysprintf("FlashDrvExInit ERROR (hwInit false)!!\n");
;;;444                return FALSE;
;;;445            }
;;;446            if(swInitPure() == FALSE)
;;;447            {
;;;448                sysprintf("FlashDrvExInit ERROR (swInitPure false)!!\n");
;;;449                return FALSE;
;;;450            }        
;;;451           
;;;452        }
;;;453        else
;;;454        {
;;;455            sysprintf("FlashDrvExInit!! ignore\n");
;;;456        }
;;;457        sysprintf("FlashDrvExInit!! OK\n");
;;;458        initFlag = TRUE;
;;;459        return TRUE;
;;;460    }
0008e0  e8bd8010          POP      {r4,pc}
                  |L1.2276|
0008e4  e51f0490          LDR      r0,|L1.1116|
0008e8  e5900000          LDR      r0,[r0,#0]            ;425  ; pSpiInterface
0008ec  e3500000          CMP      r0,#0                 ;425
0008f0  1a000035          BNE      |L1.2508|
0008f4  e59f0120          LDR      r0,|L1.2588|
0008f8  e3a01000          MOV      r1,#0                 ;427
0008fc  e1802200          ORR      r2,r0,r0,LSL #4       ;427
000900  e58d100c          STR      r1,[sp,#0xc]          ;427
000904  e58d2010          STR      r2,[sp,#0x10]         ;427
000908  e58d0018          STR      r0,[sp,#0x18]         ;427
00090c  e58d1014          STR      r1,[sp,#0x14]         ;427
000910  e1a00001          MOV      r0,r1                 ;427
000914  e3a01b02          MOV      r1,#0x800             ;427
000918  e3a02c03          MOV      r2,#0x300             ;427
00091c  e3a03902          MOV      r3,#0x8000            ;427
000920  e58d2000          STR      r2,[sp,#0]            ;427
000924  e3a02a03          MOV      r2,#0x3000            ;427
000928  e58d1004          STR      r1,[sp,#4]            ;427
00092c  e3a01603          MOV      r1,#0x300000          ;427
000930  e58d0008          STR      r0,[sp,#8]            ;427
000934  e59f00e4          LDR      r0,|L1.2592|
000938  ebfffffe          BL       sysprintf
00093c  e3a00000          MOV      r0,#0                 ;430
000940  ebfffffe          BL       SpiGetInterface
000944  e51f14f0          LDR      r1,|L1.1116|
000948  e5810000          STR      r0,[r1,#0]            ;430  ; pSpiInterface
00094c  e2810000          ADD      r0,r1,#0              ;431
000950  e5900000          LDR      r0,[r0,#0]            ;431  ; pSpiInterface
000954  e3500000          CMP      r0,#0                 ;431
000958  1a000003          BNE      |L1.2412|
00095c  e28f00c0          ADR      r0,|L1.2596|
000960  ebfffffe          BL       sysprintf
000964  e3a00000          MOV      r0,#0                 ;434
000968  eaffffdb          B        |L1.2268|
                  |L1.2412|
00096c  e51f1518          LDR      r1,|L1.1116|
000970  e5911000          LDR      r1,[r1,#0]            ;436  ; pSpiInterface
000974  e5910000          LDR      r0,[r1,#0]            ;436
000978  e12fff30          BLX      r0                    ;436
00097c  e3500000          CMP      r0,#0                 ;436
000980  1a000003          BNE      |L1.2452|
000984  e28f00c8          ADR      r0,|L1.2644|
000988  ebfffffe          BL       sysprintf
00098c  e3a00000          MOV      r0,#0                 ;439
000990  eaffffd1          B        |L1.2268|
                  |L1.2452|
000994  ebfffffe          BL       hwInit
000998  e3500000          CMP      r0,#0                 ;441
00099c  1a000003          BNE      |L1.2480|
0009a0  e28f00d8          ADR      r0,|L1.2688|
0009a4  ebfffffe          BL       sysprintf
0009a8  e3a00000          MOV      r0,#0                 ;444
0009ac  eaffffca          B        |L1.2268|
                  |L1.2480|
0009b0  ebfffffe          BL       swInitPure
0009b4  e3500000          CMP      r0,#0                 ;446
0009b8  1a000005          BNE      |L1.2516|
0009bc  e28f00e4          ADR      r0,|L1.2728|
0009c0  ebfffffe          BL       sysprintf
0009c4  e3a00000          MOV      r0,#0                 ;449
0009c8  eaffffc3          B        |L1.2268|
                  |L1.2508|
0009cc  e28f0c01          ADR      r0,|L1.2772|
0009d0  ebfffffe          BL       sysprintf
                  |L1.2516|
0009d4  e28f0f45          ADR      r0,|L1.2800|
0009d8  ebfffffe          BL       sysprintf
0009dc  e3a00001          MOV      r0,#1                 ;458
0009e0  e59f1030          LDR      r1,|L1.2584|
0009e4  e5c10000          STRB     r0,[r1,#0]            ;458  ; initFlag
0009e8  e1a00000          MOV      r0,r0                 ;459
0009ec  eaffffba          B        |L1.2268|
;;;461    
                          ENDP

                  FlashDrvExInitialize PROC
;;;462    
;;;463    BOOL FlashDrvExInitialize(uint8_t pdrv)
0009f0  e92d4010          PUSH     {r4,lr}
;;;464    {
0009f4  e1a04000          MOV      r4,r0
;;;465        //if(SPI_FLASH_EX_0_INDEX == pdrv)
;;;466        //    return FALSE;
;;;467        //return TRUE;
;;;468        if(swInit(pdrv) == FALSE)
0009f8  e1a00004          MOV      r0,r4
0009fc  ebfffffe          BL       swInit
000a00  e3500000          CMP      r0,#0
000a04  1a00004b          BNE      |L1.2872|
;;;469        {
;;;470            sysprintf("FlashDrvExInitialize ERROR (swInit false)!!\n");
000a08  e28f00f8          ADR      r0,|L1.2824|
000a0c  ebfffffe          BL       sysprintf
;;;471            return FALSE;
000a10  e3a00000          MOV      r0,#0
                  |L1.2580|
;;;472        }
;;;473        //sysprintf("FlashDrvExInitialize existFlag[pdrv - 1] = %d!!\n", existFlag[pdrv - 1]);
;;;474        return existFlag[pdrv - 1];
;;;475    }
000a14  e8bd8010          POP      {r4,pc}
                  |L1.2584|
                          DCD      initFlag
                  |L1.2588|
                          DCD      0x000002ff
                  |L1.2592|
                          DCD      ||.constdata||
                  |L1.2596|
000a24  466c6173          DCB      "FlashDrvExInit ERROR (pSpiInterface == NULL)!!\n",0
000a28  68447276
000a2c  4578496e
000a30  69742045
000a34  52524f52
000a38  20287053
000a3c  7069496e
000a40  74657266
000a44  61636520
000a48  3d3d204e
000a4c  554c4c29
000a50  21210a00
                  |L1.2644|
000a54  466c6173          DCB      "FlashDrvExInit ERROR (initFunc false)!!\n",0
000a58  68447276
000a5c  4578496e
000a60  69742045
000a64  52524f52
000a68  2028696e
000a6c  69744675
000a70  6e632066
000a74  616c7365
000a78  2921210a
000a7c  00      
000a7d  00                DCB      0
000a7e  00                DCB      0
000a7f  00                DCB      0
                  |L1.2688|
000a80  466c6173          DCB      "FlashDrvExInit ERROR (hwInit false)!!\n",0
000a84  68447276
000a88  4578496e
000a8c  69742045
000a90  52524f52
000a94  20286877
000a98  496e6974
000a9c  2066616c
000aa0  73652921
000aa4  210a00  
000aa7  00                DCB      0
                  |L1.2728|
000aa8  466c6173          DCB      "FlashDrvExInit ERROR (swInitPure false)!!\n",0
000aac  68447276
000ab0  4578496e
000ab4  69742045
000ab8  52524f52
000abc  20287377
000ac0  496e6974
000ac4  50757265
000ac8  2066616c
000acc  73652921
000ad0  210a00  
000ad3  00                DCB      0
                  |L1.2772|
000ad4  466c6173          DCB      "FlashDrvExInit!! ignore\n",0
000ad8  68447276
000adc  4578496e
000ae0  69742121
000ae4  2069676e
000ae8  6f72650a
000aec  00      
000aed  00                DCB      0
000aee  00                DCB      0
000aef  00                DCB      0
                  |L1.2800|
000af0  466c6173          DCB      "FlashDrvExInit!! OK\n",0
000af4  68447276
000af8  4578496e
000afc  69742121
000b00  204f4b0a
000b04  00      
000b05  00                DCB      0
000b06  00                DCB      0
000b07  00                DCB      0
                  |L1.2824|
000b08  466c6173          DCB      "FlashDrvExInitialize ERROR (swInit false)!!\n",0
000b0c  68447276
000b10  4578496e
000b14  69746961
000b18  6c697a65
000b1c  20455252
000b20  4f522028
000b24  7377496e
000b28  69742066
000b2c  616c7365
000b30  2921210a
000b34  00      
000b35  00                DCB      0
000b36  00                DCB      0
000b37  00                DCB      0
                  |L1.2872|
000b38  e2440001          SUB      r0,r4,#1              ;474
000b3c  e51f12cc          LDR      r1,|L1.2168|
000b40  e7d10000          LDRB     r0,[r1,r0]            ;474
000b44  eaffffb2          B        |L1.2580|
;;;476    BOOL FlashDrvExStatus(uint8_t pdrv)
                          ENDP

                  FlashDrvExStatus PROC
000b48  e1a01000          MOV      r1,r0
;;;477    {
;;;478        return TRUE;    
000b4c  e3a00001          MOV      r0,#1
;;;479    }
000b50  e12fff1e          BX       lr
;;;480    BOOL FlashDrvExRead(uint8_t pdrv, uint8_t *buff, uint32_t sector, UINT count)
                          ENDP

                  FlashDrvExRead PROC
000b54  e92d41f0          PUSH     {r4-r8,lr}
;;;481    {
000b58  e1a07000          MOV      r7,r0
000b5c  e1a05001          MOV      r5,r1
000b60  e1a04002          MOV      r4,r2
000b64  e1a06003          MOV      r6,r3
;;;482        xSemaphoreTake(xSemaphore, portMAX_DELAY); 
000b68  e3a03000          MOV      r3,#0
000b6c  e3e02000          MVN      r2,#0
000b70  e1a01003          MOV      r1,r3
000b74  e51f0328          LDR      r0,|L1.2132|
000b78  e5900000          LDR      r0,[r0,#0]  ; xSemaphore
000b7c  ebfffffe          BL       xQueueGenericReceive
;;;483        //sysprintf(".");
;;;484        sector = sector + SHIFT_SECTOR_INDEX;
000b80  e2844c03          ADD      r4,r4,#0x300
;;;485        SpiFlash_WaitReady(pdrv);
000b84  e1a00007          MOV      r0,r7
000b88  ebfffffe          BL       SpiFlash_WaitReady
;;;486        SpiFlash_NormalRead(pdrv, sector*SPI_FLASH_EX_SECTOR_SIZE, buff, count*SPI_FLASH_EX_SECTOR_SIZE);
000b8c  e1a03606          LSL      r3,r6,#12
000b90  e1a01604          LSL      r1,r4,#12
000b94  e1a02005          MOV      r2,r5
000b98  e1a00007          MOV      r0,r7
000b9c  ebfffffe          BL       SpiFlash_NormalRead
;;;487        SpiFlash_WaitReady(pdrv);
000ba0  e1a00007          MOV      r0,r7
000ba4  ebfffffe          BL       SpiFlash_WaitReady
;;;488        //sysprintf("\r\n >> SpiFlash_NormalRead <%d> [sector = %d(0x%x), count = %d <<\n", pdrv, sector, sector, count);
;;;489        xSemaphoreGive(xSemaphore);
000ba8  e3a03000          MOV      r3,#0
000bac  e1a02003          MOV      r2,r3
000bb0  e1a01003          MOV      r1,r3
000bb4  e51f0368          LDR      r0,|L1.2132|
000bb8  e5900000          LDR      r0,[r0,#0]  ; xSemaphore
000bbc  ebfffffe          BL       xQueueGenericSend
;;;490        
;;;491        return TRUE;
000bc0  e3a00001          MOV      r0,#1
;;;492    }
000bc4  e8bd81f0          POP      {r4-r8,pc}
;;;493    BOOL FlashDrvExWrite(uint8_t pdrv, uint8_t *buff, uint32_t sector, UINT count)
                          ENDP

                  FlashDrvExWrite PROC
000bc8  e92d43f8          PUSH     {r3-r9,lr}
;;;494    {    
000bcc  e1a06000          MOV      r6,r0
000bd0  e1a07001          MOV      r7,r1
000bd4  e1a05002          MOV      r5,r2
000bd8  e1a04003          MOV      r4,r3
;;;495        BOOL reVal = TRUE;
000bdc  e3a08001          MOV      r8,#1
;;;496        xSemaphoreTake(xSemaphore, portMAX_DELAY); 
000be0  e3a03000          MOV      r3,#0
000be4  e3e02000          MVN      r2,#0
000be8  e1a01003          MOV      r1,r3
000bec  e51f03a0          LDR      r0,|L1.2132|
000bf0  e5900000          LDR      r0,[r0,#0]  ; xSemaphore
000bf4  ebfffffe          BL       xQueueGenericReceive
;;;497        //sysprintf("\r\n >> SpiFlash_NormalPageProgram [pdrv = %d, sector = %d(0x%x), count = %d <<\n", pdrv, sector, sector, count);
;;;498        //sysprintf("^");
;;;499        sector = sector + SHIFT_SECTOR_INDEX;
000bf8  e2855c03          ADD      r5,r5,#0x300
;;;500        SpiFlash_WaitReady(pdrv);
000bfc  e1a00006          MOV      r0,r6
000c00  ebfffffe          BL       SpiFlash_WaitReady
;;;501        SpiFlash_SectorErase(pdrv, sector*SPI_FLASH_EX_SECTOR_SIZE);
000c04  e1a01605          LSL      r1,r5,#12
000c08  e1a00006          MOV      r0,r6
000c0c  ebfffffe          BL       SpiFlash_SectorErase
;;;502        SpiFlash_WaitReady(pdrv);
000c10  e1a00006          MOV      r0,r6
000c14  ebfffffe          BL       SpiFlash_WaitReady
;;;503        SpiFlash_NormalSectorProgram(pdrv, sector*SPI_FLASH_EX_SECTOR_SIZE, buff, SPI_FLASH_EX_SECTOR_SIZE*count);
000c18  e1a03604          LSL      r3,r4,#12
000c1c  e1a01605          LSL      r1,r5,#12
000c20  e1a02007          MOV      r2,r7
000c24  e1a00006          MOV      r0,r6
000c28  ebfffffe          BL       SpiFlash_NormalSectorProgram
;;;504        SpiFlash_WaitReady(pdrv);
000c2c  e1a00006          MOV      r0,r6
000c30  ebfffffe          BL       SpiFlash_WaitReady
;;;505        #if(1)
;;;506        {
;;;507            //uint8_t* serialFlashBuff = pvPortMalloc(count*SPI_FLASH_EX_SECTOR_SIZE);
;;;508            //if(serialFlashBuff!=NULL)
;;;509            if(count*SPI_FLASH_EX_SECTOR_SIZE <= sizeof(serialFlashBuff))
000c34  e3a00a05          MOV      r0,#0x5000
000c38  e1500604          CMP      r0,r4,LSL #12
000c3c  3a00001d          BCC      |L1.3256|
;;;510            {
;;;511                SpiFlash_WaitReady(pdrv);
000c40  e1a00006          MOV      r0,r6
000c44  ebfffffe          BL       SpiFlash_WaitReady
;;;512                SpiFlash_NormalRead(pdrv, sector*SPI_FLASH_EX_SECTOR_SIZE, serialFlashBuff, count*SPI_FLASH_EX_SECTOR_SIZE);
000c48  e1a03604          LSL      r3,r4,#12
000c4c  e1a01605          LSL      r1,r5,#12
000c50  e59f2308          LDR      r2,|L1.3936|
000c54  e1a00006          MOV      r0,r6
000c58  ebfffffe          BL       SpiFlash_NormalRead
;;;513                SpiFlash_WaitReady(pdrv);
000c5c  e1a00006          MOV      r0,r6
000c60  ebfffffe          BL       SpiFlash_WaitReady
;;;514                if(memcmp(buff, serialFlashBuff, count*SPI_FLASH_EX_SECTOR_SIZE) != 0)
000c64  e1a02604          LSL      r2,r4,#12
000c68  e59f12f0          LDR      r1,|L1.3936|
000c6c  e1a00007          MOV      r0,r7
000c70  ebfffffe          BL       memcmp
000c74  e3500000          CMP      r0,#0
000c78  0a00000e          BEQ      |L1.3256|
;;;515                {
;;;516                    //#if(ENABLE_LOG_FUNCTION)
;;;517                    //{
;;;518                    //     char str[512];
;;;519                    //     sprintf(str, " SpiFlash_NormalPageProgram <%d> ERROR (sector = %d(0x%x), size = %d) <<\n", pdrv, sector, sector, count*SPI_FLASH_EX_SECTOR_SIZE );
;;;520                    //     LoglibPrintf(LOG_TYPE_ERROR, str, FALSE);
;;;521                    //}
;;;522                    //#else
;;;523                    sysprintf("\r\n >> SpiFlash_NormalPageProgram <%d> ERROR (sector = %d(0x%x), size = %d) <<\n", pdrv, sector, sector, count*SPI_FLASH_EX_SECTOR_SIZE );
000c7c  e1a00604          LSL      r0,r4,#12
000c80  e1a03005          MOV      r3,r5
000c84  e1a02005          MOV      r2,r5
000c88  e1a01006          MOV      r1,r6
000c8c  e58d0000          STR      r0,[sp,#0]
000c90  e59f02cc          LDR      r0,|L1.3940|
000c94  ebfffffe          BL       sysprintf
;;;524                    //#endif
;;;525                    errorTimes[pdrv-1]++;
000c98  e2460001          SUB      r0,r6,#1
000c9c  e59f12c4          LDR      r1,|L1.3944|
000ca0  e7910100          LDR      r0,[r1,r0,LSL #2]
000ca4  e2800001          ADD      r0,r0,#1
000ca8  e2461001          SUB      r1,r6,#1
000cac  e59f22b4          LDR      r2,|L1.3944|
000cb0  e7820101          STR      r0,[r2,r1,LSL #2]
;;;526                    reVal = FALSE;
000cb4  e3a08000          MOV      r8,#0
                  |L1.3256|
;;;527                }
;;;528                else
;;;529                {
;;;530                    //#warning just for test 
;;;531                    #if(0)
;;;532                    if( ((sector>32) && (sector<96) && (pdrv == 2))  || ((sector>96) && (sector<128) && (pdrv == 1)) )
;;;533                    {
;;;534                        sysprintf("\r\n >> SpiFlash_NormalPageProgram <%d> ERROR FACK (sector = %d(0x%x), size = %d, errorTimes[%d:%d] ) <<\n", 
;;;535                                                                    pdrv, sector, sector, count*SPI_FLASH_EX_SECTOR_SIZE, errorTimes[0], errorTimes[1]);
;;;536                        SpiFlash_WaitReady(pdrv);
;;;537                        SpiFlash_SectorErase(pdrv, sector*SPI_FLASH_EX_SECTOR_SIZE);
;;;538                        SpiFlash_WaitReady(pdrv);
;;;539                        errorTimes[pdrv-1]++;
;;;540                        reVal = FALSE;
;;;541                    }
;;;542                    else
;;;543                    #endif
;;;544                    {
;;;545                        
;;;546                        //sysprintf("\r\n >> SpiFlash_NormalPageProgram <%d> SUCCESS (sector = %d(0x%x), size = %d, errorTimes[%d:%d] ) <<\n", 
;;;547                        //                                            pdrv, sector, sector, count*SPI_FLASH_EX_SECTOR_SIZE, errorTimes[0], errorTimes[1]);
;;;548                    }
;;;549                }
;;;550                //vPortFree(serialFlashBuff);
;;;551            }
;;;552            
;;;553        }
;;;554        #endif
;;;555        xSemaphoreGive(xSemaphore);
000cb8  e3a03000          MOV      r3,#0
000cbc  e1a02003          MOV      r2,r3
000cc0  e1a01003          MOV      r1,r3
000cc4  e51f0478          LDR      r0,|L1.2132|
000cc8  e5900000          LDR      r0,[r0,#0]  ; xSemaphore
000ccc  ebfffffe          BL       xQueueGenericSend
;;;556        return reVal;
000cd0  e1a00008          MOV      r0,r8
;;;557    }
000cd4  e8bd83f8          POP      {r3-r9,pc}
;;;558    BOOL FlashDrvExIoctl(uint8_t pdrv, uint8_t cmd, void *buff )
                          ENDP

                  FlashDrvExIoctl PROC
000cd8  e92d41f0          PUSH     {r4-r8,lr}
;;;559    {
000cdc  e1a06000          MOV      r6,r0
000ce0  e1a05001          MOV      r5,r1
000ce4  e1a04002          MOV      r4,r2
;;;560        BOOL res = TRUE;
000ce8  e3a07001          MOV      r7,#1
;;;561        switch(cmd) 
000cec  e3550000          CMP      r5,#0
000cf0  0a000004          BEQ      |L1.3336|
000cf4  e3550001          CMP      r5,#1
000cf8  0a000006          BEQ      |L1.3352|
000cfc  e3550002          CMP      r5,#2
000d00  1a00000c          BNE      |L1.3384|
000d04  ea000007          B        |L1.3368|
                  |L1.3336|
;;;562        {
;;;563            case CTRL_SYNC:
000d08  e1a00000          MOV      r0,r0
;;;564                SpiFlash_WaitReady(pdrv);
000d0c  e1a00006          MOV      r0,r6
000d10  ebfffffe          BL       SpiFlash_WaitReady
;;;565                break;
000d14  ea00000a          B        |L1.3396|
                  |L1.3352|
;;;566            case GET_SECTOR_COUNT:
000d18  e1a00000          MOV      r0,r0
;;;567                *(DWORD*)buff = SPI_FLASH_EX_FS_TOTAL_SIZE/SPI_FLASH_EX_SECTOR_SIZE;
000d1c  e3a00c05          MOV      r0,#0x500
000d20  e5840000          STR      r0,[r4,#0]
;;;568                break;
000d24  ea000006          B        |L1.3396|
                  |L1.3368|
;;;569            case GET_SECTOR_SIZE:
000d28  e1a00000          MOV      r0,r0
;;;570                *(WORD*)buff = SPI_FLASH_EX_SECTOR_SIZE;
000d2c  e3a00a01          MOV      r0,#0x1000
000d30  e1c400b0          STRH     r0,[r4,#0]
;;;571                break;
000d34  ea000002          B        |L1.3396|
                  |L1.3384|
;;;572            
;;;573            #if(USER_NEW_FATFS)
;;;574            case GET_BLOCK_SIZE:
;;;575                *(WORD*)buff = SPI_FLASH_EX_FS_TOTAL_SIZE/SPI_FLASH_EX_SECTOR_SIZE;
;;;576                //sysprintf(" >> FlashDrvExIoctl GET_BLOCK_SIZE (%d): %d<<\n", pdrv, *(WORD*)buff);
;;;577                break;
;;;578            #endif
;;;579    
;;;580            default:
000d38  e1a00000          MOV      r0,r0
;;;581                //sysprintf(" >> FlashDrvExIoctl cmd: %d  <<\n", cmd);
;;;582                res = FALSE;
000d3c  e3a07000          MOV      r7,#0
;;;583                break;
000d40  e1a00000          MOV      r0,r0
                  |L1.3396|
000d44  e1a00000          MOV      r0,r0                 ;565
;;;584        }
;;;585        //if(res)
;;;586        //    sysprintf(" >> FlashDrvExIoctl cmd: %d (%d)  <<\n", cmd, *(WORD*)buff);
;;;587        //else
;;;588        //    sysprintf(" >> FlashDrvExIoctl cmd: %d false  <<\n", cmd);
;;;589        return res;
000d48  e1a00007          MOV      r0,r7
;;;590    }
000d4c  e8bd81f0          POP      {r4-r8,pc}
;;;591    
                          ENDP

                  FlashDrvExChipErasePure PROC
;;;596    }
;;;597    void FlashDrvExChipErasePure(uint8_t flashIndex, int startSector, int endSector)
000d50  e92d41f0          PUSH     {r4-r8,lr}
;;;598    {
000d54  e1a07000          MOV      r7,r0
000d58  e1a05001          MOV      r5,r1
000d5c  e1a06002          MOV      r6,r2
;;;599        int sector;
;;;600        xSemaphoreTake(xSemaphore, portMAX_DELAY); 
000d60  e3a03000          MOV      r3,#0
000d64  e3e02000          MVN      r2,#0
000d68  e1a01003          MOV      r1,r3
000d6c  e51f0520          LDR      r0,|L1.2132|
000d70  e5900000          LDR      r0,[r0,#0]  ; xSemaphore
000d74  ebfffffe          BL       xQueueGenericReceive
;;;601        sysprintf(" >> FlashDrvExChipErase_Pure %d go(sector:%d~%d) <<\n", flashIndex, startSector, endSector);
000d78  e1a03006          MOV      r3,r6
000d7c  e1a02005          MOV      r2,r5
000d80  e1a01007          MOV      r1,r7
000d84  e28f0e1e          ADR      r0,|L1.3948|
000d88  ebfffffe          BL       sysprintf
;;;602        
;;;603        SpiFlash_WaitReady(flashIndex);
000d8c  e1a00007          MOV      r0,r7
000d90  ebfffffe          BL       SpiFlash_WaitReady
;;;604        //for(sector = startSector; sector <= endSector; sector++)
;;;605        for(sector = startSector; sector < endSector; sector++) //u 2047
000d94  e1a04005          MOV      r4,r5
000d98  ea000008          B        |L1.3520|
                  |L1.3484|
;;;606        {    
;;;607            SpiFlash_SectorErase(flashIndex, sector*SPI_FLASH_EX_SECTOR_SIZE);
000d9c  e1a01604          LSL      r1,r4,#12
000da0  e1a00007          MOV      r0,r7
000da4  ebfffffe          BL       SpiFlash_SectorErase
;;;608            SpiFlash_WaitReady(flashIndex);
000da8  e1a00007          MOV      r0,r7
000dac  ebfffffe          BL       SpiFlash_WaitReady
;;;609            sysprintf(" >> Erase %04d <<\r", sector);
000db0  e1a01004          MOV      r1,r4
000db4  e28f0f7a          ADR      r0,|L1.4004|
000db8  ebfffffe          BL       sysprintf
000dbc  e2844001          ADD      r4,r4,#1              ;605
                  |L1.3520|
000dc0  e1540006          CMP      r4,r6                 ;605
000dc4  bafffff4          BLT      |L1.3484|
;;;610        }
;;;611        sysprintf(" >> FlashDrvExChipErase_Pure %d OK <<\n", flashIndex);
000dc8  e1a01007          MOV      r1,r7
000dcc  e28f0f79          ADR      r0,|L1.4024|
000dd0  ebfffffe          BL       sysprintf
;;;612        xSemaphoreGive(xSemaphore);    
000dd4  e3a03000          MOV      r3,#0
000dd8  e1a02003          MOV      r2,r3
000ddc  e1a01003          MOV      r1,r3
000de0  e51f0594          LDR      r0,|L1.2132|
000de4  e5900000          LDR      r0,[r0,#0]  ; xSemaphore
000de8  ebfffffe          BL       xQueueGenericSend
;;;613    }
000dec  e8bd81f0          POP      {r4-r8,pc}
;;;614    
                          ENDP

                  FlashDrvExChipEraseFs PROC
;;;591    
;;;592    void FlashDrvExChipEraseFs(uint8_t flashIndex)
000df0  e92d4010          PUSH     {r4,lr}
;;;593    {
000df4  e1a04000          MOV      r4,r0
;;;594        FlashDrvExChipErasePure(flashIndex, SPI_FLASH_EX_FS_START_SECTOR, SPI_FLASH_EX_FS_END_SECTOR);    
000df8  e3a02b02          MOV      r2,#0x800
000dfc  e3a01c03          MOV      r1,#0x300
000e00  e1a00004          MOV      r0,r4
000e04  ebfffffe          BL       FlashDrvExChipErasePure
;;;595        sysprintf(" >> FlashDrvExChipErase_FS %d OK <<\n", flashIndex);
000e08  e1a01004          MOV      r1,r4
000e0c  e28f0f73          ADR      r0,|L1.4064|
000e10  ebfffffe          BL       sysprintf
;;;596    }
000e14  e8bd8010          POP      {r4,pc}
;;;597    void FlashDrvExChipErasePure(uint8_t flashIndex, int startSector, int endSector)
                          ENDP

                  FlashDrvExChipEraseFull PROC
;;;614    
;;;615    void FlashDrvExChipEraseFull(uint8_t flashIndex)
000e18  e92d4010          PUSH     {r4,lr}
;;;616    {
000e1c  e1a04000          MOV      r4,r0
;;;617        
;;;618        xSemaphoreTake(xSemaphore, portMAX_DELAY); 
000e20  e3a03000          MOV      r3,#0
000e24  e3e02000          MVN      r2,#0
000e28  e1a01003          MOV      r1,r3
000e2c  e51f05e0          LDR      r0,|L1.2132|
000e30  e5900000          LDR      r0,[r0,#0]  ; xSemaphore
000e34  ebfffffe          BL       xQueueGenericReceive
;;;619        SpiFlash_WaitReady(flashIndex);  
000e38  e1a00004          MOV      r0,r4
000e3c  ebfffffe          BL       SpiFlash_WaitReady
;;;620        sysprintf(" >> FlashDrvExChipErase_Full %d go <<\n", flashIndex);
000e40  e1a01004          MOV      r1,r4
000e44  e28f0f6f          ADR      r0,|L1.4104|
000e48  ebfffffe          BL       sysprintf
;;;621        // /CS: active
;;;622        setFlashCS(flashIndex, TRUE);
000e4c  e3a01001          MOV      r1,#1
000e50  e1a00004          MOV      r0,r4
000e54  ebfffffe          BL       setFlashCS
;;;623    
;;;624        // send Command: 0x06, Write enable
;;;625        pSpiInterface->writeFunc(0, 0x06);
000e58  e51f0a04          LDR      r0,|L1.1116|
000e5c  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000e60  e3a01006          MOV      r1,#6
000e64  e5902004          LDR      r2,[r0,#4]
000e68  e3a00000          MOV      r0,#0
000e6c  e12fff32          BLX      r2
;;;626    
;;;627        // /CS: de-active
;;;628        pSpiInterface->activeCSFunc(FALSE);
000e70  e51f0a1c          LDR      r0,|L1.1116|
000e74  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000e78  e590100c          LDR      r1,[r0,#0xc]
000e7c  e3a00000          MOV      r0,#0
000e80  e12fff31          BLX      r1
;;;629    
;;;630        //////////////////////////////////////////
;;;631    
;;;632        // /CS: active
;;;633        pSpiInterface->activeCSFunc(TRUE);
000e84  e51f0a30          LDR      r0,|L1.1116|
000e88  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000e8c  e590100c          LDR      r1,[r0,#0xc]
000e90  e3a00001          MOV      r0,#1
000e94  e12fff31          BLX      r1
;;;634    
;;;635        // send Command: 0xC7, Chip Erase
;;;636        pSpiInterface->writeFunc(0, 0xC7);
000e98  e51f0a44          LDR      r0,|L1.1116|
000e9c  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000ea0  e3a010c7          MOV      r1,#0xc7
000ea4  e5902004          LDR      r2,[r0,#4]
000ea8  e3a00000          MOV      r0,#0
000eac  e12fff32          BLX      r2
;;;637    
;;;638        // /CS: active
;;;639        setFlashCS(flashIndex, FALSE);
000eb0  e3a01000          MOV      r1,#0
000eb4  e1a00004          MOV      r0,r4
000eb8  ebfffffe          BL       setFlashCS
;;;640    
;;;641        SpiFlash_WaitReady(flashIndex);
000ebc  e1a00004          MOV      r0,r4
000ec0  ebfffffe          BL       SpiFlash_WaitReady
;;;642        sysprintf(" >> FlashDrvExChipErase_Full %d OK <<\n", flashIndex);
000ec4  e1a01004          MOV      r1,r4
000ec8  e28f0e16          ADR      r0,|L1.4144|
000ecc  ebfffffe          BL       sysprintf
;;;643        xSemaphoreGive(xSemaphore);
000ed0  e3a03000          MOV      r3,#0
000ed4  e1a02003          MOV      r2,r3
000ed8  e1a01003          MOV      r1,r3
000edc  e51f0690          LDR      r0,|L1.2132|
000ee0  e5900000          LDR      r0,[r0,#0]  ; xSemaphore
000ee4  ebfffffe          BL       xQueueGenericSend
;;;644       
;;;645    }
000ee8  e8bd8010          POP      {r4,pc}
;;;646    
                          ENDP

                  FlashDrvExGetErrorTimes PROC
;;;647    int FlashDrvExGetErrorTimes(void)
000eec  e59f0074          LDR      r0,|L1.3944|
;;;648    {
;;;649        return errorTimes[0] + errorTimes[1]*10000;
000ef0  e5900000          LDR      r0,[r0,#0]  ; errorTimes
000ef4  e59f106c          LDR      r1,|L1.3944|
000ef8  e5911004          LDR      r1,[r1,#4]  ; errorTimes
000efc  e59f2154          LDR      r2,|L1.4184|
000f00  e0010192          MUL      r1,r2,r1
000f04  e0800201          ADD      r0,r0,r1,LSL #4
;;;650    }
000f08  e12fff1e          BX       lr
;;;651    uint16_t FlashDrvExGetChipID(uint8_t flashIndex)
                          ENDP

                  FlashDrvExGetChipID PROC
000f0c  e92d4070          PUSH     {r4-r6,lr}
;;;652    {
000f10  e1a04000          MOV      r4,r0
;;;653        uint16_t u16ID;
;;;654        xSemaphoreTake(xSemaphore, portMAX_DELAY); 
000f14  e3a03000          MOV      r3,#0
000f18  e3e02000          MVN      r2,#0
000f1c  e1a01003          MOV      r1,r3
000f20  e51f06d4          LDR      r0,|L1.2132|
000f24  e5900000          LDR      r0,[r0,#0]  ; xSemaphore
000f28  ebfffffe          BL       xQueueGenericReceive
;;;655        SpiFlash_WaitReady(flashIndex);  
000f2c  e1a00004          MOV      r0,r4
000f30  ebfffffe          BL       SpiFlash_WaitReady
;;;656        // check flash id
;;;657        u16ID = SpiFlash_ReadMidDid(flashIndex/*SPI_FLASH_EX_0_INDEX*/);
000f34  e1a00004          MOV      r0,r4
000f38  ebfffffe          BL       SpiFlash_ReadMidDid
000f3c  e1a05000          MOV      r5,r0
;;;658        xSemaphoreGive(xSemaphore);
000f40  e3a03000          MOV      r3,#0
000f44  e1a02003          MOV      r2,r3
000f48  e1a01003          MOV      r1,r3
000f4c  e51f0700          LDR      r0,|L1.2132|
000f50  e5900000          LDR      r0,[r0,#0]  ; xSemaphore
000f54  ebfffffe          BL       xQueueGenericSend
;;;659        return u16ID;
000f58  e1a00005          MOV      r0,r5
;;;660    }
000f5c  e8bd8070          POP      {r4-r6,pc}
                  |L1.3936|
                          DCD      serialFlashBuff
                  |L1.3940|
                          DCD      ||.constdata||+0x60
                  |L1.3944|
                          DCD      errorTimes
                  |L1.3948|
000f6c  203e3e20          DCB      " >> FlashDrvExChipErase_Pure %d go(sector:%d~%d) <<\n",0
000f70  466c6173
000f74  68447276
000f78  45784368
000f7c  69704572
000f80  6173655f
000f84  50757265
000f88  20256420
000f8c  676f2873
000f90  6563746f
000f94  723a2564
000f98  7e256429
000f9c  203c3c0a
000fa0  00      
000fa1  00                DCB      0
000fa2  00                DCB      0
000fa3  00                DCB      0
                  |L1.4004|
000fa4  203e3e20          DCB      " >> Erase %04d <<\r",0
000fa8  45726173
000fac  65202530
000fb0  3464203c
000fb4  3c0d00  
000fb7  00                DCB      0
                  |L1.4024|
000fb8  203e3e20          DCB      " >> FlashDrvExChipErase_Pure %d OK <<\n",0
000fbc  466c6173
000fc0  68447276
000fc4  45784368
000fc8  69704572
000fcc  6173655f
000fd0  50757265
000fd4  20256420
000fd8  4f4b203c
000fdc  3c0a00  
000fdf  00                DCB      0
                  |L1.4064|
000fe0  203e3e20          DCB      " >> FlashDrvExChipErase_FS %d OK <<\n",0
000fe4  466c6173
000fe8  68447276
000fec  45784368
000ff0  69704572
000ff4  6173655f
000ff8  46532025
000ffc  64204f4b
001000  203c3c0a
001004  00      
001005  00                DCB      0
001006  00                DCB      0
001007  00                DCB      0
                  |L1.4104|
001008  203e3e20          DCB      " >> FlashDrvExChipErase_Full %d go <<\n",0
00100c  466c6173
001010  68447276
001014  45784368
001018  69704572
00101c  6173655f
001020  46756c6c
001024  20256420
001028  676f203c
00102c  3c0a00  
00102f  00                DCB      0
                  |L1.4144|
001030  203e3e20          DCB      " >> FlashDrvExChipErase_Full %d OK <<\n",0
001034  466c6173
001038  68447276
00103c  45784368
001040  69704572
001044  6173655f
001048  46756c6c
00104c  20256420
001050  4f4b203c
001054  3c0a00  
001057  00                DCB      0
                  |L1.4184|
                          DCD      0x00000271
                          ENDP

                  FlashDrvPageProgram PROC
;;;661    
;;;662    void FlashDrvPageProgram(uint8_t flashIndex, uint32_t StartAddress, uint8_t *u8DataBuffer, int BuffLen)
00105c  e92d41f0          PUSH     {r4-r8,lr}
;;;663    {
001060  e1a04000          MOV      r4,r0
001064  e1a05001          MOV      r5,r1
001068  e1a06002          MOV      r6,r2
00106c  e1a07003          MOV      r7,r3
;;;664        xSemaphoreTake(xSemaphore, portMAX_DELAY);
001070  e3a03000          MOV      r3,#0
001074  e3e02000          MVN      r2,#0
001078  e1a01003          MOV      r1,r3
00107c  e51f0830          LDR      r0,|L1.2132|
001080  e5900000          LDR      r0,[r0,#0]  ; xSemaphore
001084  ebfffffe          BL       xQueueGenericReceive
;;;665        SpiFlash_WaitReady(flashIndex);
001088  e1a00004          MOV      r0,r4
00108c  ebfffffe          BL       SpiFlash_WaitReady
;;;666        SpiFlash_NormalPageProgram(flashIndex, StartAddress, u8DataBuffer, BuffLen);
001090  e1a03007          MOV      r3,r7
001094  e1a02006          MOV      r2,r6
001098  e1a01005          MOV      r1,r5
00109c  e1a00004          MOV      r0,r4
0010a0  ebfffffe          BL       SpiFlash_NormalPageProgram
;;;667        SpiFlash_WaitReady(flashIndex);
0010a4  e1a00004          MOV      r0,r4
0010a8  ebfffffe          BL       SpiFlash_WaitReady
;;;668        xSemaphoreGive(xSemaphore);
0010ac  e3a03000          MOV      r3,#0
0010b0  e1a02003          MOV      r2,r3
0010b4  e1a01003          MOV      r1,r3
0010b8  e51f086c          LDR      r0,|L1.2132|
0010bc  e5900000          LDR      r0,[r0,#0]  ; xSemaphore
0010c0  ebfffffe          BL       xQueueGenericSend
;;;669    }
0010c4  e8bd81f0          POP      {r4-r8,pc}
;;;670    
                          ENDP

                  FlashDrvSectorErase PROC
;;;671    void FlashDrvSectorErase(uint8_t flashIndex, uint32_t StartAddress)
0010c8  e92d4070          PUSH     {r4-r6,lr}
;;;672    {
0010cc  e1a04000          MOV      r4,r0
0010d0  e1a05001          MOV      r5,r1
;;;673        xSemaphoreTake(xSemaphore, portMAX_DELAY);
0010d4  e3a03000          MOV      r3,#0
0010d8  e3e02000          MVN      r2,#0
0010dc  e1a01003          MOV      r1,r3
0010e0  e51f0894          LDR      r0,|L1.2132|
0010e4  e5900000          LDR      r0,[r0,#0]  ; xSemaphore
0010e8  ebfffffe          BL       xQueueGenericReceive
;;;674        SpiFlash_WaitReady(flashIndex);
0010ec  e1a00004          MOV      r0,r4
0010f0  ebfffffe          BL       SpiFlash_WaitReady
;;;675        SpiFlash_SectorErase(flashIndex, StartAddress);
0010f4  e1a01005          MOV      r1,r5
0010f8  e1a00004          MOV      r0,r4
0010fc  ebfffffe          BL       SpiFlash_SectorErase
;;;676        SpiFlash_WaitReady(flashIndex);
001100  e1a00004          MOV      r0,r4
001104  ebfffffe          BL       SpiFlash_WaitReady
;;;677        xSemaphoreGive(xSemaphore);
001108  e3a03000          MOV      r3,#0
00110c  e1a02003          MOV      r2,r3
001110  e1a01003          MOV      r1,r3
001114  e51f08c8          LDR      r0,|L1.2132|
001118  e5900000          LDR      r0,[r0,#0]  ; xSemaphore
00111c  ebfffffe          BL       xQueueGenericSend
;;;678    }
001120  e8bd8070          POP      {r4-r6,pc}
;;;679    
                          ENDP

                  FlashDrvNormalRead PROC
;;;680    void FlashDrvNormalRead(uint8_t flashIndex, uint32_t StartAddress, uint8_t *u8DataBuffer, int BuffLen)
001124  e92d41f0          PUSH     {r4-r8,lr}
;;;681    {
001128  e1a04000          MOV      r4,r0
00112c  e1a05001          MOV      r5,r1
001130  e1a06002          MOV      r6,r2
001134  e1a07003          MOV      r7,r3
;;;682        xSemaphoreTake(xSemaphore, portMAX_DELAY);
001138  e3a03000          MOV      r3,#0
00113c  e3e02000          MVN      r2,#0
001140  e1a01003          MOV      r1,r3
001144  e51f08f8          LDR      r0,|L1.2132|
001148  e5900000          LDR      r0,[r0,#0]  ; xSemaphore
00114c  ebfffffe          BL       xQueueGenericReceive
;;;683        SpiFlash_WaitReady(flashIndex);
001150  e1a00004          MOV      r0,r4
001154  ebfffffe          BL       SpiFlash_WaitReady
;;;684        SpiFlash_NormalRead(flashIndex, StartAddress, u8DataBuffer, BuffLen);
001158  e1a03007          MOV      r3,r7
00115c  e1a02006          MOV      r2,r6
001160  e1a01005          MOV      r1,r5
001164  e1a00004          MOV      r0,r4
001168  ebfffffe          BL       SpiFlash_NormalRead
;;;685        SpiFlash_WaitReady(flashIndex);
00116c  e1a00004          MOV      r0,r4
001170  ebfffffe          BL       SpiFlash_WaitReady
;;;686        xSemaphoreGive(xSemaphore);
001174  e3a03000          MOV      r3,#0
001178  e1a02003          MOV      r2,r3
00117c  e1a01003          MOV      r1,r3
001180  e51f0934          LDR      r0,|L1.2132|
001184  e5900000          LDR      r0,[r0,#0]  ; xSemaphore
001188  ebfffffe          BL       xQueueGenericSend
;;;687    }
00118c  e8bd81f0          POP      {r4-r8,pc}
;;;688    /*** * Copyright (C) 2016 Far Easy Pass LTD. All rights reserved. ***/
                          ENDP


                          AREA ||.bss||, DATA, NOINIT, ALIGN=2

                  _FatfsVolSFlash
                          %        4152
                  serialFlashBuff
                          %        20480

                          AREA ||.constdata||, DATA, READONLY, ALIGN=2

000000  466c6173          DCB      0x46,0x6c,0x61,0x73
000004  68447276          DCB      0x68,0x44,0x72,0x76
000008  4578496e          DCB      0x45,0x78,0x49,0x6e
00000c  69742121          DCB      0x69,0x74,0x21,0x21
000010  2846533a          DCB      0x28,0x46,0x53,0x3a
000014  30782530          DCB      0x30,0x78,0x25,0x30
000018  38782028          DCB      0x38,0x78,0x20,0x28
00001c  70616765          DCB      0x70,0x61,0x67,0x65
000020  3a25647e          DCB      0x3a,0x25,0x64,0x7e
000024  25642c20          DCB      0x25,0x64,0x2c,0x20
000028  73656374          DCB      0x73,0x65,0x63,0x74
00002c  6f723a25          DCB      0x6f,0x72,0x3a,0x25
000030  647e2564          DCB      0x64,0x7e,0x25,0x64
000034  292c2052          DCB      0x29,0x2c,0x20,0x52
000038  41573a30          DCB      0x41,0x57,0x3a,0x30
00003c  78253038          DCB      0x78,0x25,0x30,0x38
000040  78202870          DCB      0x78,0x20,0x28,0x70
000044  6167653a          DCB      0x61,0x67,0x65,0x3a
000048  25647e25          DCB      0x25,0x64,0x7e,0x25
00004c  642c2073          DCB      0x64,0x2c,0x20,0x73
000050  6563746f          DCB      0x65,0x63,0x74,0x6f
000054  723a2564          DCB      0x72,0x3a,0x25,0x64
000058  7e256429          DCB      0x7e,0x25,0x64,0x29
00005c  290a0000          DCB      0x29,0x0a,0x00,0x00
000060  0d0a203e          DCB      0x0d,0x0a,0x20,0x3e
000064  3e205370          DCB      0x3e,0x20,0x53,0x70
000068  69466c61          DCB      0x69,0x46,0x6c,0x61
00006c  73685f4e          DCB      0x73,0x68,0x5f,0x4e
000070  6f726d61          DCB      0x6f,0x72,0x6d,0x61
000074  6c506167          DCB      0x6c,0x50,0x61,0x67
000078  6550726f          DCB      0x65,0x50,0x72,0x6f
00007c  6772616d          DCB      0x67,0x72,0x61,0x6d
000080  203c2564          DCB      0x20,0x3c,0x25,0x64
000084  3e204552          DCB      0x3e,0x20,0x45,0x52
000088  524f5220          DCB      0x52,0x4f,0x52,0x20
00008c  28736563          DCB      0x28,0x73,0x65,0x63
000090  746f7220          DCB      0x74,0x6f,0x72,0x20
000094  3d202564          DCB      0x3d,0x20,0x25,0x64
000098  28307825          DCB      0x28,0x30,0x78,0x25
00009c  78292c20          DCB      0x78,0x29,0x2c,0x20
0000a0  73697a65          DCB      0x73,0x69,0x7a,0x65
0000a4  203d2025          DCB      0x20,0x3d,0x20,0x25
0000a8  6429203c          DCB      0x64,0x29,0x20,0x3c
0000ac  3c0a00            DCB      0x3c,0x0a,0x00

                          AREA ||.data||, DATA, ALIGN=2

                  initFlag
000000  00000000          DCB      0x00,0x00,0x00,0x00
                  pSpiInterface
                          DCD      0x00000000
                  xSemaphore
                          DCD      0x00000000
                  existFlag
00000c  00000000          DCB      0x00,0x00,0x00,0x00
                  errorTimes
                          %        8
