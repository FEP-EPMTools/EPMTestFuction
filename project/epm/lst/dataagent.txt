; generated by ARM C/C++ Compiler, 5.03 [Build 76]
; commandline ArmCC [--c99 --list --debug -c --asm --interleave -o.\obj\dataagent.o --asm_dir=.\lst\ --list_dir=.\lst\ --depend=.\obj\dataagent.d --cpu=ARM926EJ-S --apcs=interwork -O0 -I.\src -I..\..\common\src\BSP\Driver\Include -I..\..\common\src\FreeRTOS -I..\..\common\src\FreeRTOS\Source\include -I..\..\common\src\FreeRTOS\Source\portable\RVDS\ARM926EJ-S -I..\..\common\src\BSP\ThirdParty\FATFS\src -I.\src\userdrv -I.\src\syshal -I.\src\user -I.\src\userdrv\vl53l0x\core\inc -I.\src\userdrv\vl53l0x\platform\inc -I.\src\syshal\json -I.\src\syshal\modemlib -I..\..\common\src\BSP\ThirdParty\yaffs2 -I..\..\common\src\BSP\ThirdParty\yaffs2\include -I..\..\common\src\BSP\ThirdParty\yaffs2\include\asm -I..\..\common\src\BSP\ThirdParty\yaffs2\include\linux -I.\src\syshal\yaffs2 -IC:\Keil\ARM\RV31\INC -IC:\Keil\ARM\CMSIS\Include -IC:\Keil\ARM\Inc\Toshiba -DCONFIG_YAFFS_DIRECT -DCONFIG_YAFFS_SHORT_NAMES_IN_RAM -DCONFIG_YAFFS_YAFFS2 -DNO_Y_INLINE -DCONFIG_YAFFS_PROVIDE_DEFS -DCONFIG_YAFFSFS_PROVIDE_VALUES --omf_browse=.\obj\dataagent.crf src\SysHal\dataagent.c]
                          ARM

                          AREA ||.text||, CODE, READONLY, ALIGN=2

                  DataAgentPreOffCallback PROC
;;;67     
;;;68     static BOOL DataAgentPreOffCallback(int flag)
000000  e1a01000          MOV      r1,r0
;;;69     {
;;;70         BOOL reVal = TRUE;
000004  e3a00001          MOV      r0,#1
;;;71         //sysprintf("### DataAgent OFF Callback [%s] ###\r\n", dataAgentPowerCallabck.drvName);    
;;;72         return reVal;    
;;;73     }
000008  e12fff1e          BX       lr
;;;74     static BOOL DataAgentOffCallback(int flag)
                          ENDP

                  DataAgentOffCallback PROC
00000c  e92d4070          PUSH     {r4-r6,lr}
;;;75     {
000010  e1a05000          MOV      r5,r0
;;;76         //int timers = 2000;
;;;77         BOOL reVal = TRUE;
000014  e3a04001          MOV      r4,#1
;;;78         //sysprintf("### DataAgent OFF Callback [%s] ###\r\n", dataAgentPowerCallabck.drvName); 
;;;79         while(!dataAgentPowerStatus)
000018  ea000001          B        |L1.36|
                  |L1.28|
;;;80         {
;;;81             //sysprintf("\r\n CardOffCallback waiting...\r\n", dataAgentPowerCallabck.drvName);
;;;82             //sysprintf("!");
;;;83             //if(timers-- == 0)
;;;84             //{
;;;85             //    return FALSE;
;;;86             //}
;;;87             vTaskDelay(1);
00001c  e3a00001          MOV      r0,#1
000020  ebfffffe          BL       vTaskDelay
                  |L1.36|
000024  e59f0584          LDR      r0,|L1.1456|
000028  e5d00000          LDRB     r0,[r0,#0]            ;79  ; dataAgentPowerStatus
00002c  e3500000          CMP      r0,#0                 ;79
000030  0afffff9          BEQ      |L1.28|
;;;88         }
;;;89         return reVal;    
000034  e1a00004          MOV      r0,r4
;;;90     }
000038  e8bd8070          POP      {r4-r6,pc}
;;;91     static BOOL DataAgentOnCallback(int flag)
                          ENDP

                  DataAgentOnCallback PROC
00003c  e92d4070          PUSH     {r4-r6,lr}
;;;92     {
000040  e1a05000          MOV      r5,r0
;;;93         BOOL reVal = TRUE;
000044  e3a04001          MOV      r4,#1
;;;94         dataAgentPowerStatus = FALSE;
000048  e3a00000          MOV      r0,#0
00004c  e59f155c          LDR      r1,|L1.1456|
000050  e5c10000          STRB     r0,[r1,#0]  ; dataAgentPowerStatus
;;;95         xSemaphoreGive(xDataAgentTxSemaphore);
000054  e3a03000          MOV      r3,#0
000058  e1a02003          MOV      r2,r3
00005c  e1a01003          MOV      r1,r3
000060  e59f054c          LDR      r0,|L1.1460|
000064  e5900000          LDR      r0,[r0,#0]  ; xDataAgentTxSemaphore
000068  ebfffffe          BL       xQueueGenericSend
;;;96         #warning check this
;;;97         xSemaphoreGive(xDataAgentRoutineSemaphore);
00006c  e3a03000          MOV      r3,#0
000070  e1a02003          MOV      r2,r3
000074  e1a01003          MOV      r1,r3
000078  e59f0538          LDR      r0,|L1.1464|
00007c  e5900000          LDR      r0,[r0,#0]  ; xDataAgentRoutineSemaphore
000080  ebfffffe          BL       xQueueGenericSend
;;;98         //sysprintf("### DataAgent ON Callback [%s] ###\r\n", dataAgentPowerCallabck.drvName);    
;;;99         return reVal;    
000084  e1a00004          MOV      r0,r4
;;;100    }
000088  e8bd8070          POP      {r4-r6,pc}
;;;101    static BOOL DataAgentCheckStatus(int flag)
                          ENDP

                  DataAgentCheckStatus PROC
00008c  e1a01000          MOV      r1,r0
;;;102    {
;;;103        //BOOL reVal = TRUE;
;;;104        //sysprintf("### DataAgent STATUS Callback [%s] ###\r\n", dataAgentPowerCallabck.drvName); 
;;;105        return dataAgentPowerStatus;    
000090  e59f0518          LDR      r0,|L1.1456|
000094  e5d00000          LDRB     r0,[r0,#0]  ; dataAgentPowerStatus
;;;106    }
000098  e12fff1e          BX       lr
;;;107    
                          ENDP

                  getData PROC
;;;109    
;;;110    static uint8_t getData(uint8_t* pbuff, uint16_t buffLen)
00009c  e92d43f8          PUSH     {r3-r9,lr}
;;;111    {
0000a0  e1a09000          MOV      r9,r0
0000a4  e1a07001          MOV      r7,r1
;;;112        uint8_t reVal = 0;
0000a8  e3a08000          MOV      r8,#0
;;;113        int i;
;;;114        xSemaphoreTake(xRxTxSemaphore, portMAX_DELAY);
0000ac  e3a03000          MOV      r3,#0
0000b0  e3e02000          MVN      r2,#0
0000b4  e1a01003          MOV      r1,r3
0000b8  e59f04fc          LDR      r0,|L1.1468|
0000bc  e5900000          LDR      r0,[r0,#0]  ; xRxTxSemaphore
0000c0  ebfffffe          BL       xQueueGenericReceive
;;;115        for(i = 0; i<MAX_AGENT_BUFF_NUMBER; i++)
0000c4  e3a04000          MOV      r4,#0
0000c8  ea000082          B        |L1.728|
                  |L1.204|
;;;116        {
;;;117            if(dataAgentTxBuff[i].useFlag == TRUE)
0000cc  e59f04ec          LDR      r0,|L1.1472|
0000d0  e0000094          MUL      r0,r4,r0
0000d4  e59f14e8          LDR      r1,|L1.1476|
0000d8  e0810100          ADD      r0,r1,r0,LSL #2
0000dc  e5d00001          LDRB     r0,[r0,#1]
0000e0  e3500001          CMP      r0,#1
0000e4  1a00007a          BNE      |L1.724|
;;;118            {
;;;119                CmdHeader* pCmdHeader = (CmdHeader*)dataAgentTxBuff[i].data;
0000e8  e59f04d0          LDR      r0,|L1.1472|
0000ec  e0000094          MUL      r0,r4,r0
0000f0  e0810100          ADD      r0,r1,r0,LSL #2
0000f4  e2805008          ADD      r5,r0,#8
;;;120                if((xTaskGetTickCount() - dataAgentTxBuff[i].sendTimeTick) > DATA_AGENT_TX_INTERVAL)
0000f8  ebfffffe          BL       xTaskGetTickCount
0000fc  e59f14bc          LDR      r1,|L1.1472|
000100  e0010194          MUL      r1,r4,r1
000104  e59f24b8          LDR      r2,|L1.1476|
000108  e0821101          ADD      r1,r2,r1,LSL #2
00010c  e5911508          LDR      r1,[r1,#0x508]
000110  e0400001          SUB      r0,r0,r1
000114  e59f14ac          LDR      r1,|L1.1480|
000118  e1500001          CMP      r0,r1
00011c  9a00005e          BLS      |L1.668|
;;;121                {                
;;;122                    uint16_t sendLen = 0;
000120  e1a00000          MOV      r0,r0
;;;123                    dataAgentTxBuff[i].useFlag = TRUE;            
000124  e3a00001          MOV      r0,#1
000128  e59f1490          LDR      r1,|L1.1472|
00012c  e0010194          MUL      r1,r4,r1
000130  e0821101          ADD      r1,r2,r1,LSL #2
000134  e5c10001          STRB     r0,[r1,#1]
;;;124                    if(buffLen<dataAgentTxBuff[i].dataLen)
000138  e59f0480          LDR      r0,|L1.1472|
00013c  e0000094          MUL      r0,r4,r0
000140  e2821000          ADD      r1,r2,#0
000144  e0810100          ADD      r0,r1,r0,LSL #2
000148  e1d000b2          LDRH     r0,[r0,#2]
00014c  e1500007          CMP      r0,r7
000150  da000009          BLE      |L1.380|
;;;125                    {
;;;126                        memcpy(pbuff, dataAgentTxBuff[i].data, buffLen);
000154  e59f0464          LDR      r0,|L1.1472|
000158  e0000094          MUL      r0,r4,r0
00015c  e2812000          ADD      r2,r1,#0
000160  e0820100          ADD      r0,r2,r0,LSL #2
000164  e2801008          ADD      r1,r0,#8
000168  e1a02007          MOV      r2,r7
00016c  e1a00009          MOV      r0,r9
000170  ebfffffe          BL       __aeabi_memcpy
;;;127                        sendLen = buffLen;
000174  e1a06007          MOV      r6,r7
000178  ea00000f          B        |L1.444|
                  |L1.380|
;;;128                    }
;;;129                    else
;;;130                    {
;;;131                        memcpy(pbuff, dataAgentTxBuff[i].data, dataAgentTxBuff[i].dataLen);
00017c  e59f043c          LDR      r0,|L1.1472|
000180  e0000094          MUL      r0,r4,r0
000184  e59f3438          LDR      r3,|L1.1476|
000188  e0830100          ADD      r0,r3,r0,LSL #2
00018c  e1d020b2          LDRH     r2,[r0,#2]
000190  e59f0428          LDR      r0,|L1.1472|
000194  e0000094          MUL      r0,r4,r0
000198  e0830100          ADD      r0,r3,r0,LSL #2
00019c  e2801008          ADD      r1,r0,#8
0001a0  e1a00009          MOV      r0,r9
0001a4  ebfffffe          BL       __aeabi_memcpy
;;;132                        sendLen = dataAgentTxBuff[i].dataLen;
0001a8  e59f0410          LDR      r0,|L1.1472|
0001ac  e0000094          MUL      r0,r4,r0
0001b0  e59f140c          LDR      r1,|L1.1476|
0001b4  e0810100          ADD      r0,r1,r0,LSL #2
0001b8  e1d060b2          LDRH     r6,[r0,#2]
                  |L1.444|
;;;133                    }
;;;134                    
;;;135                    if(dataAgentTxBuff[i].needAckFlag == FALSE)
0001bc  e59f03fc          LDR      r0,|L1.1472|
0001c0  e0000094          MUL      r0,r4,r0
0001c4  e59f13f8          LDR      r1,|L1.1476|
0001c8  e7d10100          LDRB     r0,[r1,r0,LSL #2]
0001cc  e3500000          CMP      r0,#0
0001d0  1a000018          BNE      |L1.568|
;;;136                    {
;;;137                        dataAgentTxBuff[i].useFlag = FALSE;
0001d4  e3a00000          MOV      r0,#0
0001d8  e59f13e0          LDR      r1,|L1.1472|
0001dc  e0010194          MUL      r1,r4,r1
0001e0  e59f23dc          LDR      r2,|L1.1476|
0001e4  e0821101          ADD      r1,r2,r1,LSL #2
0001e8  e5c10001          STRB     r0,[r1,#1]
;;;138                        memset(dataAgentTxBuff[i].data, 0x0, MAX_AGENT_DATA_SIZE);
0001ec  e59f13cc          LDR      r1,|L1.1472|
0001f0  e0010194          MUL      r1,r4,r1
0001f4  e0821101          ADD      r1,r2,r1,LSL #2
0001f8  e2810008          ADD      r0,r1,#8
0001fc  e3a01c05          MOV      r1,#0x500
000200  ebfffffe          BL       __aeabi_memclr4
;;;139                        //#if(BUILD_DEBUG_VERSION)
;;;140                        if(dataAgentDebugEnable)
000204  e59f03c0          LDR      r0,|L1.1484|
000208  e5d00000          LDRB     r0,[r0,#0]  ; dataAgentDebugEnable
00020c  e3500000          CMP      r0,#0
000210  0a000014          BEQ      |L1.616|
;;;141                            sysprintf(" ==> getData[%d]: OK [cmd id : 0x%02x, cmd index : %d, len = %d ], remove from queue...\r\n", i, pCmdHeader->cmdId, pCmdHeader->cmdIndex, sendLen); 
000214  e58d6000          STR      r6,[sp,#0]
000218  e5d50009          LDRB     r0,[r5,#9]
00021c  e5d51008          LDRB     r1,[r5,#8]
000220  e1813400          ORR      r3,r1,r0,LSL #8
000224  e5d5200a          LDRB     r2,[r5,#0xa]
000228  e1a01004          MOV      r1,r4
00022c  e59f039c          LDR      r0,|L1.1488|
000230  ebfffffe          BL       sysprintf
000234  ea00000b          B        |L1.616|
                  |L1.568|
;;;142                        //#endif
;;;143                    }
;;;144                    else
;;;145                    {
;;;146                        //#if(BUILD_DEBUG_VERSION)
;;;147                        if(dataAgentDebugEnable)
000238  e59f038c          LDR      r0,|L1.1484|
00023c  e5d00000          LDRB     r0,[r0,#0]  ; dataAgentDebugEnable
000240  e3500000          CMP      r0,#0
000244  0a000007          BEQ      |L1.616|
;;;148                            sysprintf(" ==> getData[%d]: OK [cmd id : 0x%02x, cmd index : %d, len = %d ], need ACK...\r\n", i, pCmdHeader->cmdId, pCmdHeader->cmdIndex, sendLen); 
000248  e58d6000          STR      r6,[sp,#0]
00024c  e5d50009          LDRB     r0,[r5,#9]
000250  e5d51008          LDRB     r1,[r5,#8]
000254  e1813400          ORR      r3,r1,r0,LSL #8
000258  e5d5200a          LDRB     r2,[r5,#0xa]
00025c  e1a01004          MOV      r1,r4
000260  e59f036c          LDR      r0,|L1.1492|
000264  ebfffffe          BL       sysprintf
                  |L1.616|
;;;149                        //#endif
;;;150                    }
;;;151                    dataAgentTxBuff[i].sendTimeTick = xTaskGetTickCount();
000268  ebfffffe          BL       xTaskGetTickCount
00026c  e59f134c          LDR      r1,|L1.1472|
000270  e0010194          MUL      r1,r4,r1
000274  e59f2348          LDR      r2,|L1.1476|
000278  e0821101          ADD      r1,r2,r1,LSL #2
00027c  e5810508          STR      r0,[r1,#0x508]
;;;152                    pCommunicationInterface->writeFunc(pbuff, sendLen); 
000280  e59f0350          LDR      r0,|L1.1496|
000284  e5900000          LDR      r0,[r0,#0]  ; pCommunicationInterface
000288  e1a01006          MOV      r1,r6
00028c  e5902004          LDR      r2,[r0,#4]
000290  e1a00009          MOV      r0,r9
000294  e12fff32          BLX      r2
;;;153                    
;;;154                    //if(dataAgentDebugEnable)
;;;155                    //    vTaskDelay(1500);
;;;156                    //return reVal;
;;;157                }
000298  ea00000a          B        |L1.712|
                  |L1.668|
;;;158                else
;;;159                {
;;;160                    if(dataAgentDebugEnable)
00029c  e59f0328          LDR      r0,|L1.1484|
0002a0  e5d00000          LDRB     r0,[r0,#0]  ; dataAgentDebugEnable
0002a4  e3500000          CMP      r0,#0
0002a8  0a000006          BEQ      |L1.712|
;;;161                        sysprintf(" ==> getData[%d]: WARNING ignore [cmd id : 0x%02x, cmd index : %d]\r\n", i, pCmdHeader->cmdId, pCmdHeader->cmdIndex); 
0002ac  e5d50009          LDRB     r0,[r5,#9]
0002b0  e5d51008          LDRB     r1,[r5,#8]
0002b4  e1813400          ORR      r3,r1,r0,LSL #8
0002b8  e5d5200a          LDRB     r2,[r5,#0xa]
0002bc  e1a01004          MOV      r1,r4
0002c0  e59f0314          LDR      r0,|L1.1500|
0002c4  ebfffffe          BL       sysprintf
                  |L1.712|
;;;162                }
;;;163                reVal++;
0002c8  e2880001          ADD      r0,r8,#1
0002cc  e20080ff          AND      r8,r0,#0xff
;;;164            }
0002d0  e1a00000          MOV      r0,r0
                  |L1.724|
0002d4  e2844001          ADD      r4,r4,#1              ;115
                  |L1.728|
0002d8  e354000a          CMP      r4,#0xa               ;115
0002dc  baffff7a          BLT      |L1.204|
;;;165        }    
;;;166        //sysprintf("getData end: sendLen = %d...\r\n", reVal); 
;;;167        xSemaphoreGive(xRxTxSemaphore);    
0002e0  e3a03000          MOV      r3,#0
0002e4  e1a02003          MOV      r2,r3
0002e8  e1a01003          MOV      r1,r3
0002ec  e59f02c8          LDR      r0,|L1.1468|
0002f0  e5900000          LDR      r0,[r0,#0]  ; xRxTxSemaphore
0002f4  ebfffffe          BL       xQueueGenericSend
;;;168        return reVal;
0002f8  e1a00008          MOV      r0,r8
;;;169    }
0002fc  e8bd83f8          POP      {r3-r9,pc}
;;;170    
                          ENDP

                  vDataAgentRxTask PROC
;;;171    static void vDataAgentRxTask( void *pvParameters )
000300  e3a00e7d          MOV      r0,#0x7d0
;;;172    {
;;;173        vTaskDelay(2000); 
000304  ebfffffe          BL       vTaskDelay
;;;174        int totalRead = 0;;
000308  e3a05000          MOV      r5,#0
;;;175        sysprintf("vDataAgentRxTask Going...\r\n");        
00030c  e28f0fb3          ADR      r0,|L1.1504|
000310  ebfffffe          BL       sysprintf
;;;176        for(;;)
000314  e1a00000          MOV      r0,r0
                  |L1.792|
;;;177        {
;;;178            BaseType_t reval = pCommunicationInterface->readWaitFunc(portMAX_DELAY);//xSemaphoreTake(xDataAgentRxSemaphore, portMAX_DELAY);
000318  e59f02b8          LDR      r0,|L1.1496|
00031c  e5900000          LDR      r0,[r0,#0]  ; pCommunicationInterface
000320  e590100c          LDR      r1,[r0,#0xc]
000324  e3e00000          MVN      r0,#0
000328  e12fff31          BLX      r1
00032c  e1a06000          MOV      r6,r0
;;;179            vTaskDelay(10); 
000330  e3a0000a          MOV      r0,#0xa
000334  ebfffffe          BL       vTaskDelay
;;;180            //sysprintf("Lora Read Going...\r\n");
;;;181            while(1)
000338  ea000010          B        |L1.896|
                  |L1.828|
;;;182            {
;;;183                int retval = pCommunicationInterface->readFunc(RXBuff, sizeof(RXBuff));
00033c  e59f0294          LDR      r0,|L1.1496|
000340  e5900000          LDR      r0,[r0,#0]  ; pCommunicationInterface
000344  e3a01b01          MOV      r1,#0x400
000348  e5902008          LDR      r2,[r0,#8]
00034c  e59f02a8          LDR      r0,|L1.1532|
000350  e12fff32          BLX      r2
000354  e1a04000          MOV      r4,r0
;;;184                if( retval > 0)
000358  e3540000          CMP      r4,#0
00035c  da000005          BLE      |L1.888|
;;;185                {
;;;186                    totalRead = totalRead + retval;
000360  e0855004          ADD      r5,r5,r4
;;;187                    
;;;188                    //sysprintf("vDataAgentRxTask %d Data(Total:%d) ...\r\n", retval, totalRead);
;;;189                    #if(0)
;;;190                    {
;;;191                        int i;
;;;192                        char cChar;
;;;193                        for(i = 0; i< retval; i++)
;;;194                        {
;;;195                            cChar = RX_Test[i] & 0xFF;
;;;196                            //sysprintf("Lora Read [%02d]: 0x%02x (%c)...\r\n", i, cChar, cChar); 
;;;197                            sysprintf("[%02d]: 0x%02x (%c)\r\n", i, cChar, cChar);
;;;198                        }
;;;199                    }
;;;200                    #endif
;;;201                    CmdProcessReadData(RXBuff, retval);
000364  e1a01804          LSL      r1,r4,#16
000368  e1a01821          LSR      r1,r1,#16
00036c  e59f0288          LDR      r0,|L1.1532|
000370  ebfffffe          BL       CmdProcessReadData
000374  ea000000          B        |L1.892|
                  |L1.888|
;;;202                    
;;;203                }
;;;204                else
;;;205                {
;;;206                    //sysprintf("!!vDataAgentRxTask Break(Total:%d) ...\r\n", totalRead);
;;;207                    break;
000378  ea000001          B        |L1.900|
                  |L1.892|
;;;208                }
;;;209            }
00037c  e1a00000          MOV      r0,r0
                  |L1.896|
000380  eaffffed          B        |L1.828|
                  |L1.900|
000384  e1a00000          MOV      r0,r0                 ;207
;;;210        }
000388  eaffffe2          B        |L1.792|
;;;211    }
;;;212    static void vDataAgentTxTask( void *pvParameters )
                          ENDP

                  vDataAgentTxTask PROC
00038c  e24ddc05          SUB      sp,sp,#0x500
;;;213    {
;;;214        vTaskDelay(1000); 
000390  e3a00ffa          MOV      r0,#0x3e8
000394  ebfffffe          BL       vTaskDelay
;;;215        uint8_t buff[MAX_AGENT_DATA_SIZE];
;;;216    //    int totalRead = 0;;
;;;217        sysprintf("vDataAgentTxTask Going...\r\n");       
000398  e28f0e26          ADR      r0,|L1.1536|
00039c  ebfffffe          BL       sysprintf
;;;218        threadTxWaitTime = 0; //需要先執行一次     
0003a0  e3a00000          MOV      r0,#0
0003a4  e59f1270          LDR      r1,|L1.1564|
0003a8  e5810000          STR      r0,[r1,#0]  ; threadTxWaitTime
;;;219        for(;;)
0003ac  e1a00000          MOV      r0,r0
                  |L1.944|
;;;220        {
;;;221            #if(BUILD_DEBUG_VERSION)
;;;222            sysprintf("vDataAgentTxTask Waiting (%d)...\r\n", threadTxWaitTime); 
;;;223            #endif
;;;224            BaseType_t reval = xSemaphoreTake(xDataAgentTxSemaphore, threadTxWaitTime/*portMAX_DELAY*/);
0003b0  e3a03000          MOV      r3,#0
0003b4  e59f0260          LDR      r0,|L1.1564|
0003b8  e1a01003          MOV      r1,r3
0003bc  e5902000          LDR      r2,[r0,#0]  ; threadTxWaitTime
0003c0  e59f01ec          LDR      r0,|L1.1460|
0003c4  e5900000          LDR      r0,[r0,#0]  ; xDataAgentTxSemaphore
0003c8  ebfffffe          BL       xQueueGenericReceive
0003cc  e1a05000          MOV      r5,r0
;;;225            //sysprintf("vDataAgentTxTask Going...\r\n"); 
;;;226            #warning just test
;;;227            dataAgentPowerStatus = FALSE;
0003d0  e3a00000          MOV      r0,#0
0003d4  e59f11d4          LDR      r1,|L1.1456|
0003d8  e5c10000          STRB     r0,[r1,#0]  ; dataAgentPowerStatus
;;;228            
;;;229            uint8_t reVal = getData(buff, MAX_AGENT_DATA_SIZE);
0003dc  e3a01c05          MOV      r1,#0x500
0003e0  e1a0000d          MOV      r0,sp
0003e4  ebfffffe          BL       getData
0003e8  e1a04000          MOV      r4,r0
;;;230            if(reVal == 0)
0003ec  e3540000          CMP      r4,#0
0003f0  1a000006          BNE      |L1.1040|
;;;231            {
;;;232                //sysprintf("vDataAgentTxTask break...\r\n"); 
;;;233                threadTxWaitTime = portMAX_DELAY;
0003f4  e3e00000          MVN      r0,#0
0003f8  e59f121c          LDR      r1,|L1.1564|
0003fc  e5810000          STR      r0,[r1,#0]  ; threadTxWaitTime
;;;234                dataAgentPowerStatus = TRUE;
000400  e3a00001          MOV      r0,#1
000404  e59f11a4          LDR      r1,|L1.1456|
000408  e5c10000          STRB     r0,[r1,#0]  ; dataAgentPowerStatus
00040c  ea000002          B        |L1.1052|
                  |L1.1040|
;;;235            }
;;;236            else
;;;237            {
;;;238                //sysprintf("vDataAgentTxTask sending (len = %d)...\r\n", reVal); 
;;;239                //if(dataAgentDebugEnable)
;;;240                //{
;;;241                //    threadTxWaitTime = 5000;
;;;242                //}
;;;243                //else
;;;244                {
;;;245                    threadTxWaitTime = DATA_AGENT_TX_INTERVAL;
000410  e59f01b0          LDR      r0,|L1.1480|
000414  e59f1200          LDR      r1,|L1.1564|
000418  e5810000          STR      r0,[r1,#0]  ; threadTxWaitTime
                  |L1.1052|
;;;246                }
;;;247                //#warning just test
;;;248                //dataAgentPowerStatus = TRUE;
;;;249            }  
;;;250            if(reval == pdTRUE)
;;;251            {
;;;252                
;;;253            }
;;;254            else
;;;255            {//timeout
;;;256                
;;;257            }        
;;;258        }
00041c  eaffffe3          B        |L1.944|
;;;259    }
;;;260    
                          ENDP

                  vDataAgentRoutineTask PROC
;;;261    static void vDataAgentRoutineTask( void *pvParameters )
000420  e59f01a0          LDR      r0,|L1.1480|
;;;262    {
;;;263        vTaskDelay(3000);     
000424  ebfffffe          BL       vTaskDelay
;;;264        sysprintf("vDataAgentRoutineTask Going...\r\n");  
000428  e28f0e1f          ADR      r0,|L1.1568|
00042c  ebfffffe          BL       sysprintf
;;;265    
;;;266        xSemaphoreGive(xDataAgentRoutineSemaphore);
000430  e3a03000          MOV      r3,#0
000434  e1a02003          MOV      r2,r3
000438  e1a01003          MOV      r1,r3
00043c  e59f0174          LDR      r0,|L1.1464|
000440  e5900000          LDR      r0,[r0,#0]  ; xDataAgentRoutineSemaphore
000444  ebfffffe          BL       xQueueGenericSend
;;;267        for(;;)
000448  e1a00000          MOV      r0,r0
                  |L1.1100|
;;;268        {
;;;269            BaseType_t reval = xSemaphoreTake(xDataAgentRoutineSemaphore, threadRoutineWaitTime/*portMAX_DELAY*/);  
00044c  e3a03000          MOV      r3,#0
000450  e59f01ec          LDR      r0,|L1.1604|
000454  e1a01003          MOV      r1,r3
000458  e5902000          LDR      r2,[r0,#0]  ; threadRoutineWaitTime
00045c  e59f0154          LDR      r0,|L1.1464|
000460  e5900000          LDR      r0,[r0,#0]  ; xDataAgentRoutineSemaphore
000464  ebfffffe          BL       xQueueGenericReceive
000468  e1a05000          MOV      r5,r0
;;;270            #warning check this
;;;271            CmdSendVersion(PowerGetTotalWakeupTick());  
00046c  ebfffffe          BL       PowerGetTotalWakeupTick
000470  e1a04000          MOV      r4,r0
000474  ebfffffe          BL       CmdSendVersion
;;;272              
;;;273            #warning just test 
;;;274    #if(0)        
;;;275            {
;;;276                static int times = 0;
;;;277                if(times%5 == 0)
;;;278                    PhotoAgentStartTakePhoto(0);
;;;279                times++;
;;;280            }
;;;281    #endif
;;;282        }
000478  eafffff3          B        |L1.1100|
;;;283    }
;;;284    
                          ENDP

                  DataAgentRemoveDataByCmdId PROC
;;;285    static BOOL DataAgentRemoveDataByCmdId(uint16_t cmdId)
00047c  e92d41f0          PUSH     {r4-r8,lr}
;;;286    {
000480  e1a05000          MOV      r5,r0
;;;287        BOOL reVal = FALSE;
000484  e3a06000          MOV      r6,#0
;;;288        int i;
;;;289        xSemaphoreTake(xRxTxSemaphore, portMAX_DELAY);
000488  e3a03000          MOV      r3,#0
00048c  e3e02000          MVN      r2,#0
000490  e1a01003          MOV      r1,r3
000494  e59f0120          LDR      r0,|L1.1468|
000498  e5900000          LDR      r0,[r0,#0]  ; xRxTxSemaphore
00049c  ebfffffe          BL       xQueueGenericReceive
;;;290        for(i = 0; i<MAX_AGENT_BUFF_NUMBER; i++)
0004a0  e3a04000          MOV      r4,#0
0004a4  ea000031          B        |L1.1392|
                  |L1.1192|
;;;291        {
;;;292            if((dataAgentTxBuff[i].useFlag == TRUE) && (dataAgentTxBuff[i].needAckFlag == TRUE))
0004a8  e59f0110          LDR      r0,|L1.1472|
0004ac  e0000094          MUL      r0,r4,r0
0004b0  e59f110c          LDR      r1,|L1.1476|
0004b4  e0810100          ADD      r0,r1,r0,LSL #2
0004b8  e5d00001          LDRB     r0,[r0,#1]
0004bc  e3500001          CMP      r0,#1
0004c0  1a000029          BNE      |L1.1388|
0004c4  e59f00f4          LDR      r0,|L1.1472|
0004c8  e0000094          MUL      r0,r4,r0
0004cc  e7d10100          LDRB     r0,[r1,r0,LSL #2]
0004d0  e3500001          CMP      r0,#1
0004d4  1a000024          BNE      |L1.1388|
;;;293            {
;;;294                CmdHeader* pCmdHeader = (CmdHeader*)dataAgentTxBuff[i].data;
0004d8  e59f00e0          LDR      r0,|L1.1472|
0004dc  e0000094          MUL      r0,r4,r0
0004e0  e0810100          ADD      r0,r1,r0,LSL #2
0004e4  e2807008          ADD      r7,r0,#8
;;;295                if(pCmdHeader->cmdId == cmdId)
0004e8  e5d7000a          LDRB     r0,[r7,#0xa]
0004ec  e1500005          CMP      r0,r5
0004f0  1a00001c          BNE      |L1.1384|
;;;296                {
;;;297                    dataAgentTxBuff[i].useFlag = FALSE;
0004f4  e3a00000          MOV      r0,#0
0004f8  e59f10c0          LDR      r1,|L1.1472|
0004fc  e0010194          MUL      r1,r4,r1
000500  e59f20bc          LDR      r2,|L1.1476|
000504  e0821101          ADD      r1,r2,r1,LSL #2
000508  e5c10001          STRB     r0,[r1,#1]
;;;298                    dataAgentTxBuff[i].sendTimeTick = 0;
00050c  e59f10ac          LDR      r1,|L1.1472|
000510  e0010194          MUL      r1,r4,r1
000514  e0821101          ADD      r1,r2,r1,LSL #2
000518  e5810508          STR      r0,[r1,#0x508]
;;;299                    dataAgentTxBuff[i].needAckFlag = FALSE;
00051c  e59f109c          LDR      r1,|L1.1472|
000520  e0010194          MUL      r1,r4,r1
000524  e7c20101          STRB     r0,[r2,r1,LSL #2]
;;;300                    memset(dataAgentTxBuff[i].data, 0x0, MAX_AGENT_DATA_SIZE);
000528  e59f1090          LDR      r1,|L1.1472|
00052c  e0010194          MUL      r1,r4,r1
000530  e0821101          ADD      r1,r2,r1,LSL #2
000534  e2810008          ADD      r0,r1,#8
000538  e3a01c05          MOV      r1,#0x500
00053c  ebfffffe          BL       __aeabi_memclr4
;;;301                    
;;;302                    //#if(BUILD_DEBUG_VERSION)
;;;303                    if(dataAgentDebugEnable)
000540  e59f0084          LDR      r0,|L1.1484|
000544  e5d00000          LDRB     r0,[r0,#0]  ; dataAgentDebugEnable
000548  e3500000          CMP      r0,#0
00054c  0a000003          BEQ      |L1.1376|
;;;304                        sysprintf(" ~> DataAgentRemoveDataByCmdId[%d]: OK [cmdId : %d ]...\r\n", i, cmdId);
000550  e1a02005          MOV      r2,r5
000554  e1a01004          MOV      r1,r4
000558  e28f00e8          ADR      r0,|L1.1608|
00055c  ebfffffe          BL       sysprintf
                  |L1.1376|
;;;305                    //#endif
;;;306    
;;;307                    reVal = TRUE;
000560  e3a06001          MOV      r6,#1
;;;308                    break;
000564  ea000003          B        |L1.1400|
                  |L1.1384|
;;;309                }
;;;310                else
;;;311                {
;;;312                    //if(dataAgentDebugEnable)
;;;313                    //    sysprintf("DataAgentRemoveDataByAck[%d]: cmdIndex error [%d : %d] ...\r\n", i, pCmdHeader->cmdIndex, cmdIndex);
;;;314                }
;;;315                //return TRUE;
;;;316            }
000568  e1a00000          MOV      r0,r0
                  |L1.1388|
00056c  e2844001          ADD      r4,r4,#1              ;290
                  |L1.1392|
000570  e354000a          CMP      r4,#0xa               ;290
000574  baffffcb          BLT      |L1.1192|
                  |L1.1400|
000578  e1a00000          MOV      r0,r0                 ;308
;;;317        }  
;;;318        
;;;319        if(reVal == FALSE)    
00057c  e3560000          CMP      r6,#0
000580  1a000002          BNE      |L1.1424|
;;;320            sysprintf(" ~> DataAgentRemoveDataByCmdId: ERROR [cmdId : %d ]...\r\n", cmdId); 
000584  e1a01005          MOV      r1,r5
000588  e28f00f4          ADR      r0,|L1.1668|
00058c  ebfffffe          BL       sysprintf
                  |L1.1424|
;;;321        
;;;322        xSemaphoreGive(xRxTxSemaphore);
000590  e3a03000          MOV      r3,#0
000594  e1a02003          MOV      r2,r3
000598  e1a01003          MOV      r1,r3
00059c  e59f0018          LDR      r0,|L1.1468|
0005a0  e5900000          LDR      r0,[r0,#0]  ; xRxTxSemaphore
0005a4  ebfffffe          BL       xQueueGenericSend
;;;323        return reVal;
0005a8  e1a00006          MOV      r0,r6
;;;324    }
0005ac  e8bd81f0          POP      {r4-r8,pc}
                  |L1.1456|
                          DCD      dataAgentPowerStatus
                  |L1.1460|
                          DCD      xDataAgentTxSemaphore
                  |L1.1464|
                          DCD      xDataAgentRoutineSemaphore
                  |L1.1468|
                          DCD      xRxTxSemaphore
                  |L1.1472|
                          DCD      0x00000143
                  |L1.1476|
                          DCD      dataAgentTxBuff
                  |L1.1480|
                          DCD      0x00000bb8
                  |L1.1484|
                          DCD      dataAgentDebugEnable
                  |L1.1488|
                          DCD      ||.constdata||
                  |L1.1492|
                          DCD      ||.constdata||+0x5c
                  |L1.1496|
                          DCD      pCommunicationInterface
                  |L1.1500|
                          DCD      ||.constdata||+0xb0
                  |L1.1504|
0005e0  76446174          DCB      "vDataAgentRxTask Going...\r\n",0
0005e4  61416765
0005e8  6e745278
0005ec  5461736b
0005f0  20476f69
0005f4  6e672e2e
0005f8  2e0d0a00
                  |L1.1532|
                          DCD      RXBuff
                  |L1.1536|
000600  76446174          DCB      "vDataAgentTxTask Going...\r\n",0
000604  61416765
000608  6e745478
00060c  5461736b
000610  20476f69
000614  6e672e2e
000618  2e0d0a00
                  |L1.1564|
                          DCD      threadTxWaitTime
                  |L1.1568|
000620  76446174          DCB      "vDataAgentRoutineTask Going...\r\n",0
000624  61416765
000628  6e74526f
00062c  7574696e
000630  65546173
000634  6b20476f
000638  696e672e
00063c  2e2e0d0a
000640  00      
000641  00                DCB      0
000642  00                DCB      0
000643  00                DCB      0
                  |L1.1604|
                          DCD      threadRoutineWaitTime
                  |L1.1608|
000648  207e3e20          DCB      " ~> DataAgentRemoveDataByCmdId[%d]: OK [cmdId : %d ]..."
00064c  44617461
000650  4167656e
000654  7452656d
000658  6f766544
00065c  61746142
000660  79436d64
000664  49645b25
000668  645d3a20
00066c  4f4b205b
000670  636d6449
000674  64203a20
000678  2564205d
00067c  2e2e2e  
00067f  0d0a00            DCB      "\r\n",0
000682  00                DCB      0
000683  00                DCB      0
                  |L1.1668|
000684  207e3e20          DCB      " ~> DataAgentRemoveDataByCmdId: ERROR [cmdId : %d ]...\r"
000688  44617461
00068c  4167656e
000690  7452656d
000694  6f766544
000698  61746142
00069c  79436d64
0006a0  49643a20
0006a4  4552524f
0006a8  52205b63
0006ac  6d644964
0006b0  203a2025
0006b4  64205d2e
0006b8  2e2e0d  
0006bb  0a00              DCB      "\n",0
0006bd  00                DCB      0
0006be  00                DCB      0
0006bf  00                DCB      0
                          ENDP

                  initBuffData PROC
;;;325    
;;;326    static void initBuffData(void)
0006c0  e92d4010          PUSH     {r4,lr}
;;;327    {
;;;328        int i;
;;;329        for(i = 0; i<MAX_AGENT_BUFF_NUMBER; i++)
0006c4  e3a04000          MOV      r4,#0
0006c8  ea000017          B        |L1.1836|
                  |L1.1740|
;;;330        {
;;;331            dataAgentTxBuff[i].needAckFlag = FALSE;
0006cc  e3a00000          MOV      r0,#0
0006d0  e51f1118          LDR      r1,|L1.1472|
0006d4  e0010194          MUL      r1,r4,r1
0006d8  e51f211c          LDR      r2,|L1.1476|
0006dc  e7c20101          STRB     r0,[r2,r1,LSL #2]
;;;332            dataAgentTxBuff[i].useFlag = FALSE;
0006e0  e51f1128          LDR      r1,|L1.1472|
0006e4  e0010194          MUL      r1,r4,r1
0006e8  e0821101          ADD      r1,r2,r1,LSL #2
0006ec  e5c10001          STRB     r0,[r1,#1]
;;;333            dataAgentTxBuff[i].callback = NULL;
0006f0  e51f1138          LDR      r1,|L1.1472|
0006f4  e0010194          MUL      r1,r4,r1
0006f8  e0821101          ADD      r1,r2,r1,LSL #2
0006fc  e5810004          STR      r0,[r1,#4]
;;;334            dataAgentTxBuff[i].sendTimeTick = 0;
000700  e51f1148          LDR      r1,|L1.1472|
000704  e0010194          MUL      r1,r4,r1
000708  e0821101          ADD      r1,r2,r1,LSL #2
00070c  e5810508          STR      r0,[r1,#0x508]
;;;335            memset(dataAgentTxBuff[i].data, 0x0, MAX_AGENT_DATA_SIZE);
000710  e51f1158          LDR      r1,|L1.1472|
000714  e0010194          MUL      r1,r4,r1
000718  e0821101          ADD      r1,r2,r1,LSL #2
00071c  e2810008          ADD      r0,r1,#8
000720  e3a01c05          MOV      r1,#0x500
000724  ebfffffe          BL       __aeabi_memclr4
000728  e2844001          ADD      r4,r4,#1              ;329
                  |L1.1836|
00072c  e354000a          CMP      r4,#0xa               ;329
000730  baffffe5          BLT      |L1.1740|
;;;336        }    
;;;337    }
000734  e8bd8010          POP      {r4,pc}
;;;338    static BOOL hwInit(void)
                          ENDP

                  hwInit PROC
000738  e3a00001          MOV      r0,#1
;;;339    {   
;;;340        return TRUE;
;;;341    }
00073c  e12fff1e          BX       lr
;;;342    
                          ENDP

                  loadFileData PROC
;;;509    static uint16_t  mFileTransferCurrentFileLen = 0;
;;;510    static uint16_t loadFileData(uint8_t* buff, uint16_t len)
000740  e92d40f8          PUSH     {r3-r7,lr}
;;;511    {
000744  e1a04000          MOV      r4,r0
000748  e1a05001          MOV      r5,r1
;;;512        if(MyFileOpenFlag)
00074c  e59f01e4          LDR      r0,|L1.2360|
000750  e5d00000          LDRB     r0,[r0,#0]  ; MyFileOpenFlag
000754  e3500000          CMP      r0,#0
000758  0a00000d          BEQ      |L1.1940|
;;;513        {
;;;514            FRESULT reval;
;;;515            uint16_t NumByteToRead;
;;;516            reval = f_read(&MyFile, buff, len, (void *)&NumByteToRead);
00075c  e1a0300d          MOV      r3,sp
000760  e1a02005          MOV      r2,r5
000764  e1a01004          MOV      r1,r4
000768  e59f01cc          LDR      r0,|L1.2364|
00076c  ebfffffe          BL       f_read
000770  e1a06000          MOV      r6,r0
;;;517            //  
;;;518            if(reval != FR_OK)
000774  e3560000          CMP      r6,#0
000778  0a000003          BEQ      |L1.1932|
;;;519            {
;;;520                sysprintf("loadFileData:Cannot Read (reval != FR_OK)... \r\n"); 
00077c  e28f0f6f          ADR      r0,|L1.2368|
000780  ebfffffe          BL       sysprintf
;;;521                return 0;
000784  e3a00000          MOV      r0,#0
                  |L1.1928|
;;;522            }            
;;;523            return NumByteToRead;;
;;;524        }
;;;525        else
;;;526        {
;;;527            sysprintf("loadFileData:not open yet... \r\n"); 
;;;528            return 0;
;;;529        }
;;;530    }
000788  e8bd80f8          POP      {r3-r7,pc}
                  |L1.1932|
00078c  e1dd00b0          LDRH     r0,[sp,#0]            ;523
000790  eafffffc          B        |L1.1928|
                  |L1.1940|
000794  e1a00000          MOV      r0,r0                 ;524
000798  e28f0e1d          ADR      r0,|L1.2416|
00079c  ebfffffe          BL       sysprintf
0007a0  e3a00000          MOV      r0,#0                 ;528
0007a4  eafffff7          B        |L1.1928|
;;;531    
                          ENDP

                  DataAgentTxCallback PROC
;;;532    static BOOL DataAgentTxCallback(uint16_t address)
0007a8  e92d4070          PUSH     {r4-r6,lr}
;;;533    {   
0007ac  e1a05000          MOV      r5,r0
;;;534        if(FILE_TRANSFER_STATUS_IDLE == fileTransferStatus)
0007b0  e59f01d8          LDR      r0,|L1.2448|
0007b4  e5d00000          LDRB     r0,[r0,#0]  ; fileTransferStatus
0007b8  e3500001          CMP      r0,#1
0007bc  1a000003          BNE      |L1.2000|
;;;535        {
;;;536            sysprintf("DataAgentTxCallback ignore[FILE_TRANSFER_STATUS_IDLE]...\r\n"); 
0007c0  e28f0f73          ADR      r0,|L1.2452|
0007c4  ebfffffe          BL       sysprintf
;;;537            return FALSE;
0007c8  e3a00000          MOV      r0,#0
                  |L1.1996|
;;;538        }
;;;539        else
;;;540        {
;;;541            if(MyFileOpenFlag)
;;;542            {
;;;543                uint16_t readLen;
;;;544                //sysprintf("DataAgentTxCallback Going...\r\n"); 
;;;545                sysprintf("+");
;;;546                mFileTransferCurrentAddress = mFileTransferCurrentAddress +  mFileTransferCurrentDataLen;  
;;;547                readLen = loadFileData(mFileTransferDataPara.data, FILE_TRANSFER_DATA_LEN); 
;;;548                if( readLen == 0)
;;;549                {
;;;550                    f_close(&MyFile);
;;;551                    MyFileOpenFlag = FALSE;
;;;552                    fileTransferStatus = FILE_TRANSFER_STATUS_END;
;;;553                    xSemaphoreGive(xDataAgentFileTransferSemaphore);             
;;;554                    return FALSE;
;;;555                }    
;;;556                mFileTransferCurrentDataLen = readLen;
;;;557                fileTransferStatus = FILE_TRANSFER_STATUS_SEND;
;;;558                xSemaphoreGive(xDataAgentFileTransferSemaphore);  
;;;559            }
;;;560            else
;;;561            {
;;;562                 sysprintf("DataAgentTxCallback End...\r\n");  
;;;563                 fileTransferStatus = FILE_TRANSFER_STATUS_IDLE;
;;;564                 threadFileTransferWaitTime = portMAX_DELAY;
;;;565            }
;;;566    
;;;567            return TRUE;
;;;568        }
;;;569    }
0007cc  e8bd8070          POP      {r4-r6,pc}
                  |L1.2000|
0007d0  e59f0160          LDR      r0,|L1.2360|
0007d4  e5d00000          LDRB     r0,[r0,#0]            ;541  ; MyFileOpenFlag
0007d8  e3500000          CMP      r0,#0                 ;541
0007dc  0a00002b          BEQ      |L1.2192|
0007e0  e28f0f7a          ADR      r0,|L1.2512|
0007e4  ebfffffe          BL       sysprintf
0007e8  e59f01e4          LDR      r0,|L1.2516|
0007ec  e1d000b0          LDRH     r0,[r0,#0]            ;546  ; mFileTransferCurrentAddress
0007f0  e59f11e0          LDR      r1,|L1.2520|
0007f4  e1d110b0          LDRH     r1,[r1,#0]            ;546  ; mFileTransferCurrentDataLen
0007f8  e0800001          ADD      r0,r0,r1              ;546
0007fc  e3c00801          BIC      r0,r0,#0x10000        ;546
000800  e59f11cc          LDR      r1,|L1.2516|
000804  e1c100b0          STRH     r0,[r1,#0]            ;546  ; mFileTransferCurrentAddress
000808  e3a01b01          MOV      r1,#0x400             ;547
00080c  e59f01c8          LDR      r0,|L1.2524|
000810  ebfffffe          BL       loadFileData
000814  e1a04000          MOV      r4,r0                 ;547
000818  e3540000          CMP      r4,#0                 ;548
00081c  1a00000f          BNE      |L1.2144|
000820  e59f0114          LDR      r0,|L1.2364|
000824  ebfffffe          BL       f_close
000828  e3a00000          MOV      r0,#0                 ;551
00082c  e59f1104          LDR      r1,|L1.2360|
000830  e5c10000          STRB     r0,[r1,#0]            ;551  ; MyFileOpenFlag
000834  e3a00004          MOV      r0,#4                 ;552
000838  e59f1150          LDR      r1,|L1.2448|
00083c  e5c10000          STRB     r0,[r1,#0]            ;552  ; fileTransferStatus
000840  e3a03000          MOV      r3,#0                 ;553
000844  e1a02003          MOV      r2,r3                 ;553
000848  e1a01003          MOV      r1,r3                 ;553
00084c  e59f018c          LDR      r0,|L1.2528|
000850  e5900000          LDR      r0,[r0,#0]            ;553  ; xDataAgentFileTransferSemaphore
000854  ebfffffe          BL       xQueueGenericSend
000858  e3a00000          MOV      r0,#0                 ;554
00085c  eaffffda          B        |L1.1996|
                  |L1.2144|
000860  e59f0170          LDR      r0,|L1.2520|
000864  e1c040b0          STRH     r4,[r0,#0]            ;556  ; mFileTransferCurrentDataLen
000868  e3a00003          MOV      r0,#3                 ;557
00086c  e59f111c          LDR      r1,|L1.2448|
000870  e5c10000          STRB     r0,[r1,#0]            ;557  ; fileTransferStatus
000874  e3a03000          MOV      r3,#0                 ;558
000878  e1a02003          MOV      r2,r3                 ;558
00087c  e1a01003          MOV      r1,r3                 ;558
000880  e59f0158          LDR      r0,|L1.2528|
000884  e5900000          LDR      r0,[r0,#0]            ;558  ; xDataAgentFileTransferSemaphore
000888  ebfffffe          BL       xQueueGenericSend
00088c  ea000007          B        |L1.2224|
                  |L1.2192|
000890  e28f0f53          ADR      r0,|L1.2532|
000894  ebfffffe          BL       sysprintf
000898  e3a00001          MOV      r0,#1                 ;563
00089c  e59f10ec          LDR      r1,|L1.2448|
0008a0  e5c10000          STRB     r0,[r1,#0]            ;563  ; fileTransferStatus
0008a4  e3e00000          MVN      r0,#0                 ;564
0008a8  e59f1154          LDR      r1,|L1.2564|
0008ac  e5810000          STR      r0,[r1,#0]            ;564  ; threadFileTransferWaitTime
                  |L1.2224|
0008b0  e3a00001          MOV      r0,#1                 ;567
0008b4  eaffffc4          B        |L1.1996|
;;;570    
                          ENDP

                  vDataAgentFileTransferTask PROC
;;;630    
;;;631    static void vDataAgentFileTransferTask( void *pvParameters )
0008b8  e28f0f52          ADR      r0,|L1.2568|
;;;632    {
;;;633        sysprintf("vDataAgentFileTransferTask Going...\r\n");       
0008bc  ebfffffe          BL       sysprintf
;;;634        for(;;)
0008c0  e1a00000          MOV      r0,r0
                  |L1.2244|
;;;635        {
;;;636            BaseType_t reval = xSemaphoreTake(xDataAgentFileTransferSemaphore, threadFileTransferWaitTime/*portMAX_DELAY*/); 
0008c4  e3a03000          MOV      r3,#0
0008c8  e59f0134          LDR      r0,|L1.2564|
0008cc  e1a01003          MOV      r1,r3
0008d0  e5902000          LDR      r2,[r0,#0]  ; threadFileTransferWaitTime
0008d4  e59f0104          LDR      r0,|L1.2528|
0008d8  e5900000          LDR      r0,[r0,#0]  ; xDataAgentFileTransferSemaphore
0008dc  ebfffffe          BL       xQueueGenericReceive
0008e0  e1a04000          MOV      r4,r0
;;;637            switch(fileTransferStatus)
0008e4  e59f00a4          LDR      r0,|L1.2448|
0008e8  e5d00000          LDRB     r0,[r0,#0]  ; fileTransferStatus
0008ec  e3500001          CMP      r0,#1
0008f0  0a000006          BEQ      |L1.2320|
0008f4  e3500002          CMP      r0,#2
0008f8  0a000006          BEQ      |L1.2328|
0008fc  e3500003          CMP      r0,#3
000900  0a00004d          BEQ      |L1.2620|
000904  e3500004          CMP      r0,#4
000908  1a00005c          BNE      |L1.2688|
00090c  ea000053          B        |L1.2656|
                  |L1.2320|
;;;638            {
;;;639            case FILE_TRANSFER_STATUS_IDLE:
000910  e1a00000          MOV      r0,r0
;;;640                break;
000914  ea000059          B        |L1.2688|
                  |L1.2328|
;;;641            case FILE_TRANSFER_STATUS_INIT:
000918  e1a00000          MOV      r0,r0
;;;642                CmdSendFileTransfer(targetFileNameTmp, mFileTransferCurrentFileLen/*MyFile.fsize*/, FILE_TRANSFER_CMD_STATUS_START, DataAgentTxCallback) ; 
00091c  e59f310c          LDR      r3,|L1.2608|
000920  e3a02001          MOV      r2,#1
000924  e59f0108          LDR      r0,|L1.2612|
000928  e1d010b0          LDRH     r1,[r0,#0]  ; mFileTransferCurrentFileLen
00092c  e59f0104          LDR      r0,|L1.2616|
000930  ebfffffe          BL       CmdSendFileTransfer
;;;643                break;
000934  ea000051          B        |L1.2688|
                  |L1.2360|
                          DCD      MyFileOpenFlag
                  |L1.2364|
                          DCD      MyFile
                  |L1.2368|
000940  6c6f6164          DCB      "loadFileData:Cannot Read (reval != FR_OK)... \r\n",0
000944  46696c65
000948  44617461
00094c  3a43616e
000950  6e6f7420
000954  52656164
000958  20287265
00095c  76616c20
000960  213d2046
000964  525f4f4b
000968  292e2e2e
00096c  200d0a00
                  |L1.2416|
000970  6c6f6164          DCB      "loadFileData:not open yet... \r\n",0
000974  46696c65
000978  44617461
00097c  3a6e6f74
000980  206f7065
000984  6e207965
000988  742e2e2e
00098c  200d0a00
                  |L1.2448|
                          DCD      fileTransferStatus
                  |L1.2452|
000994  44617461          DCB      "DataAgentTxCallback ignore[FILE_TRANSFER_STATUS_IDLE].."
000998  4167656e
00099c  74547843
0009a0  616c6c62
0009a4  61636b20
0009a8  69676e6f
0009ac  72655b46
0009b0  494c455f
0009b4  5452414e
0009b8  53464552
0009bc  5f535441
0009c0  5455535f
0009c4  49444c45
0009c8  5d2e2e  
0009cb  2e0d0a00          DCB      ".\r\n",0
0009cf  00                DCB      0
                  |L1.2512|
0009d0  2b00              DCB      "+",0
0009d2  00                DCB      0
0009d3  00                DCB      0
                  |L1.2516|
                          DCD      mFileTransferCurrentAddress
                  |L1.2520|
                          DCD      mFileTransferCurrentDataLen
                  |L1.2524|
                          DCD      mFileTransferDataPara+0x4
                  |L1.2528|
                          DCD      xDataAgentFileTransferSemaphore
                  |L1.2532|
0009e4  44617461          DCB      "DataAgentTxCallback End...\r\n",0
0009e8  4167656e
0009ec  74547843
0009f0  616c6c62
0009f4  61636b20
0009f8  456e642e
0009fc  2e2e0d0a
000a00  00      
000a01  00                DCB      0
000a02  00                DCB      0
000a03  00                DCB      0
                  |L1.2564|
                          DCD      threadFileTransferWaitTime
                  |L1.2568|
000a08  76446174          DCB      "vDataAgentFileTransferTask Going...\r\n",0
000a0c  61416765
000a10  6e744669
000a14  6c655472
000a18  616e7366
000a1c  65725461
000a20  736b2047
000a24  6f696e67
000a28  2e2e2e0d
000a2c  0a00    
000a2e  00                DCB      0
000a2f  00                DCB      0
                  |L1.2608|
                          DCD      DataAgentTxCallback
                  |L1.2612|
                          DCD      mFileTransferCurrentFileLen
                  |L1.2616|
                          DCD      targetFileNameTmp
                  |L1.2620|
;;;644            case FILE_TRANSFER_STATUS_SEND:
000a3c  e1a00000          MOV      r0,r0
;;;645                CmdSendFileTransferData(mFileTransferCurrentAddress, mFileTransferCurrentDataLen, mFileTransferDataPara.data, DataAgentTxCallback);
000a40  e51f3018          LDR      r3,|L1.2608|
000a44  e51f2070          LDR      r2,|L1.2524|
000a48  e51f0078          LDR      r0,|L1.2520|
000a4c  e1d010b0          LDRH     r1,[r0,#0]  ; mFileTransferCurrentDataLen
000a50  e51f0084          LDR      r0,|L1.2516|
000a54  e1d000b0          LDRH     r0,[r0,#0]  ; mFileTransferCurrentAddress
000a58  ebfffffe          BL       CmdSendFileTransferData
;;;646                break;  
000a5c  ea000007          B        |L1.2688|
                  |L1.2656|
;;;647            case FILE_TRANSFER_STATUS_END:
000a60  e1a00000          MOV      r0,r0
;;;648                CmdSendFileTransfer(targetFileNameTmp, mFileTransferCurrentFileLen/*MyFile.fsize*/, FILE_TRANSFER_CMD_STATUS_END, DataAgentTxCallback) ;
000a64  e51f303c          LDR      r3,|L1.2608|
000a68  e3a02002          MOV      r2,#2
000a6c  e51f0040          LDR      r0,|L1.2612|
000a70  e1d010b0          LDRH     r1,[r0,#0]  ; mFileTransferCurrentFileLen
000a74  e51f0044          LDR      r0,|L1.2616|
000a78  ebfffffe          BL       CmdSendFileTransfer
;;;649                break;
000a7c  e1a00000          MOV      r0,r0
                  |L1.2688|
000a80  e1a00000          MOV      r0,r0                 ;640
;;;650            }
;;;651        }
000a84  eaffff8e          B        |L1.2244|
;;;652    }
;;;653    #endif
                          ENDP

                  swInit PROC
;;;342    
;;;343    static BOOL swInit(void)
000a88  e92d401c          PUSH     {r2-r4,lr}
;;;344    {   
;;;345        PowerRegCallback(&dataAgentPowerCallabck);
000a8c  e59f0174          LDR      r0,|L1.3080|
000a90  ebfffffe          BL       PowerRegCallback
;;;346        initBuffData();
000a94  ebfffffe          BL       initBuffData
;;;347        xRxTxSemaphore = xSemaphoreCreateMutex();
000a98  e3a00001          MOV      r0,#1
000a9c  ebfffffe          BL       xQueueCreateMutex
000aa0  e51f14ec          LDR      r1,|L1.1468|
000aa4  e5810000          STR      r0,[r1,#0]  ; xRxTxSemaphore
;;;348        xDataAgentRoutineSemaphore = xSemaphoreCreateBinary();
000aa8  e3a02003          MOV      r2,#3
000aac  e3a01000          MOV      r1,#0
000ab0  e3a00001          MOV      r0,#1
000ab4  ebfffffe          BL       xQueueGenericCreate
000ab8  e51f1508          LDR      r1,|L1.1464|
000abc  e5810000          STR      r0,[r1,#0]  ; xDataAgentRoutineSemaphore
;;;349        xDataAgentFileTransferSemaphore = xSemaphoreCreateBinary();
000ac0  e3a02003          MOV      r2,#3
000ac4  e3a01000          MOV      r1,#0
000ac8  e3a00001          MOV      r0,#1
000acc  ebfffffe          BL       xQueueGenericCreate
000ad0  e51f10f8          LDR      r1,|L1.2528|
000ad4  e5810000          STR      r0,[r1,#0]  ; xDataAgentFileTransferSemaphore
;;;350        xDataAgentTxSemaphore = xSemaphoreCreateBinary();
000ad8  e3a02003          MOV      r2,#3
000adc  e3a01000          MOV      r1,#0
000ae0  e3a00001          MOV      r0,#1
000ae4  ebfffffe          BL       xQueueGenericCreate
000ae8  e51f153c          LDR      r1,|L1.1460|
000aec  e5810000          STR      r0,[r1,#0]  ; xDataAgentTxSemaphore
;;;351        xTaskCreate( vDataAgentRxTask, "vDataAgentRxTask", 1024*10, NULL, DATA_AGENT_RX_THREAD_PROI, NULL ); 
000af0  e3a00000          MOV      r0,#0
000af4  e3a01008          MOV      r1,#8
000af8  e58d0004          STR      r0,[sp,#4]
000afc  e1a03000          MOV      r3,r0
000b00  e3a02b0a          MOV      r2,#0x2800
000b04  e58d1000          STR      r1,[sp,#0]
000b08  e28f10fc          ADR      r1,|L1.3084|
000b0c  e59f010c          LDR      r0,|L1.3104|
000b10  ebfffffe          BL       xTaskCreate
;;;352        xTaskCreate( vDataAgentTxTask, "vDataAgentTxTask", 1024*10, NULL, DATA_AGENT_TX_THREAD_PROI, NULL ); 
000b14  e3a00000          MOV      r0,#0
000b18  e3a01007          MOV      r1,#7
000b1c  e58d0004          STR      r0,[sp,#4]
000b20  e1a03000          MOV      r3,r0
000b24  e3a02b0a          MOV      r2,#0x2800
000b28  e58d1000          STR      r1,[sp,#0]
000b2c  e28f10f0          ADR      r1,|L1.3108|
000b30  e59f0100          LDR      r0,|L1.3128|
000b34  ebfffffe          BL       xTaskCreate
;;;353        xTaskCreate( vDataAgentRoutineTask, "vDataAgentRoutineTask", 1024*10, NULL, DATA_AGENT_ROUTINE_THREAD_PROI, NULL ); 
000b38  e3a00000          MOV      r0,#0
000b3c  e3a01006          MOV      r1,#6
000b40  e58d0004          STR      r0,[sp,#4]
000b44  e1a03000          MOV      r3,r0
000b48  e3a02b0a          MOV      r2,#0x2800
000b4c  e58d1000          STR      r1,[sp,#0]
000b50  e28f10e4          ADR      r1,|L1.3132|
000b54  e59f00f8          LDR      r0,|L1.3156|
000b58  ebfffffe          BL       xTaskCreate
;;;354        xTaskCreate( vDataAgentFileTransferTask, "vDataAgentFileTransferTask", 1024*10, NULL, DATA_AGENT_ROUTINE_THREAD_PROI, NULL ); 
000b5c  e3a00000          MOV      r0,#0
000b60  e3a01006          MOV      r1,#6
000b64  e58d0004          STR      r0,[sp,#4]
000b68  e1a03000          MOV      r3,r0
000b6c  e3a02b0a          MOV      r2,#0x2800
000b70  e58d1000          STR      r1,[sp,#0]
000b74  e28f10dc          ADR      r1,|L1.3160|
000b78  e59f00f4          LDR      r0,|L1.3188|
000b7c  ebfffffe          BL       xTaskCreate
;;;355        return TRUE;
000b80  e3a00001          MOV      r0,#1
;;;356    }
000b84  e8bd801c          POP      {r2-r4,pc}
;;;357      
                          ENDP

                  DataAgentInit PROC
;;;361    /*-----------------------------------------*/
;;;362    BOOL DataAgentInit(void)
000b88  e92d4010          PUSH     {r4,lr}
;;;363    {
;;;364        sysprintf("DataAgentInit!!\n");
000b8c  e28f00e4          ADR      r0,|L1.3192|
000b90  ebfffffe          BL       sysprintf
;;;365        //pCommunicationInterface = CommunicationGetInterface(COMMUNICATION_RS232_INTERFACE_INDEX/*COMMUNICATION_LORA_INTERFACE_INDEX*/);
;;;366        pCommunicationInterface = CommunicationGetInterface(COMMUNICATION_LORA_INTERFACE_INDEX);
000b94  e3a00000          MOV      r0,#0
000b98  ebfffffe          BL       CommunicationGetInterface
000b9c  e51f15cc          LDR      r1,|L1.1496|
000ba0  e5810000          STR      r0,[r1,#0]  ; pCommunicationInterface
;;;367        if(pCommunicationInterface == NULL)
000ba4  e2810000          ADD      r0,r1,#0
000ba8  e5900000          LDR      r0,[r0,#0]  ; pCommunicationInterface
000bac  e3500000          CMP      r0,#0
000bb0  1a000003          BNE      |L1.3012|
;;;368        {
;;;369            sysprintf("DataAgentInit ERROR (pStorageInterface == NULL)!!\n");
000bb4  e28f00d0          ADR      r0,|L1.3212|
000bb8  ebfffffe          BL       sysprintf
;;;370            return FALSE;
000bbc  e3a00000          MOV      r0,#0
                  |L1.3008|
;;;371        }
;;;372        if(pCommunicationInterface->initFunc() == FALSE)
;;;373        {
;;;374            sysprintf("DataAgentInit ERROR (initFunc false)!!\n");
;;;375            return FALSE;
;;;376        }
;;;377        if(hwInit() == FALSE)
;;;378        {
;;;379            sysprintf("DataAgentInit ERROR (hwInit false)!!\n");
;;;380            return FALSE;
;;;381        }
;;;382        if(swInit() == FALSE)
;;;383        {
;;;384            sysprintf("DataAgentInit ERROR (swInit false)!!\n");
;;;385            return FALSE;
;;;386        }
;;;387        sysprintf("DataAgentInit OK!!\n");
;;;388        return TRUE;
;;;389    }
000bc0  e8bd8010          POP      {r4,pc}
                  |L1.3012|
000bc4  e51f15f4          LDR      r1,|L1.1496|
000bc8  e5911000          LDR      r1,[r1,#0]            ;372  ; pCommunicationInterface
000bcc  e5910000          LDR      r0,[r1,#0]            ;372
000bd0  e12fff30          BLX      r0                    ;372
000bd4  e3500000          CMP      r0,#0                 ;372
000bd8  1a000003          BNE      |L1.3052|
000bdc  e28f00dc          ADR      r0,|L1.3264|
000be0  ebfffffe          BL       sysprintf
000be4  e3a00000          MOV      r0,#0                 ;375
000be8  eafffff4          B        |L1.3008|
                  |L1.3052|
000bec  ebfffffe          BL       hwInit
000bf0  e3500000          CMP      r0,#0                 ;377
000bf4  1a000045          BNE      |L1.3344|
000bf8  e28f00e8          ADR      r0,|L1.3304|
000bfc  ebfffffe          BL       sysprintf
000c00  e3a00000          MOV      r0,#0                 ;380
000c04  eaffffed          B        |L1.3008|
                  |L1.3080|
                          DCD      dataAgentPowerCallabck
                  |L1.3084|
000c0c  76446174          DCB      "vDataAgentRxTask",0
000c10  61416765
000c14  6e745278
000c18  5461736b
000c1c  00      
000c1d  00                DCB      0
000c1e  00                DCB      0
000c1f  00                DCB      0
                  |L1.3104|
                          DCD      vDataAgentRxTask
                  |L1.3108|
000c24  76446174          DCB      "vDataAgentTxTask",0
000c28  61416765
000c2c  6e745478
000c30  5461736b
000c34  00      
000c35  00                DCB      0
000c36  00                DCB      0
000c37  00                DCB      0
                  |L1.3128|
                          DCD      vDataAgentTxTask
                  |L1.3132|
000c3c  76446174          DCB      "vDataAgentRoutineTask",0
000c40  61416765
000c44  6e74526f
000c48  7574696e
000c4c  65546173
000c50  6b00    
000c52  00                DCB      0
000c53  00                DCB      0
                  |L1.3156|
                          DCD      vDataAgentRoutineTask
                  |L1.3160|
000c58  76446174          DCB      "vDataAgentFileTransferTask",0
000c5c  61416765
000c60  6e744669
000c64  6c655472
000c68  616e7366
000c6c  65725461
000c70  736b00  
000c73  00                DCB      0
                  |L1.3188|
                          DCD      vDataAgentFileTransferTask
                  |L1.3192|
000c78  44617461          DCB      "DataAgentInit!!\n",0
000c7c  4167656e
000c80  74496e69
000c84  7421210a
000c88  00      
000c89  00                DCB      0
000c8a  00                DCB      0
000c8b  00                DCB      0
                  |L1.3212|
000c8c  44617461          DCB      "DataAgentInit ERROR (pStorageInterface == NULL)!!\n",0
000c90  4167656e
000c94  74496e69
000c98  74204552
000c9c  524f5220
000ca0  28705374
000ca4  6f726167
000ca8  65496e74
000cac  65726661
000cb0  6365203d
000cb4  3d204e55
000cb8  4c4c2921
000cbc  210a00  
000cbf  00                DCB      0
                  |L1.3264|
000cc0  44617461          DCB      "DataAgentInit ERROR (initFunc false)!!\n",0
000cc4  4167656e
000cc8  74496e69
000ccc  74204552
000cd0  524f5220
000cd4  28696e69
000cd8  7446756e
000cdc  63206661
000ce0  6c736529
000ce4  21210a00
                  |L1.3304|
000ce8  44617461          DCB      "DataAgentInit ERROR (hwInit false)!!\n",0
000cec  4167656e
000cf0  74496e69
000cf4  74204552
000cf8  524f5220
000cfc  28687749
000d00  6e697420
000d04  66616c73
000d08  65292121
000d0c  0a00    
000d0e  00                DCB      0
000d0f  00                DCB      0
                  |L1.3344|
000d10  ebfffffe          BL       swInit
000d14  e3500000          CMP      r0,#0                 ;382
000d18  1a000003          BNE      |L1.3372|
000d1c  e28f0f7d          ADR      r0,|L1.3864|
000d20  ebfffffe          BL       sysprintf
000d24  e3a00000          MOV      r0,#0                 ;385
000d28  eaffffa4          B        |L1.3008|
                  |L1.3372|
000d2c  e28f0f83          ADR      r0,|L1.3904|
000d30  ebfffffe          BL       sysprintf
000d34  e3a00001          MOV      r0,#1                 ;388
000d38  eaffffa0          B        |L1.3008|
;;;390    BOOL DataAgentAddData(uint8_t* pData, uint16_t dataLen, BOOL needAck, dataAgentTxCallback callback)
                          ENDP

                  DataAgentAddData PROC
000d3c  e92d47f0          PUSH     {r4-r10,lr}
;;;391    {
000d40  e1a05000          MOV      r5,r0
000d44  e1a06001          MOV      r6,r1
000d48  e1a07002          MOV      r7,r2
000d4c  e1a08003          MOV      r8,r3
;;;392        BOOL reVal = FALSE;
000d50  e3a09000          MOV      r9,#0
;;;393        int i;
;;;394        if(xRxTxSemaphore == NULL)
000d54  e51f07a0          LDR      r0,|L1.1468|
000d58  e5900000          LDR      r0,[r0,#0]  ; xRxTxSemaphore
000d5c  e3500000          CMP      r0,#0
000d60  1a000003          BNE      |L1.3444|
;;;395        {
;;;396            sysprintf("DataAgentAddData: ignore, (xRxTxSemaphore == NULL)...\r\n"); 
000d64  e28f0f7a          ADR      r0,|L1.3924|
000d68  ebfffffe          BL       sysprintf
;;;397            return reVal;
000d6c  e1a00009          MOV      r0,r9
                  |L1.3440|
;;;398        }
;;;399        if(dataAgentDebugEnable)
;;;400            sysprintf("DataAgentAddData: Waitinging ...\r\n");
;;;401        xSemaphoreTake(xRxTxSemaphore, portMAX_DELAY);
;;;402        if(dataAgentDebugEnable)
;;;403            sysprintf("DataAgentAddData: Going ...\r\n");
;;;404        for(i = 0; i<MAX_AGENT_BUFF_NUMBER; i++)
;;;405        {
;;;406            if(dataAgentTxBuff[i].useFlag == FALSE)
;;;407            {
;;;408                dataAgentTxBuff[i].useFlag = TRUE;
;;;409                dataAgentTxBuff[i].sendTimeTick = 0;
;;;410                dataAgentTxBuff[i].needAckFlag = needAck;
;;;411                dataAgentTxBuff[i].callback = callback;
;;;412                if(dataLen<MAX_AGENT_DATA_SIZE)
;;;413                {
;;;414                    memcpy(dataAgentTxBuff[i].data, pData, dataLen);
;;;415                    dataAgentTxBuff[i].dataLen = dataLen; 
;;;416                }
;;;417                else
;;;418                {
;;;419                    memcpy(dataAgentTxBuff[i].data, pData, MAX_AGENT_DATA_SIZE);
;;;420                    dataAgentTxBuff[i].dataLen = MAX_AGENT_DATA_SIZE;
;;;421                }
;;;422                xSemaphoreGive( xDataAgentTxSemaphore); 
;;;423                //#if(BUILD_DEBUG_VERSION)
;;;424                if(dataAgentDebugEnable)
;;;425                {
;;;426                    CmdHeader* cmdHeader = (CmdHeader*)pData;
;;;427                    sysprintf("DataAgentAddData[%d]: OK [cmdId = %d, cmdIndex = %d ]...\r\n", i, cmdHeader->cmdId, cmdHeader->cmdIndex);
;;;428                }
;;;429               // #endif
;;;430                reVal = TRUE;
;;;431                break;
;;;432            }
;;;433        }    
;;;434        if(reVal == FALSE)
;;;435            sysprintf("DataAgentAddData: error...\r\n"); 
;;;436        else
;;;437            dataAgentPowerStatus = FALSE;
;;;438        
;;;439        xSemaphoreGive(xRxTxSemaphore);
;;;440        return reVal;
;;;441    }
000d70  e8bd87f0          POP      {r4-r10,pc}
                  |L1.3444|
000d74  e51f07b0          LDR      r0,|L1.1484|
000d78  e5d00000          LDRB     r0,[r0,#0]            ;399  ; dataAgentDebugEnable
000d7c  e3500000          CMP      r0,#0                 ;399
000d80  0a000001          BEQ      |L1.3468|
000d84  e28f0c02          ADR      r0,|L1.3980|
000d88  ebfffffe          BL       sysprintf
                  |L1.3468|
000d8c  e3a03000          MOV      r3,#0                 ;401
000d90  e3e02000          MVN      r2,#0                 ;401
000d94  e1a01003          MOV      r1,r3                 ;401
000d98  e51f07e4          LDR      r0,|L1.1468|
000d9c  e5900000          LDR      r0,[r0,#0]            ;401  ; xRxTxSemaphore
000da0  ebfffffe          BL       xQueueGenericReceive
000da4  e51f07e0          LDR      r0,|L1.1484|
000da8  e5d00000          LDRB     r0,[r0,#0]            ;402  ; dataAgentDebugEnable
000dac  e3500000          CMP      r0,#0                 ;402
000db0  0a000001          BEQ      |L1.3516|
000db4  e28f0f7d          ADR      r0,|L1.4016|
000db8  ebfffffe          BL       sysprintf
                  |L1.3516|
000dbc  e3a04000          MOV      r4,#0                 ;404
000dc0  ea00004c          B        |L1.3832|
                  |L1.3524|
000dc4  e51f080c          LDR      r0,|L1.1472|
000dc8  e0000094          MUL      r0,r4,r0              ;406
000dcc  e51f1810          LDR      r1,|L1.1476|
000dd0  e0810100          ADD      r0,r1,r0,LSL #2       ;406
000dd4  e5d00001          LDRB     r0,[r0,#1]            ;406
000dd8  e3500000          CMP      r0,#0                 ;406
000ddc  1a000044          BNE      |L1.3828|
000de0  e3a00001          MOV      r0,#1                 ;408
000de4  e51f182c          LDR      r1,|L1.1472|
000de8  e0010194          MUL      r1,r4,r1              ;408
000dec  e51f2830          LDR      r2,|L1.1476|
000df0  e0821101          ADD      r1,r2,r1,LSL #2       ;408
000df4  e5c10001          STRB     r0,[r1,#1]            ;408
000df8  e3a00000          MOV      r0,#0                 ;409
000dfc  e51f1844          LDR      r1,|L1.1472|
000e00  e0010194          MUL      r1,r4,r1              ;409
000e04  e0821101          ADD      r1,r2,r1,LSL #2       ;409
000e08  e5810508          STR      r0,[r1,#0x508]        ;409
000e0c  e51f0854          LDR      r0,|L1.1472|
000e10  e0000094          MUL      r0,r4,r0              ;410
000e14  e2821000          ADD      r1,r2,#0              ;410
000e18  e7c17100          STRB     r7,[r1,r0,LSL #2]     ;410
000e1c  e51f0864          LDR      r0,|L1.1472|
000e20  e0000094          MUL      r0,r4,r0              ;411
000e24  e0810100          ADD      r0,r1,r0,LSL #2       ;411
000e28  e5808004          STR      r8,[r0,#4]            ;411
000e2c  e3560c05          CMP      r6,#0x500             ;412
000e30  aa00000c          BGE      |L1.3688|
000e34  e51f187c          LDR      r1,|L1.1472|
000e38  e0010194          MUL      r1,r4,r1              ;414
000e3c  e0821101          ADD      r1,r2,r1,LSL #2       ;414
000e40  e2810008          ADD      r0,r1,#8              ;414
000e44  e1a02006          MOV      r2,r6                 ;414
000e48  e1a01005          MOV      r1,r5                 ;414
000e4c  ebfffffe          BL       __aeabi_memcpy
000e50  e51f0898          LDR      r0,|L1.1472|
000e54  e0000094          MUL      r0,r4,r0              ;415
000e58  e51f189c          LDR      r1,|L1.1476|
000e5c  e0810100          ADD      r0,r1,r0,LSL #2       ;415
000e60  e1c060b2          STRH     r6,[r0,#2]            ;415
000e64  ea00000d          B        |L1.3744|
                  |L1.3688|
000e68  e51f18b0          LDR      r1,|L1.1472|
000e6c  e0010194          MUL      r1,r4,r1              ;419
000e70  e51f28b4          LDR      r2,|L1.1476|
000e74  e0821101          ADD      r1,r2,r1,LSL #2       ;419
000e78  e2810008          ADD      r0,r1,#8              ;419
000e7c  e3a02c05          MOV      r2,#0x500             ;419
000e80  e1a01005          MOV      r1,r5                 ;419
000e84  ebfffffe          BL       __aeabi_memcpy
000e88  e3a00c05          MOV      r0,#0x500             ;420
000e8c  e51f18d4          LDR      r1,|L1.1472|
000e90  e0010194          MUL      r1,r4,r1              ;420
000e94  e51f28d8          LDR      r2,|L1.1476|
000e98  e0821101          ADD      r1,r2,r1,LSL #2       ;420
000e9c  e1c100b2          STRH     r0,[r1,#2]            ;420
                  |L1.3744|
000ea0  e3a03000          MOV      r3,#0                 ;422
000ea4  e1a02003          MOV      r2,r3                 ;422
000ea8  e1a01003          MOV      r1,r3                 ;422
000eac  e51f0900          LDR      r0,|L1.1460|
000eb0  e5900000          LDR      r0,[r0,#0]            ;422  ; xDataAgentTxSemaphore
000eb4  ebfffffe          BL       xQueueGenericSend
000eb8  e51f08f4          LDR      r0,|L1.1484|
000ebc  e5d00000          LDRB     r0,[r0,#0]            ;424  ; dataAgentDebugEnable
000ec0  e3500000          CMP      r0,#0                 ;424
000ec4  0a000008          BEQ      |L1.3820|
000ec8  e1a0a005          MOV      r10,r5                ;426
000ecc  e5da0009          LDRB     r0,[r10,#9]           ;427
000ed0  e5da1008          LDRB     r1,[r10,#8]           ;427
000ed4  e1813400          ORR      r3,r1,r0,LSL #8       ;427
000ed8  e5da200a          LDRB     r2,[r10,#0xa]         ;427
000edc  e1a01004          MOV      r1,r4                 ;427
000ee0  e28f00e8          ADR      r0,|L1.4048|
000ee4  ebfffffe          BL       sysprintf
000ee8  e1a00000          MOV      r0,r0                 ;428
                  |L1.3820|
000eec  e3a09001          MOV      r9,#1                 ;430
000ef0  ea000002          B        |L1.3840|
                  |L1.3828|
000ef4  e2844001          ADD      r4,r4,#1              ;404
                  |L1.3832|
000ef8  e354000a          CMP      r4,#0xa               ;404
000efc  baffffb0          BLT      |L1.3524|
                  |L1.3840|
000f00  e1a00000          MOV      r0,r0                 ;431
000f04  e3590000          CMP      r9,#0                 ;434
000f08  1a000047          BNE      |L1.4140|
000f0c  e28f00f8          ADR      r0,|L1.4108|
000f10  ebfffffe          BL       sysprintf
000f14  ea000047          B        |L1.4152|
                  |L1.3864|
000f18  44617461          DCB      "DataAgentInit ERROR (swInit false)!!\n",0
000f1c  4167656e
000f20  74496e69
000f24  74204552
000f28  524f5220
000f2c  28737749
000f30  6e697420
000f34  66616c73
000f38  65292121
000f3c  0a00    
000f3e  00                DCB      0
000f3f  00                DCB      0
                  |L1.3904|
000f40  44617461          DCB      "DataAgentInit OK!!\n",0
000f44  4167656e
000f48  74496e69
000f4c  74204f4b
000f50  21210a00
                  |L1.3924|
000f54  44617461          DCB      "DataAgentAddData: ignore, (xRxTxSemaphore == NULL)...\r"
000f58  4167656e
000f5c  74416464
000f60  44617461
000f64  3a206967
000f68  6e6f7265
000f6c  2c202878
000f70  52785478
000f74  53656d61
000f78  70686f72
000f7c  65203d3d
000f80  204e554c
000f84  4c292e2e
000f88  2e0d    
000f8a  0a00              DCB      "\n",0
                  |L1.3980|
000f8c  44617461          DCB      "DataAgentAddData: Waitinging ...\r\n",0
000f90  4167656e
000f94  74416464
000f98  44617461
000f9c  3a205761
000fa0  6974696e
000fa4  67696e67
000fa8  202e2e2e
000fac  0d0a00  
000faf  00                DCB      0
                  |L1.4016|
000fb0  44617461          DCB      "DataAgentAddData: Going ...\r\n",0
000fb4  4167656e
000fb8  74416464
000fbc  44617461
000fc0  3a20476f
000fc4  696e6720
000fc8  2e2e2e0d
000fcc  0a00    
000fce  00                DCB      0
000fcf  00                DCB      0
                  |L1.4048|
000fd0  44617461          DCB      "DataAgentAddData[%d]: OK [cmdId = %d, cmdIndex = %d ].."
000fd4  4167656e
000fd8  74416464
000fdc  44617461
000fe0  5b25645d
000fe4  3a204f4b
000fe8  205b636d
000fec  64496420
000ff0  3d202564
000ff4  2c20636d
000ff8  64496e64
000ffc  6578203d
001000  20256420
001004  5d2e2e  
001007  2e0d0a00          DCB      ".\r\n",0
00100b  00                DCB      0
                  |L1.4108|
00100c  44617461          DCB      "DataAgentAddData: error...\r\n",0
001010  4167656e
001014  74416464
001018  44617461
00101c  3a206572
001020  726f722e
001024  2e2e0d0a
001028  00      
001029  00                DCB      0
00102a  00                DCB      0
00102b  00                DCB      0
                  |L1.4140|
00102c  e3a00000          MOV      r0,#0                 ;437
001030  e51f1a88          LDR      r1,|L1.1456|
001034  e5c10000          STRB     r0,[r1,#0]            ;437  ; dataAgentPowerStatus
                  |L1.4152|
001038  e3a03000          MOV      r3,#0                 ;439
00103c  e1a02003          MOV      r2,r3                 ;439
001040  e1a01003          MOV      r1,r3                 ;439
001044  e51f0a90          LDR      r0,|L1.1468|
001048  e5900000          LDR      r0,[r0,#0]            ;439  ; xRxTxSemaphore
00104c  ebfffffe          BL       xQueueGenericSend
001050  e1a00009          MOV      r0,r9                 ;440
001054  eaffff45          B        |L1.3440|
;;;442    BOOL DataAgentRemoveDataByAck(uint16_t cmdIndex)
                          ENDP

                  DataAgentRemoveDataByAck PROC
001058  e92d41f0          PUSH     {r4-r8,lr}
;;;443    {
00105c  e1a05000          MOV      r5,r0
;;;444        BOOL reVal = FALSE;
001060  e3a06000          MOV      r6,#0
;;;445        int i;
;;;446        xSemaphoreTake(xRxTxSemaphore, portMAX_DELAY);
001064  e3a03000          MOV      r3,#0
001068  e3e02000          MVN      r2,#0
00106c  e1a01003          MOV      r1,r3
001070  e51f0abc          LDR      r0,|L1.1468|
001074  e5900000          LDR      r0,[r0,#0]  ; xRxTxSemaphore
001078  ebfffffe          BL       xQueueGenericReceive
;;;447        for(i = 0; i<MAX_AGENT_BUFF_NUMBER; i++)
00107c  e3a04000          MOV      r4,#0
001080  ea000041          B        |L1.4492|
                  |L1.4228|
;;;448        {
;;;449            if((dataAgentTxBuff[i].useFlag == TRUE) && (dataAgentTxBuff[i].needAckFlag == TRUE))
001084  e51f0acc          LDR      r0,|L1.1472|
001088  e0000094          MUL      r0,r4,r0
00108c  e51f1ad0          LDR      r1,|L1.1476|
001090  e0810100          ADD      r0,r1,r0,LSL #2
001094  e5d00001          LDRB     r0,[r0,#1]
001098  e3500001          CMP      r0,#1
00109c  1a000039          BNE      |L1.4488|
0010a0  e51f0ae8          LDR      r0,|L1.1472|
0010a4  e0000094          MUL      r0,r4,r0
0010a8  e7d10100          LDRB     r0,[r1,r0,LSL #2]
0010ac  e3500001          CMP      r0,#1
0010b0  1a000034          BNE      |L1.4488|
;;;450            {
;;;451                CmdHeader* pCmdHeader = (CmdHeader*)dataAgentTxBuff[i].data;
0010b4  e51f0afc          LDR      r0,|L1.1472|
0010b8  e0000094          MUL      r0,r4,r0
0010bc  e0810100          ADD      r0,r1,r0,LSL #2
0010c0  e2807008          ADD      r7,r0,#8
;;;452                if(pCmdHeader->cmdIndex == cmdIndex)
0010c4  e5d70009          LDRB     r0,[r7,#9]
0010c8  e5d71008          LDRB     r1,[r7,#8]
0010cc  e1810400          ORR      r0,r1,r0,LSL #8
0010d0  e1500005          CMP      r0,r5
0010d4  1a00002a          BNE      |L1.4484|
;;;453                {
;;;454                    dataAgentTxBuff[i].useFlag = FALSE;
0010d8  e3a00000          MOV      r0,#0
0010dc  e51f1b24          LDR      r1,|L1.1472|
0010e0  e0010194          MUL      r1,r4,r1
0010e4  e51f2b28          LDR      r2,|L1.1476|
0010e8  e0821101          ADD      r1,r2,r1,LSL #2
0010ec  e5c10001          STRB     r0,[r1,#1]
;;;455                    dataAgentTxBuff[i].needAckFlag = FALSE;
0010f0  e51f1b38          LDR      r1,|L1.1472|
0010f4  e0010194          MUL      r1,r4,r1
0010f8  e7c20101          STRB     r0,[r2,r1,LSL #2]
;;;456                    dataAgentTxBuff[i].sendTimeTick = 0;
0010fc  e51f1b44          LDR      r1,|L1.1472|
001100  e0010194          MUL      r1,r4,r1
001104  e0821101          ADD      r1,r2,r1,LSL #2
001108  e5810508          STR      r0,[r1,#0x508]
;;;457                    memset(dataAgentTxBuff[i].data, 0x0, MAX_AGENT_DATA_SIZE);
00110c  e51f1b54          LDR      r1,|L1.1472|
001110  e0010194          MUL      r1,r4,r1
001114  e0821101          ADD      r1,r2,r1,LSL #2
001118  e2810008          ADD      r0,r1,#8
00111c  e3a01c05          MOV      r1,#0x500
001120  ebfffffe          BL       __aeabi_memclr4
;;;458                    
;;;459                    //#if(BUILD_DEBUG_VERSION)
;;;460                    if(dataAgentDebugEnable)
001124  e51f0b60          LDR      r0,|L1.1484|
001128  e5d00000          LDRB     r0,[r0,#0]  ; dataAgentDebugEnable
00112c  e3500000          CMP      r0,#0
001130  0a000003          BEQ      |L1.4420|
;;;461                        sysprintf(" -> DataAgentRemoveDataByAck[%d]: OK [index : %d ]...\r\n", i, cmdIndex);
001134  e1a02005          MOV      r2,r5
001138  e1a01004          MOV      r1,r4
00113c  e28f0e21          ADR      r0,|L1.4948|
001140  ebfffffe          BL       sysprintf
                  |L1.4420|
;;;462                    //#endif
;;;463                    
;;;464                    if(dataAgentTxBuff[i].callback != NULL)
001144  e51f0b8c          LDR      r0,|L1.1472|
001148  e0000094          MUL      r0,r4,r0
00114c  e51f1b90          LDR      r1,|L1.1476|
001150  e0810100          ADD      r0,r1,r0,LSL #2
001154  e5900004          LDR      r0,[r0,#4]
001158  e3500000          CMP      r0,#0
00115c  0a000006          BEQ      |L1.4476|
;;;465                    {
;;;466                        dataAgentTxBuff[i].callback(0);
001160  e51f0ba8          LDR      r0,|L1.1472|
001164  e0000094          MUL      r0,r4,r0
001168  e2812000          ADD      r2,r1,#0
00116c  e0820100          ADD      r0,r2,r0,LSL #2
001170  e5901004          LDR      r1,[r0,#4]
001174  e3a00000          MOV      r0,#0
001178  e12fff31          BLX      r1
                  |L1.4476|
;;;467                    }
;;;468                    reVal = TRUE;
00117c  e3a06001          MOV      r6,#1
;;;469                    break;
001180  ea000003          B        |L1.4500|
                  |L1.4484|
;;;470                }
;;;471                else
;;;472                {
;;;473                    //if(dataAgentDebugEnable)
;;;474                    //    sysprintf("DataAgentRemoveDataByAck[%d]: cmdIndex error [%d : %d] ...\r\n", i, pCmdHeader->cmdIndex, cmdIndex);
;;;475                }
;;;476                //return TRUE;
;;;477            }
001184  e1a00000          MOV      r0,r0
                  |L1.4488|
001188  e2844001          ADD      r4,r4,#1              ;447
                  |L1.4492|
00118c  e354000a          CMP      r4,#0xa               ;447
001190  baffffbb          BLT      |L1.4228|
                  |L1.4500|
001194  e1a00000          MOV      r0,r0                 ;469
;;;478        }  
;;;479        
;;;480        if(reVal == FALSE)    
001198  e3560000          CMP      r6,#0
00119c  1a000002          BNE      |L1.4524|
;;;481            sysprintf(" -> DataAgentRemoveDataByAck: ERROR [index : %d ]...\r\n", cmdIndex); 
0011a0  e1a01005          MOV      r1,r5
0011a4  e28f0e1e          ADR      r0,|L1.5004|
0011a8  ebfffffe          BL       sysprintf
                  |L1.4524|
;;;482        
;;;483        xSemaphoreGive(xRxTxSemaphore);
0011ac  e3a03000          MOV      r3,#0
0011b0  e1a02003          MOV      r2,r3
0011b4  e1a01003          MOV      r1,r3
0011b8  e51f0c04          LDR      r0,|L1.1468|
0011bc  e5900000          LDR      r0,[r0,#0]  ; xRxTxSemaphore
0011c0  ebfffffe          BL       xQueueGenericSend
;;;484        return reVal;
0011c4  e1a00006          MOV      r0,r6
;;;485    }
0011c8  e8bd81f0          POP      {r4-r8,pc}
;;;486    
                          ENDP

                  DataAgentSetDebugEnable PROC
;;;489    
;;;490    BOOL DataAgentSetDebugEnable(BOOL flag)
0011cc  e1a01000          MOV      r1,r0
;;;491    {
;;;492        dataAgentDebugEnable = flag;
0011d0  e51f0c0c          LDR      r0,|L1.1484|
0011d4  e5c01000          STRB     r1,[r0,#0]  ; dataAgentDebugEnable
;;;493        return dataAgentDebugEnable;
0011d8  e5d00000          LDRB     r0,[r0,#0]  ; dataAgentDebugEnable
;;;494    }
0011dc  e12fff1e          BX       lr
;;;495    #if(1)
                          ENDP

                  DataAgentStopFileTransfer PROC
;;;606    
;;;607    void DataAgentStopFileTransfer(void)
0011e0  e92d4010          PUSH     {r4,lr}
;;;608    {      
;;;609    //    FILINFO fno;
;;;610        sysprintf("DataAgentStopFileTransfer..\r\n"); 
0011e4  e28f0f76          ADR      r0,|L1.5060|
0011e8  ebfffffe          BL       sysprintf
;;;611        if(xRxTxSemaphore == NULL)
0011ec  e51f0c38          LDR      r0,|L1.1468|
0011f0  e5900000          LDR      r0,[r0,#0]  ; xRxTxSemaphore
0011f4  e3500000          CMP      r0,#0
0011f8  1a000002          BNE      |L1.4616|
;;;612        {
;;;613            sysprintf("DataAgentStopFileTransfer: ignore, (xRxTxSemaphore == NULL)...\r\n"); 
0011fc  e59f01e0          LDR      r0,|L1.5092|
001200  ebfffffe          BL       sysprintf
                  |L1.4612|
;;;614            return;
;;;615        }
;;;616        
;;;617        DataAgentRemoveDataByCmdId(CMD_FILE_FRANSFER_ID);
;;;618        DataAgentRemoveDataByCmdId(CMD_FILE_FRANSFER_DATA_ID);
;;;619        
;;;620        if(MyFileOpenFlag)
;;;621        {
;;;622            f_close(&MyFile);
;;;623            MyFileOpenFlag = FALSE;
;;;624            fileTransferStatus = FILE_TRANSFER_STATUS_IDLE;
;;;625            threadFileTransferWaitTime = portMAX_DELAY;
;;;626            xSemaphoreGive(xDataAgentFileTransferSemaphore);
;;;627        }   
;;;628    }
001204  e8bd8010          POP      {r4,pc}
                  |L1.4616|
001208  e3a00007          MOV      r0,#7                 ;617
00120c  ebfffffe          BL       DataAgentRemoveDataByCmdId
001210  e3a00008          MOV      r0,#8                 ;618
001214  ebfffffe          BL       DataAgentRemoveDataByCmdId
001218  e51f08e8          LDR      r0,|L1.2360|
00121c  e5d00000          LDRB     r0,[r0,#0]            ;620  ; MyFileOpenFlag
001220  e3500000          CMP      r0,#0                 ;620
001224  0a000010          BEQ      |L1.4716|
001228  e51f08f4          LDR      r0,|L1.2364|
00122c  ebfffffe          BL       f_close
001230  e3a00000          MOV      r0,#0                 ;623
001234  e51f1904          LDR      r1,|L1.2360|
001238  e5c10000          STRB     r0,[r1,#0]            ;623  ; MyFileOpenFlag
00123c  e3a00001          MOV      r0,#1                 ;624
001240  e51f18b8          LDR      r1,|L1.2448|
001244  e5c10000          STRB     r0,[r1,#0]            ;624  ; fileTransferStatus
001248  e3e00000          MVN      r0,#0                 ;625
00124c  e51f1850          LDR      r1,|L1.2564|
001250  e5810000          STR      r0,[r1,#0]            ;625  ; threadFileTransferWaitTime
001254  e3a03000          MOV      r3,#0                 ;626
001258  e1a02003          MOV      r2,r3                 ;626
00125c  e1a01003          MOV      r1,r3                 ;626
001260  e51f0888          LDR      r0,|L1.2528|
001264  e5900000          LDR      r0,[r0,#0]            ;626  ; xDataAgentFileTransferSemaphore
001268  ebfffffe          BL       xQueueGenericSend
                  |L1.4716|
00126c  e1a00000          MOV      r0,r0
001270  eaffffe3          B        |L1.4612|
;;;629    
                          ENDP

                  DataAgentStartFileTransfer PROC
;;;571    
;;;572    BOOL DataAgentStartFileTransfer(char* filename, char* targetFileName)
001274  e92d4070          PUSH     {r4-r6,lr}
;;;573    {      
001278  e1a05000          MOV      r5,r0
00127c  e1a06001          MOV      r6,r1
;;;574    //    FILINFO fno;
;;;575        if(xRxTxSemaphore == NULL)
001280  e51f0ccc          LDR      r0,|L1.1468|
001284  e5900000          LDR      r0,[r0,#0]  ; xRxTxSemaphore
001288  e3500000          CMP      r0,#0
00128c  1a000005          BNE      |L1.4776|
;;;576        {
;;;577            sysprintf("DataAgentStartFileTransfer: [%s][%s]: ignore, (xRxTxSemaphore == NULL)...\r\n", filename, targetFileName); 
001290  e1a02006          MOV      r2,r6
001294  e1a01005          MOV      r1,r5
001298  e59f0148          LDR      r0,|L1.5096|
00129c  ebfffffe          BL       sysprintf
;;;578            return FALSE;
0012a0  e3a00000          MOV      r0,#0
                  |L1.4772|
;;;579        }
;;;580        sysprintf("DataAgentStartFileTransfer: [%s][%s]..\r\n", filename, targetFileName); 
;;;581        
;;;582        DataAgentStopFileTransfer();
;;;583        
;;;584        FRESULT reval = f_open(&MyFile, filename, FA_READ);
;;;585        if(reval != FR_OK) 
;;;586        {
;;;587            sysprintf("Cannot Open %s file for reading...\r\n", filename); 
;;;588            return FALSE;
;;;589        }
;;;590        else
;;;591        {
;;;592            //if(f_stat(filename, &fno) == FR_OK)
;;;593            //{
;;;594                mFileTransferCurrentFileLen = MyFile.fsize;
;;;595            //}
;;;596            MyFileOpenFlag = TRUE;
;;;597            mFileTransferCurrentAddress = 0;
;;;598            mFileTransferCurrentDataLen = 0;
;;;599            
;;;600            fileTransferStatus = FILE_TRANSFER_STATUS_INIT;
;;;601            strcpy(targetFileNameTmp, targetFileName);
;;;602            xSemaphoreGive(xDataAgentFileTransferSemaphore);
;;;603            return TRUE;
;;;604        }
;;;605    }
0012a4  e8bd8070          POP      {r4-r6,pc}
                  |L1.4776|
0012a8  e1a02006          MOV      r2,r6                 ;580
0012ac  e1a01005          MOV      r1,r5                 ;580
0012b0  e28f0f4d          ADR      r0,|L1.5100|
0012b4  ebfffffe          BL       sysprintf
0012b8  ebfffffe          BL       DataAgentStopFileTransfer
0012bc  e3a02001          MOV      r2,#1                 ;584
0012c0  e1a01005          MOV      r1,r5                 ;584
0012c4  e51f0990          LDR      r0,|L1.2364|
0012c8  ebfffffe          BL       f_open
0012cc  e1a04000          MOV      r4,r0                 ;584
0012d0  e3540000          CMP      r4,#0                 ;585
0012d4  0a000004          BEQ      |L1.4844|
0012d8  e1a01005          MOV      r1,r5                 ;587
0012dc  e28f0f4d          ADR      r0,|L1.5144|
0012e0  ebfffffe          BL       sysprintf
0012e4  e3a00000          MOV      r0,#0                 ;588
0012e8  eaffffed          B        |L1.4772|
                  |L1.4844|
0012ec  e51f09b8          LDR      r0,|L1.2364|
0012f0  e1d000bc          LDRH     r0,[r0,#0xc]          ;594  ; MyFile
0012f4  e51f18c8          LDR      r1,|L1.2612|
0012f8  e1c100b0          STRH     r0,[r1,#0]            ;594  ; mFileTransferCurrentFileLen
0012fc  e3a00001          MOV      r0,#1                 ;596
001300  e51f19d0          LDR      r1,|L1.2360|
001304  e5c10000          STRB     r0,[r1,#0]            ;596  ; MyFileOpenFlag
001308  e3a00000          MOV      r0,#0                 ;597
00130c  e51f1940          LDR      r1,|L1.2516|
001310  e1c100b0          STRH     r0,[r1,#0]            ;597  ; mFileTransferCurrentAddress
001314  e51f1944          LDR      r1,|L1.2520|
001318  e1c100b0          STRH     r0,[r1,#0]            ;598  ; mFileTransferCurrentDataLen
00131c  e3a00002          MOV      r0,#2                 ;600
001320  e51f1998          LDR      r1,|L1.2448|
001324  e5c10000          STRB     r0,[r1,#0]            ;600  ; fileTransferStatus
001328  e1a01006          MOV      r1,r6                 ;601
00132c  e51f08fc          LDR      r0,|L1.2616|
001330  ebfffffe          BL       strcpy
001334  e3a03000          MOV      r3,#0                 ;602
001338  e1a02003          MOV      r2,r3                 ;602
00133c  e1a01003          MOV      r1,r3                 ;602
001340  e51f0968          LDR      r0,|L1.2528|
001344  e5900000          LDR      r0,[r0,#0]            ;602  ; xDataAgentFileTransferSemaphore
001348  ebfffffe          BL       xQueueGenericSend
00134c  e3a00001          MOV      r0,#1                 ;603
001350  eaffffd3          B        |L1.4772|
                  |L1.4948|
001354  202d3e20          DCB      " -> DataAgentRemoveDataByAck[%d]: OK [index : %d ]...\r"
001358  44617461
00135c  4167656e
001360  7452656d
001364  6f766544
001368  61746142
00136c  7941636b
001370  5b25645d
001374  3a204f4b
001378  205b696e
00137c  64657820
001380  3a202564
001384  205d2e2e
001388  2e0d    
00138a  0a00              DCB      "\n",0
                  |L1.5004|
00138c  202d3e20          DCB      " -> DataAgentRemoveDataByAck: ERROR [index : %d ]...\r\n"
001390  44617461
001394  4167656e
001398  7452656d
00139c  6f766544
0013a0  61746142
0013a4  7941636b
0013a8  3a204552
0013ac  524f5220
0013b0  5b696e64
0013b4  6578203a
0013b8  20256420
0013bc  5d2e2e2e
0013c0  0d0a    
0013c2  00                DCB      0
0013c3  00                DCB      0
                  |L1.5060|
0013c4  44617461          DCB      "DataAgentStopFileTransfer..\r\n",0
0013c8  4167656e
0013cc  7453746f
0013d0  7046696c
0013d4  65547261
0013d8  6e736665
0013dc  722e2e0d
0013e0  0a00    
0013e2  00                DCB      0
0013e3  00                DCB      0
                  |L1.5092|
                          DCD      ||.constdata||+0xf8
                  |L1.5096|
                          DCD      ||.constdata||+0x13c
                  |L1.5100|
0013ec  44617461          DCB      "DataAgentStartFileTransfer: [%s][%s]..\r\n",0
0013f0  4167656e
0013f4  74537461
0013f8  72744669
0013fc  6c655472
001400  616e7366
001404  65723a20
001408  5b25735d
00140c  5b25735d
001410  2e2e0d0a
001414  00      
001415  00                DCB      0
001416  00                DCB      0
001417  00                DCB      0
                  |L1.5144|
001418  43616e6e          DCB      "Cannot Open %s file for reading...\r\n",0
00141c  6f74204f
001420  70656e20
001424  25732066
001428  696c6520
00142c  666f7220
001430  72656164
001434  696e672e
001438  2e2e0d0a
00143c  00      
00143d  00                DCB      0
00143e  00                DCB      0
00143f  00                DCB      0
                          ENDP


                          AREA ||.bss||, DATA, NOINIT, ALIGN=2

                  dataAgentTxBuff
                          %        12920
                  RXBuff
                          %        1024
                  MyFile
                          %        4136
                  mFileTransferDataPara
                          %        1028
                  targetFileNameTmp
                          %        32

                          AREA ||.constdata||, DATA, READONLY, ALIGN=2

000000  203d3d3e          DCB      0x20,0x3d,0x3d,0x3e
000004  20676574          DCB      0x20,0x67,0x65,0x74
000008  44617461          DCB      0x44,0x61,0x74,0x61
00000c  5b25645d          DCB      0x5b,0x25,0x64,0x5d
000010  3a204f4b          DCB      0x3a,0x20,0x4f,0x4b
000014  205b636d          DCB      0x20,0x5b,0x63,0x6d
000018  64206964          DCB      0x64,0x20,0x69,0x64
00001c  203a2030          DCB      0x20,0x3a,0x20,0x30
000020  78253032          DCB      0x78,0x25,0x30,0x32
000024  782c2063          DCB      0x78,0x2c,0x20,0x63
000028  6d642069          DCB      0x6d,0x64,0x20,0x69
00002c  6e646578          DCB      0x6e,0x64,0x65,0x78
000030  203a2025          DCB      0x20,0x3a,0x20,0x25
000034  642c206c          DCB      0x64,0x2c,0x20,0x6c
000038  656e203d          DCB      0x65,0x6e,0x20,0x3d
00003c  20256420          DCB      0x20,0x25,0x64,0x20
000040  5d2c2072          DCB      0x5d,0x2c,0x20,0x72
000044  656d6f76          DCB      0x65,0x6d,0x6f,0x76
000048  65206672          DCB      0x65,0x20,0x66,0x72
00004c  6f6d2071          DCB      0x6f,0x6d,0x20,0x71
000050  75657565          DCB      0x75,0x65,0x75,0x65
000054  2e2e2e0d          DCB      0x2e,0x2e,0x2e,0x0d
000058  0a000000          DCB      0x0a,0x00,0x00,0x00
00005c  203d3d3e          DCB      0x20,0x3d,0x3d,0x3e
000060  20676574          DCB      0x20,0x67,0x65,0x74
000064  44617461          DCB      0x44,0x61,0x74,0x61
000068  5b25645d          DCB      0x5b,0x25,0x64,0x5d
00006c  3a204f4b          DCB      0x3a,0x20,0x4f,0x4b
000070  205b636d          DCB      0x20,0x5b,0x63,0x6d
000074  64206964          DCB      0x64,0x20,0x69,0x64
000078  203a2030          DCB      0x20,0x3a,0x20,0x30
00007c  78253032          DCB      0x78,0x25,0x30,0x32
000080  782c2063          DCB      0x78,0x2c,0x20,0x63
000084  6d642069          DCB      0x6d,0x64,0x20,0x69
000088  6e646578          DCB      0x6e,0x64,0x65,0x78
00008c  203a2025          DCB      0x20,0x3a,0x20,0x25
000090  642c206c          DCB      0x64,0x2c,0x20,0x6c
000094  656e203d          DCB      0x65,0x6e,0x20,0x3d
000098  20256420          DCB      0x20,0x25,0x64,0x20
00009c  5d2c206e          DCB      0x5d,0x2c,0x20,0x6e
0000a0  65656420          DCB      0x65,0x65,0x64,0x20
0000a4  41434b2e          DCB      0x41,0x43,0x4b,0x2e
0000a8  2e2e0d0a          DCB      0x2e,0x2e,0x0d,0x0a
0000ac  00000000          DCB      0x00,0x00,0x00,0x00
0000b0  203d3d3e          DCB      0x20,0x3d,0x3d,0x3e
0000b4  20676574          DCB      0x20,0x67,0x65,0x74
0000b8  44617461          DCB      0x44,0x61,0x74,0x61
0000bc  5b25645d          DCB      0x5b,0x25,0x64,0x5d
0000c0  3a205741          DCB      0x3a,0x20,0x57,0x41
0000c4  524e494e          DCB      0x52,0x4e,0x49,0x4e
0000c8  47206967          DCB      0x47,0x20,0x69,0x67
0000cc  6e6f7265          DCB      0x6e,0x6f,0x72,0x65
0000d0  205b636d          DCB      0x20,0x5b,0x63,0x6d
0000d4  64206964          DCB      0x64,0x20,0x69,0x64
0000d8  203a2030          DCB      0x20,0x3a,0x20,0x30
0000dc  78253032          DCB      0x78,0x25,0x30,0x32
0000e0  782c2063          DCB      0x78,0x2c,0x20,0x63
0000e4  6d642069          DCB      0x6d,0x64,0x20,0x69
0000e8  6e646578          DCB      0x6e,0x64,0x65,0x78
0000ec  203a2025          DCB      0x20,0x3a,0x20,0x25
0000f0  645d0d0a          DCB      0x64,0x5d,0x0d,0x0a
0000f4  00000000          DCB      0x00,0x00,0x00,0x00
0000f8  44617461          DCB      0x44,0x61,0x74,0x61
0000fc  4167656e          DCB      0x41,0x67,0x65,0x6e
000100  7453746f          DCB      0x74,0x53,0x74,0x6f
000104  7046696c          DCB      0x70,0x46,0x69,0x6c
000108  65547261          DCB      0x65,0x54,0x72,0x61
00010c  6e736665          DCB      0x6e,0x73,0x66,0x65
000110  723a2069          DCB      0x72,0x3a,0x20,0x69
000114  676e6f72          DCB      0x67,0x6e,0x6f,0x72
000118  652c2028          DCB      0x65,0x2c,0x20,0x28
00011c  78527854          DCB      0x78,0x52,0x78,0x54
000120  7853656d          DCB      0x78,0x53,0x65,0x6d
000124  6170686f          DCB      0x61,0x70,0x68,0x6f
000128  7265203d          DCB      0x72,0x65,0x20,0x3d
00012c  3d204e55          DCB      0x3d,0x20,0x4e,0x55
000130  4c4c292e          DCB      0x4c,0x4c,0x29,0x2e
000134  2e2e0d0a          DCB      0x2e,0x2e,0x0d,0x0a
000138  00000000          DCB      0x00,0x00,0x00,0x00
00013c  44617461          DCB      0x44,0x61,0x74,0x61
000140  4167656e          DCB      0x41,0x67,0x65,0x6e
000144  74537461          DCB      0x74,0x53,0x74,0x61
000148  72744669          DCB      0x72,0x74,0x46,0x69
00014c  6c655472          DCB      0x6c,0x65,0x54,0x72
000150  616e7366          DCB      0x61,0x6e,0x73,0x66
000154  65723a20          DCB      0x65,0x72,0x3a,0x20
000158  5b25735d          DCB      0x5b,0x25,0x73,0x5d
00015c  5b25735d          DCB      0x5b,0x25,0x73,0x5d
000160  3a206967          DCB      0x3a,0x20,0x69,0x67
000164  6e6f7265          DCB      0x6e,0x6f,0x72,0x65
000168  2c202878          DCB      0x2c,0x20,0x28,0x78
00016c  52785478          DCB      0x52,0x78,0x54,0x78
000170  53656d61          DCB      0x53,0x65,0x6d,0x61
000174  70686f72          DCB      0x70,0x68,0x6f,0x72
000178  65203d3d          DCB      0x65,0x20,0x3d,0x3d
00017c  204e554c          DCB      0x20,0x4e,0x55,0x4c
000180  4c292e2e          DCB      0x4c,0x29,0x2e,0x2e
000184  2e0d0a00          DCB      0x2e,0x0d,0x0a,0x00

                          AREA ||.conststring||, DATA, READONLY, MERGE=1, STRINGS, ALIGN=0

000000  205b4461          DCB      " [DataAgent] ",0
000004  74614167
000008  656e745d
00000c  2000    

                          AREA ||.data||, DATA, ALIGN=2

                  pCommunicationInterface
                          DCD      0x00000000
                  xRxTxSemaphore
                          DCD      0x00000000
                  threadFileTransferWaitTime
                          DCD      0xffffffff
                  threadRoutineWaitTime
                          DCD      0x0000ea60
                  threadTxWaitTime
                          DCD      0xffffffff
                  dataAgentPowerStatus
000014  01000000          DCB      0x01,0x00,0x00,0x00
                  dataAgentPowerCallabck
                          DCD      ||.conststring||
                          DCD      DataAgentPreOffCallback
                          DCD      DataAgentOffCallback
                          DCD      DataAgentOnCallback
                          DCD      DataAgentCheckStatus
                  dataAgentDebugEnable
00002c  00                DCB      0x00
                  fileTransferStatus
00002d  01                DCB      0x01
                  MyFileOpenFlag
00002e  0000              DCB      0x00,0x00
                  mFileTransferCurrentAddress
000030  0000              DCW      0x0000
                  mFileTransferCurrentDataLen
000032  0000              DCW      0x0000
                  mFileTransferCurrentFileLen
000034  0000              DCW      0x0000
000036  0000              DCB      0x00,0x00
                  xDataAgentRoutineSemaphore
                          DCD      0x00000000
                  xDataAgentFileTransferSemaphore
                          DCD      0x00000000
                  xDataAgentTxSemaphore
                          DCD      0x00000000
