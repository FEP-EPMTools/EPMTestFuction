; generated by ARM C/C++ Compiler, 5.03 [Build 76]
; commandline ArmCC [--c99 --list --debug -c --asm --interleave -o.\obj\flashdrv.o --asm_dir=.\lst\ --list_dir=.\lst\ --depend=.\obj\flashdrv.d --cpu=ARM926EJ-S --apcs=interwork -O0 -I.\src -I..\..\common\src\BSP\Driver\Include -I..\..\common\src\FreeRTOS -I..\..\common\src\FreeRTOS\Source\include -I..\..\common\src\FreeRTOS\Source\portable\RVDS\ARM926EJ-S -I..\..\common\src\BSP\ThirdParty\FATFS\src -I.\src\userdrv -I.\src\syshal -I.\src\user -I.\src\userdrv\vl53l0x\core\inc -I.\src\userdrv\vl53l0x\platform\inc -I.\src\syshal\json -I.\src\syshal\modemlib -I..\..\common\src\BSP\ThirdParty\yaffs2 -I..\..\common\src\BSP\ThirdParty\yaffs2\include -I..\..\common\src\BSP\ThirdParty\yaffs2\include\asm -I..\..\common\src\BSP\ThirdParty\yaffs2\include\linux -I.\src\syshal\yaffs2 -IC:\Keil\ARM\RV31\INC -IC:\Keil\ARM\CMSIS\Include -IC:\Keil\ARM\Inc\Toshiba -DCONFIG_YAFFS_DIRECT -DCONFIG_YAFFS_SHORT_NAMES_IN_RAM -DCONFIG_YAFFS_YAFFS2 -DNO_Y_INLINE -DCONFIG_YAFFS_PROVIDE_DEFS -DCONFIG_YAFFSFS_PROVIDE_VALUES --omf_browse=.\obj\flashdrv.crf src\userdrv\flashdrv.c]
                          ARM

                          AREA ||.text||, CODE, READONLY, ALIGN=2

                  SpiFlash_SectorErase PROC
;;;66     */
;;;67     static void SpiFlash_SectorErase(uint32_t StartAddress)
000000  e92d4010          PUSH     {r4,lr}
;;;68     {
000004  e1a04000          MOV      r4,r0
;;;69         // /CS: active
;;;70         pSpiInterface->activeCSFunc(TRUE);
000008  e59f05ec          LDR      r0,|L1.1532|
00000c  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000010  e590100c          LDR      r1,[r0,#0xc]
000014  e3a00001          MOV      r0,#1
000018  e12fff31          BLX      r1
;;;71     
;;;72         // send Command: 0x06, Write enable
;;;73         pSpiInterface->writeFunc(0, 0x06);
00001c  e59f05d8          LDR      r0,|L1.1532|
000020  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000024  e3a01006          MOV      r1,#6
000028  e5902004          LDR      r2,[r0,#4]
00002c  e3a00000          MOV      r0,#0
000030  e12fff32          BLX      r2
;;;74     
;;;75         // /CS: de-active
;;;76         pSpiInterface->activeCSFunc(FALSE);
000034  e59f05c0          LDR      r0,|L1.1532|
000038  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
00003c  e590100c          LDR      r1,[r0,#0xc]
000040  e3a00000          MOV      r0,#0
000044  e12fff31          BLX      r1
;;;77     
;;;78         //////////////////////////////////////////
;;;79     
;;;80         // /CS: active
;;;81         pSpiInterface->activeCSFunc(TRUE);
000048  e59f05ac          LDR      r0,|L1.1532|
00004c  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000050  e590100c          LDR      r1,[r0,#0xc]
000054  e3a00001          MOV      r0,#1
000058  e12fff31          BLX      r1
;;;82     
;;;83         // send Command: 0x20, Sector Erase
;;;84         pSpiInterface->writeFunc(0, 0x20);
00005c  e59f0598          LDR      r0,|L1.1532|
000060  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000064  e3a01020          MOV      r1,#0x20
000068  e5902004          LDR      r2,[r0,#4]
00006c  e3a00000          MOV      r0,#0
000070  e12fff32          BLX      r2
;;;85         
;;;86         
;;;87         // send 24-bit start address
;;;88         pSpiInterface->writeFunc(0, (StartAddress>>16) & 0xFF);
000074  e1a00404          LSL      r0,r4,#8
000078  e1a01c20          LSR      r1,r0,#24
00007c  e59f0578          LDR      r0,|L1.1532|
000080  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000084  e5902004          LDR      r2,[r0,#4]
000088  e3a00000          MOV      r0,#0
00008c  e12fff32          BLX      r2
;;;89     
;;;90         pSpiInterface->writeFunc(0, (StartAddress>>8) & 0xFF);
000090  e1a00804          LSL      r0,r4,#16
000094  e1a01c20          LSR      r1,r0,#24
000098  e59f055c          LDR      r0,|L1.1532|
00009c  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0000a0  e5902004          LDR      r2,[r0,#4]
0000a4  e3a00000          MOV      r0,#0
0000a8  e12fff32          BLX      r2
;;;91     
;;;92         pSpiInterface->writeFunc(0, StartAddress & 0xFF);
0000ac  e20410ff          AND      r1,r4,#0xff
0000b0  e59f0544          LDR      r0,|L1.1532|
0000b4  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0000b8  e5902004          LDR      r2,[r0,#4]
0000bc  e3a00000          MOV      r0,#0
0000c0  e12fff32          BLX      r2
;;;93     
;;;94         // /CS: de-active
;;;95         pSpiInterface->activeCSFunc(FALSE);
0000c4  e59f0530          LDR      r0,|L1.1532|
0000c8  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0000cc  e590100c          LDR      r1,[r0,#0xc]
0000d0  e3a00000          MOV      r0,#0
0000d4  e12fff31          BLX      r1
;;;96     }
0000d8  e8bd8010          POP      {r4,pc}
;;;97     
                          ENDP

                  SpiFlash_ReadStatusReg PROC
;;;98     static uint8_t SpiFlash_ReadStatusReg(void)
0000dc  e92d4010          PUSH     {r4,lr}
;;;99     {
;;;100        uint8_t u8Status;
;;;101    
;;;102        // /CS: active
;;;103        pSpiInterface->activeCSFunc(TRUE);
0000e0  e59f0514          LDR      r0,|L1.1532|
0000e4  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0000e8  e590100c          LDR      r1,[r0,#0xc]
0000ec  e3a00001          MOV      r0,#1
0000f0  e12fff31          BLX      r1
;;;104    
;;;105        // send Command: 0x05, Read status register
;;;106        pSpiInterface->writeFunc(0, 0x05);
0000f4  e59f0500          LDR      r0,|L1.1532|
0000f8  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0000fc  e3a01005          MOV      r1,#5
000100  e5902004          LDR      r2,[r0,#4]
000104  e3a00000          MOV      r0,#0
000108  e12fff32          BLX      r2
;;;107    
;;;108        // read status
;;;109        pSpiInterface->writeFunc(0, 0x00);
00010c  e59f04e8          LDR      r0,|L1.1532|
000110  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000114  e3a01000          MOV      r1,#0
000118  e5902004          LDR      r2,[r0,#4]
00011c  e1a00001          MOV      r0,r1
000120  e12fff32          BLX      r2
;;;110    
;;;111        u8Status = pSpiInterface->readFunc(0);
000124  e59f04d0          LDR      r0,|L1.1532|
000128  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
00012c  e5901008          LDR      r1,[r0,#8]
000130  e3a00000          MOV      r0,#0
000134  e12fff31          BLX      r1
000138  e20040ff          AND      r4,r0,#0xff
;;;112    
;;;113        // /CS: de-active
;;;114        pSpiInterface->activeCSFunc(FALSE);
00013c  e59f04b8          LDR      r0,|L1.1532|
000140  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000144  e590100c          LDR      r1,[r0,#0xc]
000148  e3a00000          MOV      r0,#0
00014c  e12fff31          BLX      r1
;;;115    
;;;116        return u8Status;
000150  e1a00004          MOV      r0,r4
;;;117    }
000154  e8bd8010          POP      {r4,pc}
;;;118    
                          ENDP

                  SpiFlash_WaitReady PROC
;;;119    static void SpiFlash_WaitReady(void)
000158  e92d4010          PUSH     {r4,lr}
;;;120    {
;;;121        uint8_t ReturnValue;
;;;122    
;;;123        do {
00015c  e1a00000          MOV      r0,r0
                  |L1.352|
;;;124            ReturnValue = SpiFlash_ReadStatusReg();
000160  ebfffffe          BL       SpiFlash_ReadStatusReg
000164  e1a04000          MOV      r4,r0
;;;125            ReturnValue = ReturnValue & 1;
000168  e2044001          AND      r4,r4,#1
;;;126        } while(ReturnValue!=0); // check the BUSY bit
00016c  e3540000          CMP      r4,#0
000170  1afffffa          BNE      |L1.352|
;;;127    }
000174  e8bd8010          POP      {r4,pc}
;;;128    
                          ENDP

                  SpiFlash_NormalPageProgram PROC
;;;129    static void SpiFlash_NormalPageProgram(uint32_t StartAddress, uint8_t *u8DataBuffer, int BuffLen)
000178  e92d41f0          PUSH     {r4-r8,lr}
;;;130    {
00017c  e1a04000          MOV      r4,r0
000180  e1a06001          MOV      r6,r1
000184  e1a07002          MOV      r7,r2
;;;131        uint32_t i = 0;
000188  e3a05000          MOV      r5,#0
;;;132    
;;;133        // /CS: active
;;;134        pSpiInterface->activeCSFunc(TRUE);
00018c  e59f0468          LDR      r0,|L1.1532|
000190  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000194  e590100c          LDR      r1,[r0,#0xc]
000198  e3a00001          MOV      r0,#1
00019c  e12fff31          BLX      r1
;;;135    
;;;136        // send Command: 0x06, Write enable
;;;137        pSpiInterface->writeFunc(0, 0x06);
0001a0  e59f0454          LDR      r0,|L1.1532|
0001a4  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0001a8  e3a01006          MOV      r1,#6
0001ac  e5902004          LDR      r2,[r0,#4]
0001b0  e3a00000          MOV      r0,#0
0001b4  e12fff32          BLX      r2
;;;138    
;;;139        // /CS: de-active
;;;140        pSpiInterface->activeCSFunc(FALSE);
0001b8  e59f043c          LDR      r0,|L1.1532|
0001bc  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0001c0  e590100c          LDR      r1,[r0,#0xc]
0001c4  e3a00000          MOV      r0,#0
0001c8  e12fff31          BLX      r1
;;;141    
;;;142    
;;;143        // /CS: active
;;;144        pSpiInterface->activeCSFunc(TRUE);
0001cc  e59f0428          LDR      r0,|L1.1532|
0001d0  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0001d4  e590100c          LDR      r1,[r0,#0xc]
0001d8  e3a00001          MOV      r0,#1
0001dc  e12fff31          BLX      r1
;;;145    
;;;146        // send Command: 0x02, Page program
;;;147        pSpiInterface->writeFunc(0, 0x02);
0001e0  e59f0414          LDR      r0,|L1.1532|
0001e4  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0001e8  e3a01002          MOV      r1,#2
0001ec  e5902004          LDR      r2,[r0,#4]
0001f0  e3a00000          MOV      r0,#0
0001f4  e12fff32          BLX      r2
;;;148    
;;;149        // send 24-bit start address
;;;150        pSpiInterface->writeFunc(0, (StartAddress>>16) & 0xFF);
0001f8  e1a00404          LSL      r0,r4,#8
0001fc  e1a01c20          LSR      r1,r0,#24
000200  e59f03f4          LDR      r0,|L1.1532|
000204  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000208  e5902004          LDR      r2,[r0,#4]
00020c  e3a00000          MOV      r0,#0
000210  e12fff32          BLX      r2
;;;151    
;;;152        pSpiInterface->writeFunc(0, (StartAddress>>8) & 0xFF);
000214  e1a00804          LSL      r0,r4,#16
000218  e1a01c20          LSR      r1,r0,#24
00021c  e59f03d8          LDR      r0,|L1.1532|
000220  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000224  e5902004          LDR      r2,[r0,#4]
000228  e3a00000          MOV      r0,#0
00022c  e12fff32          BLX      r2
;;;153    
;;;154        pSpiInterface->writeFunc(0, StartAddress & 0xFF);
000230  e20410ff          AND      r1,r4,#0xff
000234  e59f03c0          LDR      r0,|L1.1532|
000238  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
00023c  e5902004          LDR      r2,[r0,#4]
000240  e3a00000          MOV      r0,#0
000244  e12fff32          BLX      r2
;;;155    
;;;156        // write data
;;;157        for(i=0; i<BuffLen; i++) {
000248  e1a00000          MOV      r0,r0
00024c  ea000006          B        |L1.620|
                  |L1.592|
;;;158            pSpiInterface->writeFunc(0, u8DataBuffer[i]);
000250  e7d61005          LDRB     r1,[r6,r5]
000254  e59f03a0          LDR      r0,|L1.1532|
000258  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
00025c  e5902004          LDR      r2,[r0,#4]
000260  e3a00000          MOV      r0,#0
000264  e12fff32          BLX      r2
000268  e2855001          ADD      r5,r5,#1              ;157
                  |L1.620|
00026c  e1550007          CMP      r5,r7                 ;157
000270  3afffff6          BCC      |L1.592|
;;;159        }
;;;160    
;;;161        // /CS: de-active
;;;162        pSpiInterface->activeCSFunc(FALSE);
000274  e59f0380          LDR      r0,|L1.1532|
000278  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
00027c  e590100c          LDR      r1,[r0,#0xc]
000280  e3a00000          MOV      r0,#0
000284  e12fff31          BLX      r1
;;;163    }
000288  e8bd81f0          POP      {r4-r8,pc}
;;;164    
                          ENDP

                  SpiFlash_NormalRead PROC
;;;165    static void SpiFlash_NormalRead(uint32_t StartAddress, uint8_t *u8DataBuffer, int BuffLen)
00028c  e92d41f0          PUSH     {r4-r8,lr}
;;;166    {
000290  e1a04000          MOV      r4,r0
000294  e1a06001          MOV      r6,r1
000298  e1a07002          MOV      r7,r2
;;;167        uint32_t i;
;;;168    
;;;169        // /CS: active
;;;170        pSpiInterface->activeCSFunc(TRUE);
00029c  e59f0358          LDR      r0,|L1.1532|
0002a0  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0002a4  e590100c          LDR      r1,[r0,#0xc]
0002a8  e3a00001          MOV      r0,#1
0002ac  e12fff31          BLX      r1
;;;171    
;;;172        // send Command: 0x03, Read data
;;;173        pSpiInterface->writeFunc(0, 0x03);
0002b0  e59f0344          LDR      r0,|L1.1532|
0002b4  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0002b8  e3a01003          MOV      r1,#3
0002bc  e5902004          LDR      r2,[r0,#4]
0002c0  e3a00000          MOV      r0,#0
0002c4  e12fff32          BLX      r2
;;;174    
;;;175        // send 24-bit start address
;;;176        pSpiInterface->writeFunc(0, (StartAddress>>16) & 0xFF);
0002c8  e1a00404          LSL      r0,r4,#8
0002cc  e1a01c20          LSR      r1,r0,#24
0002d0  e59f0324          LDR      r0,|L1.1532|
0002d4  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0002d8  e5902004          LDR      r2,[r0,#4]
0002dc  e3a00000          MOV      r0,#0
0002e0  e12fff32          BLX      r2
;;;177    
;;;178        pSpiInterface->writeFunc(0, (StartAddress>>8) & 0xFF);
0002e4  e1a00804          LSL      r0,r4,#16
0002e8  e1a01c20          LSR      r1,r0,#24
0002ec  e59f0308          LDR      r0,|L1.1532|
0002f0  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0002f4  e5902004          LDR      r2,[r0,#4]
0002f8  e3a00000          MOV      r0,#0
0002fc  e12fff32          BLX      r2
;;;179    
;;;180        pSpiInterface->writeFunc(0, StartAddress & 0xFF);
000300  e20410ff          AND      r1,r4,#0xff
000304  e59f02f0          LDR      r0,|L1.1532|
000308  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
00030c  e5902004          LDR      r2,[r0,#4]
000310  e3a00000          MOV      r0,#0
000314  e12fff32          BLX      r2
;;;181    
;;;182        // read data
;;;183        for(i=0; i<BuffLen; i++) {
000318  e3a05000          MOV      r5,#0
00031c  ea00000c          B        |L1.852|
                  |L1.800|
;;;184            pSpiInterface->writeFunc(0, 0x00);
000320  e59f02d4          LDR      r0,|L1.1532|
000324  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000328  e3a01000          MOV      r1,#0
00032c  e5902004          LDR      r2,[r0,#4]
000330  e1a00001          MOV      r0,r1
000334  e12fff32          BLX      r2
;;;185            u8DataBuffer[i] = pSpiInterface->readFunc(0);
000338  e59f02bc          LDR      r0,|L1.1532|
00033c  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000340  e5901008          LDR      r1,[r0,#8]
000344  e3a00000          MOV      r0,#0
000348  e12fff31          BLX      r1
00034c  e7c60005          STRB     r0,[r6,r5]
000350  e2855001          ADD      r5,r5,#1              ;183
                  |L1.852|
000354  e1550007          CMP      r5,r7                 ;183
000358  3afffff0          BCC      |L1.800|
;;;186        }
;;;187        // /CS: de-active
;;;188        pSpiInterface->activeCSFunc(FALSE);
00035c  e59f0298          LDR      r0,|L1.1532|
000360  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000364  e590100c          LDR      r1,[r0,#0xc]
000368  e3a00000          MOV      r0,#0
00036c  e12fff31          BLX      r1
;;;189    }
000370  e8bd81f0          POP      {r4-r8,pc}
;;;190    
                          ENDP

                  SpiFlash_ReadMidDid PROC
;;;191    static uint16_t SpiFlash_ReadMidDid(void)
000374  e92d4008          PUSH     {r3,lr}
;;;192    {
;;;193        uint8_t u8RxData[2];
;;;194    
;;;195        // /CS: active
;;;196        pSpiInterface->activeCSFunc(TRUE);
000378  e59f027c          LDR      r0,|L1.1532|
00037c  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000380  e590100c          LDR      r1,[r0,#0xc]
000384  e3a00001          MOV      r0,#1
000388  e12fff31          BLX      r1
;;;197    
;;;198        // send Command: 0x90, Read Manufacturer/Device ID
;;;199        pSpiInterface->writeFunc(0, 0x90);
00038c  e59f0268          LDR      r0,|L1.1532|
000390  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000394  e3a01090          MOV      r1,#0x90
000398  e5902004          LDR      r2,[r0,#4]
00039c  e3a00000          MOV      r0,#0
0003a0  e12fff32          BLX      r2
;;;200    
;;;201        // send 24-bit '0', dummy
;;;202        pSpiInterface->writeFunc(0, 0x00);
0003a4  e59f0250          LDR      r0,|L1.1532|
0003a8  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0003ac  e3a01000          MOV      r1,#0
0003b0  e5902004          LDR      r2,[r0,#4]
0003b4  e1a00001          MOV      r0,r1
0003b8  e12fff32          BLX      r2
;;;203    
;;;204        pSpiInterface->writeFunc(0, 0x00);
0003bc  e59f0238          LDR      r0,|L1.1532|
0003c0  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0003c4  e3a01000          MOV      r1,#0
0003c8  e5902004          LDR      r2,[r0,#4]
0003cc  e1a00001          MOV      r0,r1
0003d0  e12fff32          BLX      r2
;;;205    
;;;206        pSpiInterface->writeFunc(0, 0x00);
0003d4  e59f0220          LDR      r0,|L1.1532|
0003d8  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0003dc  e3a01000          MOV      r1,#0
0003e0  e5902004          LDR      r2,[r0,#4]
0003e4  e1a00001          MOV      r0,r1
0003e8  e12fff32          BLX      r2
;;;207    
;;;208        // receive 16-bit
;;;209        pSpiInterface->writeFunc(0, 0x00);
0003ec  e59f0208          LDR      r0,|L1.1532|
0003f0  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0003f4  e3a01000          MOV      r1,#0
0003f8  e5902004          LDR      r2,[r0,#4]
0003fc  e1a00001          MOV      r0,r1
000400  e12fff32          BLX      r2
;;;210        u8RxData[0] = pSpiInterface->readFunc(0);
000404  e59f01f0          LDR      r0,|L1.1532|
000408  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
00040c  e5901008          LDR      r1,[r0,#8]
000410  e3a00000          MOV      r0,#0
000414  e12fff31          BLX      r1
000418  e5cd0000          STRB     r0,[sp,#0]
;;;211    
;;;212        pSpiInterface->writeFunc(0, 0x00);
00041c  e59f01d8          LDR      r0,|L1.1532|
000420  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000424  e3a01000          MOV      r1,#0
000428  e5902004          LDR      r2,[r0,#4]
00042c  e1a00001          MOV      r0,r1
000430  e12fff32          BLX      r2
;;;213        u8RxData[1] = pSpiInterface->readFunc(0);
000434  e59f01c0          LDR      r0,|L1.1532|
000438  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
00043c  e5901008          LDR      r1,[r0,#8]
000440  e3a00000          MOV      r0,#0
000444  e12fff31          BLX      r1
000448  e5cd0001          STRB     r0,[sp,#1]
;;;214    
;;;215        // /CS: de-active
;;;216        pSpiInterface->activeCSFunc(FALSE);
00044c  e59f01a8          LDR      r0,|L1.1532|
000450  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
000454  e590100c          LDR      r1,[r0,#0xc]
000458  e3a00000          MOV      r0,#0
00045c  e12fff31          BLX      r1
;;;217    
;;;218        return ( (u8RxData[0]<<8) | u8RxData[1] );
000460  e5dd0001          LDRB     r0,[sp,#1]
000464  e5dd1000          LDRB     r1,[sp,#0]
000468  e1800401          ORR      r0,r0,r1,LSL #8
;;;219    }
00046c  e8bd8008          POP      {r3,pc}
;;;220    
                          ENDP

                  hwInit PROC
;;;221    static BOOL hwInit(void)
000470  e3a00001          MOV      r0,#1
;;;222    {
;;;223    
;;;224        return TRUE;
;;;225    }
000474  e12fff1e          BX       lr
;;;226    static BOOL swInit(void)
                          ENDP

                  swInit PROC
000478  e92d4010          PUSH     {r4,lr}
;;;227    {   
;;;228        uint16_t u16ID;
;;;229        // check flash id
;;;230        if((u16ID = SpiFlash_ReadMidDid()) != 0xEF17) 
00047c  ebfffffe          BL       SpiFlash_ReadMidDid
000480  e1a04000          MOV      r4,r0
000484  e2401cef          SUB      r1,r0,#0xef00
000488  e2511017          SUBS     r1,r1,#0x17
00048c  0a000004          BEQ      |L1.1188|
;;;231        {
;;;232            sysprintf("Flash Wrong ID, 0x%x\n", u16ID);
000490  e1a01004          MOV      r1,r4
000494  e28f0f59          ADR      r0,|L1.1536|
000498  ebfffffe          BL       sysprintf
;;;233            return FALSE;
00049c  e3a00000          MOV      r0,#0
                  |L1.1184|
;;;234        } 
;;;235        else
;;;236        {
;;;237            sysprintf("Flash found: W25Q128BV ...\n");
;;;238            return TRUE;
;;;239        }
;;;240    }
0004a0  e8bd8010          POP      {r4,pc}
                  |L1.1188|
0004a4  e28f0f5b          ADR      r0,|L1.1560|
0004a8  ebfffffe          BL       sysprintf
0004ac  e3a00001          MOV      r0,#1                 ;238
0004b0  eafffffa          B        |L1.1184|
;;;241    
                          ENDP

                  FlashDrvInit PROC
;;;244    /*-----------------------------------------*/
;;;245    BOOL FlashDrvInit(void)
0004b4  e92d4010          PUSH     {r4,lr}
;;;246    {
;;;247        sysprintf("FlashDrvInit!!\n");
0004b8  e28f0f5d          ADR      r0,|L1.1588|
0004bc  ebfffffe          BL       sysprintf
;;;248        pSpiInterface = SpiGetInterface(FLASH_SPI);
0004c0  e3a00000          MOV      r0,#0
0004c4  ebfffffe          BL       SpiGetInterface
0004c8  e59f112c          LDR      r1,|L1.1532|
0004cc  e5810000          STR      r0,[r1,#0]  ; pSpiInterface
;;;249        if(pSpiInterface == NULL)
0004d0  e2810000          ADD      r0,r1,#0
0004d4  e5900000          LDR      r0,[r0,#0]  ; pSpiInterface
0004d8  e3500000          CMP      r0,#0
0004dc  1a000003          BNE      |L1.1264|
;;;250        {
;;;251            sysprintf("EpdInit ERROR (pSpiInterface == NULL)!!\n");
0004e0  e28f0f57          ADR      r0,|L1.1604|
0004e4  ebfffffe          BL       sysprintf
;;;252            return FALSE;
0004e8  e3a00000          MOV      r0,#0
                  |L1.1260|
;;;253        }
;;;254        if(pSpiInterface->initFunc() == FALSE)
;;;255        {
;;;256            sysprintf("EpdInit ERROR (initFunc false)!!\n");
;;;257            return FALSE;
;;;258        }
;;;259        if(hwInit() == FALSE)
;;;260        {
;;;261            sysprintf("FlashDrvInit ERROR (hwInit false)!!\n");
;;;262            return FALSE;
;;;263        }
;;;264        if(swInit() == FALSE)
;;;265        {
;;;266            sysprintf("FlashDrvInit ERROR (swInit false)!!\n");
;;;267            return FALSE;
;;;268        }
;;;269        return TRUE;
;;;270    }
0004ec  e8bd8010          POP      {r4,pc}
                  |L1.1264|
0004f0  e59f1104          LDR      r1,|L1.1532|
0004f4  e5911000          LDR      r1,[r1,#0]            ;254  ; pSpiInterface
0004f8  e5910000          LDR      r0,[r1,#0]            ;254
0004fc  e12fff30          BLX      r0                    ;254
000500  e3500000          CMP      r0,#0                 ;254
000504  1a000003          BNE      |L1.1304|
000508  e28f0e16          ADR      r0,|L1.1648|
00050c  ebfffffe          BL       sysprintf
000510  e3a00000          MOV      r0,#0                 ;257
000514  eafffff4          B        |L1.1260|
                  |L1.1304|
000518  ebfffffe          BL       hwInit
00051c  e3500000          CMP      r0,#0                 ;259
000520  1a000003          BNE      |L1.1332|
000524  e28f0f5a          ADR      r0,|L1.1684|
000528  ebfffffe          BL       sysprintf
00052c  e3a00000          MOV      r0,#0                 ;262
000530  eaffffed          B        |L1.1260|
                  |L1.1332|
000534  ebfffffe          BL       swInit
000538  e3500000          CMP      r0,#0                 ;264
00053c  1a000003          BNE      |L1.1360|
000540  e28f0f5d          ADR      r0,|L1.1724|
000544  ebfffffe          BL       sysprintf
000548  e3a00000          MOV      r0,#0                 ;267
00054c  eaffffe6          B        |L1.1260|
                  |L1.1360|
000550  e3a00001          MOV      r0,#1                 ;269
000554  eaffffe4          B        |L1.1260|
;;;271    
                          ENDP

                  FlashRead PROC
;;;272    BOOL FlashRead(uint8_t *u8DataBuffer, int BuffLen)
000558  e92d4070          PUSH     {r4-r6,lr}
;;;273    {
00055c  e1a06000          MOV      r6,r0
000560  e1a05001          MOV      r5,r1
;;;274        uint32_t i;
;;;275        memset(bufftemp, 0x0, sizeof(bufftemp));
000564  e3a01a01          MOV      r1,#0x1000
000568  e59f0174          LDR      r0,|L1.1764|
00056c  ebfffffe          BL       __aeabi_memclr
;;;276        SpiFlash_NormalRead(SPI_FLASH_START_ADDRESS, bufftemp, sizeof(bufftemp));
000570  e3a02a01          MOV      r2,#0x1000
000574  e59f1168          LDR      r1,|L1.1764|
000578  e3a0060f          MOV      r0,#0xf00000
00057c  ebfffffe          BL       SpiFlash_NormalRead
;;;277        for(i = 0; i< SPI_FLASH_SECTOR_SIZE; i = i + SPI_FLASH_PAGE_SIZE)
000580  e3a04000          MOV      r4,#0
000584  ea000080          B        |L1.1932|
                  |L1.1416|
;;;278        {
;;;279            sysprintf("FlashRead: check address 0x%08x [0x%02x, 0x%02x]... \r\n", i, bufftemp[i], bufftemp[i+1]); 
000588  e59f0154          LDR      r0,|L1.1764|
00058c  e2841001          ADD      r1,r4,#1
000590  e7d03001          LDRB     r3,[r0,r1]
000594  e7d02004          LDRB     r2,[r0,r4]
000598  e1a01004          MOV      r1,r4
00059c  e28f0f51          ADR      r0,|L1.1768|
0005a0  ebfffffe          BL       sysprintf
;;;280            if((bufftemp[i] == SPI_FLASH_DATA_HEADER) && (bufftemp[i+1] == SPI_FLASH_DATA_HEADER_2))
0005a4  e59f0138          LDR      r0,|L1.1764|
0005a8  e7d00004          LDRB     r0,[r0,r4]
0005ac  e350002a          CMP      r0,#0x2a
0005b0  1a000074          BNE      |L1.1928|
0005b4  e59f0128          LDR      r0,|L1.1764|
0005b8  e2841001          ADD      r1,r4,#1
0005bc  e7d00001          LDRB     r0,[r0,r1]
0005c0  e35000a2          CMP      r0,#0xa2
0005c4  1a00006f          BNE      |L1.1928|
;;;281            {
;;;282                if(BuffLen > (SPI_FLASH_PAGE_SIZE - 2))
0005c8  e35500fe          CMP      r5,#0xfe
0005cc  da000061          BLE      |L1.1880|
;;;283                {
;;;284                    sysprintf("FlashRead: get data at address 0x%08x [len = %d]... \r\n", i, SPI_FLASH_PAGE_SIZE - 2); 
0005d0  e3a020fe          MOV      r2,#0xfe
0005d4  e1a01004          MOV      r1,r4
0005d8  e28f0f50          ADD      r0,pc,#0x50, 30 ; #0x140
0005dc  ebfffffe          BL       sysprintf
;;;285                    memcpy(u8DataBuffer, (bufftemp+i+2), SPI_FLASH_PAGE_SIZE - 2);
0005e0  e59f00fc          LDR      r0,|L1.1764|
0005e4  e0800004          ADD      r0,r0,r4
0005e8  e2801002          ADD      r1,r0,#2
0005ec  e3a020fe          MOV      r2,#0xfe
0005f0  e1a00006          MOV      r0,r6
0005f4  ebfffffe          BL       __aeabi_memcpy
0005f8  ea000060          B        |L1.1920|
                  |L1.1532|
                          DCD      pSpiInterface
                  |L1.1536|
000600  466c6173          DCB      "Flash Wrong ID, 0x%x\n",0
000604  68205772
000608  6f6e6720
00060c  49442c20
000610  30782578
000614  0a00    
000616  00                DCB      0
000617  00                DCB      0
                  |L1.1560|
000618  466c6173          DCB      "Flash found: W25Q128BV ...\n",0
00061c  6820666f
000620  756e643a
000624  20573235
000628  51313238
00062c  4256202e
000630  2e2e0a00
                  |L1.1588|
000634  466c6173          DCB      "FlashDrvInit!!\n",0
000638  68447276
00063c  496e6974
000640  21210a00
                  |L1.1604|
000644  45706449          DCB      "EpdInit ERROR (pSpiInterface == NULL)!!\n",0
000648  6e697420
00064c  4552524f
000650  52202870
000654  53706949
000658  6e746572
00065c  66616365
000660  203d3d20
000664  4e554c4c
000668  2921210a
00066c  00      
00066d  00                DCB      0
00066e  00                DCB      0
00066f  00                DCB      0
                  |L1.1648|
000670  45706449          DCB      "EpdInit ERROR (initFunc false)!!\n",0
000674  6e697420
000678  4552524f
00067c  52202869
000680  6e697446
000684  756e6320
000688  66616c73
00068c  65292121
000690  0a00    
000692  00                DCB      0
000693  00                DCB      0
                  |L1.1684|
000694  466c6173          DCB      "FlashDrvInit ERROR (hwInit false)!!\n",0
000698  68447276
00069c  496e6974
0006a0  20455252
0006a4  4f522028
0006a8  6877496e
0006ac  69742066
0006b0  616c7365
0006b4  2921210a
0006b8  00      
0006b9  00                DCB      0
0006ba  00                DCB      0
0006bb  00                DCB      0
                  |L1.1724|
0006bc  466c6173          DCB      "FlashDrvInit ERROR (swInit false)!!\n",0
0006c0  68447276
0006c4  496e6974
0006c8  20455252
0006cc  4f522028
0006d0  7377496e
0006d4  69742066
0006d8  616c7365
0006dc  2921210a
0006e0  00      
0006e1  00                DCB      0
0006e2  00                DCB      0
0006e3  00                DCB      0
                  |L1.1764|
                          DCD      bufftemp
                  |L1.1768|
0006e8  466c6173          DCB      "FlashRead: check address 0x%08x [0x%02x, 0x%02x]... \r\n"
0006ec  68526561
0006f0  643a2063
0006f4  6865636b
0006f8  20616464
0006fc  72657373
000700  20307825
000704  30387820
000708  5b307825
00070c  3032782c
000710  20307825
000714  3032785d
000718  2e2e2e20
00071c  0d0a    
00071e  00                DCB      0
00071f  00                DCB      0
                  |L1.1824|
000720  466c6173          DCB      "FlashRead: get data at address 0x%08x [len = %d]... \r\n"
000724  68526561
000728  643a2067
00072c  65742064
000730  61746120
000734  61742061
000738  64647265
00073c  73732030
000740  78253038
000744  78205b6c
000748  656e203d
00074c  2025645d
000750  2e2e2e20
000754  0d0a    
000756  00                DCB      0
000757  00                DCB      0
                  |L1.1880|
;;;286                }
;;;287                else
;;;288                {
;;;289                    sysprintf("FlashRead: get data at address 0x%08x [len = %d]... \r\n", i, BuffLen); 
000758  e1a02005          MOV      r2,r5
00075c  e1a01004          MOV      r1,r4
000760  e24f0048          ADR      r0,|L1.1824|
000764  ebfffffe          BL       sysprintf
;;;290                    memcpy(u8DataBuffer, (bufftemp+i+2), BuffLen);
000768  e51f008c          LDR      r0,|L1.1764|
00076c  e0800004          ADD      r0,r0,r4
000770  e2801002          ADD      r1,r0,#2
000774  e1a02005          MOV      r2,r5
000778  e1a00006          MOV      r0,r6
00077c  ebfffffe          BL       __aeabi_memcpy
                  |L1.1920|
;;;291                }
;;;292                return TRUE;
000780  e3a00001          MOV      r0,#1
                  |L1.1924|
;;;293            }
;;;294        }
;;;295        sysprintf("FlashRead: cant get data, erase sector...\r\n"); 
;;;296        SpiFlash_SectorErase(SPI_FLASH_START_ADDRESS);
;;;297        //SpiFlash_ChipErase();
;;;298         /* Wait ready */
;;;299        SpiFlash_WaitReady();
;;;300        return FALSE;
;;;301    }
000784  e8bd8070          POP      {r4-r6,pc}
                  |L1.1928|
000788  e2844c01          ADD      r4,r4,#0x100          ;277
                  |L1.1932|
00078c  e3540a01          CMP      r4,#0x1000            ;277
000790  3affff7c          BCC      |L1.1416|
000794  e28f0f63          ADR      r0,|L1.2344|
000798  ebfffffe          BL       sysprintf
00079c  e3a0060f          MOV      r0,#0xf00000          ;296
0007a0  ebfffffe          BL       SpiFlash_SectorErase
0007a4  ebfffffe          BL       SpiFlash_WaitReady
0007a8  e3a00000          MOV      r0,#0                 ;300
0007ac  eafffff4          B        |L1.1924|
;;;302    BOOL FlashWrite(uint8_t *u8DataBuffer, int BuffLen)
                          ENDP

                  FlashWrite PROC
0007b0  e92d41f0          PUSH     {r4-r8,lr}
;;;303    {
0007b4  e24ddc02          SUB      sp,sp,#0x200
0007b8  e1a07000          MOV      r7,r0
0007bc  e1a05001          MOV      r5,r1
;;;304        BOOL reval = FALSE;
0007c0  e3a08000          MOV      r8,#0
;;;305        uint32_t i;
;;;306        int targetLen;
;;;307        uint8_t pageTemp[SPI_FLASH_PAGE_SIZE], targetPageTemp[SPI_FLASH_PAGE_SIZE];
;;;308        memset(bufftemp, 0x0, sizeof(bufftemp));
0007c4  e3a01a01          MOV      r1,#0x1000
0007c8  e51f00ec          LDR      r0,|L1.1764|
0007cc  ebfffffe          BL       __aeabi_memclr
;;;309        SpiFlash_NormalRead(SPI_FLASH_START_ADDRESS, bufftemp, sizeof(bufftemp));
0007d0  e3a02a01          MOV      r2,#0x1000
0007d4  e51f10f8          LDR      r1,|L1.1764|
0007d8  e3a0060f          MOV      r0,#0xf00000
0007dc  ebfffffe          BL       SpiFlash_NormalRead
;;;310        for(i = 0; i< SPI_FLASH_SECTOR_SIZE; i = i + SPI_FLASH_PAGE_SIZE)
0007e0  e3a04000          MOV      r4,#0
0007e4  ea000014          B        |L1.2108|
                  |L1.2024|
;;;311        {
;;;312            sysprintf("FlashWrite: check address 0x%08x [0x%02x, 0x%02x]... \r\n", i, bufftemp[i], bufftemp[i+1]); 
0007e8  e51f010c          LDR      r0,|L1.1764|
0007ec  e2841001          ADD      r1,r4,#1
0007f0  e7d03001          LDRB     r3,[r0,r1]
0007f4  e7d02004          LDRB     r2,[r0,r4]
0007f8  e1a01004          MOV      r1,r4
0007fc  e28f0e15          ADR      r0,|L1.2388|
000800  ebfffffe          BL       sysprintf
;;;313            if((bufftemp[i] == SPI_FLASH_DATA_HEADER) && (bufftemp[i+1] == SPI_FLASH_DATA_HEADER_2))
000804  e51f0128          LDR      r0,|L1.1764|
000808  e7d00004          LDRB     r0,[r0,r4]
00080c  e350002a          CMP      r0,#0x2a
000810  1a000008          BNE      |L1.2104|
000814  e51f0138          LDR      r0,|L1.1764|
000818  e2841001          ADD      r1,r4,#1
00081c  e7d00001          LDRB     r0,[r0,r1]
000820  e35000a2          CMP      r0,#0xa2
000824  1a000003          BNE      |L1.2104|
;;;314            {            
;;;315                sysprintf("FlashWrite: get data at address 0x%08x, break... \r\n", i);             
000828  e1a01004          MOV      r1,r4
00082c  e28f0f56          ADR      r0,|L1.2444|
000830  ebfffffe          BL       sysprintf
;;;316                break;
000834  ea000002          B        |L1.2116|
                  |L1.2104|
000838  e2844c01          ADD      r4,r4,#0x100          ;310
                  |L1.2108|
00083c  e3540a01          CMP      r4,#0x1000            ;310
000840  3affffe8          BCC      |L1.2024|
                  |L1.2116|
000844  e1a00000          MOV      r0,r0
;;;317            }
;;;318        }
;;;319        if(i >= SPI_FLASH_SECTOR_SIZE)
000848  e3540a01          CMP      r4,#0x1000
00084c  3a000004          BCC      |L1.2148|
;;;320        {//§ä¤£¨ìheader
;;;321            i = 0;//SPI_FLASH_PAGE_SIZE;
000850  e3a04000          MOV      r4,#0
;;;322            memset(targetPageTemp, 0x0, sizeof(targetPageTemp));
000854  e3a01c01          MOV      r1,#0x100
000858  e1a0000d          MOV      r0,sp
00085c  ebfffffe          BL       __aeabi_memclr4
000860  ea000004          B        |L1.2168|
                  |L1.2148|
;;;323        }
;;;324        else
;;;325        {
;;;326            memcpy(targetPageTemp, bufftemp+i, sizeof(targetPageTemp));
000864  e51f0188          LDR      r0,|L1.1764|
000868  e0801004          ADD      r1,r0,r4
00086c  e3a02c01          MOV      r2,#0x100
000870  e1a0000d          MOV      r0,sp
000874  ebfffffe          BL       __aeabi_memcpy
                  |L1.2168|
;;;327        }
;;;328        
;;;329        if(BuffLen > (SPI_FLASH_PAGE_SIZE - 2))
000878  e35500fe          CMP      r5,#0xfe
00087c  da000001          BLE      |L1.2184|
;;;330        {
;;;331            targetLen = SPI_FLASH_PAGE_SIZE - 2;
000880  e3a060fe          MOV      r6,#0xfe
000884  ea000000          B        |L1.2188|
                  |L1.2184|
;;;332        }
;;;333        else
;;;334        {
;;;335            targetLen = BuffLen;
000888  e1a06005          MOV      r6,r5
                  |L1.2188|
;;;336        }
;;;337        targetPageTemp[0] = SPI_FLASH_DATA_HEADER;
00088c  e3a0002a          MOV      r0,#0x2a
000890  e5cd0000          STRB     r0,[sp,#0]
;;;338        targetPageTemp[1] = SPI_FLASH_DATA_HEADER_2;
000894  e3a000a2          MOV      r0,#0xa2
000898  e5cd0001          STRB     r0,[sp,#1]
;;;339        memcpy((targetPageTemp+2), u8DataBuffer, targetLen);
00089c  e1a02006          MOV      r2,r6
0008a0  e1a01007          MOV      r1,r7
0008a4  e28d0002          ADD      r0,sp,#2
0008a8  ebfffffe          BL       __aeabi_memcpy
;;;340        /*
;;;341        {
;;;342            int j;
;;;343            for(j = 0; j<10; j++)
;;;344            {
;;;345                sysprintf("FlashWrite:dump page [%02d]: 0x%02x...\r\n", j, u8DataBuffer[j]); 
;;;346            }
;;;347        }
;;;348        */
;;;349        while( i < SPI_FLASH_SECTOR_SIZE)
0008ac  ea00006d          B        |L1.2664|
                  |L1.2224|
;;;350        {
;;;351            sysprintf("FlashWrite: write data at address 0x%08x [len = %d]... \r\n", SPI_FLASH_START_ADDRESS + i, targetLen);     
0008b0  e284160f          ADD      r1,r4,#0xf00000
0008b4  e1a02006          MOV      r2,r6
0008b8  e28f0c01          ADR      r0,|L1.2496|
0008bc  ebfffffe          BL       sysprintf
;;;352            
;;;353            sysprintf("FlashWrite:erase sector...\r\n"); 
0008c0  e28f0f4d          ADR      r0,|L1.2556|
0008c4  ebfffffe          BL       sysprintf
;;;354            SpiFlash_SectorErase(SPI_FLASH_START_ADDRESS);
0008c8  e3a0060f          MOV      r0,#0xf00000
0008cc  ebfffffe          BL       SpiFlash_SectorErase
;;;355            //SpiFlash_ChipErase();
;;;356             /* Wait ready */
;;;357            SpiFlash_WaitReady();
0008d0  ebfffffe          BL       SpiFlash_WaitReady
;;;358            sysprintf("FlashWrite:write page...\r\n"); 
0008d4  e28f0d05          ADR      r0,|L1.2588|
0008d8  ebfffffe          BL       sysprintf
;;;359            /*
;;;360            {
;;;361                int j;
;;;362                for(j = 0; j<10; j++)
;;;363                {
;;;364                    sysprintf("FlashWrite:dump2 page [%02d]: 0x%02x...\r\n", j, targetPageTemp[j]); 
;;;365                }
;;;366            }
;;;367            */
;;;368            SpiFlash_NormalPageProgram(SPI_FLASH_START_ADDRESS + i, targetPageTemp, SPI_FLASH_PAGE_SIZE);  
0008dc  e284060f          ADD      r0,r4,#0xf00000
0008e0  e3a02c01          MOV      r2,#0x100
0008e4  e1a0100d          MOV      r1,sp
0008e8  ebfffffe          BL       SpiFlash_NormalPageProgram
;;;369             /* Wait ready */
;;;370            SpiFlash_WaitReady();
0008ec  ebfffffe          BL       SpiFlash_WaitReady
;;;371            SpiFlash_NormalRead(SPI_FLASH_START_ADDRESS + i, pageTemp, SPI_FLASH_PAGE_SIZE);
0008f0  e284060f          ADD      r0,r4,#0xf00000
0008f4  e3a02c01          MOV      r2,#0x100
0008f8  e28d1c01          ADD      r1,sp,#0x100
0008fc  ebfffffe          BL       SpiFlash_NormalRead
;;;372            if(memcmp(targetPageTemp, pageTemp, SPI_FLASH_PAGE_SIZE) == 0)
000900  e3a02c01          MOV      r2,#0x100
000904  e28d1c01          ADD      r1,sp,#0x100
000908  e1a0000d          MOV      r0,sp
00090c  ebfffffe          BL       memcmp
000910  e3500000          CMP      r0,#0
000914  1a000050          BNE      |L1.2652|
;;;373            {
;;;374                sysprintf("FlashWrite: compare OK...break...\r\n"); 
000918  e28f0f46          ADR      r0,|L1.2616|
00091c  ebfffffe          BL       sysprintf
;;;375                reval = TRUE;
000920  e3a08001          MOV      r8,#1
;;;376                break;
000924  ea000051          B        |L1.2672|
                  |L1.2344|
000928  466c6173          DCB      "FlashRead: cant get data, erase sector...\r\n",0
00092c  68526561
000930  643a2063
000934  616e7420
000938  67657420
00093c  64617461
000940  2c206572
000944  61736520
000948  73656374
00094c  6f722e2e
000950  2e0d0a00
                  |L1.2388|
000954  466c6173          DCB      "FlashWrite: check address 0x%08x [0x%02x, 0x%02x]... \r"
000958  68577269
00095c  74653a20
000960  63686563
000964  6b206164
000968  64726573
00096c  73203078
000970  25303878
000974  205b3078
000978  25303278
00097c  2c203078
000980  25303278
000984  5d2e2e2e
000988  200d    
00098a  0a00              DCB      "\n",0
                  |L1.2444|
00098c  466c6173          DCB      "FlashWrite: get data at address 0x%08x, break... \r\n",0
000990  68577269
000994  74653a20
000998  67657420
00099c  64617461
0009a0  20617420
0009a4  61646472
0009a8  65737320
0009ac  30782530
0009b0  38782c20
0009b4  62726561
0009b8  6b2e2e2e
0009bc  200d0a00
                  |L1.2496|
0009c0  466c6173          DCB      "FlashWrite: write data at address 0x%08x [len = %d]... "
0009c4  68577269
0009c8  74653a20
0009cc  77726974
0009d0  65206461
0009d4  74612061
0009d8  74206164
0009dc  64726573
0009e0  73203078
0009e4  25303878
0009e8  205b6c65
0009ec  6e203d20
0009f0  25645d2e
0009f4  2e2e20  
0009f7  0d0a00            DCB      "\r\n",0
0009fa  00                DCB      0
0009fb  00                DCB      0
                  |L1.2556|
0009fc  466c6173          DCB      "FlashWrite:erase sector...\r\n",0
000a00  68577269
000a04  74653a65
000a08  72617365
000a0c  20736563
000a10  746f722e
000a14  2e2e0d0a
000a18  00      
000a19  00                DCB      0
000a1a  00                DCB      0
000a1b  00                DCB      0
                  |L1.2588|
000a1c  466c6173          DCB      "FlashWrite:write page...\r\n",0
000a20  68577269
000a24  74653a77
000a28  72697465
000a2c  20706167
000a30  652e2e2e
000a34  0d0a00  
000a37  00                DCB      0
                  |L1.2616|
000a38  466c6173          DCB      "FlashWrite: compare OK...break...\r\n",0
000a3c  68577269
000a40  74653a20
000a44  636f6d70
000a48  61726520
000a4c  4f4b2e2e
000a50  2e627265
000a54  616b2e2e
000a58  2e0d0a00
                  |L1.2652|
;;;377                //i = i + SPI_FLASH_PAGE_SIZE;
;;;378            }
;;;379            else
;;;380            {
;;;381                sysprintf("FlashWrite: compare error...\r\n"); 
000a5c  e28f001c          ADR      r0,|L1.2688|
000a60  ebfffffe          BL       sysprintf
;;;382                i = i + SPI_FLASH_PAGE_SIZE;
000a64  e2844c01          ADD      r4,r4,#0x100
                  |L1.2664|
000a68  e3540a01          CMP      r4,#0x1000            ;349
000a6c  3affff8f          BCC      |L1.2224|
                  |L1.2672|
000a70  e1a00000          MOV      r0,r0                 ;376
;;;383            }
;;;384        }
;;;385        
;;;386        return reval;
000a74  e1a00008          MOV      r0,r8
000a78  e28ddc02          ADD      sp,sp,#0x200
;;;387    }
000a7c  e8bd81f0          POP      {r4-r8,pc}
;;;388    
                          ENDP

                  |L1.2688|
000a80  466c6173          DCB      "FlashWrite: compare error...\r\n",0
000a84  68577269
000a88  74653a20
000a8c  636f6d70
000a90  61726520
000a94  6572726f
000a98  722e2e2e
000a9c  0d0a00  
000a9f  00                DCB      0

                          AREA ||.bss||, DATA, NOINIT, ALIGN=0

                  bufftemp
                          %        4096

                          AREA ||.data||, DATA, ALIGN=2

                  pSpiInterface
                          DCD      0x00000000
